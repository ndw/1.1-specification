<?xml version="1.0" encoding="UTF-8"?><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><!--Generated by the DeltaXML.com xhtml-outfilter.xsl--><!--Using XSL Processor: Saxonica--><title>XProc 3.0: Standard Step Library</title><meta charset="utf-8" /><link rel="alternate" title="XML" href="specification.xml" /><link rel="alternate" title="Latest editor's draft" href="http://www.w3.org/XML/XProc/docs/langspec.html" /><link rel="alternate" title="Latest Public Working Draft" href="http://www.w3.org/TR/xproc/" /><meta name="generator" content="DocBook XSL 2.0 Stylesheets V2.3.9" /><meta name="description" content="Abstract This specification describes the standard step vocabulary of&#xA;  XProc 3.0: An XML Pipeline Language." /><link href="css/prism.css" rel="stylesheet" type="text/css" /><link href="css/db-prism.css" rel="stylesheet" type="text/css" /><link rel="stylesheet" type="text/css" href="css/base.css" /><link rel="stylesheet" type="text/css" href="css/xproc.css" /><link rel="stylesheet" type="text/css" href="css/base.css" /><link rel="stylesheet" type="text/css" href="css/print.css" media="print" /><script type="text/javascript" src="js/dbmodnizr.js"></script><style type="text/css">
          body { margin-top: 50px }
          a.button { background: #DDD; border: 2px outset black; padding: 2px; margin: 2px; font-family: sans-serif; font-size: small;}
          a.button:hover { cursor:pointer; }
          a.button:active { border-style: inset; }
        </style><script type="text/javascript">
            function view(doc) {
              var allSpans=document.getElementsByTagName("*");
              if(doc=="old") {
                for(i=0;i!=allSpans.length;i++) {
                  var displayType= "inline";
                  if (allSpans[i].localName == "tr") {
                    displayType= "table-row";
                  } else if (allSpans[i].localName == "li") {
                    displayType= "list-item";
                  }
                  var name=allSpans[i].className;
                  if(name=="deltaxml-new" || name=="deltaxml-new-img" || name=="deltaxml-new-format" || name=="add_version" || name=="modify_version") {
                    allSpans[i].style.display="none";
                  } else if (name=="deltaxml-old" || name=="deltaxml-old-img" || name=="deltaxml-old-format" || name=="delete_version") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#FFF";
                    //need to take border off images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="none";
                    }
                  }
                }
              } else if(doc=="new") {
                for(i=0;i!=allSpans.length;i++) {
                  var displayType= "inline";
                  if (allSpans[i].localName == "tr") {
                    displayType= "table-row";
                  } else if (allSpans[i].localName == "li") {
                    displayType= "list-item";
                  }
                  var name=allSpans[i].className;
                  if(name=="deltaxml-new" || name=="deltaxml-new-img" || name=="deltaxml-new-format" || name=="add_version") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#FFF";
                    //need to take border off images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="none";
                    }
                  } else if (name=="deltaxml-old" || name=="deltaxml-old-img" || name=="deltaxml-old-format" || name=="delete_version" || name=="modify_version") {
                    allSpans[i].style.display="none";
                   }
                }
              } else if(doc=="both") {
                for(i=0;i!=allSpans.length;i++) {
                  var displayType= "inline";
                  if (allSpans[i].localName == "tr") {
                    displayType= "table-row";
                  } else if (allSpans[i].localName == "li") {
                    displayType= "list-item";
                  }
                  var name=allSpans[i].className;
                  if(name=="deltaxml-new" || name=="deltaxml-new-format" || name=="deltaxml-new-img") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#90EE90";
                    //need to add border to images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="2px solid green";
                    }
                  } else if(name=="deltaxml-old" || name=="deltaxml-old-format" || name=="deltaxml-old-img") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#FF5555";
                    //need to add border to images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="2px solid red";
                    }
                  } else if (name=="add_version" || name=="delete_version") {
                    allSpans[i].style.display="none";
                  } else if (name=="modify_version") {
                    allSpans[i].style.display= displayType;
                  }
                }
              }
            }
  
        </script></head><body><div style="position:fixed; clear:both; top:0px"><p><a class="button" onclick="view('old')">
              View Old
            </a><a class="button" onclick="view('new')">
              View New
            </a><a class="button" onclick="view('both')">
              View Both
            </a></p></div><article class="specification"><div class="head" id="spec.head"><h1>XProc 3.0: Standard Step Library</h1><h2>Editor's Draft <time datetime="2019-06-21T20:04:44Z">21 June 2019 at <span class="deltaxml-old" style="background:#FF5555">14</span><span class="deltaxml-new" style="background:#90EE90">20</span>:04 UTC (<a href="https://github.com/ndw/steps/commit/c6182784ded70dca7b49a0812617a583ec2d94a7">build <span class="deltaxml-old" style="background:#FF5555">103</span><span class="deltaxml-new" style="background:#90EE90">24</span></a>)</time></h2><dl><dt>This Version:</dt><dd><a href="https://ndw.github.io/steps/iss-138/head/steps/">https://<span class="deltaxml-old" style="background:#FF5555">xproc.github.io/3.0-steps/master</span><span class="deltaxml-new" style="background:#90EE90">ndw.github.io/steps/iss-138</span>/head/steps/</a></dd><dt>Latest Version:</dt><dd><a href="http://spec.xproc.org/master/head/steps/">http://spec.xproc.org/master/head/steps/</a></dd><dt>Editors:</dt><dd><span class="personname">Norman Walsh</span></dd><dd><span class="personname">Achim Berndzen</span></dd><dd><span class="personname">Gerrit Imsieke</span></dd><dd><span class="personname">Erik Siegel</span></dd><dt>Repository:</dt><dd><a href="http://github.com/ndw/steps">This specification on GitHub</a></dd><dd><a href="http://github.com/xproc/3.0-specification/issues">Report an issue</a></dd><dt>Changes:</dt><dd><a href="diff.html">Diff against current “status quo” draft</a></dd><dd><a href="http://github.com/ndw/steps/commits/iss-138">Commits for this specification</a></dd></dl><p>This document is also available in these non-normative formats: <a href="specification.xml">XML</a>, automatic <a href="diff.html">change markup</a> from the previous draft courtesy of <a href="http://www.deltaxml.com/">DeltaXML</a>.</p><p class="copyright"><span class="copyright">Copyright © <span class="years">2018</span> <span class="holders"><span class="holder">@@FIXME:</span></span></span></p><hr /><div class="abstract"><h2>Abstract</h2><p>This specification describes the standard step vocabulary of <em class="citetitle">XProc 3.0: An XML Pipeline Language</em>.</p></div><div class="status"><h2>Status of this Document</h2><p><strong>This document is an editor's draft that has no official standing.</strong></p><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document.</em></p><p>This document is derived from <a href="https://www.w3.org/TR/2010/REC-xproc-20100511/">XProc: An XML Pipeline Language</a> published by the W3C.</p></div></div><hr /><div class="lists-of-titles"><div class="toc"><h2 id="TableOfContents">Table of Contents</h2><ul class="toc"><li><span>1 <a href="#introduction">Introduction</a></span></li><li><span>2 <a href="#req-steps">The required steps</a></span><ul class="toc"><li><span>2.1 <a href="#c.add-attribute">p:add-attribute</a></span></li><li><span>2.2 <a href="#c.add-xml-base">p:add-xml-base</a></span></li><li><span>2.3 <a href="#c.archive">p:archive</a></span><ul class="toc"><li><span>2.3.1 <a href="#cv.archive-manifest">The archive manifest</a></span></li><li><span>2.3.2 <a href="#cv.archive-zips">Handling of ZIP archives</a></span></li></ul></li><li><span>2.4 <a href="#c.archive-manifest">p:archive-manifest</a></span></li><li><span>2.5 <a href="#c.cast-content-type">p:cast-content-type</a></span></li><li><span>2.6 <a href="#c.compare">p:compare</a></span></li><li><span>2.7 <a href="#c.count">p:count</a></span></li><li><span>2.8 <a href="#c.delete">p:delete</a></span></li><li><span>2.9 <a href="#c.directory-list">p:directory-list</a></span><ul class="toc"><li><span>2.9.1 <a href="#dir-list-details">Directory list details</a></span></li></ul></li><li><span>2.10 <a href="#c.error">p:error</a></span></li><li><span>2.11 <a href="#c.escape-markup">p:escape-markup</a></span></li><li><span>2.12 <a href="#c.filter">p:filter</a></span></li><li><span>2.13 <a href="#c.hash">p:hash</a></span></li><li><span>2.14 <a href="#c.http-request">p:http-request</a></span><ul class="toc"><li><span>2.14.1 <a href="#cv.request">Specifying a request</a></span></li><li><span>2.14.2 <a href="#c.request_body">Request Entity body conversion</a></span></li><li><span>2.14.3 <a href="#c.request_response">Managing the response</a></span></li><li><span>2.14.4 <a href="#c.response_body">Converting Response Entity Bodies</a></span></li><li><span>2.14.5 <a href="#example-http-request">HTTP Request Example</a></span></li></ul></li><li><span>2.15 <a href="#c.identity">p:identity</a></span></li><li><span>2.16 <a href="#c.insert">p:insert</a></span></li><li><span>2.17 <a href="#c.label-elements">p:label-elements</a></span></li><li><span>2.18 <a href="#c.load">p:load</a></span><ul class="toc"><li><span>2.18.1 <a href="#c.load.xml">Loading XML data</a></span></li><li><span>2.18.2 <a href="#c.load.text">Loading text data</a></span></li><li><span>2.18.3 <a href="#c.load.json">Loading JSON data</a></span></li><li><span>2.18.4 <a href="#c.load.html">Loading HTML data</a></span></li><li><span>2.18.5 <a href="#c.load.binary">Loading binary data</a></span></li></ul></li><li><span>2.19 <a href="#c.make-absolute-uris">p:make-absolute-uris</a></span></li><li><span>2.20 <a href="#c.namespace-rename">p:namespace-rename</a></span></li><li><span>2.21 <a href="#c.pack">p:pack</a></span></li><li><span>2.22 <a href="#c.rename">p:rename</a></span></li><li><span>2.23 <a href="#c.replace">p:replace</a></span></li><li><span>2.24 <a href="#c.set-attributes">p:set-attributes</a></span></li><li><span>2.25 <a href="#c.set-properties">p:set-properties</a></span></li><li><span>2.26 <a href="#c.sink">p:sink</a></span></li><li><span>2.27 <a href="#c.split-sequence">p:split-sequence</a></span></li><li><span>2.28 <a href="#c.store">p:store</a></span></li><li><span>2.29 <a href="#c.string-replace">p:string-replace</a></span></li><li><span>2.30 <a href="#c.text-count">p:text-count</a></span></li><li><span>2.31 <a href="#c.text-head">p:text-head</a></span></li><li><span>2.32 <a href="#c.text-join">p:text-join</a></span></li><li><span>2.33 <a href="#c.text-replace">p:text-replace</a></span></li><li><span>2.34 <a href="#c.text-sort">p:text-sort</a></span></li><li><span>2.35 <a href="#c.text-tail">p:text-tail</a></span></li><li><span>2.36 <a href="#c.unarchive">p:unarchive</a></span></li><li><span>2.37 <a href="#c.unescape-markup">p:unescape-markup</a></span></li><li><span>2.38 <a href="#c.unwrap">p:unwrap</a></span></li><li><span>2.39 <a href="#c.uuid">p:uuid</a></span></li><li><span>2.40 <a href="#c.wrap-sequence">p:wrap-sequence</a></span></li><li><span>2.41 <a href="#c.wrap">p:wrap</a></span></li><li><span>2.42 <a href="#c.www-form-urldecode">p:www-form-urldecode</a></span></li><li><span>2.43 <a href="#c.www-form-urlencode">p:www-form-urlencode</a></span></li><li><span>2.44 <a href="#c.xinclude">p:xinclude</a></span></li><li><span>2.45 <a href="#c.xquery">p:xquery</a></span><ul class="toc"><li><span>2.45.1 <a href="#example-xquery">Example</a></span></li><li><span>2.45.2 <a href="#c.xquery.17">Document properties</a></span></li></ul></li><li><span>2.46 <a href="#c.xslt">p:xslt</a></span></li></ul></li><li><span>3 <a href="#errors">Step Errors</a></span></li><li><span>A <a href="#conformance">Conformance</a></span><ul class="toc"><li><span>A.1 <a href="#implementation-defined">Implementation-defined features</a></span></li><li><span>A.2 <a href="#implementation-dependent">Implementation-dependent features</a></span></li></ul></li><li><span>B <a href="#references">References</a></span><ul class="toc"><li><span>B.1 <a href="#normative-references">Normative References</a></span></li><li><span>B.2 <a href="#informative-references">Informative References</a></span></li></ul></li><li><span>C <a href="#glossary">Glossary</a></span></li><li><span>D <a href="#ancillary-files">Ancillary files</a></span></li><li><span>E <a href="#credits">Credits</a></span></li></ul></div></div><section id="introduction" class="section"><div class="section-titlepage"><h2>1 Introduction</h2></div><div class="content"><p>This specification describes the standard, required atomic XProc steps. A machine-readable description of these steps may be found in <a href="steps.xpl">steps.xpl</a>. </p><p>Many atomic steps are available for [<a href="#xproc30"><span class="abbrev">XProc 3.0</span></a>]. They are described in several specifications. This specification describes the general background common to all steps. A conformant processor <span class="rfc2119" id="introduction.3.2">must</span> implement all of the steps in this specification. Additional steps may also be implemented. </p><p>The types given for options should be understood as follows:</p><div class="itemizedlist"><ul><li><p>Types in the XML Schema namespace, identified as QNames with the <code class="code">xs:</code> prefix, as per the XML Schema specification with one exception. Anywhere an <code class="code">xs:QName</code> is specified, an <a href="https://www.w3.org/TR/xquery-30/#doc-xquery30-EQName">EQName</a> is allowed.</p></li><li><p><code class="type">XPathExpression</code>: As a string per [<a href="#xmlschema-2"><span class="abbrev">W3C XML Schema: Part 2</span></a>], including whitespace normalization, and the further requirement to be a conformant Expression per [<a href="#xpath31"><span class="abbrev">XPath 3.1</span></a>]. </p></li><li><p><span style="display: none;" class="delete_version"><code class="type">XSLTSelectionPattern</code>: An XSLT pattern. </span><span style="display: none;" class="add_version"><code class="type">XSLTSelectionPattern</code>: <span id="dt-selection-pattern" class="termdef">[Definition: A <em class="glossterm">selection pattern</em> is an XSLT selection pattern. FIXME:]</span></span><span class="modify_version"><code class="type">XSLTSelectionPattern</code>: <span id="dt-selection-pattern" class="termdef"><span class="deltaxml-old" style="background:#FF5555">An</span><span class="deltaxml-new" style="background:#90EE90">[Definition: A</span> <em class="glossterm"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></em><span class="deltaxml-new" style="background:#90EE90"> is an </span>XSLT <span class="deltaxml-new" style="background:#90EE90">selection </span>pattern. <span class="deltaxml-new" style="background:#90EE90">FIXME:]</span></span></span></p></li><li><p><code class="type">XPathSequenceType</code>: An XPath <a href="https://www.w3.org/TR/xpath-31/#id-types">sequence type</a>. </p></li><li><p><code class="type">ContentType</code>: A media type as defined in [<a href="#rfc2046"><span class="abbrev">RFC 2046</span></a>]. </p></li><li><p><code class="type">ContentTypes</code>: As a whitespace separated list of media types as defined in [<a href="#rfc2046"><span class="abbrev">RFC 2046</span></a>]. </p></li></ul></div><p>Option values are often expressed using the shortcut syntax. In these cases, the option shortcuts are generally treated as value templates. However, for options of type <code class="code">map()</code> or <code class="code">array()</code>, an expression is <em>required</em> (there is no non-expression string which can ever be a legal value for a map or array). Given that every value entered this way will have to be a value template, and consequently every curly brace contained within the expression will have to be escaped, values of type map or array are defined to be expressions directly.</p><p>Some aspects of documents are generally unchanged by steps:</p><div class="itemizedlist"><ul><li><p>When a step in this library produces an output document, the base URI of the output is the base URI of the step's primary input document unless the step's process explicitly sets an <code class="tag-attribute">xml:base</code> attribute or the step's description explicitly states how the base URI is constructed.</p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Each step describes how it modifies the document properties of the documents that flow through it.</span></p><p><span class="deltaxml-old" style="background:#FF5555">A great many steps indicate that they preserve some or all of the properties of the input document. It should be noted that in some cases the transformation performed by the step will violate the condition associated with some property. In general, the steps cannot know this and the pipeline author is responsible for managing the properties with greater care in this case. </span></p><p><span class="deltaxml-new" style="background:#90EE90">Steps are responsible for describing how document properties are transformed as documents flow through them. Many steps claim that the specified properties are preserved. Generally, it is the responsibility of the pipeline author to determine when this is inapropriate and take corrective action. However, it is the responsibility of the pipeline processor to assure that the </span><code class="code"><span class="deltaxml-new" style="background:#90EE90">content-type</span></code><span class="deltaxml-new" style="background:#90EE90"> property is correct. If a step transforms a document in a manner that is inconsistent with the </span><code class="code"><span class="deltaxml-new" style="background:#90EE90">content-type</span></code><span class="deltaxml-new" style="background:#90EE90"> property (accepting an XML document on the source port but producing a text document on the result, for example), the processor must assure that the </span><code class="code"><span class="deltaxml-new" style="background:#90EE90">content-type</span></code><span class="deltaxml-new" style="background:#90EE90"> property is appropriate. If a step changes the </span><code class="code"><span class="deltaxml-new" style="background:#90EE90">content-type</span></code><span class="deltaxml-new" style="background:#90EE90"> in this way, it </span><span class="rfc2119" id="introduction.8.2.1.5"><span class="deltaxml-new" style="background:#90EE90">must</span></span><span class="deltaxml-new" style="background:#90EE90"> also remove the </span><code class="code"><span class="deltaxml-new" style="background:#90EE90">serialization</span></code><span class="deltaxml-new" style="background:#90EE90"> property </span></p></li></ul></div><p>Also, in this specification, several steps use this element for result information:</p><p class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:result&gt;<br />    <var>string</var><br />&lt;/c:result&gt;</code></p><p>When a step uses an XPath to compute an option value, the XPath context is as defined in [<a href="#xproc30"><span class="abbrev">XProc 3.0</span></a>].</p><p>When a step specifies a particular version of a technology, implementations <span class="rfc2119" id="introduction.12.1">must</span> implement that version or a subsequent version that is backwards compatible with that version. At user-option, they may implement other non-backwards compatible versions.</p><p>In this specification the words <span class="rfc2119" id="introduction.13.1">must</span>, <span class="rfc2119" id="introduction.13.2">must not</span>, <span class="rfc2119" id="introduction.13.3">should</span>, <span class="rfc2119" id="introduction.13.4">should not</span>, <span class="rfc2119" id="introduction.13.5">may</span> and <span class="rfc2119" id="introduction.13.6">recommended</span> are to be interpreted as described in [<a href="#rfc2119"><span class="abbrev">RFC 2119</span></a>].</p></div></section><section class="section" id="req-steps"><div class="section-titlepage"><h2>2 The required steps</h2></div><div class="content"><p>A conformant processor must support all of these steps.</p><section class="section" id="c.add-attribute"><div class="section-titlepage"><h3>2.1 p:add-attribute</h3></div><div class="content"><p><span style="display: none;" class="delete_version">The <code class="code">p:add-attribute</code> step adds a single attribute to a set of matching elements. The input document specified on the <code class="code">source</code> is processed for matches specified by the <em class="glossterm">selection pattern</em> in the <code class="option">match</code> option. For each of these matches, the attribute whose name is specified by the <code class="option">attribute-name</code> option is set to the attribute value specified by the <code class="option">attribute-value</code> option. </span><span style="display: none;" class="add_version">The <code class="code">p:add-attribute</code> step adds a single attribute to a set of matching elements. The input document specified on the <code class="code">source</code> is processed for matches specified by the <em class="glossterm"><a href="#dt-selection-pattern">selection pattern</a></em> in the <code class="option">match</code> option. For each of these matches, the attribute whose name is specified by the <code class="option">attribute-name</code> option is set to the attribute value specified by the <code class="option">attribute-value</code> option. </span><span class="modify_version">The <code class="code">p:add-attribute</code> step adds a single attribute to a set of matching elements. The input document specified on the <code class="code">source</code> is processed for matches specified by the <em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">selection</span><span class="deltaxml-old" style="background:#FF5555"> pattern</span><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em> in the <code class="option">match</code> option. For each of these matches, the attribute whose name is specified by the <code class="option">attribute-name</code> option is set to the attribute value specified by the <code class="option">attribute-value</code> option. </span></p><p>The resulting document is produced on the <code class="code">result</code> output port and consists of a exact copy of the input with the exception of the matched elements. Each of the matched elements is copied to the output with the addition of the specified attribute with the specified value. </p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:add-attribute</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'/*'</code><code>"</code><code>/&gt;</code><code>         </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">attribute-name</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">attribute-value</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p><span style="display: none;" class="delete_version">The value of the <code class="option">match</code> option <span class="rfc2119" id="c.add-attribute.5.2">must</span> be an XSLTSelectionPattern. <a id="err.inline.C0023"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if the <em class="glossterm">selection pattern</em> matches a node which is not an element.</span><span style="display: none;" class="add_version">The value of the <code class="option">match</code> option <span class="rfc2119" id="c.add-attribute.5.2">must</span> be an XSLTSelectionPattern. <a id="err.inline.C0023"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if the <em class="glossterm"><a href="#dt-selection-pattern">selection pattern</a></em> matches a node which is not an element.</span><span class="modify_version">The value of the <code class="option">match</code> option <span class="rfc2119" id="c.add-attribute.5.2">must</span> be an XSLTSelectionPattern. <a id="err.inline.C0023"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if the <em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">selection</span><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em> <span class="deltaxml-old" style="background:#FF5555">pattern</span><span class="deltaxml-old" style="background:#FF5555"> </span>matches a node which is not an element.</span></p><p>The value of the <code class="option">attribute-value</code> option <span class="rfc2119" id="c.add-attribute.6.2">must</span> be a legal attribute value according to XML.</p><p>If an attribute with the same name as the expanded name from the <code class="option">attribute-name</code> option exists on the matched element, the value specified in the <code class="option">attribute-value</code> option is used to set the value of that existing attribute. That is, the value of the existing attribute is changed to the <code class="option">attribute-value</code> value. </p><div id="note-multattr" class="note admonition"><h3>Note</h3><div class="admonition-body"><p>If multiple attributes need to be set on the same element(s), the <a href="#c.set-attributes"><code class="tag-element">p:set-attributes</code></a> step can be used to set them all at once.</p></div></div><p>This step cannot be used to add namespace declarations. <a id="err.inline.C0059"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0059"><code class="errqname">err:XC0059</code></a>) if the QName value in the <code class="option">attribute-name</code> option uses the prefix “<code class="literal">xmlns</code>” or any other prefix that resolves to the namespace name <code class="uri">http://www.w3.org/2000/xmlns/</code>. Note, however, that while namespace declarations cannot be added explicitly by this step, adding an attribute whose name is in a namespace for which there is no namespace declaration in scope on the matched element may result in a namespace binding being added by namespace fixup.</p><p>If an attribute named <code class="tag-attribute">xml:base</code> is added or changed, the base URI of the element <span class="rfc2119" id="c.add-attribute.10.2">must</span> also be amended accordingly.</p><section id="c.add-attribute.11" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section id="c.add-xml-base" class="section"><div class="section-titlepage"><h3>2.2 p:add-xml-base</h3></div><div class="content"><p>The <code class="code">p:add-xml-base</code> step exposes the base URI via explicit <code class="code">xml:base</code> attributes. The input document from the <code class="port">source</code> port is replicated to the <code class="port">result</code> port with <code class="code">xml:base</code> attributes added to or corrected on each element as specified by the options on this step.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:add-xml-base</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">all</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code><code>/&gt;</code><code>       </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">relative</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code><code>/&gt;</code><code>   </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">all</code> option <span class="rfc2119" id="c.add-xml-base.4.2">must</span> be a boolean.</p><p>The value of the <code class="option">relative</code> option <span class="rfc2119" id="c.add-xml-base.5.2">must</span> be a boolean.</p><p><a id="err.inline.C0058"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0058"><code class="errqname">err:XC0058</code></a>) if the <code class="option">all</code> and <code class="option">relative</code> options are <em>both</em><code class="literal">true</code>.</p><p>The <code class="tag-element">p:add-xml-base</code> step modifies its input as follows:</p><div class="itemizedlist"><ul><li><p>For every element that is a child of the document node: force the element to have an <code class="tag-attribute">xml:base</code> attribute with the document's [base URI] property's value as its value.</p></li><li><p>For other elements:</p><div class="itemizedlist"><ul><li><p>If the <code class="option">all</code> option has the value <code class="literal">true</code>, force the element to have an <code class="tag-attribute">xml:base</code> attribute with the element's [base URI] value as its value.</p></li><li><p>If the element's [base URI] is different from the its parent's [base URI], force the element to have an <code class="tag-attribute">xml:base</code> attribute with the following value: if the value of the <code class="option">relative</code> option is <code class="literal">true</code>, a string which, when resolved against the parent's [base URI], will give the element's [base URI], otherwise the element's [base URI].</p></li><li><p>Otherwise, if there is an <code class="tag-attribute">xml:base</code> attribute present, remove it. </p></li></ul></div></li></ul></div><section id="c.add-xml-base.9" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section class="section" id="c.archive"><div class="section-titlepage"><h3>2.3 p:archive</h3></div><div class="content"><p>The <code class="code">p:archive</code> step outputs on its <code class="port">result</code> port an archive (usually binary) document, for instance a ZIP file. A specification of the contents of the archive may be specified in a manifest XML document on the <code class="port">manifest</code>. The contents of the archive can come from documents provided on the <code class="port">source</code> and <code class="port">archive</code> ports, from documents specified inline in the manifest, or from a combination of these. The step produces a report on the <code class="port">report</code> port, which contains the manifest, amended with additional information about the archiving.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:archive</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">manifest</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">archive</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/*</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/*</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">report</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">format</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'zip'</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">relative-to</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:Qname, item()*)</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p><span style="display: none;" class="delete_version">The <code class="code">p:archive</code> step can perform several different operations on archives. The most common one will likely be creating an archive, but it could also, depending on the archive format, provide services like update, freshen or even merge. The only format implementations <span class="rfc2119" id="c.archive.4.2">must</span> support is [<a href="#zip"><span class="abbrev">ZIP</span></a>]. Support for other formats is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><span style="display: none;" class="add_version">The <code class="code">p:archive</code> step can perform several different operations on archives. The most common one will likely be creating an archive, but it could also, depending on the archive format, provide services like update, freshen or even merge. The only format implementations <span class="rfc2119" id="c.archive.4.2">must</span> support is [<a href="#zip"><span class="abbrev">ZIP</span></a>]. <span id="impl-1">The list of formats supported by the <code class="tag-element">p:archive</code> step is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version">The <code class="code">p:archive</code> step can perform several different operations on archives. The most common one will likely be creating an archive, but it could also, depending on the archive format, provide services like update, freshen or even merge. The only format implementations <span class="rfc2119" id="c.archive.4.2">must</span> support is [<a href="#zip"><span class="abbrev">ZIP</span></a>]. <span id="impl-1"><span class="deltaxml-old" style="background:#FF5555">Support for other formats</span><span class="deltaxml-new" style="background:#90EE90">The list of formats supported by the</span> <code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:archive</span></code><span class="deltaxml-new" style="background:#90EE90"> step </span>is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p><p>The <code class="code">p:archive</code> step has the following input ports:</p><div class="variablelist"><dl><dt><span class="term"><code class="port">source</code></span></dt><dd><p>The (primary) <code class="port">source</code> port is used to provide documents to be archived (for instance constructed by other steps). How and which of these documents are processed is governed by the document(s) appearing on the other input ports and the combination of options and parameters. See below for details. <a id="err.inline.C0084"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0084"><code class="errqname">err:XC0084</code></a>) if documents appear on the <code class="code">p:archive</code> step's <code class="port">source</code> port that have duplicate or no base URI's.</p></dd><dt><span class="term"><code class="port">manifest</code></span></dt><dd><p>The <code class="port">manifest</code> port can receive a manifest document that tells the step how to construct the archive. If no manifest document is provided on this port, a default manifest is automatically constructed. See <a href="#cv.archive-manifest" title="The archive manifest">Section 2.3.1, “The archive manifest”</a>.</p></dd><dt><span class="term"><code class="port">archive</code></span></dt><dd><p><span style="display: none;" class="delete_version">The <code class="port">archive</code> port is used to provide the step with existing archive(s) for operations like update, freshen or merge. Handling of ZIP files supports modifying archives appearing on the <code class="port">archive</code> port (<a href="#cv.archive-zips" title="Handling of ZIP archives">Section 2.3.2, “Handling of ZIP archives”</a>). Whether other archive formats and implementations support modifications of <code class="port">archive</code> inputs is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. A, currently hypothetical, archive merging implementation may accept more than one document on the <code class="port">archive</code> port. <a id="err.inline.C0081"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0081"><code class="errqname">err:XC0081</code></a>) if the content type of a document on the <code class="port">archive</code> does not match the given archive format as specified in the <code class="option">format</code> option.</span><span style="display: none;" class="add_version">The <code class="port">archive</code> port is used to provide the step with existing archive(s) for operations like update, freshen or merge. Handling of ZIP files supports modifying archives appearing on the <code class="port">archive</code> port (<a href="#cv.archive-zips" title="Handling of ZIP archives">Section 2.3.2, “Handling of ZIP archives”</a>). <span id="impl-2">The list of archive formats that can be modified by <code class="tag-element">p:archive</code> is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span> A, currently hypothetical, archive merging implementation may accept more than one document on the <code class="port">archive</code> port. <a id="err.inline.C0081"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0081"><code class="errqname">err:XC0081</code></a>) if the content type of a document on the <code class="port">archive</code> does not match the given archive format as specified in the <code class="option">format</code> option.</span><span class="modify_version">The <code class="port">archive</code> port is used to provide the step with existing archive(s) for operations like update, freshen or merge. Handling of ZIP files supports modifying archives appearing on the <code class="port">archive</code> port (<a href="#cv.archive-zips" title="Handling of ZIP archives">Section 2.3.2, “Handling of ZIP archives”</a>). <span id="impl-2"><span class="deltaxml-old" style="background:#FF5555">Whether other archive formats and implementations support modifications of</span><span class="deltaxml-new" style="background:#90EE90">The list of archive formats that can be modified by</span> <code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">archive</span><span class="deltaxml-new" style="background:#90EE90">p:archive</span></code> <span class="deltaxml-old" style="background:#FF5555">inputs </span>is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span> A, currently hypothetical, archive merging implementation may accept more than one document on the <code class="port">archive</code> port. <a id="err.inline.C0081"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0081"><code class="errqname">err:XC0081</code></a>) if the content type of a document on the <code class="port">archive</code> does not match the given archive format as specified in the <code class="option">format</code> option.</span></p></dd></dl></div><p>The <code class="code">p:archive</code> step has the following output ports:</p><div class="variablelist"><dl><dt><span class="term"><code class="port">result</code></span></dt><dd><p>The (primary) <code class="port">result</code> port will output the resulting archive.</p></dd><dt><span class="term"><code class="port">report</code></span></dt><dd><p><span style="display: none;" class="delete_version">The <code class="port">report</code> port will output a report about the archiving operation. This will be the same as the manifest (as provided on the <code class="port">manifest</code> port or automatically created if there was no manifest provided), optionally amended with additional attributes and/or elements. <span id="impl-1">The semantics of any additional attributes, elements and their values are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version">The <code class="port">report</code> port will output a report about the archiving operation. This will be the same as the manifest (as provided on the <code class="port">manifest</code> port or automatically created if there was no manifest provided), optionally amended with additional attributes and/or elements. <span id="impl-3">The semantics of any additional attributes, elements and their values are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version">The <code class="port">report</code> port will output a report about the archiving operation. This will be the same as the manifest (as provided on the <code class="port">manifest</code> port or automatically created if there was no manifest provided), optionally amended with additional attributes and/or elements. <span id="impl-3">The semantics of any additional attributes, elements and their values are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p></dd></dl></div><p>The <code class="code">p:archive</code> step has the following options:</p><div class="variablelist"><dl><dt><span class="term"><code class="option">format</code></span></dt><dd><p><span style="display: none;" class="delete_version">The format of the archive can be specified using the <code class="option">format</code> option. Implementations <span class="rfc2119" id="c.archive.10.1.2.1.2">must</span> support the [<a href="#zip"><span class="abbrev">ZIP</span></a>] format, specified with the value <code class="code">zip</code>. <span id="impl-2">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other formats are supported.</span></span><span style="display: none;" class="add_version">The format of the archive can be specified using the <code class="option">format</code> option. Implementations <span class="rfc2119" id="c.archive.10.1.2.1.2">must</span> support the [<a href="#zip"><span class="abbrev">ZIP</span></a>] format, specified with the value <code class="code">zip</code>. <span id="impl-4">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other formats are supported.</span></span><span class="modify_version">The format of the archive can be specified using the <code class="option">format</code> option. Implementations <span class="rfc2119" id="c.archive.10.1.2.1.2">must</span> support the [<a href="#zip"><span class="abbrev">ZIP</span></a>] format, specified with the value <code class="code">zip</code>. <span id="impl-4">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other formats are supported.</span></span></p></dd><dt><span class="term"><code class="option">parameters</code></span></dt><dd><p><span style="display: none;" class="delete_version">The <code class="option">parameters</code> option can be used to supply parameters to control the archiving. <span id="impl-3">The semantics of the keys and the allowed values for these keys are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0079"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0079"><code class="errqname">err:XC0079</code></a>) if the map <code class="option">parameters</code> contains an entry whose key is defined by the implementation and whose value is not valid for that key.</span><span style="display: none;" class="add_version">The <code class="option">parameters</code> option can be used to supply parameters to control the archiving. <span id="impl-5">The semantics of the keys and the allowed values for these keys are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0079"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0079"><code class="errqname">err:XC0079</code></a>) if the map <code class="option">parameters</code> contains an entry whose key is defined by the implementation and whose value is not valid for that key.</span><span class="modify_version">The <code class="option">parameters</code> option can be used to supply parameters to control the archiving. <span id="impl-5">The semantics of the keys and the allowed values for these keys are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0079"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0079"><code class="errqname">err:XC0079</code></a>) if the map <code class="option">parameters</code> contains an entry whose key is defined by the implementation and whose value is not valid for that key.</span></p></dd><dt><span class="term"><code class="option">relative-to</code></span></dt><dd><p>The <code class="option">relative-to</code> option is used in creating a manifest when no manifest is provided on the <code class="port">manifest</code> port. See <a href="#cv.archive-manifest" title="The archive manifest">Section 2.3.1, “The archive manifest”</a>.</p></dd></dl></div><section id="cv.archive-manifest" class="section"><div class="section-titlepage"><h4>2.3.1 The archive manifest</h4></div><div class="content"><p>An archive manifest specifies what must be archived and how. It is represented by a <a href="#cv.archive"><code class="tag-element">c:archive</code></a> root element:</p><p class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:archive&gt;<br />    (<a href="#cv.entry">c:entry</a>* &amp; <br />     <var>anyNonXProcElement</var>*)<br />&lt;/c:archive&gt;</code></p><p><span style="display: none;" class="delete_version"><span id="impl-4">The <code class="code">c:archive</code> root element may contain additional <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> attributes.</span></span><span style="display: none;" class="add_version"><span id="impl-6">The <code class="code">c:archive</code> root element may contain additional <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> attributes.</span></span><span class="modify_version"><span id="impl-6">The <code class="code">c:archive</code> root element may contain additional <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> attributes.</span></span></p><p>All entries in the archive must be present as <a href="#cv.entry"><code class="tag-element">c:entry</code></a> child elements:</p><p class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:entry<br />  <strong>name</strong> = <var>string</var><br />  href? = <var>anyURI</var><br />  comment? = <var>string</var><br />  method? = <var>string</var><br />  level? = <var>string</var>&gt;<br />    <var>anyElement</var>*<br />&lt;/c:entry&gt;</code></p><div class="itemizedlist"><ul><li><p>The mandatory <code class="code">name</code> attribute specifies the name of the entry in the archive. It <span class="rfc2119" id="cv.archive-manifest.7.1.1.2">must</span> be specified as a relative path.</p></li><li><p>The optional <code class="code">href</code> attribute is interpreted as follows:</p><div class="itemizedlist"><ul><li><p><a id="err.inline.D0064"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.D0064"><code class="errqname">err:XD0064</code></a>) if the <code class="option">c:entry/@href</code> attribute in a <code class="code">p:archive</code> step manifest is present and its value is not a valid <code class="type">xs:anyURI</code>.</p></li><li><p>When the <a href="#cv.entry"><code class="tag-element">c:entry</code></a> elements has any child nodes, the <code class="code">href</code> attribute is ignored.</p></li><li><p>The <code class="code">p:archive</code> step checks the documents appearing on its <code class="port">source</code> port for any documents with exactly the same base URI as the contents of the <code class="code">href</code> attribute. If any such document is found, this is used as entry for the archive.</p><p><a id="err.inline.C0082"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0082"><code class="errqname">err:XC0082</code></a>) if more than one document appears on the <code class="port">source</code> port of a <code class="code">p:archive</code> step with a base URI mentioned in one of the non-ignored <code class="code">c:entry/@href</code> attributes.</p></li><li><p>If the above doesn't apply, the value of the <code class="code">href</code> attribute is interpreted as a URI and the document is loaded from this location. <a id="err.inline.D0011"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.D0011"><code class="errqname">err:XD0011</code></a>) if the resource referenced by the <code class="option">href</code> option does not exist, cannot be accessed or is not a file If the <code class="option">href</code> option is relative, it is made absolute against the base URI of the manifest.</p></li><li><p><a id="err.inline.C0083"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0083"><code class="errqname">err:XC0083</code></a>) if the <code class="code">c:entry/@href</code> attribute in a <code class="code">p:archive</code> step manifest is not specified and the <a href="#cv.file"><code class="tag-element">c:file</code></a> element has no child nodes.</p></li></ul></div></li><li><p><span style="display: none;" class="delete_version">The <code class="code">method</code> attribute specifies how the entry should be compressed. <span id="impl-5">The default compression method is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span>Implementations <span class="rfc2119" id="cv.archive-manifest.7.3.1.3">must</span> support no compression, specified with the value <code class="code">none</code>. <span id="impl-6">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other compression methods are supported.</span></span><span style="display: none;" class="add_version">The <code class="code">method</code> attribute specifies how the entry should be compressed. <span id="impl-7">The default compression method is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span>Implementations <span class="rfc2119" id="cv.archive-manifest.7.3.1.3">must</span> support no compression, specified with the value <code class="code">none</code>. <span id="impl-8">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other compression methods are supported.</span></span><span class="modify_version">The <code class="code">method</code> attribute specifies how the entry should be compressed. <span id="impl-7">The default compression method is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span>Implementations <span class="rfc2119" id="cv.archive-manifest.7.3.1.3">must</span> support no compression, specified with the value <code class="code">none</code>. <span id="impl-8">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other compression methods are supported.</span></span></p></li><li><p><span style="display: none;" class="delete_version">The <code class="code">level</code> attribute specifies the level of compression. <span id="impl-7">The default compression method is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span><span id="impl-8">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what compression levels are supported.</span></span><span style="display: none;" class="add_version">The <code class="code">level</code> attribute specifies the level of compression. <span id="impl-9">The default compression method is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span><span id="impl-10">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what compression levels are supported.</span></span><span class="modify_version">The <code class="code">level</code> attribute specifies the level of compression. <span id="impl-9">The default compression method is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span><span id="impl-10">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what compression levels are supported.</span></span></p></li></ul></div><p>When the <code class="code">c:file</code> element has any child nodes this is taken as the contents of the archive's entry. The <code class="code">href</code> attribute is ignored in this case.</p><p>The <code class="code">p:archive</code> step <span class="rfc2119" id="cv.archive-manifest.9.2">should</span> strive to retain the order of the <a href="#cv.entry"><code class="tag-element">c:entry</code></a> elements when constructing the archive. For instance, an e-book in EPUB format has a non-compressed entry that must be first in the archive. It should be possible to construct such an archive using <code class="code">p:archive</code>.</p><p><span style="display: none;" class="delete_version"><span id="impl-9">The <code class="code">c:entry</code> elements may contain additional <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> attributes.</span></span><span style="display: none;" class="add_version"><span id="impl-11">The <code class="code">c:entry</code> elements may contain additional <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> attributes.</span></span><span class="modify_version"><span id="impl-11">The <code class="code">c:entry</code> elements may contain additional <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> attributes.</span></span></p><p>If no manifest entry is provided for a document appearing on the <code class="port">source</code> port, the step will manufacture a manifest entry from the document’s <code class="code">base-uri</code> property. If no document arrives on the <code class="port">manifest</code>, it will create a complete manifest document.</p><p>The option <code class="option">relative-to</code> can be used to derive the entry’s <code class="tag-element attribute">name</code> attribute from the <code class="port">source</code> document’s <code class="code">base-uri</code> property, which in turn will be used for the entry’s <code class="tag-element attribute">href</code> attribute. Both the URI that is given in <code class="option">relative-to</code> and the value of the <code class="code">base-uri</code> property should be normalized with respect to slash deduplication, parent path elimination, and drive letter case folding. The the step will remove the leading (normalized) <code class="option">relative-to</code> option value from the <code class="port">source</code> document’s (normalized) base URI. If there is no match, the manifest entry’s <code class="tag-element attribute">name</code> attribute will consist of the path part of the <code class="port">source</code> document’s base URI, without any leading slashes.</p></div></section><section id="cv.archive-zips" class="section"><div class="section-titlepage"><h4>2.3.2 Handling of ZIP archives</h4></div><div class="content"><p>The format of the archive can be specified using the <code class="option">format</code> option. Implementations <span class="rfc2119" id="cv.archive-zips.2.2">must</span> support the [<a href="#zip"><span class="abbrev">ZIP</span></a>] format, specified with the value <code class="code">zip</code>. </p><p>The <code class="option">parameters</code> option can be used to supply parameters to control the archiving. For the <code class="code">zip</code> format, the following parameters <span class="rfc2119" id="cv.archive-zips.3.3">must</span> be supported:</p><div class="variablelist"><dl><dt><span class="term"><code class="code">command</code></span></dt><dd><p>Specifies what operation to perform. If not specified, its default value is <code class="code">update</code>. Possible values are:</p><div class="variablelist"><dl><dt><span class="term"><code class="code">update</code></span></dt><dd><p>When the <code class="code">command</code> parameter is set to <code class="code">update</code> or not specified, zero or exactly one document in ZIP format can appear on the <code class="port">archive</code> port. If there is no document on the <code class="port">archive</code> port, an empty ZIP archive is assumed.</p><p>The contents of the manifest (either provided or (partially) constructed, see <a href="#cv.archive-manifest" title="The archive manifest">Section 2.3.1, “The archive manifest”</a>) is held against the entries in the ZIP file provided on the <code class="port">archive</code> port: </p><div class="itemizedlist"><ul><li><p>Any entry in the manifest that does not exist in the ZIP file provided on the <code class="port">archive</code> port is added.</p></li><li><p>For any entry that does exist in the ZIP file provided on the <code class="port">archive</code> port, a timestamp compare is done. When the entry in the manifest is newer than the entry in the ZIP file provided on the <code class="port">archive</code> port, it is replaced. Documents that are either specified in the manifest or come from the <code class="port">source</code> port have no timestamp and will <em>always</em> cause a replace to be done.</p></li></ul></div></dd><dt><span class="term"><code class="code">create</code></span></dt><dd><p>When the <code class="code">command</code> parameter is set to <code class="code">create</code>, the <code class="code">p:archive</code> step will behave exactly as for <code class="code">update</code>, except that existing entries will <em>always</em> be updated, regardless of their timestamp.</p></dd><dt><span class="term"><code class="code">freshen</code></span></dt><dd><p>When the <code class="code">command</code> parameter is set to <code class="code">freshen</code>, the <code class="code">p:archive</code> step will behave exactly as for <code class="code">update</code>, except that no new entries will be added. Any entries in the manifest that do not match an entry in the archive are ignored.</p></dd><dt><span class="term"><code class="code">delete</code></span></dt><dd><p>When the <code class="code">command</code> parameter is set to <code class="code">delete</code>, exactly one document in ZIP format must appear on the <code class="port">archive</code> port. The contents of the manifest (either provided or (partially) constructed, see <a href="#cv.archive-manifest" title="The archive manifest">Section 2.3.1, “The archive manifest”</a>) is held against the entries in the ZIP file provided on the <code class="port">archive</code> port. Any entries in the manifest file that match an entry in the ZIP archive will be deleted. All other entries in the manifest are ignored.</p></dd></dl></div></dd><dt><span class="term"><code class="code">level</code></span></dt><dd><p>Specifies the default compression level for files added to or updated in the archive. It can be overruled on a per-entry basis with a <code class="code">c:entry/@level</code> attribute in the manifest. Values that must be supported for ZIP files are: “<code class="code">smallest</code>” | “<code class="code">fastest</code>” | “<code class="code">default</code>” | “<code class="code">huffman</code>” | “<code class="code">none</code>”.</p></dd><dt><span class="term"><code class="code">method</code></span></dt><dd><p>Specifies the default compression method for files added to or updated in the archive. It can be overruled on a per-entry basis with a <code class="code">c:entry/@method</code> attribute in the manifest. Values that must be supported for ZIP files are: “<code class="code">none</code>” | “<code class="code">deflated</code>”.</p></dd></dl></div><p><a id="err.inline.C0080"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0080"><code class="errqname">err:XC0080</code></a>) if the number of documents on the <code class="port">archive</code> does not match the expected number of archive input documents for the given <code class="code">format</code> and <code class="code">command</code>.</p><p><span style="display: none;" class="delete_version">Implementations of other archive formats <span class="rfc2119" id="cv.archive-zips.6.1">should</span> use the same parameter names if applicable. The value spaces for these parameters may be format-specific though. They are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><span style="display: none;" class="add_version">Implementations of other archive formats <span class="rfc2119" id="cv.archive-zips.6.1">should</span> use the same parameter names if applicable. The value spaces for these parameters may be format-specific though. <span id="impl-12">The actual parameter names supported by <a href="#c.archive"><code class="tag-element">p:archive</code></a> for a particular format are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version">Implementations of other archive formats <span class="rfc2119" id="cv.archive-zips.6.1">should</span> use the same parameter names if applicable. The value spaces for these parameters may be format-specific though. <span id="impl-12"><span class="deltaxml-old" style="background:#FF5555">They</span><span class="deltaxml-new" style="background:#90EE90">The actual parameter names supported by</span> <a href="#c.archive"><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:archive</span></code></a><span class="deltaxml-new" style="background:#90EE90"> for a particular format </span>are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p></div></section><section id="c.archive.13" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.archive-manifest" class="section"><div class="section-titlepage"><h3>2.4 p:archive-manifest</h3></div><div class="content"><p>The <code class="code">p:archive-manifest</code> creates an XML manifest file describing the contents of the archive appearing on its <code class="port">source</code> port.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:archive-manifest</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">format</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName?</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:Qname, item()*)</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The <code class="code">p:archive-manifest</code> step inspects the archive appearing on its <code class="port">source</code> port and outputs a manifest describing the contents of the archive on its <code class="port">result</code> port. </p><p>The format of the archive is determined as follows:</p><div class="itemizedlist"><ul><li><p><span style="display: none;" class="delete_version">If the <code class="option">format</code> option is specified, this determines the format of the archive. Implementations <span class="rfc2119" id="c.archive-manifest.6.1.1.2">must</span> support the [<a href="#zip"><span class="abbrev">ZIP</span></a>] format, specified with the value <code class="code">zip</code>. <span id="impl-10">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other formats are supported.</span><a id="err.inline.C0081.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0081"><code class="errqname">err:XC0081</code></a>) if the format of the archive does not match the format as specified in the <code class="option">format</code> option.</span><span style="display: none;" class="add_version">If the <code class="option">format</code> option is specified, this determines the format of the archive. Implementations <span class="rfc2119" id="c.archive-manifest.6.1.1.2">must</span> support the [<a href="#zip"><span class="abbrev">ZIP</span></a>] format, specified with the value <code class="code">zip</code>. <span id="impl-13">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other formats are supported.</span><a id="err.inline.C0081.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0081"><code class="errqname">err:XC0081</code></a>) if the format of the archive does not match the format as specified in the <code class="option">format</code> option.</span><span class="modify_version">If the <code class="option">format</code> option is specified, this determines the format of the archive. Implementations <span class="rfc2119" id="c.archive-manifest.6.1.1.2">must</span> support the [<a href="#zip"><span class="abbrev">ZIP</span></a>] format, specified with the value <code class="code">zip</code>. <span id="impl-13">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other formats are supported.</span><a id="err.inline.C0081.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0081"><code class="errqname">err:XC0081</code></a>) if the format of the archive does not match the format as specified in the <code class="option">format</code> option.</span></p></li><li><p><span style="display: none;" class="delete_version">If no <code class="option">format</code> option is specified or if its value is the empty sequence, the archive's format will be determined by the step, using the <code class="code">content-type</code> document-property of the document on the <code class="port">source</code> port and/or by inspecting its contents. <span id="impl-11">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> how the step determines the archive's format.</span> Implementations <span class="rfc2119" id="c.archive-manifest.6.2.1.5">should</span> recognize archives in [<a href="#zip"><span class="abbrev">ZIP</span></a>] format. </span><span style="display: none;" class="add_version">If no <code class="option">format</code> option is specified or if its value is the empty sequence, the archive's format will be determined by the step, using the <code class="code">content-type</code> document-property of the document on the <code class="port">source</code> port and/or by inspecting its contents. <span id="impl-14">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> how the step determines the archive's format.</span> Implementations <span class="rfc2119" id="c.archive-manifest.6.2.1.5">should</span> recognize archives in [<a href="#zip"><span class="abbrev">ZIP</span></a>] format. </span><span class="modify_version">If no <code class="option">format</code> option is specified or if its value is the empty sequence, the archive's format will be determined by the step, using the <code class="code">content-type</code> document-property of the document on the <code class="port">source</code> port and/or by inspecting its contents. <span id="impl-14">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> how the step determines the archive's format.</span> Implementations <span class="rfc2119" id="c.archive-manifest.6.2.1.5">should</span> recognize archives in [<a href="#zip"><span class="abbrev">ZIP</span></a>] format. </span></p></li></ul></div><p><a id="err.inline.C0085"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0085"><code class="errqname">err:XC0085</code></a>) if the format of the archive cannot be understood, determined and/or processed.</p><p><span style="display: none;" class="delete_version">The <code class="option">parameters</code> option can be used to supply parameters to control the archive manifest generation. <span id="impl-12">The semantics of the keys and the allowed values for these keys are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0079.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0079"><code class="errqname">err:XC0079</code></a>) if the map <code class="option">parameters</code> contains an entry whose key is defined by the implementation and whose value is not valid for that key.</span><span style="display: none;" class="add_version">The <code class="option">parameters</code> option can be used to supply parameters to control the archive manifest generation. <span id="impl-15">The semantics of the keys and the allowed values for these keys are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0079.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0079"><code class="errqname">err:XC0079</code></a>) if the map <code class="option">parameters</code> contains an entry whose key is defined by the implementation and whose value is not valid for that key.</span><span class="modify_version">The <code class="option">parameters</code> option can be used to supply parameters to control the archive manifest generation. <span id="impl-15">The semantics of the keys and the allowed values for these keys are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0079.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0079"><code class="errqname">err:XC0079</code></a>) if the map <code class="option">parameters</code> contains an entry whose key is defined by the implementation and whose value is not valid for that key.</span></p><p><span style="display: none;" class="delete_version">The generated manifest has the format as described in <a href="#cv.archive-manifest" title="The archive manifest">Section 2.3.1, “The archive manifest”</a>. Implementations <span class="rfc2119" id="c.archive-manifest.9.2">must</span> supply an <a href="#cv.entry"><code class="tag-element">c:entry</code></a> element and its <code class="code">name</code> attribute for every entry in the archive. Supplying additional information is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><span style="display: none;" class="add_version">The generated manifest has the format as described in <a href="#cv.archive-manifest" title="The archive manifest">Section 2.3.1, “The archive manifest”</a>. Implementations <span class="rfc2119" id="c.archive-manifest.9.2">must</span> supply an <a href="#cv.entry"><code class="tag-element">c:entry</code></a> element and its <code class="code">name</code> attribute for every entry in the archive. <span id="impl-16">Additional information provided for entries in <code class="tag-element">p:archive-manifest</code> is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version">The generated manifest has the format as described in <a href="#cv.archive-manifest" title="The archive manifest">Section 2.3.1, “The archive manifest”</a>. Implementations <span class="rfc2119" id="c.archive-manifest.9.2">must</span> supply an <a href="#cv.entry"><code class="tag-element">c:entry</code></a> element and its <code class="code">name</code> attribute for every entry in the archive. <span id="impl-16"><span class="deltaxml-old" style="background:#FF5555">Supplying additional information</span><span class="deltaxml-new" style="background:#90EE90">Additional information provided for entries in</span> <code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:archive-manifest</span></code><span class="deltaxml-new" style="background:#90EE90"> </span>is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p><section id="c.archive-manifest.10" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section class="section" id="c.cast-content-type"><div class="section-titlepage"><h3>2.5 p:cast-content-type</h3></div><div class="content"><p>The <code class="tag-element">p:cast-content-type</code> step changes the media type of its input.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:cast-content-type</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">content-type</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item()*)?</code><code>"</code><code>/&gt;</code><code>     </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The input document is transformed from one media type to another. <a id="err.inline.C0070"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0070"><code class="errqname">err:XC0070</code></a>) if the supplied <code class="option">content-type</code> is not a valid media type of the form “<code class="literal"><em class="replaceable"><code>type</code></em>/<em class="replaceable"><code>subtype</code></em>+<em class="replaceable"><code>ext</code></em></code>” where “<code class="literal">+<em class="replaceable"><code>ext</code></em></code>” is optional. <a id="err.inline.C0071"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0071"><code class="errqname">err:XC0071</code></a>) if the <code class="tag-element">p:cast-content-type</code> step cannot perform the requested cast. </p><p><span style="display: none;" class="delete_version">The <code class="option">parameters</code> can be used to supply parameters to control casting. <span id="impl-13">The semantics of the keys and the allowed values for these keys are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0079.2"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0079"><code class="errqname">err:XC0079</code></a>) if the map <code class="option">parameters</code> contains an entry whose key is defined by the implementation and whose value is not valid for that key.</span><span style="display: none;" class="add_version">The <code class="option">parameters</code> can be used to supply parameters to control casting. <span id="impl-17">The semantics of the keys and the allowed values for these keys are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0079.2"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0079"><code class="errqname">err:XC0079</code></a>) if the map <code class="option">parameters</code> contains an entry whose key is defined by the implementation and whose value is not valid for that key.</span><span class="modify_version">The <code class="option">parameters</code> can be used to supply parameters to control casting. <span id="impl-17">The semantics of the keys and the allowed values for these keys are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0079.2"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0079"><code class="errqname">err:XC0079</code></a>) if the map <code class="option">parameters</code> contains an entry whose key is defined by the implementation and whose value is not valid for that key.</span></p><div class="itemizedlist"><ul><li><p>Casting from one XML media type to another simply changes the “<code class="literal">content-type</code>” document property. </p></li><li><p><span style="display: none;" class="delete_version">Casting from an HTML media type to an XML media type, if the input document is already an XPath data model document, simply changes the “<code class="literal">content-type</code>” document property. <span id="impl-14">Casting an HTML document that isn’t already an XPath data model document into XML is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version">Casting from an HTML media type to an XML media type, if the input document is already an XPath data model document, simply changes the “<code class="literal">content-type</code>” document property. <span id="impl-18">Casting an HTML document that isn’t already an XPath data model document into XML is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version">Casting from an HTML media type to an XML media type, if the input document is already an XPath data model document, simply changes the “<code class="literal">content-type</code>” document property. <span id="impl-18">Casting an HTML document that isn’t already an XPath data model document into XML is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p></li><li><p>Casting from an XML media type to an HTML media type, simply changes the “<code class="literal">content-type</code>” document property. </p></li><li><p><span style="display: none;" class="delete_version">Casting from a JSON media type to an XML media type, converts the JSON into XML. <span id="impl-15">The precise nature of the conversion from JSON to XML is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span> If the input document is a text node or other string representation, implementations <span class="rfc2119" id="c.cast-content-type.6.4.1.2">should</span> use <code class="function">fn:json-to-xml</code> by default. </span><span style="display: none;" class="add_version">Casting from a JSON media type to an XML media type, converts the JSON into XML. <span id="impl-19">The precise nature of the conversion from JSON to XML is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span> If the input document is a text node or other string representation, implementations <span class="rfc2119" id="c.cast-content-type.6.4.1.2">should</span> use <code class="function">fn:json-to-xml</code> by default. </span><span class="modify_version">Casting from a JSON media type to an XML media type, converts the JSON into XML. <span id="impl-19">The precise nature of the conversion from JSON to XML is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span> If the input document is a text node or other string representation, implementations <span class="rfc2119" id="c.cast-content-type.6.4.1.2">should</span> use <code class="function">fn:json-to-xml</code> by default. </span></p></li><li><p><span style="display: none;" class="delete_version">Casting from an XML media type to a JSON media type, converts the XML into JSON. <span id="impl-16">The precise nature of the conversion from XML to JSON is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span> If the input document is an XML representation of JSON as defined in [<a href="#xpath31-functions"><span class="abbrev">XPath and XQuery Functions and Operators 3.1</span></a>], implementations <span class="rfc2119" id="c.cast-content-type.6.5.1.3">must</span> use <code class="function">fn:xml-to-json</code> by default. If the input document has a <code class="tag-element">c:param-set</code> document element, a map <span class="rfc2119" id="c.cast-content-type.6.5.1.6">must</span> be returned that represents the document's <code class="tag-element">c:param</code> elements. </span><span style="display: none;" class="add_version">Casting from an XML media type to a JSON media type, converts the XML into JSON. <span id="impl-20">The precise nature of the conversion from XML to JSON is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span> If the input document is an XML representation of JSON as defined in [<a href="#xpath31-functions"><span class="abbrev">XPath and XQuery Functions and Operators 3.1</span></a>], implementations <span class="rfc2119" id="c.cast-content-type.6.5.1.3">must</span> use <code class="function">fn:xml-to-json</code> by default. If the input document has a <code class="tag-element">c:param-set</code> document element, a map <span class="rfc2119" id="c.cast-content-type.6.5.1.6">must</span> be returned that represents the document's <code class="tag-element">c:param</code> elements. </span><span class="modify_version">Casting from an XML media type to a JSON media type, converts the XML into JSON. <span id="impl-20">The precise nature of the conversion from XML to JSON is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span> If the input document is an XML representation of JSON as defined in [<a href="#xpath31-functions"><span class="abbrev">XPath and XQuery Functions and Operators 3.1</span></a>], implementations <span class="rfc2119" id="c.cast-content-type.6.5.1.3">must</span> use <code class="function">fn:xml-to-json</code> by default. If the input document has a <code class="tag-element">c:param-set</code> document element, a map <span class="rfc2119" id="c.cast-content-type.6.5.1.6">must</span> be returned that represents the document's <code class="tag-element">c:param</code> elements. </span></p></li><li id="c.data"><p>Casting from a non-XML media type to an XML media type produces an XML document with a <a href="#c.data"><code class="tag-element">c:data</code></a> document element. The original media type will be preserved in the <code class="tag-attribute">content-type</code> attribute on the <a href="#c.data"><code class="tag-element">c:data</code></a> element.</p><p class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:data<br />  <strong>content-type</strong> = <var>ContentType</var><br />  charset? = <var>string</var><br />  encoding? = <var>string</var>&gt;<br />    <var>string</var><br />&lt;/c:data&gt;</code></p><p>The content of the <a href="#c.data"><code class="tag-element">c:data</code></a> element is the base64 encoded representation of the non-XML content.</p></li><li><p>Casting from an XML media type to a non-XML media type <span class="rfc2119" id="c.cast-content-type.6.7.1.1">must</span> support the case where the input document is a <a href="#c.data"><code class="tag-element">c:data</code></a> document. The resulting document will have the specified media type and a representation that is the content of the <a href="#c.data"><code class="tag-element">c:data</code></a> element after decoding the base64 encoded content.</p><p><a id="err.inline.C0072"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0072"><code class="errqname">err:XC0072</code></a>) if the <a href="#c.data"><code class="tag-element">c:data</code></a> contains content is not a valid base64 string.</p><p><a id="err.inline.C0073"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0073"><code class="errqname">err:XC0073</code></a>) if the <a href="#c.data"><code class="tag-element">c:data</code></a> element does not have a <code class="tag-attribute">content-type</code> attribute.</p><p><a id="err.inline.C0074"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0074"><code class="errqname">err:XC0074</code></a>) if the <code class="option">content-type</code> is supplied and is not the same as the <code class="tag-attribute">content-type</code> specified on the <a href="#c.data"><code class="tag-element">c:data</code></a> element. </p><p><span style="display: none;" class="delete_version"><span id="impl-17">Casting from an XML media type to a non-XML media type when the input document is not a <a href="#c.data"><code class="tag-element">c:data</code></a> document is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version"><span id="impl-21">Casting from an XML media type to a non-XML media type when the input document is not a <a href="#c.data"><code class="tag-element">c:data</code></a> document is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version"><span id="impl-21">Casting from an XML media type to a non-XML media type when the input document is not a <a href="#c.data"><code class="tag-element">c:data</code></a> document is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p></li><li><p><span style="display: none;" class="delete_version"><span id="impl-18">Casting from one non-XML media type to another non-XML media type is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version"><span id="impl-22">Casting from one non-XML media type to another non-XML media type is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version"><span id="impl-22">Casting from one non-XML media type to another non-XML media type is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p></li></ul></div><p><a id="err.inline.C075"></a>In all cases except when the input document is a <a href="#c.data"><code class="tag-element">c:data</code></a> element, it is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C075"><code class="errqname">err:XC075</code></a>) if the <code class="option">content-type</code> is not supplied. </p><section id="c.cast-content-type.8" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved except the <code class="code">content-type</code> property which is updated accordingly.</p></div></section></div></section><section id="c.compare" class="section"><div class="section-titlepage"><h3>2.6 p:compare</h3></div><div class="content"><p>The <code class="code">p:compare</code> step compares two documents for equality.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:compare</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">alternate</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">differences</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item()*)?</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">method</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName?</code><code>"</code><code>/&gt;</code><code>                      </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">fail-if-not-equal</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p><span style="display: none;" class="delete_version">This step takes single documents on each of two ports and compares them. If <code class="option">method</code> is not specified, or if <code class="code">deep-equal</code> is specified, the comparison uses <code class="function">fn:deep-equal</code> (as defined in [<a href="#xpath31-functions"><span class="abbrev">XPath and XQuery Functions and Operators 3.1</span></a>]). <span id="impl-19">Implementations of <code class="tag-element">p:compare</code><span class="rfc2119" id="c.compare.4.5.2">must</span> support the <code class="code">deep-equal</code><code class="option">method</code>; other supported methods are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0076"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0076"><code class="errqname">err:XC0076</code></a>) if the comparison <code class="option">method</code> specified in <code class="tag-element">p:compare</code> is not supported by the implementation. <a id="err.inline.C0077"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0077"><code class="errqname">err:XC0077</code></a>) if the media types of the documents supplied are incompatible with the comparison <code class="option">method</code>. </span><span style="display: none;" class="add_version">This step takes single documents on each of two ports and compares them. If <code class="option">method</code> is not specified, or if <code class="code">deep-equal</code> is specified, the comparison uses <code class="function">fn:deep-equal</code> (as defined in [<a href="#xpath31-functions"><span class="abbrev">XPath and XQuery Functions and Operators 3.1</span></a>]). <span id="impl-23">Implementations of <code class="tag-element">p:compare</code><span class="rfc2119" id="c.compare.4.5.2">must</span> support the <code class="code">deep-equal</code><code class="option">method</code>; other supported methods are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0076"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0076"><code class="errqname">err:XC0076</code></a>) if the comparison <code class="option">method</code> specified in <code class="tag-element">p:compare</code> is not supported by the implementation. <a id="err.inline.C0077"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0077"><code class="errqname">err:XC0077</code></a>) if the media types of the documents supplied are incompatible with the comparison <code class="option">method</code>. </span><span class="modify_version">This step takes single documents on each of two ports and compares them. If <code class="option">method</code> is not specified, or if <code class="code">deep-equal</code> is specified, the comparison uses <code class="function">fn:deep-equal</code> (as defined in [<a href="#xpath31-functions"><span class="abbrev">XPath and XQuery Functions and Operators 3.1</span></a>]). <span id="impl-23">Implementations of <code class="tag-element">p:compare</code><span class="rfc2119" id="c.compare.4.5.2">must</span> support the <code class="code">deep-equal</code><code class="option">method</code>; other supported methods are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0076"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0076"><code class="errqname">err:XC0076</code></a>) if the comparison <code class="option">method</code> specified in <code class="tag-element">p:compare</code> is not supported by the implementation. <a id="err.inline.C0077"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0077"><code class="errqname">err:XC0077</code></a>) if the media types of the documents supplied are incompatible with the comparison <code class="option">method</code>. </span></p><p><a id="err.inline.C0019"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0019"><code class="errqname">err:XC0019</code></a>) if the documents are not equal according to the specified comparison <code class="option">method</code>, and the value of the <code class="option">fail-if-not-equal</code> option is <code class="literal">true</code>. If the documents are equal, or if the value of the <code class="option">fail-if-not-equal</code> option is <code class="literal">false</code>, a <a href="#cv.result"><code class="tag-element">c:result</code></a> document is produced with contents <code class="literal">true</code> if the documents are equal, otherwise <code class="literal">false</code>.</p><p><span style="display: none;" class="delete_version"><span id="impl-20">If <code class="option">fail-if-not-equal</code> is <code class="code">false</code>, and the documents differ, an <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> summary of the differences between the two documents may appear on the <code class="port">differences</code> port.</span></span><span style="display: none;" class="add_version"><span id="impl-24">If <code class="option">fail-if-not-equal</code> is <code class="code">false</code>, and the documents differ, an <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> summary of the differences between the two documents may appear on the <code class="port">differences</code> port.</span></span><span class="modify_version"><span id="impl-24">If <code class="option">fail-if-not-equal</code> is <code class="code">false</code>, and the documents differ, an <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> summary of the differences between the two documents may appear on the <code class="port">differences</code> port.</span></span></p><section id="c.compare.7" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.count" class="section"><div class="section-titlepage"><h3>2.7 p:count</h3></div><div class="content"><p>The <code class="code">p:count</code> step counts the number of documents in the <code class="code">source</code> input sequence and returns a single document on <code class="code">result</code> containing that number. The generated document contains a single <a href="#cv.result"><code class="tag-element">c:result</code></a> element whose contents is the string representation of the number of documents in the sequence.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:count</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">limit</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:integer</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">0</code><code>"</code><code>/&gt;</code><code>           </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>If the <code class="tag-attribute">limit</code> option is specified and is greater than zero, the <code class="tag-element">p:count</code> step will count at most that many documents. This provides a convenient mechanism to discover, for example, if a sequence consists of more than 1 document, without requiring every single document to be buffered before processing can continue.</p><section id="c.count.5" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.delete" class="section"><div class="section-titlepage"><h3>2.8 p:delete</h3></div><div class="content"><p><span style="display: none;" class="delete_version">The <code class="code">p:delete</code> step deletes items specified by a <em class="glossterm">selection pattern</em> from the <code class="code">source</code> input document and produces the resulting document, with the deleted items removed, on the <code class="port">result</code> port.</span><span style="display: none;" class="add_version">The <code class="code">p:delete</code> step deletes items specified by a <em class="glossterm"><a href="#dt-selection-pattern">selection pattern</a></em> from the <code class="code">source</code> input document and produces the resulting document, with the deleted items removed, on the <code class="port">result</code> port.</span><span class="modify_version">The <code class="code">p:delete</code> step deletes items specified by a <em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">selection</span><span class="deltaxml-old" style="background:#FF5555"> pattern</span><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em> from the <code class="code">source</code> input document and produces the resulting document, with the deleted items removed, on the <code class="port">result</code> port.</span></p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:delete</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p><span style="display: none;" class="delete_version">The value of the <code class="option">match</code> option <span class="rfc2119" id="c.delete.4.2">must</span> be an XSLTSelectionPattern. A <em class="glossterm">selection pattern</em> may match multiple items to be deleted.</span><span style="display: none;" class="add_version">The value of the <code class="option">match</code> option <span class="rfc2119" id="c.delete.4.2">must</span> be an XSLTSelectionPattern. A <em class="glossterm"><a href="#dt-selection-pattern">selection pattern</a></em> may match multiple items to be deleted.</span><span class="modify_version">The value of the <code class="option">match</code> option <span class="rfc2119" id="c.delete.4.2">must</span> be an XSLTSelectionPattern. A <em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">selection</span><span class="deltaxml-old" style="background:#FF5555"> pattern</span><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em> may match multiple items to be deleted.</span></p><p>If an element is selected by the <code class="option">match</code> option, the entire subtree rooted at that element is deleted.</p><p><a id="err.inline.C0023.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if the <code class="option">match</code> option matches the document node.</p><p>This step cannot be used to remove namespaces. <a id="err.inline.C0062"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0062"><code class="errqname">err:XC0062</code></a>) if the <code class="option">match</code> option matches a namespace node. Also, note that deleting an attribute named <code class="tag-attribute">xml:base</code> does not change the base URI of the element on which it occurred.</p><section id="c.delete.8" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>If the resulting document contains exactly one text node, the <code class="literal">content-type</code> property is changed to <code class="literal">text/plain</code> and the <code class="literal">serialization</code> property is removed, while all other document properties are preserved. For other document types, all document properties are preserved.</p></div></section></div></section><section class="section" id="c.directory-list"><div class="section-titlepage"><h3>2.9 p:directory-list</h3></div><div class="content"><p>The <code class="code">p:directory-list</code> step produces a list of the contents of a specified directory.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:directory-list</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-type-attr">content-type</code><code>="</code><code class="value content-type-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">path</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>        </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">detailed</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code><code>/&gt;</code><code>  </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">max-depth</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string?</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'1'</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">include-filter</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string*</code><code>"</code><code>/&gt;</code><code>             </code><code class="comment">&lt;!-- </code><span class="opt-type">RegularExpression</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">exclude-filter</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string*</code><code>"</code><code>/&gt;</code><code>             </code><code class="comment">&lt;!-- </code><span class="opt-type">RegularExpression</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p><span style="display: none;" class="delete_version"><span id="impl-21">Conformant processors <span class="rfc2119" id="c.directory-list.4.1.1">must</span> support directory paths whose scheme is <code class="code">file</code>. It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other schemes are supported by <code class="tag-element">p:directory-list</code>, and what the interpretation of 'directory', 'file' and 'contents' is for those schemes.</span><a id="err.inline.C0102"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0102"><code class="errqname">err:XC0102</code></a>) if an implementation does not support directory listing for a specified scheme. </span><span style="display: none;" class="add_version"><span id="impl-25">Conformant processors <span class="rfc2119" id="c.directory-list.4.1.1">must</span> support directory paths whose scheme is <code class="code">file</code>. It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other schemes are supported by <code class="tag-element">p:directory-list</code>, and what the interpretation of 'directory', 'file' and 'contents' is for those schemes.</span><a id="err.inline.C0102"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0102"><code class="errqname">err:XC0102</code></a>) if an implementation does not support directory listing for a specified scheme. </span><span class="modify_version"><span id="impl-25">Conformant processors <span class="rfc2119" id="c.directory-list.4.1.1">must</span> support directory paths whose scheme is <code class="code">file</code>. It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other schemes are supported by <code class="tag-element">p:directory-list</code>, and what the interpretation of 'directory', 'file' and 'contents' is for those schemes.</span><a id="err.inline.C0102"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0102"><code class="errqname">err:XC0102</code></a>) if an implementation does not support directory listing for a specified scheme. </span></p><p>If <code class="option">path</code> is relative, it is made absolute against the base URI of the element on which it is specified (<code class="tag-element">p:with-option</code> or <code class="tag-element">p:directory-list</code> in the case of a syntactic shortcut value). <a id="err.inline.C0017"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0017"><code class="errqname">err:XC0017</code></a>) if the absolute path does not identify a directory. <a id="err.inline.C0012"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0012"><code class="errqname">err:XC0012</code></a>) if the contents of the directory path are not available to the step due to access restrictions in the environment in which the pipeline is run.</p><p>If the <code class="option">detailed</code> option is true, the pipeline author is requesting additional information about the matching entries, see <a href="#dir-list-details" title="Directory list details">Section 2.9.1, “Directory list details”</a>.</p><p>The <code class="option">max-depth</code> option may contain either the string “<code class="literal">unbounded</code>” or a string that may be cast to a non-negative integer. An integer value of <code class="literal">0</code> means that only information about the directory that is given in the <code class="option">path</code> option is returned. A <code class="option">max-depth</code> of <code class="literal">1</code>, which is the default, will effect that also information about the top-level directory’s immediate children will be included. For larger values of <code class="option">max-depth</code>, also the content of directories will be considered recursively up to the maximum depth, and it will be included as children of the corresponding <a href="#cv.directory"><code class="tag-element">c:directory</code></a> elements.</p><p>If present, the value of the <code class="option">include-filter</code> or <code class="option">exclude-filter</code> option <span class="rfc2119" id="c.directory-list.8.3">must</span> be a sequence of strings, each one representing a regular expressions as specified in [<a href="#xpath31-functions"><span class="abbrev">XPath and XQuery Functions and Operators 3.1</span></a>], section 7.61 “<code class="literal">Regular Expression Syntax</code>”.</p><p>The regular expressions will be matched against an item’s file system path relative to the top-level path that was given in the <code class="option">path</code> option. If the item is a directory, a trailing slash will be appended.</p><p>Examples: A file <code class="literal">file.txt</code> in the directory specified by <code class="option">path</code> will remain <code class="literal">file.txt</code>, a relative path <code class="literal">dir1/file.txt</code> will remain <code class="literal">dir1/file.txt</code>, while a relative path <code class="literal">dir1/dir2</code> will become <code class="literal">dir1/dir2/</code> if <code class="literal">dir2</code> is a directory.</p><p>Regular expressions that match <code class="literal">a/a/b/file.txt</code> are, for example, <code class="literal">^/(\w+/){2,3}.+\.txt$</code>, <code class="literal">a/a/b/</code>, or <code class="literal">/file\.[^/]+$</code>.</p><p>If any <code class="option">include-filter</code> pattern matches the slash-augmented relative path, the entry is included in the output. If a directory’s path matches the inclusion regex, the directory’s content will not automatically be included, too. They need to match, the regular expression, too. So the filter regex <code class="literal">^dir/</code> will match the directory content but <code class="literal">^dir/$</code> won’t, and as a consequence the directory’s content will not be included in the result.</p><p>If a relative path is matched by an include filter, all its ancestor directories starting from the initial directory (but not their content if not included explicitly) will be included, too.</p><figure id="ex.c.directory-list" class="example-wrapper"><div class="title">Example 1. Sample Directory List Output for a Single File</div><div class="example"><p>For a file <code class="literal">a/a/b/file.txt</code> below the initial directory <code class="literal">/home/jane</code>, this output will be produced, omitting content that might be present in the intermediate directories:</p><pre class="literallayout language-none line-numbers"><code>&lt;c:directory xml:base="file:///home/jane/" name="jane"&gt; &lt;c:directory xml:base="a/" name="a"&gt; &lt;c:directory xml:base="a/" name="a"&gt; &lt;c:directory xml:base="b/" name="b"&gt; &lt;c:file xml:base="file.txt" name="file.txt"/&gt; &lt;/c:directory&gt; &lt;/c:directory&gt; &lt;/c:directory&gt; &lt;/c:directory&gt;</code></pre></div></figure><p>If the <code class="option">exclude-filter</code> pattern matches the slash-augmented relative path, the entry (and all of its content in case of a directory) is excluded in the output.</p><p>If both options are provided, the include filter is processed first, then the exclude filter. As a result, an item is included if it matches (at least) one of the <code class="option">include-filter</code> values and none of the <code class="option">exclude-filter</code> values.</p><p>If no <code class="option">include-filter</code> is given, that is, if <code class="option">include-filter</code> is an empty sequence, any item will be included in the result (unless it is excluded by <code class="option">exclude-filter</code>).</p><div class="note admonition"><h3>Note</h3><div class="admonition-body"><p>There is no way to specify a list of values using attribute value templates. If the option shortcut syntax is used to provide the <code class="option">include-filter</code> or <code class="option">exclude-filter</code> option, it will consist of a single regular expression. To specify a list of regular expressions, you must use the <code class="tag-element">p:with-option</code> syntax. </p></div></div><p>The result document produced for the specified directory path has a <a href="#cv.directory"><code class="tag-element">c:directory</code></a> document element whose base URI, attached as an <code class="tag-element attribute">xml:base</code> attribute, is the absolute directory path (expressed as a URI that ends in a slash) and whose <code class="tag-attribute">name</code> attribute (without a trailing slash) is the last segment of the directory path.</p><p class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:directory<br />  <strong>name</strong> = <var>string</var><br />  <strong>uri</strong> = <var>anyURI</var>&gt;<br />    (<a href="#cv.file">c:file</a> | <br />     <a href="#cv.directory">c:directory</a> | <br />     <a href="#cv.other">c:other</a>)*<br />&lt;/c:directory&gt;</code></p><p>Its contents are determined as follows, based on the entries in the directory identified by the directory path. For each entry in the directory and subject to the rules that are imposed by the <code class="option">max-depth</code>, <code class="option">include-filter</code>, and <code class="option">exclude-filter</code> options, a <a href="#cv.file"><code class="tag-element">c:file</code></a>, a <a href="#cv.directory"><code class="tag-element">c:directory</code></a>, or a <a href="#cv.other"><code class="tag-element">c:other</code></a> element is produced, as follows: </p><div class="itemizedlist"><ul><li><p>A <a href="#cv.directory"><code class="tag-element">c:directory</code></a> is produced for each subdirectory not determined to be special. Depending on the values of the three options, it may contain child elements for the directory’s content.</p></li><li><p>A <a href="#cv.file"><code class="tag-element">c:file</code></a> is produced for each file not determined to be special.</p><p class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:file<br />  <strong>name</strong> = <var>string</var><br />  <strong>uri</strong> = <var>anyURI</var><br />  content-types? = <var>ContentTypes</var> /&gt;</code></p></li><li><p><span style="display: none;" class="delete_version"><span id="impl-22">Any file or directory determined to be special by the <code class="tag-element">p:directory-list</code> step may be output using a <a href="#cv.other"><code class="tag-element">c:other</code></a> element but the criteria for marking a file as special are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version"><span id="impl-26">Any file or directory determined to be special by the <code class="tag-element">p:directory-list</code> step may be output using a <a href="#cv.other"><code class="tag-element">c:other</code></a> element but the criteria for marking a file as special are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version"><span id="impl-26">Any file or directory determined to be special by the <code class="tag-element">p:directory-list</code> step may be output using a <a href="#cv.other"><code class="tag-element">c:other</code></a> element but the criteria for marking a file as special are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p><p class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:other<br />  <strong>name</strong> = <var>string</var><br />  <strong>uri</strong> = <var>anyURI</var> /&gt;</code></p></li></ul></div><p>Each of the elements <a href="#cv.file"><code class="tag-element">c:file</code></a>, <a href="#cv.directory"><code class="tag-element">c:directory</code></a>, and <a href="#cv.other"><code class="tag-element">c:other</code></a> has a <code class="code">name</code> attribute, whose value is a relative IRI reference, giving the (local) file or directory name.</p><p>Each of these element also contains the corresponding resource’s URI in an <code class="tag-element attribute">xml:base</code> attribute, which may be a relative URI for any but the top-level <a href="#cv.directory"><code class="tag-element">c:directory</code></a> element. In the case of <a href="#cv.directory"><code class="tag-element">c:directory</code></a>, it must end in a trailing slash. This way, users will always be able to compute the absolute URI for any of these elements by applying <code class="code">fn:base-uri()</code> to it.</p><section class="section" id="dir-list-details"><div class="section-titlepage"><h4>2.9.1 Directory list details</h4></div><div class="content"><p>If <code class="option">detailed</code> is false, then only the <code class="tag-attribute">name</code> and <code class="tag-attribute">xml:base</code> attributes are expected on <a href="#cv.file"><code class="tag-element">c:file</code></a>, <a href="#cv.directory"><code class="tag-element">c:directory</code></a>, or <a href="#cv.other"><code class="tag-element">c:other</code></a> elements.</p><p>If <code class="option">detailed</code> is true, then the pipeline author is expecting additional details about each entry. The following attributes <span class="rfc2119" id="dir-list-details.3.2">should</span> be provided by the implementation:</p><div class="variablelist"><dl><dt><span class="term"><code class="tag-attribute">readable</code></span></dt><dd><p>“<code class="code">true</code>” if the entry is readable.</p></dd><dt><span class="term"><code class="tag-attribute">writable</code></span></dt><dd><p>“<code class="code">true</code>” if the entry is writable.</p></dd><dt><span class="term"><code class="tag-attribute">hidden</code></span></dt><dd><p>“<code class="code">true</code>” if the entry is hidden.</p></dd><dt><span class="term"><code class="tag-attribute">last-modified</code></span></dt><dd><p>The last modification time of the entry, expressed as a lexical <code class="code">xs:dateTime</code> in UTC.</p></dd><dt><span class="term"><code class="tag-attribute">size</code></span></dt><dd><p>The size of the entry in bytes.</p></dd></dl></div><p><span style="display: none;" class="delete_version"><span id="impl-23">The precise meaning of these properties are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> and may vary according to the URI scheme of the <code class="option">path</code>.</span> If the value of an attribute is “<code class="code">false</code>” or if it has no meaningful value, the attribute may be omitted.</span><span style="display: none;" class="add_version"><span id="impl-27">The precise meaning of these properties are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> and may vary according to the URI scheme of the <code class="option">path</code>.</span> If the value of an attribute is “<code class="code">false</code>” or if it has no meaningful value, the attribute may be omitted.</span><span class="modify_version"><span id="impl-27">The precise meaning of these properties are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> and may vary according to the URI scheme of the <code class="option">path</code>.</span> If the value of an attribute is “<code class="code">false</code>” or if it has no meaningful value, the attribute may be omitted.</span></p><p><span style="display: none;" class="delete_version"><span id="impl-24">Any other attributes on <a href="#cv.file"><code class="tag-element">c:file</code></a>, <a href="#cv.directory"><code class="tag-element">c:directory</code></a>, or <a href="#cv.other"><code class="tag-element">c:other</code></a> are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version"><span id="impl-28">Any other attributes on <a href="#cv.file"><code class="tag-element">c:file</code></a>, <a href="#cv.directory"><code class="tag-element">c:directory</code></a>, or <a href="#cv.other"><code class="tag-element">c:other</code></a> are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version"><span id="impl-28">Any other attributes on <a href="#cv.file"><code class="tag-element">c:file</code></a>, <a href="#cv.directory"><code class="tag-element">c:directory</code></a>, or <a href="#cv.other"><code class="tag-element">c:other</code></a> are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p></div></section><section id="c.directory-list.26" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.error" class="section"><div class="section-titlepage"><h3>2.10 p:error</h3></div><div class="content"><p>The <code class="code">p:error</code> step generates a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> using the input provided to the step.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:error</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">any</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">code</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>         </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>This step uses the document provided on its input as the content of the error raised. An instance of the <code class="tag-element">c:errors</code> element will be produced on the error output port, as is always the case for <em class="glossterm"><a href="#dt-dynamic-error">dynamic errors</a></em>. The error generated can be caught by a <code class="tag-element">p:try</code> just like any other dynamic error.</p><p>For authoring convenience, the <code class="tag-element">p:error</code> step is declared with a single, primary output port. With respect to connections, this port behaves like any other output port even though nothing can ever appear on it since the step always fails.</p><p>For example, given the following invocation:</p><pre class="programlisting language-markup line-numbers"><code>&lt;p:error xmlns:my="http://www.example.org/error" name="bad-document" code="my:unk12"&gt; &lt;p:input port="source"&gt; &lt;p:inline&gt; &lt;message&gt;The document element is unknown.&lt;/message&gt; &lt;/p:inline&gt; &lt;/p:input&gt; &lt;/p:error&gt;</code></pre><p>The error vocabulary element (and document) generated on the error output port would be:</p><pre class="programlisting language-markup line-numbers"><code>&lt;c:errors xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:p="http://www.w3.org/ns/xproc" xmlns:my="http://www.example.org/error"&gt; &lt;c:error name="bad-document" type="p:error" code="my:unk12"&gt;&lt;message&gt;The document element is unknown.&lt;/message&gt; &lt;/c:error&gt; &lt;/c:errors&gt;</code></pre><p>The <code class="tag-attribute">href</code>, <code class="tag-attribute">line</code> and <code class="tag-attribute">column</code>, or <code class="tag-attribute">offset</code>, might also be present on the <code class="tag-element">c:error</code> to identify the location of the <code class="tag-element">p:error</code> element in the pipeline.</p><section id="c.error.11" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.escape-markup" class="section"><div class="section-titlepage"><h3>2.11 p:escape-markup</h3></div><div class="content"><p>The <code class="code">p:escape-markup</code> step applies XML serialization to the children of the all elements that are children of the document node and replaces those children with their serialization. The outcome is a list of elements with text content that represents the "escaped" syntax of the children as they were serialized.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:escape-markup</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">serialization</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item()*)?</code><code>"</code><code>/&gt;</code><code>  </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>This step supports the standard serialization options as specified in [<a href="#xml-serialization-31"><span class="abbrev">Serialization</span></a>]. These options control how the output markup is produced before it is escaped. </p><p>For example, the input:</p><pre class="programlisting language-markup line-numbers"><code>&lt;description&gt; &lt;div xmlns="http://www.w3.org/1999/xhtml"&gt; &lt;p&gt;This is a chunk of XHTML.&lt;/p&gt; &lt;/div&gt; &lt;/description&gt;</code></pre><p>produces:</p><pre class="programlisting language-markup line-numbers"><code>&lt;description&gt; &amp;lt;div xmlns="http://www.w3.org/1999/xhtml"&amp;gt; &amp;lt;p&gt;This is a chunk of XHTML.&amp;lt;/p&amp;gt; &amp;lt;/div&amp;gt; &lt;/description&gt;</code></pre><div id="note-escaped" class="note admonition"><h3>Note</h3><div class="admonition-body"><p>The result of this step is an XML document that contains the Unicode characters that are the characters that result from escaping the input. It is not encoded characters in a serialized octet stream, therefore, the serialization options related to encoding characters (<code class="option">byte-order-mark</code>, <code class="option">encoding</code>, and <code class="option">normalization-form</code>) do not apply. They are omitted from the standard serialization options on this step.</p></div></div><p>By default, this step <span class="rfc2119" id="c.escape-markup.10.1">must not</span> generate an XML declaration in the escaped result.</p><section id="c.escape-markup.11" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section id="c.filter" class="section"><div class="section-titlepage"><h3>2.12 p:filter</h3></div><div class="content"><p>The <code class="code">p:filter</code> step selects portions of the source document based on a (possibly dynamically constructed) XPath select expression.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:filter</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">select</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>      </code><code class="comment">&lt;!-- </code><span class="opt-type">XPathExpression</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>This step behaves just like an <code class="tag-element">p:input</code> with a <code class="tag-attribute">select</code> expression except that the select expression is computed dynamically.</p><section id="c.filter.5" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.hash" class="section"><div class="section-titlepage"><h3>2.13 p:hash</h3></div><div class="content"><p>The <code class="tag-element">p:hash</code> step generates a hash, or digital “fingerprint”, for some value and injects it into the <code class="port">source</code> document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:hash</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item()*)?</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">value</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">algorithm</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>    </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'/*/node()'</code><code>"</code><code>/&gt;</code><code>  </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">version</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string?</code><code>"</code><code>/&gt;</code><code>                    </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">algorithm</code> option must be a QName. If it does not have a prefix, then it must be one of the following values: “crc”, “md”, or “sha”.</p><p>If a <code class="tag-attribute">version</code> is not specified, the default version is algorithm-defined. For “<code class="literal">crc</code>” it is 32, for “<code class="literal">md</code>” it is 5, for “<code class="literal">sha</code>” it is 1.</p><p><span style="display: none;" class="delete_version">A hash is constructed from the string specified in the <code class="option">value</code> option using the specified algorithm and version. Implementations <span class="rfc2119" id="c.hash.6.2">must</span> support [<a href="#bib.crc"><span class="abbrev">CRC32</span></a>], [<a href="#rfc1321"><span class="abbrev">MD5</span></a>], and [<a href="#bib.sha"><span class="abbrev">SHA1</span></a>] hashes. <span id="impl-25">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other algorithms are supported.</span> The resulting hash <span class="rfc2119" id="c.hash.6.7">should</span> be returned as a string of hexadecimal characters. </span><span style="display: none;" class="add_version">A hash is constructed from the string specified in the <code class="option">value</code> option using the specified algorithm and version. Implementations <span class="rfc2119" id="c.hash.6.2">must</span> support [<a href="#bib.crc"><span class="abbrev">CRC32</span></a>], [<a href="#rfc1321"><span class="abbrev">MD5</span></a>], and [<a href="#bib.sha"><span class="abbrev">SHA1</span></a>] hashes. <span id="impl-29">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other algorithms are supported.</span> The resulting hash <span class="rfc2119" id="c.hash.6.7">should</span> be returned as a string of hexadecimal characters. </span><span class="modify_version">A hash is constructed from the string specified in the <code class="option">value</code> option using the specified algorithm and version. Implementations <span class="rfc2119" id="c.hash.6.2">must</span> support [<a href="#bib.crc"><span class="abbrev">CRC32</span></a>], [<a href="#rfc1321"><span class="abbrev">MD5</span></a>], and [<a href="#bib.sha"><span class="abbrev">SHA1</span></a>] hashes. <span id="impl-29">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other algorithms are supported.</span> The resulting hash <span class="rfc2119" id="c.hash.6.7">should</span> be returned as a string of hexadecimal characters. </span></p><p>The value of the <code class="option">match</code> option must be an XSLTSelectionPattern.</p><p>The hash of the specified value is computed using the algorithm and parameters specified. <a id="err.inline.C0036"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0036"><code class="errqname">err:XC0036</code></a>) if the requested hash algorithm is not one that the processor understands or if the value or parameters are not appropriate for that algorithm.</p><p><span style="display: none;" class="delete_version">The matched nodes are specified with the <em class="glossterm">selection pattern</em> in the <code class="option">match</code> option. For each matching node, the string value of the computed hash is used in the output (if more than one node matches, the <em>same</em> hash value is used in each match). Nodes that do not match are copied without change.</span><span style="display: none;" class="add_version">The matched nodes are specified with the <em class="glossterm"><a href="#dt-selection-pattern">selection pattern</a></em> in the <code class="option">match</code> option. For each matching node, the string value of the computed hash is used in the output (if more than one node matches, the <em>same</em> hash value is used in each match). Nodes that do not match are copied without change.</span><span class="modify_version">The matched nodes are specified with the <em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">selection</span><span class="deltaxml-old" style="background:#FF5555"> pattern</span><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em> in the <code class="option">match</code> option. For each matching node, the string value of the computed hash is used in the output (if more than one node matches, the <em>same</em> hash value is used in each match). Nodes that do not match are copied without change.</span></p><p>If the expression given in the <code class="option">match</code> option matches an <em>attribute</em>, the hash is used as the new value of the attribute in the output. If the attribute is named “<code class="tag-attribute">xml:base</code>”, the base URI of the element <span class="rfc2119" id="c.hash.10.4">must</span> also be amended accordingly.</p><p>If the expression matches any other kind of node, the entire node (and <em>not</em> just its contents) is replaced by the hash.</p><section id="c.hash.12" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>If the resulting document contains exactly one text node, the <code class="literal">content-type</code> property is changed to <code class="literal">text/plain</code> and the <code class="literal">serialization</code> property is removed, while all other document properties are preserved. For other document types, all document properties are preserved.</p></div></section></div></section><section class="section" id="c.http-request"><div class="section-titlepage"><h3>2.14 p:http-request</h3></div><div class="content"><p>The <code class="code">p:http-request</code> step provides for interaction with resources over HTTP or related protocols. The input document provided on the <code class="port">source</code> port specifies a request by a single <a href="#cv.request"><code class="tag-element">c:request</code></a> element. This element specifies the method, resource, and other request properties as well as possibly including an entity body (content) for the request.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:http-request</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">serialization</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item()*)?</code><code>"</code><code>/&gt;</code><code>  </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The <code class="option">serialization</code> option is provided to control the serialization of any content which is sent as part of the request. The effect of these options is as specified in [<a href="#xproc30"><span class="abbrev">XProc 3.0</span></a>]. See <a href="#c.request_body" title="Request Entity body conversion">Section 2.14.2, “Request Entity body conversion”</a> for a discussion of when serialization occurs in constructing a request.</p><p><a id="err.inline.C0040"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0040"><code class="errqname">err:XC0040</code></a>) if the document element of the document that arrives on the <code class="port">source</code> port is not <a href="#cv.request"><code class="tag-element">c:request</code></a>.</p><div id="ednote-json" class="note editorial admonition"><h3>Editorial Note</h3><div class="admonition-body"><p>Can the input document be JSON?</p></div></div><section class="section" id="cv.request"><div class="section-titlepage"><h4>2.14.1 Specifying a request</h4></div><div class="content"><p>An HTTP request is represented by a <code class="tag-element">c:request</code> element.</p><p class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:request<br />  <strong>method</strong> = <var>NCName</var><br />  href? = <var>anyURI</var><br />  detailed? = <var>boolean</var><br />  status-only? = <var>boolean</var><br />  username? = <var>string</var><br />  password? = <var>string</var><br />  auth-method? = <var>string</var><br />  send-authorization? = <var>boolean</var><br />  override-content-type? = <var>ContentType</var><br />  timeout? = <var>positiveInteger</var><br />  fail-on-timeout? = <var>boolean</var>&gt;<br />    (<a href="#cv.header">c:header</a>*,<br />     (<a href="#cv.multipart">c:multipart</a> | <br />      <a href="#cv.body">c:body</a>)?)<br />&lt;/c:request&gt;</code></p><p><a id="err.inline.C0006"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0006"><code class="errqname">err:XC0006</code></a>) if the <code class="tag-attribute">method</code> is not specified on a <code class="tag-element">c:request</code>. <a id="err.inline.C0005"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0005"><code class="errqname">err:XC0005</code></a>) if the request contains a <a href="#cv.body"><code class="tag-element">c:body</code></a> or <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> but the <code class="tag-attribute">method</code> does not allow for an entity body being sent with the request.</p><p><a id="err.inline.C0004"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0004"><code class="errqname">err:XC0004</code></a>) if the <code class="code">status-only</code> attribute has the value <code class="literal">true</code> and the <code class="code">detailed</code> attribute does not have the value <code class="literal">true</code>.</p><p>The <code class="code">method</code> attribute specifies the method to be used against the IRI specified by the <code class="code">href</code> attribute, e.g. <code class="code">GET</code> or <code class="code">POST</code> (the value is not case-sensitive). If the <code class="code">href</code> attribute is not absolute, it will be resolved against the base URI of the element on which it is occurs.</p><div id="note-http-get" class="note admonition"><h3>Note</h3><div class="admonition-body"><p>In the case of simple “GET” requests, implementors are encouraged to support as many protocols as practical. In particular, pipeline authors may attempt to use <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> to load documents with computed URIs using the <code class="literal">file:</code> scheme.</p></div></div><p>If the <code class="code">username</code> attribute is specified, the <code class="code">username</code>, <code class="code">password</code>, <code class="code">auth-method</code>, and <code class="code">send-authorization</code> attributes are used to handle authentication according to the selected authentication method.</p><p>For the purposes of avoiding an authentication challenge, if the <code class="code">send-authorization</code> attribute has the value <code class="literal">true</code> and the authentication method specified by the <code class="code">auth-method</code> supports generation of an <code class="code">Authorization</code> header without a challenge, then an <code class="code">Authorization</code> header is generated and sent on the first request. If the <code class="code">send-authorization</code> attribute is absent or has the value <code class="literal">false</code>, then the first request is sent without an <code class="code">Authorization</code> header.</p><p>If the initial response to the request is an authentication challenge, the <code class="code">auth-method</code>, <code class="code">username</code>, <code class="code">password</code> and any relevant data from the challenge are used to generate an <code class="code">Authorization</code> header and the request is sent again. If that authorization fails, the request is not retried.</p><p><span style="display: none;" class="delete_version">Appropriate values for the <code class="code">auth-method</code> attribute are “Basic” or “Digest” but other values are allowed. If the authentication method is “Basic” or “Digest”, authentication is handled as per [<a href="#rfc2617"><span class="abbrev">RFC 2617</span></a>]. <span id="impl-26">The interpretation of <code class="code">auth-method</code> values on <code class="tag-element">c:request</code> other than “Basic” or “Digest” is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version">Appropriate values for the <code class="code">auth-method</code> attribute are “Basic” or “Digest” but other values are allowed. If the authentication method is “Basic” or “Digest”, authentication is handled as per [<a href="#rfc2617"><span class="abbrev">RFC 2617</span></a>]. <span id="impl-30">The interpretation of <code class="code">auth-method</code> values on <code class="tag-element">c:request</code> other than “Basic” or “Digest” is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version">Appropriate values for the <code class="code">auth-method</code> attribute are “Basic” or “Digest” but other values are allowed. If the authentication method is “Basic” or “Digest”, authentication is handled as per [<a href="#rfc2617"><span class="abbrev">RFC 2617</span></a>]. <span id="impl-30">The interpretation of <code class="code">auth-method</code> values on <code class="tag-element">c:request</code> other than “Basic” or “Digest” is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p><p><a id="err.inline.C0003"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0003"><code class="errqname">err:XC0003</code></a>) if a <code class="option">username</code> or <code class="option">password</code> is specified without specifying an <code class="option">auth-method</code>, if the requested <code class="option">auth-method</code> isn't supported, or the authentication challenge contains an authentication method that isn't supported. All implementations are required to support "Basic" and "Digest" authentication per [<a href="#rfc2617"><span class="abbrev">RFC 2617</span></a>].</p><p>The attribute <code class="code">timeout</code> controls the time the XProc processor is waiting for the request to be answered. If a value is given for <code class="code">timeout</code> it is taken as the number of seconds to wait for the response to be delivered. If no response is received after that time, the request is terminated.</p><div class="itemizedlist"><ul><li><p><a id="err.inline.C0078"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0078"><code class="errqname">err:XC0078</code></a>) if <code class="option">fail-on-timeout</code> is specified as <code class="literal">true</code> and a value is given for <code class="option">timeout</code> and the <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> is not finished in the time specified by <code class="option">timeout</code>. </p></li><li><p>If <code class="code">fail-on-timeout</code> is <code class="literal">false</code>, a <code class="code">c:response</code> document with <code class="code">status=408</code> is generated.</p></li><li><p>If no value is given for <code class="code">fail-on-timeout</code>, <code class="literal">false</code> is assumed. If no value is given for <code class="code">timeout</code>, <code class="code">fail-on-timeout</code> is ignored.</p></li></ul></div><div class="note admonition"><h3>Note</h3><div class="admonition-body"><p>Please note the difference between option <code class="code">p:timeout</code> on <code class="code">p:http-request</code> and the attribute <code class="code">timeout</code> in combination with <code class="code">fail-on-timeout="true"</code> on <code class="code">c:request</code>. If the step does not finish in the set time, <code class="code">D0053</code> is raised. If the request does not finish in time and fail-on-timeout is true, <code class="code">C0078</code> is raised. The actual times after which a timeout is detected may also differ slightly. </p></div></div><p>The <code class="code">c:header</code> element specifies a header name and value, either for inclusion in a request, or as received in a response.</p><p class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:header<br />  <strong>name</strong> = <var>string</var><br />  <strong>value</strong> = <var>string</var> /&gt;</code></p><p>The request is formulated from the attribute values on the <code class="tag-element">c:request</code> element and its <a href="#cv.header"><code class="tag-element">c:header</code></a> and <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> or <a href="#cv.body"><code class="tag-element">c:body</code></a> children, if present, and transmitted to the host (and port, if present) specified by the <code class="code">href</code> attribute. The details of how the request entity body, if any, is constructed are given in <a href="#c.response_body" title="Converting Response Entity Bodies">Section 2.14.4, “Converting Response Entity Bodies”</a>.</p><p>When the request is formulated, the step and/or protocol implementation may add headers as necessary to either complete the request or as appropriate for the content specified (e.g. transfer encodings). A user of this step is guaranteed that their requested headers and content will be sent with the exception of any conflicts with protocol-related headers.</p><p>The <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step allows users to specify independently values that are not always independent. For example, some combinations of <a href="#cv.header"><code class="tag-element">c:header</code></a> values (e.g., <code class="literal">Content-Type</code>) may be inconsistent with values that the step and/or protocol implementation must set. In a few cases, the step provides more than one mechanism to specify what is actually a single value (e.g., the boundary string in multipart messages). <a id="err.inline.C0020"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0020"><code class="errqname">err:XC0020</code></a>) if the the user specifies a value or values that are inconsistent with each other or with the requirements of the step or protocol. </p></div></section><section id="c.request_body" class="section"><div class="section-titlepage"><h4>2.14.2 Request Entity body conversion</h4></div><div class="content"><p>The <code class="code">c:multipart</code> element specifies a multi-part body, per [<a href="#rfc2046"><span class="abbrev">RFC 2046</span></a>], either for inclusion in a request or as received in a response.</p><p class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:multipart<br />  <strong>content-type</strong> = <var>ContentType</var><br />  <strong>boundary</strong> = <var>string</var>&gt;<br />    <a href="#cv.body">c:body</a>+<br />&lt;/c:multipart&gt;</code></p><p><span style="display: none;" class="delete_version">In the context of a request, the media type of the <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a><span class="rfc2119" id="c.request_body.4.2">must</span> be a multipart media type (i.e. have a main type of 'multipart'). If the <code class="code">content-type</code> attribute is not specified, a value of “<code class="literal">multipart/mixed</code>” will be assumed. (<span id="impl-27">Whether or not, and to what extent, “<code class="literal">multipart/byte-ranges</code>” responses are supported is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.)</span></span><span style="display: none;" class="add_version">In the context of a request, the media type of the <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a><span class="rfc2119" id="c.request_body.4.2">must</span> be a multipart media type (i.e. have a main type of 'multipart'). If the <code class="code">content-type</code> attribute is not specified, a value of “<code class="literal">multipart/mixed</code>” will be assumed. (<span id="impl-31">Whether or not, and to what extent, “<code class="literal">multipart/byte-ranges</code>” responses are supported is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.)</span></span><span class="modify_version">In the context of a request, the media type of the <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a><span class="rfc2119" id="c.request_body.4.2">must</span> be a multipart media type (i.e. have a main type of 'multipart'). If the <code class="code">content-type</code> attribute is not specified, a value of “<code class="literal">multipart/mixed</code>” will be assumed. (<span id="impl-31">Whether or not, and to what extent, “<code class="literal">multipart/byte-ranges</code>” responses are supported is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.)</span></span></p><p>The <code class="code">boundary</code> attribute is required and is used to provide a multipart boundary marker. The implementation must use this boundary marker and must prefix the value with the string “<code class="literal">--</code>” when formulating the multipart message. <a id="err.inline.C0002"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0002"><code class="errqname">err:XC0002</code></a>) if the value starts with the string “<code class="literal">--</code>”.</p><p>If the boundary is also specified as a parameter in the <code class="option">content-type</code> option, then the parameter value specified and the <code class="option">boundary</code> value specified <span class="rfc2119" id="c.request_body.6.3">must</span> be the same. If the boundary is specified in both the <code class="option">boundary</code> option and the <code class="option">content-type</code> option then the two values <span class="rfc2119" id="c.request_body.6.6">must</span> be the same.</p><p>The <a href="#cv.body"><code class="tag-element">c:body</code></a> element holds the body or body part of the message. Each of the attributes holds controls some aspect of the encoding the request body or decoding the body element's content when the request is formulated. These are specified as follows:</p><p class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:body<br />  <strong>content-type</strong> = <var>ContentType</var><br />  encoding? = <var>string</var><br />  id? = <var>string</var><br />  description? = <var>string</var><br />  disposition? = <var>string</var>&gt;<br />    <var>anyNode</var>*<br />&lt;/c:body&gt;</code></p><p>The <code class="code">content-type</code> attribute specifies the media type of the body or body part, that is, the value of its <code class="code">Content-Type</code> header. If the media type is not an XML type or text, the content must already be base64-encoded.</p><p><span style="display: none;" class="delete_version">The <code class="code">encoding</code> attribute controls the decoding of the element content for formulating the body. A value of <code class="literal">base64</code> indicates the element's content is a base64 encoded string whose byte stream should be sent as the message body. <span id="impl-28">An implementation may support encodings other than <code class="literal">base64</code> but these encodings and their names are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0052"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0052"><code class="errqname">err:XC0052</code></a>) if the encoding specified is not supported by the implementation.</span><span style="display: none;" class="add_version">The <code class="code">encoding</code> attribute controls the decoding of the element content for formulating the body. A value of <code class="literal">base64</code> indicates the element's content is a base64 encoded string whose byte stream should be sent as the message body. <span id="impl-32">An implementation may support encodings other than <code class="literal">base64</code> but these encodings and their names are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0052"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0052"><code class="errqname">err:XC0052</code></a>) if the encoding specified is not supported by the implementation.</span><span class="modify_version">The <code class="code">encoding</code> attribute controls the decoding of the element content for formulating the body. A value of <code class="literal">base64</code> indicates the element's content is a base64 encoded string whose byte stream should be sent as the message body. <span id="impl-32">An implementation may support encodings other than <code class="literal">base64</code> but these encodings and their names are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0052"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0052"><code class="errqname">err:XC0052</code></a>) if the encoding specified is not supported by the implementation.</span></p><div id="note-single-set-ser" class="note admonition"><h3>Note</h3><div class="admonition-body"><p>The <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step provides only a single set of serialization options for XML media types. There's no direct support for sending a multipart message with two XML parts encoded differently.</p></div></div><p>For each body or body part, the <code class="code">id</code> attribute specifies the value of the <code class="code">Content-ID</code> header; the <code class="code">description</code> attribute specifies the value of the <code class="code">Content-Description</code> header; and the <code class="code">disposition</code> attribute specifies the value of the <code class="code">Content-Disposition</code> header. </p><p>If an entity body is to be sent as part of a request (e.g. a <code class="code">POST</code>), either a <a href="#cv.body"><code class="tag-element">c:body</code></a> element, specifying the request entity body, or a <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> element, specifying multiple entity body parts, may be used. When <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> is used it may contain multiple <a href="#cv.body"><code class="tag-element">c:body</code></a> children. A <a href="#cv.body"><code class="tag-element">c:body</code></a> specifies the construction of a body or body part as follows:</p><p>If the <code class="code">content-type</code> attribute does not specify an XML media type, or the <code class="code">encoding</code> attribute is “<code class="literal">base64</code>”, then <a id="err.inline.C0028"></a>it is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0028"><code class="errqname">err:XC0028</code></a>) if the content of the <a href="#cv.body"><code class="tag-element">c:body</code></a> element does not consist entirely of characters, and the entity body or body part will consist of exactly those characters.</p><p>Otherwise (the <code class="code">content-type</code> attribute <em>does</em> specify an XML media type and the <code class="code">encoding</code> attribute is <em>not</em> 'base64'), <a id="err.inline.C0022"></a>it is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0022"><code class="errqname">err:XC0022</code></a>) if the content of the <a href="#cv.body"><code class="tag-element">c:body</code></a> element does not consist of exactly one element, optionally preceded and/or followed by any number of processing instructions, comments or whitespace characters, and the entity body or body part will consist of the serialization of a document node containing that content. The serialization of that document is controlled by the serialization options on the <code class="code">p:http-request</code> step itself.</p><p>For example, the following input to a <code class="code">p:http-request</code> step will POST a small XML document:</p><pre class="programlisting language-markup line-numbers"><code>&lt;c:request method="POST" href="http://example.com/someservice"&gt; &lt;c:body xmlns:c="http://www.w3.org/ns/xproc-step" content-type="application/xml"&gt; &lt;doc&gt; &lt;title&gt;My document&lt;/title&gt; &lt;/doc&gt; &lt;/c:body&gt; &lt;/c:request&gt; </code></pre><p>The corresponding request should look something like this:</p><pre class="programlisting language-markup line-numbers"><code>POST http://example.com/someservice HTTP/1.1 Host: example.com Content-Type: application/xml; charset="utf-8" &lt;?xml version='1.0'?&gt; &lt;doc&gt; &lt;title&gt;My document&lt;/title&gt; &lt;/doc&gt; </code></pre></div></section><section class="section" id="c.request_response"><div class="section-titlepage"><h4>2.14.3 Managing the response</h4></div><div class="content"><div id="ednote-content-types" class="note editorial admonition"><h3>Note</h3><div class="admonition-body"><p>Where do we say that for URI schemes (such as <code class="code">file:</code> and <code class="code">ftp:</code>) where a content type is not provided by the underlying request, the content type is implementation-dependent?</p></div></div><p>The handling of the response to the request and the generation of the step's result document is controlled by the <code class="code">status-only</code>, <code class="code">override-content-type</code> and <code class="code">detailed</code> attributes on the <a href="#cv.request"><code class="tag-element">c:request</code></a> input.</p><p>The <code class="code">override-content-type</code> attribute controls interpretation of the response's <code class="code">Content-Type</code> header. If this attribute is present, the response will be treated as if it returned the <code class="code">Content-Type</code> given by its value. This original <code class="code">Content-Type</code> header will however be reflected unchanged as a <a href="#cv.header"><code class="tag-element">c:header</code></a> in the result document. <a id="err.inline.C0030"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0030"><code class="errqname">err:XC0030</code></a>) if the <code class="code">override-content-type</code> value cannot be used (e.g. <code class="code">text/plain</code> to override <code class="code">image/png</code>).</p><p>If the <code class="code">override-content-type</code> includes an encoding parameter, then that encoding <span class="rfc2119" id="c.request_response.5.2">must</span> be used to read the document.</p><p>If the <code class="code">status-only</code> attribute has the value <code class="literal">true</code>, the result document will contain only header information. The entity of the response will not be processed to produce a <a href="#cv.body"><code class="tag-element">c:body</code></a> or <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> element.</p><p>The <a href="#c.response"><code class="tag-element">c:response</code></a> element represents an HTTP response. The response's status code is encoded in the <code class="code">status</code> attribute and the headers and entity body are processing into <a href="#cv.header"><code class="tag-element">c:header</code></a> and <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> or <a href="#cv.body"><code class="tag-element">c:body</code></a> content.</p><p class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:response<br />  status? = <var>integer</var>&gt;<br />    (<a href="#cv.header">c:header</a>*,<br />     (<a href="#cv.multipart">c:multipart</a> | <br />      <a href="#cv.body">c:body</a>)?)<br />&lt;/c:response&gt;</code></p><p>The value of the <code class="code">detailed</code> attribute determines the content of the result document. If it is <code class="literal">true</code>, the response to the request is handled as follows:</p><div class="orderedlist"><ol style="list-style: decimal;"><li><p>A single <a href="#c.response"><code class="tag-element">c:response</code></a> element is produced with the <code class="code">status</code> attribute containing the status of the response received.</p></li><li><p>Each response header is translated into a <a href="#cv.header"><code class="tag-element">c:header</code></a> element.</p></li><li><p>Unless the <code class="code">status-only</code> attribute has a value <code class="literal">true</code>, the entity body of the response is converted into a <a href="#cv.body"><code class="tag-element">c:body</code></a> or <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> element via the rules given in <a href="#c.response_body" title="Converting Response Entity Bodies">Section 2.14.4, “Converting Response Entity Bodies”</a>.</p></li></ol></div><p>Otherwise (the <code class="code">detailed</code> attribute is not specified or its value is <code class="literal">false</code>), the response to the request is handled as follows:</p><div class="orderedlist"><ol style="list-style: decimal;"><li><p>If the media type (as determined by the <code class="code">override-content-type</code> attribute or the <code class="code">Content-Type</code> response header) is an XML media type, the entity is decoded if necessary, then parsed as an XML document:</p><div class="itemizedlist"><ul><li><p>The parser which <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> employs <span class="rfc2119" id="c.request_response.12.1.2.1.1.2">must</span> process the external subset; all general and external parsed entities <span class="rfc2119" id="c.request_response.12.1.2.1.1.3">must</span> be fully expanded.</p><div id="ednote-parser" class="note editorial admonition"><h3>Editorial Note</h3><div class="admonition-body"><p>The requirement to process the external subset comes from p:load, we probably don't want to impose that on all p:http-request calls. Need a way to control it?</p></div></div></li><li><p>It <span class="rfc2119" id="c.request_response.12.1.2.2.1.1">may</span> perform <code class="tag-attribute">xml:id</code> processing, but it <span class="rfc2119" id="c.request_response.12.1.2.2.1.3">must not</span> perform any other processing, such as expanding XIncludes.</p></li><li><p>The parser <span class="rfc2119" id="c.request_response.12.1.2.3.1.1">must</span> be conformant to <em class="citetitle">Namespaces in XML</em>.</p></li><li><p>Parsing the document <span class="rfc2119" id="c.request_response.12.1.2.4.1.1">must not</span> fail due to validation errors. </p></li></ul></div><p>The resulting XML document is produced on the <code class="code">result</code> output port as the entire output of the step.</p></li><li><p>Otherwise, the entity body of the response is converted into a <a href="#cv.body"><code class="tag-element">c:body</code></a> or <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> element via the rules given in <a href="#c.response_body" title="Converting Response Entity Bodies">Section 2.14.4, “Converting Response Entity Bodies”</a>.</p></li></ol></div><p>In either case the base URI of the output document is the resolved value of the <code class="code">href</code> attribute from the input <a href="#cv.request"><code class="tag-element">c:request</code></a>.</p><section id="redirects" class="section"><div class="section-titlepage"><h5>2.14.3.1 Redirects</h5></div><div class="content"><p>One possible response from an HTTP request is a redirect, indicated by a status code in the three-hundred range. The precise semantics of the 3xx return codes are laid out by section <em class="citetitle">10.3 Redirection 3xx</em> in [<a href="#rfc2616"><span class="abbrev">RFC 2616</span></a>]. </p><p>The <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step <span class="rfc2119" id="redirects.3.2">should</span> follow redirect requests (in a manner consistent with [<a href="#rfc2616"><span class="abbrev">RFC 2616</span></a>]) if they are returned by the server. </p></div></section><section id="cookies" class="section"><div class="section-titlepage"><h5>2.14.3.2 Cookies</h5></div><div class="content"><p><span style="display: none;" class="delete_version">With one exception, in version 1.0 of XProc, the <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step does not provide any standard mechanisms for managing cookies. <span id="impl-29">Pipeline authors that need to preserve cookies across several <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> calls in the same pipeline or across multiple invocations of the same or different pipelines will have to rely on <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> mechanisms.</span></span><span style="display: none;" class="add_version">With one exception, in version 1.0 of XProc, the <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step does not provide any standard mechanisms for managing cookies. <span id="impl-33">Pipeline authors that need to preserve cookies across several <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> calls in the same pipeline or across multiple invocations of the same or different pipelines will have to rely on <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> mechanisms.</span></span><span class="modify_version">With one exception, in version 1.0 of XProc, the <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step does not provide any standard mechanisms for managing cookies. <span id="impl-33">Pipeline authors that need to preserve cookies across several <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> calls in the same pipeline or across multiple invocations of the same or different pipelines will have to rely on <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> mechanisms.</span></span></p><p>The exception arises in the case of redirection. If a redirect response includes cookies, those cookies <span class="rfc2119" id="cookies.3.1">should</span> be forwarded as appropriate to the redirected location when the redirection is followed.</p><p>This behavior will allow the <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step to interoperate with web services that use cookies as part of an authentication protocol.</p></div></section></div></section><section class="section" id="c.response_body"><div class="section-titlepage"><h4>2.14.4 Converting Response Entity Bodies</h4></div><div class="content"><p>The entity of a response may be multipart per [<a href="#rfc2046"><span class="abbrev">RFC 2046</span></a>]. In those situations, the result document will be a <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> element that contains multiple <a href="#cv.body"><code class="tag-element">c:body</code></a> elements inside.</p><div class="note admonition" id="note-multipart-multipart"><h3>Note</h3><div class="admonition-body"><p><span style="display: none;" class="delete_version">Although it is technically possible for any of the individual parts of a multipart message to <em>also</em> be multipart, XProc does not provide a standard representation for such messages. <span id="impl-30">The interpretation of a multipart message inside another multipart message is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span><span style="display: none;" class="add_version">Although it is technically possible for any of the individual parts of a multipart message to <em>also</em> be multipart, XProc does not provide a standard representation for such messages. <span id="impl-34">The interpretation of a multipart message inside another multipart message is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span><span class="modify_version">Although it is technically possible for any of the individual parts of a multipart message to <em>also</em> be multipart, XProc does not provide a standard representation for such messages. <span id="impl-34">The interpretation of a multipart message inside another multipart message is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span></p></div></div><p>The result of the <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step is an XML document. For media types (images, binaries, etc.) that can't be represented as a sequence of Unicode characters, the response is encoded as <code class="literal">base64</code> and then returned as text children of the <a href="#cv.body"><code class="tag-element">c:body</code></a> element. If the content is base64-encoded, the <code class="tag-attribute">encoding</code> attribute on <a href="#cv.body"><code class="tag-element">c:body</code></a> must be set to “<code class="literal">base64</code>”.</p><div id="ednote-non-xml" class="note editorial admonition"><h3>Editorial Note</h3><div class="admonition-body"><p>This section hasn't been updated to reflect the fact that non-XML documents are now possible. It should probably say something like:</p><p>If the document identified has a non-XML content type, no extra processing is mandated. The number and variety of media types that an implementation can load is implementation-defined.</p></div></div><p>If the media type of the response is a text type with a <code class="code">charset</code> parameter that is a Unicode character encoding (per [<a href="#unicodetr17"><span class="abbrev">Unicode TR#17</span></a>]) or is recognized as a non-XML media type whose contents are encoded as a sequence of Unicode characters (e.g. it has a character parameter or the definition of the media type is such that it requires Unicode), the content of the constructed <a href="#cv.body"><code class="tag-element">c:body</code></a> element is the translation of the text into a sequence of Unicode characters.</p><p>If the response is an XML media type, the content of the constructed <a href="#cv.body"><code class="tag-element">c:body</code></a> element is the result of decoding the body as necessary, then parsing it with an XML parser.</p><div class="itemizedlist"><ul><li><p>The parser which <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> employs <span class="rfc2119" id="c.response_body.8.1.1.2">must</span> process the external subset; all general and external parsed entities <span class="rfc2119" id="c.response_body.8.1.1.3">must</span> be fully expanded.</p><div id="ednote-parser" class="note editorial admonition"><h3>Editorial Note</h3><div class="admonition-body"><p>The requirement to process the external subset comes from p:load, we probably don't want to impose that on all p:http-request calls. Need a way to control it?</p></div></div></li><li><p>It <span class="rfc2119" id="c.response_body.8.2.1.1">may</span> perform <code class="tag-attribute">xml:id</code> processing, but it <span class="rfc2119" id="c.response_body.8.2.1.3">must not</span> perform any other processing, such as expanding XIncludes.</p></li><li><p>The parser <span class="rfc2119" id="c.response_body.8.3.1.1">must</span> be conformant to <em class="citetitle">Namespaces in XML</em>.</p></li><li><p>Parsing the document <span class="rfc2119" id="c.response_body.8.4.1.1">must not</span> fail due to validation errors. </p></li></ul></div><p>If the content is not well-formed, the step fails.</p><div id="ednote-combine-parsing" class="note editorial admonition"><h3>Editorial Note</h3><div class="admonition-body"><p>This prose should be consolidated into a single place.</p></div></div><p>In a <a href="#cv.body"><code class="tag-element">c:body</code></a> in a response, the <code class="tag-attribute">content-type</code> attribute <span class="rfc2119" id="c.response_body.11.3">must</span> be an exact copy of the value returned in the <code class="literal">Content-Type</code> header. That is, it must reflect the content type actually returned, not any override value that may have been specified, and it must include any parameters returned by the server.</p><p>In the case of a multipart response, the same rules apply when constructing a <a href="#cv.body"><code class="tag-element">c:body</code></a> element for each body part encountered.</p><div id="note-text-html" class="note admonition"><h3>Note</h3><div class="admonition-body"><p>Given the above description, any content identified as <code class="code">text/html</code> will be encoded as (escaped) text or base64-encoded in the <a href="#cv.body"><code class="tag-element">c:body</code></a> element, as HTML isn't always well-formed XML. A user can attempt to convert such content into XML using the <a href="#c.unescape-markup"><code class="tag-element">p:unescape-markup</code></a> step.</p></div></div></div></section><section id="example-http-request" class="section"><div class="section-titlepage"><h4>2.14.5 HTTP Request Example</h4></div><div class="content"><p>A simple form might be posted as follows:</p><pre class="programlisting language-markup line-numbers"><code>&lt;c:request method="POST" href="http://www.example.com/form-action" xmlns:c="http://www.w3.org/ns/xproc-step"&gt; &lt;c:body content-type="application/x-www-form-urlencoded"&gt; name=W3C&amp;amp;spec=XProc &lt;/c:body&gt; &lt;/c:request&gt;</code></pre><p>and if the response was an XHTML document, the result document would be:</p><pre class="programlisting language-markup line-numbers"><code>&lt;c:response status="200" xmlns:c="http://www.w3.org/ns/xproc-step"&gt; &lt;c:header name="Date" value=" Wed, 09 May 2007 23:12:24 GMT"/&gt; &lt;c:header name="Server" value="Apache/1.3.37 (Unix) PHP/4.4.5"/&gt; &lt;c:header name="Vary" value="negotiate,accept"/&gt; &lt;c:header name="TCN" value="choice"/&gt; &lt;c:header name="P3P" value="policyref='http://www.w3.org/2001/05/P3P/p3p.xml'"/&gt; &lt;c:header name="Cache-Control" value="max-age=600"/&gt; &lt;c:header name="Expires" value="Wed, 09 May 2007 23:22:24 GMT"/&gt; &lt;c:header name="Last-Modified" value="Tue, 08 May 2007 16:10:49 GMT"/&gt; &lt;c:header name="ETag" value="'4640a109;42380ddc'"/&gt; &lt;c:header name="Accept-Ranges" value="bytes"/&gt; &lt;c:header name="Keep-Alive" value="timeout=2, max=100"/&gt; &lt;c:header name="Connection" value="Keep-Alive"/&gt; &lt;c:body content-type="application/xhtml+xml"&gt; &lt;html xmlns="http://www.w3.org/1999/xhtml"&gt; &lt;head&gt;&lt;title&gt;OK&lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;p&gt;OK!&lt;/p&gt;&lt;/body&gt; &lt;/html&gt; &lt;/c:body&gt; &lt;/c:response&gt;</code></pre></div></section><section id="c.http-request.12" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.identity" class="section"><div class="section-titlepage"><h3>2.15 p:identity</h3></div><div class="content"><p>The <code class="code">p:identity</code> step makes a verbatim copy of its input available on its output.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:identity</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">any</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">any</code><code>"</code><code>/&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>If the implementation supports passing PSVI annotations between steps, the <code class="tag-element">p:identity</code> step <span class="rfc2119" id="c.identity.4.2">must</span> preserve any annotations that appear in the input.</p><section id="c.identity.5" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section id="c.insert" class="section"><div class="section-titlepage"><h3>2.16 p:insert</h3></div><div class="content"><p>The <code class="code">p:insert</code> step inserts the <code class="code">insertion</code> port's document into the <code class="port">source</code> port's document relative to the matching elements in the <code class="code">source</code> port's document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:insert</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">insertion</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'/*'</code><code>"</code><code>/&gt;</code><code>         </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">position</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:token</code><code>"</code><code class="attr values-attr">values</code><code>="</code><code class="value values-value">('first-child','last-child','before','after')</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'after'</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">match</code> option <span class="rfc2119" id="c.insert.4.2">must</span> be an XSLTSelectionPattern. <a id="err.inline.C0023.2"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if that pattern matches an attribute or a namespace node. Multiple matches are allowed, in which case multiple copies of the <code class="port">insertion</code> documents will occur. If no elements match, then the document is unchanged.</p><p>The value of the <code class="option">position</code> option <span class="rfc2119" id="c.insert.5.2">must</span> be an NMTOKEN in the following list: </p><div class="itemizedlist"><ul><li><p>“<code class="literal">first-child</code>” - the insertion is made as the first child of the match;</p></li><li><p>“<code class="literal">last-child</code>” - the insertion is made as the last child of the match;</p></li><li><p>“<code class="literal">before</code>” - the insertion is made as the immediate preceding sibling of the match;</p></li><li><p>“<code class="literal">after</code>” - the insertion is made as the immediate following sibling of the match.</p></li></ul></div><p><span style="display: none;" class="delete_version"><a id="err.inline.C0025"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0025"><code class="errqname">err:XC0025</code></a>) if the <em class="glossterm">selection pattern</em> matches anything other than an element or a document node and the value of the <code class="option">position</code> option is “<code class="literal">first-child</code>” or “<code class="literal">last-child</code>”. <a id="err.inline.C0024"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0024"><code class="errqname">err:XC0024</code></a>) if the <em class="glossterm">selection pattern</em> matches a document node and the value of the <code class="option">position</code> is “<code class="literal">before</code>” or “<code class="literal">after</code>”.</span><span style="display: none;" class="add_version"><a id="err.inline.C0025"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0025"><code class="errqname">err:XC0025</code></a>) if the <em class="glossterm"><a href="#dt-selection-pattern">selection pattern</a></em> matches anything other than an element or a document node and the value of the <code class="option">position</code> option is “<code class="literal">first-child</code>” or “<code class="literal">last-child</code>”. <a id="err.inline.C0024"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0024"><code class="errqname">err:XC0024</code></a>) if the <em class="glossterm"><a href="#dt-selection-pattern">selection pattern</a></em> matches a document node and the value of the <code class="option">position</code> is “<code class="literal">before</code>” or “<code class="literal">after</code>”.</span><span class="modify_version"><a id="err.inline.C0025"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0025"><code class="errqname">err:XC0025</code></a>) if the <em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">selection</span><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em> <span class="deltaxml-old" style="background:#FF5555">pattern</span><span class="deltaxml-old" style="background:#FF5555"> </span>matches anything other than an element or a document node and the value of the <code class="option">position</code> option is “<code class="literal">first-child</code>” or “<code class="literal">last-child</code>”. <a id="err.inline.C0024"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0024"><code class="errqname">err:XC0024</code></a>) if the <em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">selection</span><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em> <span class="deltaxml-old" style="background:#FF5555">pattern</span><span class="deltaxml-old" style="background:#FF5555"> </span>matches a document node and the value of the <code class="option">position</code> is “<code class="literal">before</code>” or “<code class="literal">after</code>”.</span></p><p>As the inserted elements are part of the output of the step they are not considered in determining matching elements. If an empty sequence appears on the <code class="port">insertion</code> port, the result will be the same as the source.</p><section id="c.insert.9" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties on the <code class="port">source</code> port are preserved. No document properties on the <code class="port">insertion</code> port are preserved.</p></div></section></div></section><section id="c.label-elements" class="section"><div class="section-titlepage"><h3>2.17 p:label-elements</h3></div><div class="content"><p>The <code class="code">p:label-elements</code> step generates a label for each matched element and stores that label in the specified attribute.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:label-elements</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">attribute</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'xml:id'</code><code>"</code><code>/&gt;</code><code>  </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">label</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'concat("_",$p:index)'</code><code>"</code><code>/&gt;</code><code></code><code class="comment">&lt;!-- </code><span class="opt-type">XPathExpression</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'*'</code><code>"</code><code>/&gt;</code><code>          </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">replace</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code><code>/&gt;</code><code>    </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">label</code> option is an XPath expression used to generate the value of the attribute label.</p><p>The value of the <code class="option">match</code> option <span class="rfc2119" id="c.label-elements.5.2">must</span> be an XSLTSelectionPattern. <a id="err.inline.C0023.3"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if that expression matches anything other than element nodes.</p><p>The value of the <code class="option">replace</code><span class="rfc2119" id="c.label-elements.6.2">must</span> be a boolean value and is used to indicate whether existing attribute values are replaced.</p><p>This step operates by generating attribute labels for each element matched. For every matched element, the expression is evaluated with the context node set to the matched element. An attribute is added to the matched element using the attribute name is specified the <code class="option">attribute</code> option and the string value of result of evaluating the expression. If the attribute already exists on the matched element, the value is replaced with the string value only if the <code class="option">replace</code> option has the value of <code class="literal">true</code>.</p><p>If this step is used to add or change the value of an attribute named “<code class="literal">xml:base</code>”, the base URI of the element <span class="rfc2119" id="c.label-elements.8.2">must</span> also be amended accordingly.</p><p>An implementation must bind the variable “<code class="literal">p:index</code>” in the static context of each evaluation of the XPath expression to the position of the element in the sequence of matched elements. In other words, the first element (in document order) matched gets the value “<code class="literal">1</code>”, the second gets the value “<code class="literal">2</code>”, the third, “<code class="literal">3</code>”, etc.</p><p>The result of the p:label-elements step is the input document with the attribute labels associated with matched elements. All other non-matching content remains the same.</p><section id="c.label-elements.11" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section id="c.load" class="section"><div class="section-titlepage"><h3>2.18 p:load</h3></div><div class="content"><p>The <code class="code">p:load</code> step has no inputs but produces as its result a document (or documents) specified by an IRI.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:load</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">any</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">href</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>        </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item()*)?</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">content-type</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string?</code><code>"</code><code>/&gt;</code><code>               </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">document-properties</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName, item()*)?</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p><a id="err.inline.D0064.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.D0064"><code class="errqname">err:XD0064</code></a>) if the <code class="option">href</code> URI is not a valid <code class="type">xs:anyURI</code>. If the <code class="option">href</code> is relative, it is made absolute against the base URI of the element on which it is specified (<code class="tag-element">p:with-option</code> or <code class="tag-element">p:load</code> in the case of a syntactic shortcut value).</p><p>The document or documents identified by the <code class="option">href</code> URI are loaded and returned. If the URI protocol supports redirection, then redirects <span class="rfc2119" id="c.load.5.2">must</span> be followed.</p><p><a id="err.inline.D0011.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.D0011"><code class="errqname">err:XD0011</code></a>) if the resource referenced by a <code class="code">p:load</code> element does not exist or cannot be accessed.</p><p>The behavior of this step depends on the content type of the document or documents loaded. The content type of each document is determined as follows:</p><div class="orderedlist"><ol style="list-style: decimal;"><li><p>If a <span class="property">content-type</span> property is specified in <code class="option">document-properties</code> or <code class="option">content-type</code> is present, then each document <span class="rfc2119" id="c.load.8.1.1.4">must</span> be interpreted according to that content type. <a id="err.inline.D0062"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.D0062"><code class="errqname">err:XD0062</code></a>) if the <code class="tag-attribute">content-type</code> is specified and the document-properties has a “<code class="code">content-type</code>” that is not the same. </p></li><li><p>If the documents are retrieved with a URI protocol that specifies a content type (for example, <code class="literal">http:</code>), then the document <span class="rfc2119" id="c.load.8.2.1.2">must</span> be interpreted according to that content type. </p></li><li><p><span style="display: none;" class="delete_version"><span id="impl-31">In the absence of an explicit type, the content type is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em></span>.</span><span style="display: none;" class="add_version"><span id="impl-35">In the absence of an explicit type, the content type is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em></span>.</span><span class="modify_version"><span id="impl-35">In the absence of an explicit type, the content type is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em></span>.</span></p></li></ol></div><p>The <code class="option">parameters</code> map contains additional, optional parameters that may influence the way that content is loaded. The interpretation of this map varies according to the content type. Parameter names that are in no namespace are treated as strings using only the local-name where appropriate.</p><p>Broadly speaking, there are five categories of data that might be loaded: <a href="#c.load.xml">XML</a>, <a href="#c.load.text">text</a>, <a href="#c.load.json">JSON</a>, <a href="#c.load.html">HTML</a>, and “other” <a href="#c.load.binary">binary</a> data.</p><section class="section" id="c.load.xml"><div class="section-titlepage"><h4>2.18.1 Loading XML data</h4></div><div class="content"><p>For an XML media type, the content is loaded and parsed as XML.</p><p><a id="err.inline.D0049"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.D0049"><code class="errqname">err:XD0049</code></a>) if the loaded content is not a well-formed XML document.</p><p>If the <code class="option">dtd-validate</code> parameter is <code class="literal">true</code>, then DTD validation must be performed when parsing the document. <a id="err.inline.D0023"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.D0023"><code class="errqname">err:XD0023</code></a>) if a DTD validation is performed and either the document is not valid or no DTD is found. <a id="err.inline.D0043"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.D0043"><code class="errqname">err:XD0043</code></a>) if the <code class="option">dtd-validate</code> parameter is <code class="literal">true</code> and the processor does not support DTD validation.</p><p><span style="display: none;" class="delete_version"><span id="impl-32">Additional XML parameters are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span style="display: none;" class="add_version"><span id="impl-36">Additional XML parameters are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span class="modify_version"><span id="impl-36">Additional XML parameters are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span></p></div></section><section class="section" id="c.load.text"><div class="section-titlepage"><h4>2.18.2 Loading text data</h4></div><div class="content"><p>For a text media type, the content is loaded as a text document. (A text document is an XPath data model document consisting of a single text node.)</p><p><a id="err.inline.D0060"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.D0060"><code class="errqname">err:XD0060</code></a>) if the <code class="option">content-type</code> specifies an encoding, which is not supported by the processor.</p><p><span style="display: none;" class="delete_version"><span id="impl-33">Text parameters are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span style="display: none;" class="add_version"><span id="impl-37">Text parameters are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span class="modify_version"><span id="impl-37">Text parameters are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span></p></div></section><section id="c.load.json" class="section"><div class="section-titlepage"><h4>2.18.3 Loading JSON data</h4></div><div class="content"><p>For a JSON media type, the content is loaded and parsed as JSON.</p><p><span style="display: none;" class="delete_version">The parameters specified for the <code class="code">fn:parse-json</code> function in [<a href="#xpath31-functions"><span class="abbrev">XPath and XQuery Functions and Operators 3.1</span></a>] <span class="rfc2119" id="c.load.json.3.3">must</span> be supported. <span id="impl-34">Additional JSON parameters are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span style="display: none;" class="add_version">The parameters specified for the <code class="code">fn:parse-json</code> function in [<a href="#xpath31-functions"><span class="abbrev">XPath and XQuery Functions and Operators 3.1</span></a>] <span class="rfc2119" id="c.load.json.3.3">must</span> be supported. <span id="impl-38">Additional JSON parameters are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span class="modify_version">The parameters specified for the <code class="code">fn:parse-json</code> function in [<a href="#xpath31-functions"><span class="abbrev">XPath and XQuery Functions and Operators 3.1</span></a>] <span class="rfc2119" id="c.load.json.3.3">must</span> be supported. <span id="impl-38">Additional JSON parameters are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span></p><p><a id="err.inline.D0057"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.D0057"><code class="errqname">err:XD0057</code></a>) if the loaded content does not conform to the JSON grammar, unless the parameter <code class="option">liberal</code> is <code class="literal">true</code> and the processor chooses to accept the deviation.</p><p><a id="err.inline.D0058"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.D0058"><code class="errqname">err:XD0058</code></a>) if the parameter <code class="option">duplicates</code> is <code class="literal">reject</code> and the value of loaded content contains a JSON object with duplicate keys.</p><p><a id="err.inline.D0059"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.D0059"><code class="errqname">err:XD0059</code></a>) if the parameter map contains an entry whose key is defined in the specification of <code class="code">fn:parse-json</code> and whose value is not valid for that key, or if it contains an entry with the key fallback when the parameter <code class="option">escape</code> with <code class="literal">true()</code> is also present.</p></div></section><section id="c.load.html" class="section"><div class="section-titlepage"><h4>2.18.4 Loading HTML data</h4></div><div class="content"><p>For an HTML media type, the content is loaded and parsed into an XPath data model document that contains a tree of elements, attributes, and other nodes.</p><p><span style="display: none;" class="delete_version"><span id="impl-35">The precise way in which HTML documents are parsed into the XPath data model is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version"><span id="impl-39">The precise way in which HTML documents are parsed into the XPath data model is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version"><span id="impl-39">The precise way in which HTML documents are parsed into the XPath data model is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p><p><span style="display: none;" class="delete_version"><span id="impl-36">HTML parameters are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span style="display: none;" class="add_version"><span id="impl-40">HTML parameters are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span class="modify_version"><span id="impl-40">HTML parameters are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span></p></div></section><section class="section" id="c.load.binary"><div class="section-titlepage"><h4>2.18.5 Loading binary data</h4></div><div class="content"><p><span style="display: none;" class="delete_version">An XProc processor may load other, arbitrary data types. <span id="impl-37">How a processor interprets other media types is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span style="display: none;" class="add_version">An XProc processor may load other, arbitrary data types. <span id="impl-41">How a processor interprets other media types is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span class="modify_version">An XProc processor may load other, arbitrary data types. <span id="impl-41">How a processor interprets other media types is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span></p><p><span style="display: none;" class="delete_version"><span id="impl-38">Parameters for other media types are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span style="display: none;" class="add_version"><span id="impl-42">Parameters for other media types are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span class="modify_version"><span id="impl-42">Parameters for other media types are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span></p></div></section><section id="c.load.16" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved. The properties specified in <code class="option">document-properties</code> are applied. </p></div></section></div></section><section id="c.make-absolute-uris" class="section"><div class="section-titlepage"><h3>2.19 p:make-absolute-uris</h3></div><div class="content"><p>The <code class="code">p:make-absolute-uris</code> step makes an element or attribute's value in the source document an absolute IRI value in the result document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:make-absolute-uris</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">base-uri</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI?</code><code>"</code><code>/&gt;</code><code>                   </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">match</code> option <span class="rfc2119" id="c.make-absolute-uris.4.2">must</span> be an XSLTSelectionPattern. <a id="err.inline.C0023.4"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if the pattern matches anything other than element or attribute nodes.</p><p>The value of the <code class="option">base-uri</code> option <span class="rfc2119" id="c.make-absolute-uris.5.2">must</span> be an <code class="type">anyURI</code>. It is interpreted as an IRI reference. If it is relative, it is made absolute against the base URI of the element on which it is specified (<code class="tag-element">p:with-option</code> or <code class="tag-element">p:make-absolute-uris</code> in the case of a syntactic shortcut value).</p><p>For every element or attribute in the input document which matches the specified pattern, its XPath string-value is resolved against the specified base URI and the resulting absolute IRI is used as the matched node's entire contents in the output.</p><p>The base URI used for resolution defaults to the matched attribute's element or the matched element's base URI unless the <code class="option">base-uri</code> option is specified. When the <code class="option">base-uri</code> option is specified, the option value is used as the base URI regardless of any contextual base URI value in the document. This option value is resolved against the base URI of the <code class="tag-element">p:option</code> element used to set the option.</p><p><span style="display: none;" class="delete_version"><span id="impl-39">If the IRI reference specified by the <code class="option">base-uri</code> option on <code class="tag-element">p:make-absolute-uris</code> is absent and the input document has no base URI, the results are <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span><span style="display: none;" class="add_version"><span id="impl-43">If the IRI reference specified by the <code class="option">base-uri</code> option on <code class="tag-element">p:make-absolute-uris</code> is absent and the input document has no base URI, the results are <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span><span class="modify_version"><span id="impl-43">If the IRI reference specified by the <code class="option">base-uri</code> option on <code class="tag-element">p:make-absolute-uris</code> is absent and the input document has no base URI, the results are <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span></p><section id="c.make-absolute-uris.9" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section id="c.namespace-rename" class="section"><div class="section-titlepage"><h3>2.20 p:namespace-rename</h3></div><div class="content"><p>The <code class="code">p:namespace-rename</code> step renames any namespace declaration or use of a namespace in a document to a new IRI value.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:namespace-rename</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">from</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>                        </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">to</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>                          </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">apply-to</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:token</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'all'</code><code>"</code><code class="attr values-attr">values</code><code>="</code><code class="value values-value">('all','elements','attributes')</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">from</code> option <span class="rfc2119" id="c.namespace-rename.4.2">must</span> be an <code class="type">anyURI</code>. It <span class="rfc2119" id="c.namespace-rename.4.4">should</span> be either empty or absolute, but will not be resolved in any case.</p><p>The value of the <code class="option">to</code> option <span class="rfc2119" id="c.namespace-rename.5.2">must</span> be an <code class="type">anyURI</code>. It <span class="rfc2119" id="c.namespace-rename.5.4">should</span> be empty or absolute, but will not be resolved in any case.</p><p>The value of the <code class="option">apply-to</code> option <span class="rfc2119" id="c.namespace-rename.6.2">must</span> be one of “<code class="literal">all</code>”, “<code class="literal">elements</code>”, or “<code class="literal">attributes</code>”. If the value is “<code class="literal">elements</code>”, only elements will be renamed, if the value is “<code class="literal">attributes</code>”, only attributes will be renamed, if the value is “<code class="literal">all</code>”, both elements and attributes will be renamed.</p><p><a id="err.inline.C0014"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0014"><code class="errqname">err:XC0014</code></a>) if the XML namespace (<code class="uri">http://www.w3.org/XML/1998/namespace</code>) or the XMLNS namespace (<code class="uri">http://www.w3.org/2000/xmlns/</code>) is the value of either the <code class="option">from</code> option or the <code class="option">to</code> option.</p><p>If the value of the <code class="option">from</code> option is the same as the value of the <code class="option">to</code> option, the input is reproduced unchanged on the output. Otherwise, namespace bindings, namespace attributes and element and attribute names are changed as follows:</p><div class="itemizedlist"><ul><li><p>Namespace bindings: If the <code class="option">from</code> option is present and its value is not the empty string, then every binding of a prefix (or the default namespace) in the input document whose value is the same as the value of the <code class="option">from</code> option is</p><div class="itemizedlist"><ul><li><p>replaced in the output with a binding to the value of the <code class="option">to</code> option, provided it is present and not the empty string;</p></li><li><p>otherwise (the <code class="option">to</code> option is not specified or has an empty string as its value) absent from the output.</p></li></ul></div><p>If the <code class="option">from</code> option is absent, or its value is the empty string, then no bindings are changed or removed.</p></li><li><p>Elements and attributes: If the <code class="option">from</code> option is present and its value is not the empty string, for every element and attribute, as appropriate, in the input whose namespace name is the same as the value of the <code class="option">from</code> option, in the output its namespace name is</p><div class="itemizedlist"><ul><li><p>replaced with the value of the <code class="option">to</code> option, provided it is present and not the empty string;</p></li><li><p>otherwise (the <code class="option">to</code> option is not specified or has an empty string as its value) changed to have no value.</p></li></ul></div><p>If the <code class="option">from</code> option is absent, or its value is the empty string, then for every element and attribute, as appropriate, whose namespace name has no value, in the output its namespace name is set to the value of the <code class="option">to</code> option.</p><p><a id="err.inline.C0092"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0092"><code class="errqname">err:XC0092</code></a>) if as a consequence of changing or removing the namespace of an attribute the attribute's name is not unique on the respective element.</p></li><li><p>Namespace attributes: If the <code class="option">from</code> option is present and its value is not the empty string, for every namespace attribute in the input whose value is the same as the value of the <code class="option">from</code> option, in the output</p><div class="itemizedlist"><ul><li><p>the namespace attribute's value is replaced with the value of the <code class="option">to</code> option, provided it is present and not the empty string;</p></li><li><p>otherwise (the <code class="option">to</code> option is not specified or has an empty string as its value) the namespace attribute is absent.</p></li></ul></div></li></ul></div><div id="note-apply-to" class="note admonition"><h3>Note</h3><div class="admonition-body"><p>The <code class="option">apply-to</code> option is primarily intended to make it possible to avoid renaming attributes when the <code class="option">from</code> option specifies no namespace, since many attributes are in no namespace.</p><p>Care should be taken when specifying no namespace with the <code class="option">to</code> option. Prefixed names in content, for example QNames and XPath expressions, may end up with no appropriate namespace binding.</p></div></div><section id="c.namespace-rename.11" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section id="c.pack" class="section"><div class="section-titlepage"><h3>2.21 p:pack</h3></div><div class="content"><p>The <code class="code">p:pack</code> step merges two document sequences in a pair-wise fashion.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:pack</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text xml html</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">alternate</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrapper</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>      </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The step takes each pair of documents, in order, one from the <code class="port">source</code> port and one from the <code class="port">alternate</code> port, wraps them with a new element node whose QName is the value specified in the <code class="option">wrapper</code> option, and writes that element to the <code class="port">result</code> port as a document.</p><p>If the step reaches the end of one input sequence before the other, then it simply wraps each of the remaining documents in the longer sequence.</p><div id="note-two-docs" class="note admonition"><h3>Note</h3><div class="admonition-body"><p>In the common case, where the document element of a document in the <code class="port">result</code> sequence has two element children, any comments, processing instructions, or white space text nodes that occur between them may have come from either of the input documents; this step does not attempt to distinguish which one.</p></div></div><section id="c.pack.7" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section class="section" id="c.rename"><div class="section-titlepage"><h3>2.22 p:rename</h3></div><div class="content"><p>The <code class="code">p:rename</code> step renames elements, attributes, or processing-instruction targets in a document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:rename</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'/*'</code><code>"</code><code>/&gt;</code><code>         </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">new-name</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>     </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">match</code> option must be an XSLTSelectionPattern. <a id="err.inline.C0023.5"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if the pattern matches anything other than element, attribute or processing instruction nodes.</p><p><span style="display: none;" class="delete_version">Each element, attribute, or processing-instruction in the input matched by the <em class="glossterm">selection pattern</em> specified in the <code class="option">match</code> option is renamed in the output to the name specified by the <code class="option">new-name</code> option.</span><span style="display: none;" class="add_version">Each element, attribute, or processing-instruction in the input matched by the <em class="glossterm"><a href="#dt-selection-pattern">selection pattern</a></em> specified in the <code class="option">match</code> option is renamed in the output to the name specified by the <code class="option">new-name</code> option.</span><span class="modify_version">Each element, attribute, or processing-instruction in the input matched by the <em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">selection</span><span class="deltaxml-old" style="background:#FF5555"> pattern</span><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em> specified in the <code class="option">match</code> option is renamed in the output to the name specified by the <code class="option">new-name</code> option.</span></p><p>If the <code class="option">match</code> option matches an attribute and if the element on which it occurs already has an attribute whose expanded name is the same as the expanded name of the specified <code class="option">new-name</code>, then the results is as if the current attribute named “<em class="replaceable"><code>new-name</code></em>” was deleted before renaming the matched attribute.</p><p>With respect to attributes named “<code class="literal">xml:base</code>”, the following semantics apply: renaming an <em>from</em> “<code class="literal">xml:base</code>” <em>to</em> something else has no effect on the underlying base URI of the element; however, if an attribute is renamed <em>from</em> something else <em>to</em> “<code class="literal">xml:base</code>”, the base URI of the element <span class="rfc2119" id="c.rename.7.8">must</span> also be amended accordingly.</p><p>If the pattern matches processing instructions, then it is the processing instruction target that is renamed. <a id="err.inline.C0013"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0013"><code class="errqname">err:XC0013</code></a>) if the pattern matches a processing instruction and the new name has a non-null namespace. </p><section id="c.rename.9" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section id="c.replace" class="section"><div class="section-titlepage"><h3>2.23 p:replace</h3></div><div class="content"><p>The <code class="code">p:replace</code> step replaces matching nodes in its primary input with the top-level node(s) of the <code class="code">replacement</code> port's document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:replace</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">replacement</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">match</code> option <span class="rfc2119" id="c.replace.4.2">must</span> be an XSLTSelectionPattern. <a id="err.inline.C0023.6"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if that pattern matches anything other than element, text, processing-instruction, or comment nodes. Multiple matches are allowed, in which case multiple copies of the <code class="port">replacement</code> document will occur.</p><p>Every node in the primary input matching the specified pattern is replaced in the output by the top-level node(s) of the <code class="port">replacement</code> document. Only non-nested matches are replaced. That is, once a node is replaced, its descendants cannot be matched.</p><section id="c.replace.6" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>If the resulting document contains exactly one text node, the <code class="literal">content-type</code> property is changed to <code class="literal">text/plain</code> and the <code class="literal">serialization</code> property is removed, while all other document properties are preserved. For other document types, all document properties are preserved.</p></div></section></div></section><section class="section" id="c.set-attributes"><div class="section-titlepage"><h3>2.24 p:set-attributes</h3></div><div class="content"><p>The <code class="tag-element">p:set-attributes</code> step sets attributes on matching elements.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:set-attributes</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">attributes</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'/*'</code><code>"</code><code>/&gt;</code><code>         </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">match</code> option <span class="rfc2119" id="c.set-attributes.4.2">must</span> be an XSLTSelectionPattern. <a id="err.inline.C0023.7"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if that pattern matches anything other than element nodes.</p><p>Each attribute on the document element of the document that appears on the <code class="port">attributes</code> port is copied to each element that matches the <code class="option">match</code> expression.</p><p>If an attribute with the same name as one of the attributes to be copied already exists, the value specified on the <code class="port">attribute</code> port's document is used. The result port of this step produces a copy of the <code class="port">source</code> port's document with the matching elements' attributes modified.</p><p><span style="display: none;" class="delete_version">The matching elements are specified by the <em class="glossterm">selection pattern</em> in the <code class="option">match</code> option. All matching elements are processed. If no elements match, the step will not change any elements.</span><span style="display: none;" class="add_version">The matching elements are specified by the <em class="glossterm"><a href="#dt-selection-pattern">selection pattern</a></em> in the <code class="option">match</code> option. All matching elements are processed. If no elements match, the step will not change any elements.</span><span class="modify_version">The matching elements are specified by the <em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">selection</span><span class="deltaxml-old" style="background:#FF5555"> pattern</span><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em> in the <code class="option">match</code> option. All matching elements are processed. If no elements match, the step will not change any elements.</span></p><p>This step must not copy namespace declarations. If the attributes copied from the <code class="port">attributes</code> use namespaces, prefixes, or prefixes bound to different namespaces, the document produced on the <code class="port">result</code> output port will require namespace fixup.</p><p>If an attribute named <code class="tag-attribute">xml:base</code> is added or changed, the base URI of the element <span class="rfc2119" id="c.set-attributes.9.2">must</span> also be amended accordingly.</p><section id="c.set-attributes.10" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section id="c.set-properties" class="section"><div class="section-titlepage"><h3>2.25 p:set-properties</h3></div><div class="content"><p>The <code class="tag-element">p:set-properties</code> step sets document properties on the source document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:set-properties</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">any</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">any</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">properties</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item()*)</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">merge</code><code>"</code><code class="attr default-attr">default</code><code>="</code><code class="value default-value">false()</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>    </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The document properties of the document on the <code class="port">source</code> port are augmented with the values specified in the <code class="option">properties</code> option. The document produced on the <code class="port">result</code> port has the same representation but the adjusted property values.</p><p>If the <code class="option">merge</code> option is true, then the supplied properties are added to the existing properties. If it is false, the document’s properties are replaced by the new set.</p><p><a id="err.inline.C0069"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0069"><code class="errqname">err:XC0069</code></a>) if the <code class="option">properties</code> map contains a key equal to the string “<code class="literal">content-type</code>”. </p><section id="c.set-properties.7" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>If <code class="option">merge</code> is true, document properties not overridden by settings in the <code class="option">properties</code> map are preserved, otherwise the resulting document has the properties specified in the <code class="option">properties</code> map. </p></div></section></div></section><section id="c.sink" class="section"><div class="section-titlepage"><h3>2.26 p:sink</h3></div><div class="content"><p>The <code class="tag-element">p:sink</code> step accepts a sequence of documents and discards them. It has no output.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:sink</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">any</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><section id="c.sink.4" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>Not applicable.</p></div></section></div></section><section id="c.split-sequence" class="section"><div class="section-titlepage"><h3>2.27 p:split-sequence</h3></div><div class="content"><p>The <code class="tag-element">p:split-sequence</code> step accepts a sequence of documents and divides it into two sequences.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:split-sequence</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">matched</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">not-matched</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">initial-only</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">test</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>        </code><code class="comment">&lt;!-- </code><span class="opt-type">XPathExpression</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">test</code> option <span class="rfc2119" id="c.split-sequence.4.2">must</span> be an XPathExpression.</p><p>The XPath expression in the <code class="option">test</code> option is applied to each document in the input sequence. If the effective boolean value of the expression is true, the document is copied to the <code class="port">matched</code> port; otherwise it is copied to the <code class="port">not-matched</code> port.</p><p>If the <code class="option">initial-only</code> option is true, then when the first document that does not satisfy the test expression is encountered, it <em>and all the documents that follow it</em> are written to the <code class="port">not-matched</code> port. In other words, it only writes the initial series of matched documents (which may be empty) to the <code class="port">matched</code> port. All other documents are written to the <code class="port">not-matched</code> port, irrespective of whether or not they match.</p><p>The XPath context for the <code class="option">test</code> option changes over time. For each document that appears on the <code class="code">source</code> port, the expression is evaluated with that document as the context document. The context position (<code class="code">position()</code>) is the position of that document within the sequence and the context size (<code class="code">last()</code>) is the total number of documents in the sequence.</p><div id="note-stream" class="note admonition"><h3>Note</h3><div class="admonition-body"><p>In principle, this component cannot stream because it must buffer all of the input sequence in order to find the context size. In practice, if the test expression does not use the <code class="function">last()</code> function, the implementation can stream and ignore the context size.</p></div></div><p>If the implementation supports passing PSVI annotations between steps, the <code class="tag-element">p:split-sequence</code> step <span class="rfc2119" id="c.split-sequence.9.2">must</span> preserve any annotations that appear in the input.</p><section id="c.split-sequence.10" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section id="c.store" class="section"><div class="section-titlepage"><h3>2.28 p:store</h3></div><div class="content"><p>The <code class="tag-element">p:store</code> step stores (a possibly serialized version of) its input to a URI. This step outputs a reference to the location of the stored document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:store</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">any</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">href</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>        </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">serialization</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item()*)?</code><code>"</code><code>/&gt;</code><code>  </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">href</code> option <span class="rfc2119" id="c.store.4.2">must</span> be an <code class="type">anyURI</code>. If it is relative, it is made absolute against the base URI of the element on which it is specified (<code class="tag-element">p:with-option</code> or <code class="tag-element">p:store</code> in the case of a syntactic shortcut value).</p><p>The step attempts to store the XML document to the specified URI. <a id="err.inline.C0050"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0050"><code class="errqname">err:XC0050</code></a>) if the URI scheme is not supported or the step cannot store to the specified location.</p><p>The output of this step is a document containing a single <a href="#cv.result"><code class="tag-element">c:result</code></a> element whose content is the absolute URI of the document stored by the step.</p><p>The <code class="option">serialization</code> option is provided to control the serialization of content when it is stored. Serialization is described in [<a href="#xproc30"><span class="abbrev">XProc 3.0</span></a>].</p><section id="c.store.8" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section class="section" id="c.string-replace"><div class="section-titlepage"><h3>2.29 p:string-replace</h3></div><div class="content"><p>The <code class="tag-element">p:string-replace</code> step matches nodes in the document provided on the <code class="port">source</code> port and replaces them with the string result of evaluating an XPath expression.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:string-replace</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">replace</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>     </code><code class="comment">&lt;!-- </code><span class="opt-type">XPathExpression</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">match</code> option <span class="rfc2119" id="c.string-replace.4.2">must</span> be an XSLTSelectionPattern.</p><p>The value of the <code class="option">replace</code> option <span class="rfc2119" id="c.string-replace.5.2">must</span> be an XPathExpression.</p><p><span style="display: none;" class="delete_version">The matched nodes are specified with the <em class="glossterm">selection pattern</em> in the <code class="option">match</code> option. For each matching node, the XPath expression provided by the <code class="option">replace</code> option is evaluated with the matching node as the XPath context node. The string value of the result is used in the output. Nodes that do not match are copied without change.</span><span style="display: none;" class="add_version">The matched nodes are specified with the <em class="glossterm"><a href="#dt-selection-pattern">selection pattern</a></em> in the <code class="option">match</code> option. For each matching node, the XPath expression provided by the <code class="option">replace</code> option is evaluated with the matching node as the XPath context node. The string value of the result is used in the output. Nodes that do not match are copied without change.</span><span class="modify_version">The matched nodes are specified with the <em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">selection</span><span class="deltaxml-old" style="background:#FF5555"> pattern</span><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em> in the <code class="option">match</code> option. For each matching node, the XPath expression provided by the <code class="option">replace</code> option is evaluated with the matching node as the XPath context node. The string value of the result is used in the output. Nodes that do not match are copied without change.</span></p><p>If the expression given in the <code class="option">match</code> option matches an <em>attribute</em>, the string value of the <code class="option">replace</code> expression is used as the new value of the attribute in the output. If the attribute is named “<code class="tag-attribute">xml:base</code>”, the base URI of the element <span class="rfc2119" id="c.string-replace.7.5">must</span> also be amended accordingly.</p><p>If the expression matches any other kind of node, the entire node (and <em>not</em> just its contents) is replaced by the string value of the <code class="option">replace</code> expression.</p><section id="c.string-replace.9" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>If the resulting document contains exactly one text node, the <code class="literal">content-type</code> property is changed to <code class="literal">text/plain</code> and the <code class="literal">serialization</code> property is removed, while all other document properties are preserved. For other document types, all document properties are preserved.</p></div></section></div></section><section id="c.text-count" class="section"><div class="section-titlepage"><h3>2.30 p:text-count</h3></div><div class="content"><p>The <code class="code">p:text-count</code> step counts the number of lines in a text document and returns a single XML document containing that number.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:text-count</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The <code class="tag-element">p:text-count</code> step counts the number of lines in the text document appearing on its <code class="port">source</code> port. It returns on its <code class="port">result</code> port an XML document containing a single <a href="#cv.result"><code class="tag-element">c:result</code></a> element whose contents is the string representing this count.</p><p>Lines are identified as described in <a href="https://www.w3.org/TR/xml/#sec-line-ends">XML, 2.11 End-of-Line Handling</a>.</p><section id="c.text-count.6" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.text-head" class="section"><div class="section-titlepage"><h3>2.31 p:text-head</h3></div><div class="content"><p>The <code class="code">p:text-head</code> step returns lines from the beginning of a text document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:text-head</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">count</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:integer</code><code>"</code><code>/&gt;</code><code>      </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The <code class="tag-element">p:text-head</code> step returns on its <code class="port">result</code> port lines from the text document that appears on its <code class="port">source</code> port:</p><div class="itemizedlist"><ul><li><p>If the <code class="option">count</code> option is positive, the <code class="tag-element">p:text-head</code> step returns the first <code class="option">count</code> lines</p></li><li><p>If the <code class="option">count</code> option is zero, the <code class="tag-element">p:text-head</code> step returns all lines</p></li><li><p>If the <code class="option">count</code> option is negative, the <code class="tag-element">p:text-head</code> step returns all lines except the first <code class="option">count</code> lines</p></li></ul></div><p>Lines are identified as described in <a href="https://www.w3.org/TR/xml/#sec-line-ends">XML, 2.11 End-of-Line Handling</a>.</p><section id="c.text-head.7" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section id="c.text-join" class="section"><div class="section-titlepage"><h3>2.32 p:text-join</h3></div><div class="content"><p>The <code class="code">p:text-join</code> step concatenates text documents.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:text-join</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text/plain</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">separator</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>  </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">prefix</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">suffix</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">override-content-type</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The <code class="code">p:text-join</code> step concatenates the text documents appearing on its <code class="port">source</code> port into a single document on its <code class="port">result</code> port. The documents will be concatenated in order of appearance. </p><div class="itemizedlist"><ul><li><p>When the <code class="option">separator</code> option is specified, its value will be inserted in between adjacent documents.</p></li><li><p>When the <code class="option">prefix</code> option is specified, the document appearing on the <code class="port">result</code> port will always start with its value (also when there are no documents on the <code class="port">source</code> port).</p></li><li><p>When the <code class="option">suffix</code> option is specified, the document appearing on the <code class="port">result</code> port will always end with its value (also when there are no documents on the <code class="port">source</code> port).</p></li></ul></div><p>When the <code class="option">override-content-type</code> option is specified, the document appearing on the port <code class="port">result</code> will have this media type as part of its document properties. <a id="err.inline.C0070.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0070"><code class="errqname">err:XC0070</code></a>) if the supplied <code class="option">content-type</code> is not a valid media type of the form “<code class="literal"><em class="replaceable"><code>type</code></em>/<em class="replaceable"><code>subtype</code></em>+<em class="replaceable"><code>ext</code></em></code>” where “<code class="literal">+<em class="replaceable"><code>ext</code></em></code>” is optional. </p><section id="c.text-join.7" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.text-replace" class="section"><div class="section-titlepage"><h3>2.33 p:text-replace</h3></div><div class="content"><p>The <code class="code">p:text-replace</code> step replaces all occurrences of substrings in a text document that match a supplied regular expression with a given replacement string.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:text-replace</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">pattern</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">replacement</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code> </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">flags</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>      </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The <code class="code">p:text-replace</code> step replaces all occurrences of substrings in the text document appearing on its <code class="port">source</code> port that match a supplied regular expression with a given replacement string. The result is returned (as another text document) on its <code class="port">result</code> port. </p><p>This step is a convenience wrapper around the XPath <a href="https://www.w3.org/TR/xpath-functions-31/#func-replace"><code class="function">fn:replace</code></a> function to ease text replacements in the document flow of a pipeline.</p><p>The <code class="option">pattern</code>, <code class="option">replacement</code> and <code class="option">flags</code> options are specified the same as the parameters with the same names of the <a href="https://www.w3.org/TR/xpath-functions-31/#func-replace"><code class="function">fn:replace</code></a> function.</p><section id="c.text-replace.7" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section class="section" id="c.text-sort"><div class="section-titlepage"><h3>2.34 p:text-sort</h3></div><div class="content"><p>The <code class="code">p:text-sort</code> step sorts lines in a text document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:text-sort</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">order</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'ascending'</code><code>"</code><code class="attr values-attr">values</code><code>="</code><code class="value values-value">('ascending', 'descending')</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">case-order</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr values-attr">values</code><code>="</code><code class="value values-value">('upper-first', 'lower-first')</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">lang</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:language</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">data-type</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'text'</code><code>"</code><code class="attr values-attr">values</code><code>="</code><code class="value values-value">('text', 'number')</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">collation</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'https://www.w3.org/2005/xpath-functions/collation/codepoint'</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">stable</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The <code class="tag-element">p:text-sort</code> step sorts the lines in the text document appearing on its <code class="port">source</code> port and returns the result as another text document on its <code class="port">result</code> port. The full lines are used as the sorting key.</p><div class="itemizedlist"><ul><li><p>The <code class="option">order</code> option defines whether the lines are processed in ascending or descending order. Its value <span class="rfc2119" id="c.text-sort.5.1.1.2">must</span> be one of <code class="code">ascending</code> or <code class="code">descending</code>. The default is <code class="code">ascending</code>.</p></li><li><p>The <code class="option">case-order</code> option defines whether upper-case letters are to be collated before or after lower-case letters. Its value <span class="rfc2119" id="c.text-sort.5.2.1.2">must</span> be one of <code class="code">upper-first</code> or <code class="code">lower-first</code>. The default is language-dependent.</p></li><li><p>The <code class="option">lang</code> option defines the language whose collating conventions are to be used. The default depends on the processing environment. Its value must be a valid language code (e.g. <code class="code">en-EN</code>).</p></li><li><p>The <code class="option">data-type</code> option defines whether the lines are to be collated alphabetically or numerically. Its value <span class="rfc2119" id="c.text-sort.5.4.1.2">must</span> be one of <code class="code">text</code> or <code class="code">number</code>. The default is <code class="code">text</code>.</p></li><li><p><span style="display: none;" class="delete_version">The <code class="option">collation</code> option identifies how strings are to be compared with each other. Its value must be a valid collation URI. The only collation XProc processors <span class="rfc2119" id="c.text-sort.5.5.1.2">must</span> support is the Unicode Codepoint Collation <a href="https://www.w3.org/2005/xpath-functions/collation/codepoint/"><code class="code">https://www.w3.org/2005/xpath-functions/collation/codepoint</code></a>. This is also its default. <span id="impl-40">Support for other collations is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version">The <code class="option">collation</code> option identifies how strings are to be compared with each other. Its value must be a valid collation URI. The only collation XProc processors <span class="rfc2119" id="c.text-sort.5.5.1.2">must</span> support is the Unicode Codepoint Collation <a href="https://www.w3.org/2005/xpath-functions/collation/codepoint/"><code class="code">https://www.w3.org/2005/xpath-functions/collation/codepoint</code></a>. This is also its default. <span id="impl-44">Support for other collations is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version">The <code class="option">collation</code> option identifies how strings are to be compared with each other. Its value must be a valid collation URI. The only collation XProc processors <span class="rfc2119" id="c.text-sort.5.5.1.2">must</span> support is the Unicode Codepoint Collation <a href="https://www.w3.org/2005/xpath-functions/collation/codepoint/"><code class="code">https://www.w3.org/2005/xpath-functions/collation/codepoint</code></a>. This is also its default. <span id="impl-44">Support for other collations is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p></li><li><p>If the <code class="option">stable</code> option is set to <code class="code">false</code> this indicates that there is no requirement to retain the original order of items that have equal values for all the sort keys.</p></li></ul></div><p>Lines are identified as described in <a href="https://www.w3.org/TR/xml/#sec-line-ends">XML, 2.11 End-of-Line Handling</a>.</p><section id="c.text-sort.7" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section id="c.text-tail" class="section"><div class="section-titlepage"><h3>2.35 p:text-tail</h3></div><div class="content"><p>The <code class="code">p:text-tail</code> step returns lines from the end of a text document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:text-tail</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">count</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:integer</code><code>"</code><code>/&gt;</code><code>      </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The <code class="tag-element">p:text-tail</code> step returns on its <code class="port">result</code> port lines from the text document that appears on its <code class="port">source</code> port:</p><div class="itemizedlist"><ul><li><p>If the <code class="option">count</code> option is positive, the <code class="tag-element">p:text-tail</code> step returns the last <code class="option">count</code> lines</p></li><li><p>If the <code class="option">count</code> option is zero, the <code class="tag-element">p:text-tail</code> step returns all lines</p></li><li><p>If the <code class="option">count</code> option is negative, the <code class="tag-element">p:text-tail</code> step returns all lines except the last <code class="option">count</code> lines</p></li></ul></div><p>Lines are identified as described in <a href="https://www.w3.org/TR/xml/#sec-line-ends">XML, 2.11 End-of-Line Handling</a>.</p><section id="c.text-tail.7" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section id="c.unarchive" class="section"><div class="section-titlepage"><h3>2.36 p:unarchive</h3></div><div class="content"><p>The <code class="code">p:unarchive</code> step outputs on its <code class="port">result</code> port specific entries in an archive (for instance from a zip file).</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:unarchive</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">include-filter</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string*</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code>/&gt;</code><code></code><code class="comment">&lt;!-- </code><span class="opt-type">RegularExpression</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">exclude-filter</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string*</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code>/&gt;</code><code></code><code class="comment">&lt;!-- </code><span class="opt-type">RegularExpression</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">format</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'zip'</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:Qname, item()*)</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">false</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p><span style="display: none;" class="delete_version">The format of the archive can be specified using the <code class="option">format</code> option. Implementations <span class="rfc2119" id="c.unarchive.4.2">must</span> support the [<a href="#zip"><span class="abbrev">ZIP</span></a>] format, specified with the value <code class="code">zip</code>. <span id="impl-41">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other formats are supported.</span></span><span style="display: none;" class="add_version">The format of the archive can be specified using the <code class="option">format</code> option. Implementations <span class="rfc2119" id="c.unarchive.4.2">must</span> support the [<a href="#zip"><span class="abbrev">ZIP</span></a>] format, specified with the value <code class="code">zip</code>. <span id="impl-45">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other formats are supported.</span></span><span class="modify_version">The format of the archive can be specified using the <code class="option">format</code> option. Implementations <span class="rfc2119" id="c.unarchive.4.2">must</span> support the [<a href="#zip"><span class="abbrev">ZIP</span></a>] format, specified with the value <code class="code">zip</code>. <span id="impl-45">It is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> what other formats are supported.</span></span></p><p><span style="display: none;" class="delete_version">The <code class="option">parameters</code> option can be used to supply parameters to control the unarchiving. <span id="impl-42">The semantics of the keys and the allowed values for these keys are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0079.3"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0079"><code class="errqname">err:XC0079</code></a>) if the map <code class="option">parameters</code> contains an entry whose key is defined by the implementation and whose value is not valid for that key.</span><span style="display: none;" class="add_version">The <code class="option">parameters</code> option can be used to supply parameters to control the unarchiving. <span id="impl-46">The semantics of the keys and the allowed values for these keys are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0079.3"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0079"><code class="errqname">err:XC0079</code></a>) if the map <code class="option">parameters</code> contains an entry whose key is defined by the implementation and whose value is not valid for that key.</span><span class="modify_version">The <code class="option">parameters</code> option can be used to supply parameters to control the unarchiving. <span id="impl-46">The semantics of the keys and the allowed values for these keys are <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span><a id="err.inline.C0079.3"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0079"><code class="errqname">err:XC0079</code></a>) if the map <code class="option">parameters</code> contains an entry whose key is defined by the implementation and whose value is not valid for that key.</span></p><p>If present, the value of the <code class="option">include-filter</code> or <code class="option">exclude-filter</code> option <span class="rfc2119" id="c.unarchive.6.3">must</span> be a sequence of strings, each one representing a regular expressions as specified in [<a href="#xpath31-functions"><span class="abbrev">XPath and XQuery Functions and Operators 3.1</span></a>], section 7.61 “<code class="literal">Regular Expression Syntax</code>”.</p><p>If neither the <code class="option">include-filter</code> option nor the <code class="option">exclude-filter</code> option is specified, the <code class="code">p:unarchive</code> step outputs on its <code class="port">result</code> port all entries in the archive.</p><p>If the <code class="option">include-filter</code> option or the <code class="option">exclude-filter</code> option is specified, the <code class="code">p:archive</code> step outputs on the <code class="port">result</code> port the entries from the archive that conform to the following rules:</p><div class="itemizedlist"><ul><li><p>If any <code class="option">include-filter</code> pattern matches an archive entry's name, the entry is included in the output.</p></li><li><p>If any <code class="option">exclude-filter</code> pattern matches an archive entry's name, the entry is excluded in the output.</p></li><li><p>If both options are provided, the include filter is processed first, then the exclude filter. </p></li><li><p>Names of entries in archives are always relative names. For instance, the name of a file called <code class="code">xyz.xml</code> in a <code class="code">specs</code> subdirectory in an archive is called in full <code class="code">specs/xyz.xml</code> (and not <code class="code">/specs/xyz.xml</code>).</p></li></ul></div><p>As a result: an item is included if it matches (at least) one of the <code class="option">include-filter</code> values and none of the <code class="option">exclude-filter</code> values.</p><div class="note editorial admonition"><h3>Note</h3><div class="admonition-body"><p>What about the base URIs of these documents?</p></div></div><section id="c.unarchive.12" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section class="section" id="c.unescape-markup"><div class="section-titlepage"><h3>2.37 p:unescape-markup</h3></div><div class="content"><p>The <code class="tag-element">p:unescape-markup</code> step takes the string value of the document element and parses the content as if it was a Unicode character stream containing serialized XML. The output consists of the same document element with children that result from the parse. This is the reverse of the <a href="#c.escape-markup"><code class="tag-element">p:escape-markup</code></a> step.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:unescape-markup</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">namespace</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI?</code><code>"</code><code>/&gt;</code><code>                  </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">content-type</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'application/xml'</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">encoding</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string?</code><code>"</code><code>/&gt;</code><code>                   </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">charset</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string?</code><code>"</code><code>/&gt;</code><code>                    </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">namespace</code> option <span class="rfc2119" id="c.unescape-markup.4.2">must</span> be an <code class="type">anyURI</code>. It <span class="rfc2119" id="c.unescape-markup.4.4">should</span> be absolute, but will not be resolved.</p><p>When the string value is parsed, the original document element is preserved so that the result will be well-formed XML even if the content consists of multiple, sibling elements.</p><p>The <code class="option">namespace</code> option specifies a default namespace. Elements that are in no namespace in the unescaped content will be placed into this namespace unless there is an in-scope namespace declaration that specifies a different namespace (or explicitly undeclares the default namespace).</p><p>The <code class="option">content-type</code> option <span class="rfc2119" id="c.unescape-markup.7.2">may</span> be used to specify an alternate content type for the string value. An implementation <span class="rfc2119" id="c.unescape-markup.7.3">may</span> use a different parser to produce XML content depending on the specified content-type. For example, an implementation might provide an HTML to XHTML parser (e.g. [<a href="#tidy"><span class="abbrev">HTML Tidy</span></a>] or [<a href="#tagsoup"><span class="abbrev">TagSoup</span></a>]) for the content type '<code class="literal">text/html</code>'.</p><p><span style="display: none;" class="delete_version">All implementations <span class="rfc2119" id="c.unescape-markup.8.1">must</span> support the content type <code class="literal">application/xml</code>, and must use a standard XML parser for it. <a id="err.inline.C0051"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0051"><code class="errqname">err:XC0051</code></a>) if the content-type specified is not supported by the implementation. <span id="impl-43">Behavior of <code class="tag-element">p:unescape-markup</code> for <code class="option">content-type</code>s other than <code class="literal">application/xml</code> is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version">All implementations <span class="rfc2119" id="c.unescape-markup.8.1">must</span> support the content type <code class="literal">application/xml</code>, and must use a standard XML parser for it. <a id="err.inline.C0051"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0051"><code class="errqname">err:XC0051</code></a>) if the content-type specified is not supported by the implementation. <span id="impl-47">Behavior of <code class="tag-element">p:unescape-markup</code> for <code class="option">content-type</code>s other than <code class="literal">application/xml</code> is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version">All implementations <span class="rfc2119" id="c.unescape-markup.8.1">must</span> support the content type <code class="literal">application/xml</code>, and must use a standard XML parser for it. <a id="err.inline.C0051"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0051"><code class="errqname">err:XC0051</code></a>) if the content-type specified is not supported by the implementation. <span id="impl-47">Behavior of <code class="tag-element">p:unescape-markup</code> for <code class="option">content-type</code>s other than <code class="literal">application/xml</code> is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p><p>The <code class="option">encoding</code> option specifies how the data is encoded. All implementations <span class="rfc2119" id="c.unescape-markup.9.2">must</span> support the <code class="literal">base64</code> encoding (and the absence of an encoding option, which implies that the content is plain Unicode text). <a id="err.inline.C0052.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0052"><code class="errqname">err:XC0052</code></a>) if the encoding specified is not supported by the implementation.</p><p>If an <code class="option">encoding</code> is specified, a <code class="option">charset</code> may also be specified. The character set may be specified as a parameter on the <code class="option">content-type</code> or via the separate <code class="option">charset</code> option. If it is specified in both places, the value of the <code class="option">charset</code> option <span class="rfc2119" id="c.unescape-markup.10.6">must</span> be used.</p><p>If the specified <code class="option">encoding</code> is <code class="literal">base64</code>, then the character set <span class="rfc2119" id="c.unescape-markup.11.3">must</span> be specified. <a id="err.inline.C0010"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0010"><code class="errqname">err:XC0010</code></a>) if an encoding of <code class="literal">base64</code> is specified and the character set is not specified or if the specified character set is not supported by the implementation. </p><p>The octet-stream that results from decoding the text <span class="rfc2119" id="c.unescape-markup.12.1">must</span> be interpreted using the character encoding named by the value of the <code class="option">charset</code> option to produce a sequence of Unicode characters to parse.</p><p>If no <code class="option">encoding</code> is specified, the character set is ignored, irrespective of where it was specified.</p><p>For example, with the 'namespace' option set to the XHTML namespace, the following input:</p><pre class="programlisting language-markup line-numbers"><code>&lt;description&gt; &amp;lt;p&gt;This is a chunk.&amp;lt;/p&gt; &amp;lt;p&gt;This is a another chunk.&amp;lt;/p&gt; &lt;/description&gt;</code></pre><p>would produce:</p><pre class="programlisting language-markup line-numbers"><code>&lt;description&gt; &lt;p xmlns="http://www.w3.org/1999/xhtml"&gt;This is a chunk.&lt;/p&gt; &lt;p xmlns="http://www.w3.org/1999/xhtml"&gt;This is a another chunk.&lt;/p&gt; &lt;/description&gt;</code></pre><section id="c.unescape-markup.18" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.unwrap" class="section"><div class="section-titlepage"><h3>2.38 p:unwrap</h3></div><div class="content"><p>The <code class="tag-element">p:unwrap</code> step replaces matched elements with their children.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:unwrap</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/plain</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'/*'</code><code>"</code><code>/&gt;</code><code>         </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">match</code> option <span class="rfc2119" id="c.unwrap.4.2">must</span> be an XSLTSelectionPattern. <a id="err.inline.C0023.8"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if that pattern matches anything other than element nodes.</p><p>Every element in the <code class="port">source</code> document that matches the specified <code class="option">match</code> pattern is replaced by its children, effectively “unwrapping” the children from their parent. Non-element nodes and unmatched elements are passed through unchanged.</p><div id="note-match-doc" class="note admonition"><h3>Note</h3><div class="admonition-body"><p>The matching applies to the entire document, not just the “top-most” matches. A pattern of the form <code class="literal">h:div</code> will replace <em>all</em><code class="tag-element">h:div</code> elements, not just the top-most ones.</p></div></div><p>This step produces a single document; if the document element is unwrapped, the result might not be well-formed XML. If the step produces a document node with a single text child, the result will have content type “<code class="literal">text/plain</code>”.</p><section id="c.unwrap.8" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section class="section" id="c.uuid"><div class="section-titlepage"><h3>2.39 p:uuid</h3></div><div class="content"><p>The <code class="tag-element">p:uuid</code> step generates a [<a href="#bib.uuid"><span class="abbrev">UUID</span></a>] and injects it into the <code class="port">source</code> document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:uuid</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">'/*'</code><code>"</code><code>/&gt;</code><code>         </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">version</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:integer?</code><code>"</code><code>/&gt;</code><code>                   </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">match</code> option must be an XSLTSelectionPattern. The value of the <code class="option">version</code> option must be an integer.</p><p><span style="display: none;" class="delete_version">If the <code class="option">version</code> is specified, that version of UUID must be computed. <a id="err.inline.C0060"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0060"><code class="errqname">err:XC0060</code></a>) if the processor does not support the specified <code class="option">version</code> of the UUID algorithm. <span id="impl-44">If the <code class="option">version</code> is not specified, the version of UUID computed is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version">If the <code class="option">version</code> is specified, that version of UUID must be computed. <a id="err.inline.C0060"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0060"><code class="errqname">err:XC0060</code></a>) if the processor does not support the specified <code class="option">version</code> of the UUID algorithm. <span id="impl-48">If the <code class="option">version</code> is not specified, the version of UUID computed is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version">If the <code class="option">version</code> is specified, that version of UUID must be computed. <a id="err.inline.C0060"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0060"><code class="errqname">err:XC0060</code></a>) if the processor does not support the specified <code class="option">version</code> of the UUID algorithm. <span id="impl-48">If the <code class="option">version</code> is not specified, the version of UUID computed is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p><p><span style="display: none;" class="delete_version">Implementations <span class="rfc2119" id="c.uuid.6.1">must</span> support version 4 UUIDs. <span id="impl-45">Support for other versions of UUID, and the mechanism by which the necessary inputs are made available for computing other versions, is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version">Implementations <span class="rfc2119" id="c.uuid.6.1">must</span> support version 4 UUIDs. <span id="impl-49">Support for other versions of UUID, and the mechanism by which the necessary inputs are made available for computing other versions, is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version">Implementations <span class="rfc2119" id="c.uuid.6.1">must</span> support version 4 UUIDs. <span id="impl-49">Support for other versions of UUID, and the mechanism by which the necessary inputs are made available for computing other versions, is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p><p><span style="display: none;" class="delete_version">The matched nodes are specified with the <em class="glossterm">selection pattern</em> in the <code class="option">match</code> option. For each matching node, the generated UUID is used in the output (if more than one node matches, the <em>same</em> UUID is used in each match). Nodes that do not match are copied without change.</span><span style="display: none;" class="add_version">The matched nodes are specified with the <em class="glossterm"><a href="#dt-selection-pattern">selection pattern</a></em> in the <code class="option">match</code> option. For each matching node, the generated UUID is used in the output (if more than one node matches, the <em>same</em> UUID is used in each match). Nodes that do not match are copied without change.</span><span class="modify_version">The matched nodes are specified with the <em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">selection</span><span class="deltaxml-old" style="background:#FF5555"> pattern</span><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em> in the <code class="option">match</code> option. For each matching node, the generated UUID is used in the output (if more than one node matches, the <em>same</em> UUID is used in each match). Nodes that do not match are copied without change.</span></p><p>If the expression given in the <code class="option">match</code> option matches an <em>attribute</em>, the UUID is used as the new value of the attribute in the output. If the attribute is named “<code class="tag-attribute">xml:base</code>”, the base URI of the element <span class="rfc2119" id="c.uuid.8.4">must</span> also be amended accordingly.</p><p>If the expression matches any other kind of node, the entire node (and <em>not</em> just its contents) is replaced by the UUID.</p><section id="c.uuid.10" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>If the resulting document contains exactly one text node, the <code class="literal">content-type</code> property is changed to <code class="literal">text/plain</code> and the <code class="literal">serialization</code> property is removed, while all other document properties are preserved. For other document types, all document properties are preserved.</p></div></section></div></section><section id="c.wrap-sequence" class="section"><div class="section-titlepage"><h3>2.40 p:wrap-sequence</h3></div><div class="content"><p>The <code class="tag-element">p:wrap-sequence</code> step accepts a sequence of documents and produces either a single document or a new sequence of documents.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:wrap-sequence</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">text xml html</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrapper</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>      </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">group-adjacent</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string?</code><code>"</code><code>/&gt;</code><code>             </code><code class="comment">&lt;!-- </code><span class="opt-type">XPathExpression</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">group-adjacent</code> option <span class="rfc2119" id="c.wrap-sequence.4.2">must</span> be an XPathExpression.</p><p>In its simplest form, <code class="tag-element">p:wrap-sequence</code> takes a sequence of documents and produces a single, new document by placing each document in the <code class="port">source</code> sequence inside a new document element as sequential siblings. The name of the document element is the value specified in the <code class="option">wrapper</code> option.</p><p>The <code class="option">group-adjacent</code> option can be used to group adjacent documents. The XPath context for the <code class="option">group-adjacent</code> option changes over time. For each document that appears on the <code class="code">source</code> port, the expression is evaluated with that document as the context document. The context position (<code class="code">position()</code>) is the position of that document within the sequence and the context size (<code class="code">last()</code>) is the total number of documents in the sequence. Whenever two or more sequentially adjacent documents have the same “group adjacent” value, they are wrapped together in a single wrapper element. </p><section id="c.wrap-sequence.7" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.wrap" class="section"><div class="section-titlepage"><h3>2.41 p:wrap</h3></div><div class="content"><p>The <code class="tag-element">p:wrap</code> step wraps matching nodes in the <code class="port">source</code> document with a new parent element.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:wrap</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrapper</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>      </code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">group-adjacent</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string?</code><code>"</code><code>/&gt;</code><code>             </code><code class="comment">&lt;!-- </code><span class="opt-type">XPathExpression</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">match</code> option <span class="rfc2119" id="c.wrap.4.2">must</span> be an XSLTSelectionPattern. <a id="err.inline.C0023.9"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if the pattern matches anything other than document, element, text, processing instruction, and comment nodes. </p><p>The value of the <code class="option">group-adjacent</code> option <span class="rfc2119" id="c.wrap.5.2">must</span> be an XPathExpression.</p><p>If the node matched is the document node (<code class="code">match="/"</code>), the result is a new document where the document element is a new element node whose QName is the value specified in the <code class="option">wrapper</code> option. That new element contains copies of all of the children of the original document node.</p><p><span style="display: none;" class="delete_version">When the <em class="glossterm">selection pattern</em> does not match the document node, every node that matches the specified <code class="option">match</code> pattern is replaced with a new element node whose QName is the value specified in the <code class="option">wrapper</code> option. The content of that new element is a copy of the original, matching node. The <code class="tag-element">p:wrap</code> step performs a "deep" wrapping, the children of the matching node and their descendants are processed and wrappers are added to all matching nodes. </span><span style="display: none;" class="add_version">When the <em class="glossterm"><a href="#dt-selection-pattern">selection pattern</a></em> does not match the document node, every node that matches the specified <code class="option">match</code> pattern is replaced with a new element node whose QName is the value specified in the <code class="option">wrapper</code> option. The content of that new element is a copy of the original, matching node. The <code class="tag-element">p:wrap</code> step performs a "deep" wrapping, the children of the matching node and their descendants are processed and wrappers are added to all matching nodes. </span><span class="modify_version">When the <em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">selection</span><span class="deltaxml-old" style="background:#FF5555"> pattern</span><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em> does not match the document node, every node that matches the specified <code class="option">match</code> pattern is replaced with a new element node whose QName is the value specified in the <code class="option">wrapper</code> option. The content of that new element is a copy of the original, matching node. The <code class="tag-element">p:wrap</code> step performs a "deep" wrapping, the children of the matching node and their descendants are processed and wrappers are added to all matching nodes. </span></p><p>The <code class="option">group-adjacent</code> option can be used to group adjacent matching nodes in a single wrapper element. The specified XPath expression is evaluated for each matching node with that node as the XPath context node. Whenever two or more adjacent matching nodes have the same “group adjacent” value, they are wrapped together in a single wrapper element.</p><p>Two matching nodes are considered adjacent if and only if they are siblings and either there are no nodes between them or all intervening, non-matching nodes are whitespace text, comment, or processing instruction nodes.</p><section id="c.wrap.10" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.www-form-urldecode" class="section"><div class="section-titlepage"><h3>2.42 p:www-form-urldecode</h3></div><div class="content"><p>The <code class="tag-element">p:www-form-urldecode</code> step decodes a <code class="literal">x-www-form-urlencoded</code> string into an XML representation.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:www-form-urldecode</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">value</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The <code class="option">value</code> option is interpreted as a string of parameter values encoded using the <code class="literal">x-www-form-urlencoded</code> algorithm. Each name/value pair is written in a <code class="tag-element">c:param</code> element. The entire set of parameters is written (as a <code class="tag-element">c:param-set</code>) on the <code class="port">result</code> output port.</p><p><a id="err.inline.C0037"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0037"><code class="errqname">err:XC0037</code></a>) if the <code class="option">value</code> provided is not a properly <code class="literal">x-www-form-urlencoded</code> value. <a id="err.inline.C0061"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0061"><code class="errqname">err:XC0061</code></a>) if the name of any encoded parameter name is not a valid <code class="type">xs:NCName</code>. In other words, this step can only decode simple name/value pairs where the names do not contain colons or any characters that cannot be used in XML names. </p><p>The order of the <code class="tag-element">c:param</code> elements in the result is the same as the order of the encoded parameters, reading from left to right.</p><p>If any parameter name occurs more than once in the encoded string, the resulting parameter set will contain a <code class="tag-element">c:param</code> for each instance.</p><section id="c.www-form-urldecode.8" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section class="section" id="c.www-form-urlencode"><div class="section-titlepage"><h3>2.43 p:www-form-urlencode</h3></div><div class="content"><p>The <code class="tag-element">p:www-form-urlencode</code> step encodes a set of parameter values as a <code class="literal">x-www-form-urlencoded</code> string and injects it into the <code class="port">source</code> document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:www-form-urlencode</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item()*)?</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-req"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code><code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTSelectionPattern</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">match</code> option must be an XSLTSelectionPattern.</p><p>The set of parameters is encoded as a single <code class="literal">x-www-form-urlencoded</code> string of name/value pairs. When parameters are encoded into name/value pairs, <em>only</em> the local name of each parameter is used. The namespace name is ignored and no prefix or colon appears in the name. </p><p><span style="display: none;" class="delete_version"><span id="impl-46">The order of the parameters is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span><span style="display: none;" class="add_version"><span id="impl-50">The order of the parameters is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span><span class="modify_version"><span id="impl-50">The order of the parameters is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span></p><p><span style="display: none;" class="delete_version">The matched nodes are specified with the <em class="glossterm">selection pattern</em> in the <code class="option">match</code> option. For each matching node, the encoded string is used in the output. Nodes that do not match are copied without change.</span><span style="display: none;" class="add_version">The matched nodes are specified with the <em class="glossterm"><a href="#dt-selection-pattern">selection pattern</a></em> in the <code class="option">match</code> option. For each matching node, the encoded string is used in the output. Nodes that do not match are copied without change.</span><span class="modify_version">The matched nodes are specified with the <em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">selection</span><span class="deltaxml-old" style="background:#FF5555"> pattern</span><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em> in the <code class="option">match</code> option. For each matching node, the encoded string is used in the output. Nodes that do not match are copied without change.</span></p><p>If the expression given in the <code class="option">match</code> option matches an <em>attribute</em>, the encoded string is used as the new value of the attribute in the output. If the expression matches any other kind of node, the entire node (and <em>not</em> just its contents) is replaced by the encoded string.</p><section id="c.www-form-urlencode.9" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.xinclude" class="section"><div class="section-titlepage"><h3>2.44 p:xinclude</h3></div><div class="content"><p>The <code class="tag-element">p:xinclude</code> step applies [<a href="#xinclude"><span class="abbrev">XInclude</span></a>] processing to the <code class="port">source</code> document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:xinclude</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml html</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">fixup-xml-base</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">fixup-xml-lang</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>The value of the <code class="option">fixup-xml-base</code> option <span class="rfc2119" id="c.xinclude.4.2">must</span> be a boolean. If it is true, base URI fixup will be performed as per [<a href="#xinclude"><span class="abbrev">XInclude</span></a>].</p><p>The value of the <code class="option">fixup-xml-lang</code> option <span class="rfc2119" id="c.xinclude.5.2">must</span> be a boolean. If it is true, language fixup will be performed as per [<a href="#xinclude"><span class="abbrev">XInclude</span></a>].</p><p>The included documents are located with the base URI of the input document and are not provided as input to the step.</p><p><a id="err.inline.C0029"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0029"><code class="errqname">err:XC0029</code></a>) if an XInclude error occurs during processing. </p><section id="c.xinclude.8" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>All document properties are preserved.</p></div></section></div></section><section id="c.xquery" class="section"><div class="section-titlepage"><h3>2.45 p:xquery</h3></div><div class="content"><p>The <code class="tag-element">p:xquery</code> step applies an [<a href="#xquery10"><span class="abbrev">XQuery 1.0</span></a>] query to the sequence of documents provided on the <code class="port">source</code> port.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:xquery</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">query</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml */*+xml text/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item()*)?</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">version</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string?</code><code>"</code><code>/&gt;</code><code>                    </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>If a sequence of documents is provided on the <code class="port">source</code> port, the first document is used as the initial context item. The whole sequence is also the default collection. If no documents are provided on the <code class="port">source</code> port, the initial context item is undefined and the default collection is empty.</p><p>The <code class="port">query</code> port must receive a single document:</p><div class="itemizedlist"><ul><li><p>If the document root element is <a href="#cv.query"><code id="cv.query" class="tag-element">c:query</code></a>, the text descendants of this element are considered the query.</p><p class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:query&gt;<br />    <var>string</var><br />&lt;/c:query&gt;</code></p></li><li><p><span style="display: none;" class="delete_version">If the document root element is in the XQueryX namespace, the document is treated as an XQueryX-encoded query. <span id="impl-47">Support for XQueryX is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version">If the document root element is in the XQueryX namespace, the document is treated as an XQueryX-encoded query. <span id="impl-51">Support for XQueryX is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version">If the document root element is in the XQueryX namespace, the document is treated as an XQueryX-encoded query. <span id="impl-51">Support for XQueryX is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p></li><li><p>If the <code class="port">query</code> document has an XML media type, then the string value of the document <span class="rfc2119" id="c.xquery.6.3.1.2">must</span> be treated as the query. If the media type has a “<code class="literal">text</code>” type, then it <span class="rfc2119" id="c.xquery.6.3.1.4">must</span> be interpreted as the query.</p></li><li><p><span style="display: none;" class="delete_version"><span id="impl-48">Otherwise, the interpretation of the query is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version"><span id="impl-52">Otherwise, the interpretation of the query is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version"><span id="impl-52">Otherwise, the interpretation of the query is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p></li></ul></div><p>If the step specifies a <code class="option">version</code>, then that version of XQuery <span class="rfc2119" id="c.xquery.7.2">must</span> be used to process the transformation. <a id="err.inline.C0038"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0038"><code class="errqname">err:XC0038</code></a>) if the specified version is not available. If the step does not specify a version, the implementation may use any version it has available and may use any means to determine what version to use, including, but not limited to, examining the version of the query.</p><p>The result of the <code class="tag-element">p:xquery</code> step must be a sequence of documents. <a id="err.inline.C0057"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0057"><code class="errqname">err:XC0057</code></a>) if the sequence that results from evaluating the XQuery contains items other than documents and elements. Any elements that appear in the result sequence will be treated as documents with the element as their document element.</p><p>For example:</p><pre class="programlisting language-markup line-numbers"><code> &lt;c:query&gt; declare namespace atom="http://www.w3.org/2005/Atom"; /atom:feed/atom:entry &lt;/c:query&gt; </code></pre><p>The output of this step <span class="rfc2119" id="c.xquery.11.1">may</span> include PSVI annotations.</p><p>The static context of the XQuery processor is augmented in the following way:</p><div class="variablelist"><dl><dt><span class="term">Statically known default collection type</span></dt><dd><p><code class="literal">document()*</code></p></dd><dt><span class="term">Statically known namespaces:</span></dt><dd><p>Unchanged from the implementation defaults. No namespace declarations in the XProc pipeline are automatically exposed in the static context. </p></dd></dl></div><p>The dynamic context of the XQuery processor is augmented in the following way:</p><div class="variablelist"><dl><dt><span class="term">Context item</span></dt><dd><p>The first document that appears on the <code class="port">source</code> port. </p></dd><dt><span class="term">Context position</span></dt><dd><p><code class="literal">1</code></p></dd><dt><span class="term">Context size</span></dt><dd><p><code class="literal">1</code></p></dd><dt><span class="term">Variable values</span></dt><dd><p>Any parameters passed in the <code class="option">parameters</code> option augment any implementation-defined variable bindings known to the XQuery processor. </p></dd><dt><span class="term">Function implementations</span></dt><dd><p>The function implementations provided by the XQuery processor.</p></dd><dt><span class="term">Current dateTime</span></dt><dd><p><span style="display: none;" class="delete_version"><span id="impl-49">The point in time returned as the current dateTime is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span style="display: none;" class="add_version"><span id="impl-53">The point in time returned as the current dateTime is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span><span class="modify_version"><span id="impl-53">The point in time returned as the current dateTime is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</span></span></p></dd><dt><span class="term">Implicit timezone</span></dt><dd><p><span style="display: none;" class="delete_version"><span id="impl-50">The implicit timezone is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span style="display: none;" class="add_version"><span id="impl-54">The implicit timezone is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span><span class="modify_version"><span id="impl-54">The implicit timezone is <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>. </span></span></p></dd><dt><span class="term">Available documents</span></dt><dd><p><span style="display: none;" class="delete_version"><span id="impl-51">The set of available documents (those that may be retrieved with a URI) is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span><span style="display: none;" class="add_version"><span id="impl-55">The set of available documents (those that may be retrieved with a URI) is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span><span class="modify_version"><span id="impl-55">The set of available documents (those that may be retrieved with a URI) is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span></p></dd><dt><span class="term">Available collections</span></dt><dd><p><span style="display: none;" class="delete_version"><span id="impl-52">The set of available collections is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span><span style="display: none;" class="add_version"><span id="impl-56">The set of available collections is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span><span class="modify_version"><span id="impl-56">The set of available collections is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span></span></p></dd><dt><span class="term">Default collection</span></dt><dd><p>The sequence of documents provided on the <code class="port">source</code> port. </p></dd></dl></div><section id="example-xquery" class="section tocsuppress"><div class="section-titlepage"><h4>2.45.1 Example</h4></div><div class="content"><p>The following pipeline applies XInclude processing and schema validation before using XQuery:</p><figure id="ex.c.xquery" class="example-wrapper"><div class="title">Example 2. A Sample Pipeline Document</div><div class="example"><pre class="programlisting language-markup line-numbers"><code>&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt; &lt;p:input port="source"/&gt; &lt;p:output port="result"/&gt; &lt;p:xinclude/&gt; &lt;p:validate-with-xml-schema name="validate"&gt; &lt;p:with-input port="schema" href="http://example.com/path/to/schema.xsd"/&gt; &lt;/p:validate-with-xml-schema&gt; &lt;p:xquery&gt; &lt;p:with-input port="query" href="countp.xq"/&gt; &lt;/p:xquery&gt; &lt;/p:declare-step&gt;</code></pre></div></figure><p>Where <code class="filename">countp.xq</code> might contain:</p><pre class="programlisting language-markup"><code>&lt;count&gt;{count(.//p)}&lt;/count&gt;</code></pre></div></section><section id="c.xquery.17" class="section"><div class="section-titlepage"><h4>2.45.2 Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section><section id="c.xslt" class="section"><div class="section-titlepage"><h3>2.46 p:xslt</h3></div><div class="content"><p>The <code class="tag-element">p:xslt</code> step applies an XSLT stylesheet to a document.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code>&lt;p:declare-step</code><code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:xslt</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">any</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">stylesheet</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code><code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">false</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">any</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code><code class="attr port-attr">port</code><code>="</code><code class="value port-value">secondary</code><code>"</code><code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item()*)?</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">initial-mode</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName?</code><code>"</code><code>/&gt;</code><code>                </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">template-name</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName?</code><code>"</code><code>/&gt;</code><code>               </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">output-base-uri</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI?</code><code>"</code><code>/&gt;</code><code>            </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code><code class="attr name-attr">name</code><code>="</code><code class="value name-value">version</code><code>"</code><code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string?</code><code>"</code><code>/&gt;</code><code>                    </code></span><br /><code>&lt;/p:declare-step&gt;</code></p><p>If present, the value of the <code class="option">initial-mode</code> option <span class="rfc2119" id="c.xslt.4.2">must</span> be a <code class="type">QName</code>.</p><p>If present, the value of the <code class="option">template-name</code> option <span class="rfc2119" id="c.xslt.5.2">must</span> be a <code class="type">QName</code>.</p><p>If present, the value of the <code class="option">output-base-uri</code> option <span class="rfc2119" id="c.xslt.6.2">must</span> be an <code class="type">anyURI</code>. If it is relative, it is made absolute against the base URI of the element on which it is specified (<code class="tag-element">p:with-option</code> or <code class="tag-element">p:xslt</code> in the case of a syntactic shortcut value).</p><p>If the step specifies a <code class="option">version</code>, then that version of XSLT <span class="rfc2119" id="c.xslt.7.2">must</span> be used to process the transformation. <a id="err.inline.C0038.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0038"><code class="errqname">err:XC0038</code></a>) if the specified version is not available. If the step does not specify a version, the implementation may use any version it has available and may use any means to determine what version to use, including, but not limited to, examining the version of the stylesheet.</p><p><span style="display: none;" class="delete_version">The XSLT stylesheet provided on the <code class="port">stylesheet</code> port is applied to the document on the <code class="port">source</code> port. Any parameters passed in the <code class="option">parameters</code> option are used to define top-level stylesheet parameters. The primary result document of the transformation, if there is one, appears on the <code class="port">result</code> port. At most one document can appear on the <code class="port">result</code> port. All other result documents appear on the <code class="port">secondary</code> port. <span id="impl-53">The order in which result documents appear on the <code class="port">secondary</code> port is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span> If XSLT 1.0 is used, an empty sequence of documents <span class="rfc2119" id="c.xslt.8.8">must</span> appear on the <code class="port">secondary</code> port.</span><span style="display: none;" class="add_version">The XSLT stylesheet provided on the <code class="port">stylesheet</code> port is applied to the document on the <code class="port">source</code> port. Any parameters passed in the <code class="option">parameters</code> option are used to define top-level stylesheet parameters. The primary result document of the transformation, if there is one, appears on the <code class="port">result</code> port. At most one document can appear on the <code class="port">result</code> port. All other result documents appear on the <code class="port">secondary</code> port. <span id="impl-57">The order in which result documents appear on the <code class="port">secondary</code> port is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span> If XSLT 1.0 is used, an empty sequence of documents <span class="rfc2119" id="c.xslt.8.8">must</span> appear on the <code class="port">secondary</code> port.</span><span class="modify_version">The XSLT stylesheet provided on the <code class="port">stylesheet</code> port is applied to the document on the <code class="port">source</code> port. Any parameters passed in the <code class="option">parameters</code> option are used to define top-level stylesheet parameters. The primary result document of the transformation, if there is one, appears on the <code class="port">result</code> port. At most one document can appear on the <code class="port">result</code> port. All other result documents appear on the <code class="port">secondary</code> port. <span id="impl-57">The order in which result documents appear on the <code class="port">secondary</code> port is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span> If XSLT 1.0 is used, an empty sequence of documents <span class="rfc2119" id="c.xslt.8.8">must</span> appear on the <code class="port">secondary</code> port.</span></p><p>If a sequence of documents is provided on the <code class="port">source</code> port, the first document is used as the primary input document. The whole sequence is also the default collection. If no documents are provided on the <code class="port">source</code> port, the primary input document is undefined and the default collection is empty. <a id="err.inline.C0039"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0039"><code class="errqname">err:XC0039</code></a>) if a sequence of documents (including an empty sequence) is provided to an XSLT 1.0 step. </p><p><span style="display: none;" class="delete_version">A dynamic error occurs if the XSLT processor signals a fatal error. This includes the case where the transformation terminates due to a <code class="tag-element">xsl:message</code> instruction with a <code class="tag-attribute">terminate</code> attribute value of “<code class="literal">yes</code>”. <span id="impl-54">How XSLT message termination errors are reported to the XProc processor is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span> Implementations <span class="rfc2119" id="c.xslt.10.5">should</span> raise an error using the error code from the XSLT step (for example, the <code class="tag-attribute">error-code</code> specified on the <code class="tag-element">xsl:message</code> or <code class="code">err:XTTM9000</code> if no code is provided).</span><span style="display: none;" class="add_version">A dynamic error occurs if the XSLT processor signals a fatal error. This includes the case where the transformation terminates due to a <code class="tag-element">xsl:message</code> instruction with a <code class="tag-attribute">terminate</code> attribute value of “<code class="literal">yes</code>”. <span id="impl-58">How XSLT message termination errors are reported to the XProc processor is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span> Implementations <span class="rfc2119" id="c.xslt.10.5">should</span> raise an error using the error code from the XSLT step (for example, the <code class="tag-attribute">error-code</code> specified on the <code class="tag-element">xsl:message</code> or <code class="code">err:XTTM9000</code> if no code is provided).</span><span class="modify_version">A dynamic error occurs if the XSLT processor signals a fatal error. This includes the case where the transformation terminates due to a <code class="tag-element">xsl:message</code> instruction with a <code class="tag-attribute">terminate</code> attribute value of “<code class="literal">yes</code>”. <span id="impl-58">How XSLT message termination errors are reported to the XProc processor is <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em>.</span> Implementations <span class="rfc2119" id="c.xslt.10.5">should</span> raise an error using the error code from the XSLT step (for example, the <code class="tag-attribute">error-code</code> specified on the <code class="tag-element">xsl:message</code> or <code class="code">err:XTTM9000</code> if no code is provided).</span></p><p>The invocation of the transformation is controlled by the <code class="option">initial-mode</code> and <code class="option">template-name</code> options that set the initial mode and/or named template in the XSLT transformation where processing begins. <a id="err.inline.C0056"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0056"><code class="errqname">err:XC0056</code></a>) if the specified initial mode or named template cannot be applied to the specified stylesheet. </p><p>The <code class="option">output-base-uri</code> option sets the context's output base URI per the XSLT 2.0 specification, otherwise the base URI of the <code class="port">result</code> document is the base URI of the first document in the <code class="code">source</code> port's sequence. If the value of the <code class="option">output-base-uri</code> option is not absolute, it will be resolved using the base URI of its <code class="tag-element">p:option</code> element. An XSLT 1.0 step <span class="rfc2119" id="c.xslt.12.6">should</span> use the value of the <code class="option">output-base-uri</code> as the base URI of its output, if the option is specified.</p><p>If XSLT 2.0 is used, the outputs of this step <span class="rfc2119" id="c.xslt.13.1">may</span> include PSVI annotations.</p><p>The static and initial dynamic contexts of the XSLT processor are the contexts defined in the step XPath context with the following adjustments.</p><p>The dynamic context is augmented as follows:</p><div class="variablelist"><dl><dt><span class="term">Context item</span></dt><dd><p>The first document that appears on the <code class="port">source</code> port. </p></dd><dt><span class="term">Variable values</span></dt><dd><p>Any parameters passed in the <code class="option">parameters</code> option are available as variable bindings to the XSLT processor.</p></dd><dt><span class="term">Function implementations</span></dt><dd><p>The function implementations provided by the XSLT processor.</p></dd><dt><span class="term">Default collection</span></dt><dd><p>The sequence of documents provided on the <code class="port">source</code> port. </p></dd></dl></div><section id="c.xslt.17" class="simplesect"><div class="section-titlepage"><h4>Document properties</h4></div><div class="content"><p>No document properties are preserved.</p></div></section></div></section></div></section><section id="errors" class="section"><div class="section-titlepage"><h2>3 Step Errors</h2></div><div class="content"><p>Several of the steps in the standard step library can generate <em class="glossterm"><a href="#dt-dynamic-error">dynamic errors</a></em>.</p><p>A <span id="dt-dynamic-error" class="termdef">[Definition: A <em class="glossterm">dynamic error</em> is one which occurs while a pipeline is being evaluated.]</span> Examples of dynamic errors include references to URIs that cannot be resolved, steps which fail, and pipelines that exhaust the capacity of an implementation (such as memory or disk space).</p><p>If a step fails due to a dynamic error, failure propagates upwards until either a <code class="tag-element">p:try</code> is encountered or the entire pipeline fails. In other words, outside of a <code class="tag-element">p:try</code>, step failure causes the entire pipeline to fail.</p><p>The following errors can be raised by steps in this specification:</p><div id="step-error-summary"><dl class="errs"><dt id="err.C0002"><code class="errqname">err:XC0002</code></dt><dd><p>It is a dynamic error if the value starts with the string “--”.</p><p>See: <a href="#err.inline.C0002">Request Entity body conversion</a></p></dd><dt id="err.C0003"><code class="errqname">err:XC0003</code></dt><dd><p>It is a dynamic error if a username or password is specified without specifying an auth-method, if the requested auth-method isn't supported, or the authentication challenge contains an authentication method that isn't supported.</p><p>See: <a href="#err.inline.C0003">Specifying a request</a></p></dd><dt id="err.C0004"><code class="errqname">err:XC0004</code></dt><dd><p>It is a dynamic error if the status-only attribute has the value true and the detailed attribute does not have the value true.</p><p>See: <a href="#err.inline.C0004">Specifying a request</a></p></dd><dt id="err.C0005"><code class="errqname">err:XC0005</code></dt><dd><p>It is a dynamic error if the request contains a c:body or c:multipart but the method does not allow for an entity body being sent with the request.</p><p>See: <a href="#err.inline.C0005">Specifying a request</a></p></dd><dt id="err.C0006"><code class="errqname">err:XC0006</code></dt><dd><p>It is a dynamic error if the method is not specified on a c:request. </p><p>See: <a href="#err.inline.C0006">Specifying a request</a></p></dd><dt id="err.C0010"><code class="errqname">err:XC0010</code></dt><dd><p>It is a dynamic error if an encoding of base64 is specified and the character set is not specified or if the specified character set is not supported by the implementation.</p><p>See: <a href="#err.inline.C0010">p:unescape-markup</a></p></dd><dt id="err.C0012"><code class="errqname">err:XC0012</code></dt><dd><p>It is a dynamic error if the contents of the directory path are not available to the step due to access restrictions in the environment in which the pipeline is run.</p><p>See: <a href="#err.inline.C0012">p:directory-list</a></p></dd><dt id="err.C0013"><code class="errqname">err:XC0013</code></dt><dd><p>It is a dynamic error if the pattern matches a processing instruction and the new name has a non-null namespace.</p><p>See: <a href="#err.inline.C0013">p:rename</a></p></dd><dt id="err.C0014"><code class="errqname">err:XC0014</code></dt><dd><p>It is a dynamic error if the XML namespace (http://www.w3.org/XML/1998/namespace) or the XMLNS namespace (http://www.w3.org/2000/xmlns/) is the value of either the from option or the to option.</p><p>See: <a href="#err.inline.C0014">p:namespace-rename</a></p></dd><dt id="err.C0017"><code class="errqname">err:XC0017</code></dt><dd><p>It is a dynamic error if the absolute path does not identify a directory.</p><p>See: <a href="#err.inline.C0017">p:directory-list</a></p></dd><dt id="err.C0019"><code class="errqname">err:XC0019</code></dt><dd><p>It is a dynamic error if the documents are not equal according to the specified comparison method, and the value of the fail-if-not-equal option is true.</p><p>See: <a href="#err.inline.C0019">p:compare</a></p></dd><dt id="err.C0020"><code class="errqname">err:XC0020</code></dt><dd><p>It is a dynamic error if the the user specifies a value or values that are inconsistent with each other or with the requirements of the step or protocol.</p><p>See: <a href="#err.inline.C0020">Specifying a request</a></p></dd><dt id="err.C0022"><code class="errqname">err:XC0022</code></dt><dd><p>it is a dynamic error if the content of the c:body element does not consist of exactly one element, optionally preceded and/or followed by any number of processing instructions, comments or whitespace characters</p><p>See: <a href="#err.inline.C0022">Request Entity body conversion</a></p></dd><dt id="err.C0023"><code class="errqname">err:XC0023</code></dt><dd><p>It is a dynamic error if the selection pattern matches a node which is not an element.</p><p>See: <a href="#err.inline.C0023">p:add-attribute</a>, <a href="#err.inline.C0023.1">p:delete</a>, <a href="#err.inline.C0023.2">p:insert</a>, <a href="#err.inline.C0023.3">p:label-elements</a>, <a href="#err.inline.C0023.4">p:make-absolute-uris</a>, <a href="#err.inline.C0023.5">p:rename</a>, <a href="#err.inline.C0023.6">p:replace</a>, <a href="#err.inline.C0023.7">p:set-attributes</a>, <a href="#err.inline.C0023.8">p:unwrap</a>, <a href="#err.inline.C0023.9">p:wrap</a></p></dd><dt id="err.C0024"><code class="errqname">err:XC0024</code></dt><dd><p>It is a dynamic error if the selection pattern matches a document node and the value of the position is “before” or “after”.</p><p>See: <a href="#err.inline.C0024">p:insert</a></p></dd><dt id="err.C0025"><code class="errqname">err:XC0025</code></dt><dd><p>It is a dynamic error if the selection pattern matches anything other than an element or a document node and the value of the position option is “first-child” or “last-child”.</p><p>See: <a href="#err.inline.C0025">p:insert</a></p></dd><dt id="err.C0028"><code class="errqname">err:XC0028</code></dt><dd><p>it is a dynamic error if the content of the c:body element does not consist entirely of characters</p><p>See: <a href="#err.inline.C0028">Request Entity body conversion</a></p></dd><dt id="err.C0029"><code class="errqname">err:XC0029</code></dt><dd><p>It is a dynamic error if an XInclude error occurs during processing.</p><p>See: <a href="#err.inline.C0029">p:xinclude</a></p></dd><dt id="err.C0030"><code class="errqname">err:XC0030</code></dt><dd><p>It is a dynamic error if the override-content-type value cannot be used (e.g. text/plain to override image/png).</p><p>See: <a href="#err.inline.C0030">Managing the response</a></p></dd><dt id="err.C0036"><code class="errqname">err:XC0036</code></dt><dd><p>It is a dynamic error if the requested hash algorithm is not one that the processor understands or if the value or parameters are not appropriate for that algorithm.</p><p>See: <a href="#err.inline.C0036">p:hash</a></p></dd><dt id="err.C0037"><code class="errqname">err:XC0037</code></dt><dd><p>It is a dynamic error if the value provided is not a properly x-www-form-urlencoded value.</p><p>See: <a href="#err.inline.C0037">p:www-form-urldecode</a></p></dd><dt id="err.C0038"><code class="errqname">err:XC0038</code></dt><dd><p>It is a dynamic error if the specified version is not available.</p><p>See: <a href="#err.inline.C0038">p:xquery</a>, <a href="#err.inline.C0038.1">p:xslt</a></p></dd><dt id="err.C0039"><code class="errqname">err:XC0039</code></dt><dd><p>It is a dynamic error if a sequence of documents (including an empty sequence) is provided to an XSLT 1.0 step.</p><p>See: <a href="#err.inline.C0039">p:xslt</a></p></dd><dt id="err.C0040"><code class="errqname">err:XC0040</code></dt><dd><p>It is a dynamic error if the document element of the document that arrives on the source port is not c:request.</p><p>See: <a href="#err.inline.C0040">p:http-request</a></p></dd><dt id="err.C0050"><code class="errqname">err:XC0050</code></dt><dd><p>It is a dynamic error if the URI scheme is not supported or the step cannot store to the specified location.</p><p>See: <a href="#err.inline.C0050">p:store</a></p></dd><dt id="err.C0051"><code class="errqname">err:XC0051</code></dt><dd><p>It is a dynamic error if the content-type specified is not supported by the implementation.</p><p>See: <a href="#err.inline.C0051">p:unescape-markup</a></p></dd><dt id="err.C0052"><code class="errqname">err:XC0052</code></dt><dd><p>It is a dynamic error if the encoding specified is not supported by the implementation.</p><p>See: <a href="#err.inline.C0052">Request Entity body conversion</a>, <a href="#err.inline.C0052.1">p:unescape-markup</a></p></dd><dt id="err.C0056"><code class="errqname">err:XC0056</code></dt><dd><p>It is a dynamic error if the specified initial mode or named template cannot be applied to the specified stylesheet.</p><p>See: <a href="#err.inline.C0056">p:xslt</a></p></dd><dt id="err.C0057"><code class="errqname">err:XC0057</code></dt><dd><p>It is a dynamic error if the sequence that results from evaluating the XQuery contains items other than documents and elements.</p><p>See: <a href="#err.inline.C0057">p:xquery</a></p></dd><dt id="err.C0058"><code class="errqname">err:XC0058</code></dt><dd><p>It is a dynamic error if the all and relative options are both true.</p><p>See: <a href="#err.inline.C0058">p:add-xml-base</a></p></dd><dt id="err.C0059"><code class="errqname">err:XC0059</code></dt><dd><p>It is a dynamic error if the QName value in the attribute-name option uses the prefix “xmlns” or any other prefix that resolves to the namespace name http://www.w3.org/2000/xmlns/. </p><p>See: <a href="#err.inline.C0059">p:add-attribute</a></p></dd><dt id="err.C0060"><code class="errqname">err:XC0060</code></dt><dd><p>It is a dynamic error if the processor does not support the specified version of the UUID algorithm.</p><p>See: <a href="#err.inline.C0060">p:uuid</a></p></dd><dt id="err.C0061"><code class="errqname">err:XC0061</code></dt><dd><p>It is a dynamic error if the name of any encoded parameter name is not a valid xs:NCName.</p><p>See: <a href="#err.inline.C0061">p:www-form-urldecode</a></p></dd><dt id="err.C0062"><code class="errqname">err:XC0062</code></dt><dd><p>It is a dynamic error if the match option matches a namespace node.</p><p>See: <a href="#err.inline.C0062">p:delete</a></p></dd><dt id="err.C0069"><code class="errqname">err:XC0069</code></dt><dd><p>It is a dynamic error if the properties map contains a key equal to the string “content-type”.</p><p>See: <a href="#err.inline.C0069">p:set-properties</a></p></dd><dt id="err.C0070"><code class="errqname">err:XC0070</code></dt><dd><p>It is a dynamic error if the supplied content-type is not a valid media type of the form “type/subtype+ext” where “+ext” is optional.</p><p>See: <a href="#err.inline.C0070">p:cast-content-type</a>, <a href="#err.inline.C0070.1">p:text-join</a></p></dd><dt id="err.C0071"><code class="errqname">err:XC0071</code></dt><dd><p>It is a dynamic error if the p:cast-content-type step cannot perform the requested cast.</p><p>See: <a href="#err.inline.C0071">p:cast-content-type</a></p></dd><dt id="err.C0072"><code class="errqname">err:XC0072</code></dt><dd><p>It is a dynamic error if the c:data contains content is not a valid base64 string.</p><p>See: <a href="#err.inline.C0072">p:cast-content-type</a></p></dd><dt id="err.C0073"><code class="errqname">err:XC0073</code></dt><dd><p>It is a dynamic error if the c:data element does not have a content-type attribute.</p><p>See: <a href="#err.inline.C0073">p:cast-content-type</a></p></dd><dt id="err.C0074"><code class="errqname">err:XC0074</code></dt><dd><p>It is a dynamic error if the content-type is supplied and is not the same as the content-type specified on the c:data element.</p><p>See: <a href="#err.inline.C0074">p:cast-content-type</a></p></dd><dt id="err.C0076"><code class="errqname">err:XC0076</code></dt><dd><p>It is a dynamic error if the comparison method specified in p:compare is not supported by the implementation.</p><p>See: <a href="#err.inline.C0076">p:compare</a></p></dd><dt id="err.C0077"><code class="errqname">err:XC0077</code></dt><dd><p>It is a dynamic error if the media types of the documents supplied are incompatible with the comparison method.</p><p>See: <a href="#err.inline.C0077">p:compare</a></p></dd><dt id="err.C0078"><code class="errqname">err:XC0078</code></dt><dd><p>It is a dynamic error if fail-on-timeout is specified as true and a value is given for timeout and the p:http-request is not finished in the time specified by timeout.</p><p>See: <a href="#err.inline.C0078">Specifying a request</a></p></dd><dt id="err.C0079"><code class="errqname">err:XC0079</code></dt><dd><p>It is a dynamic error if the map parameters contains an entry whose key is defined by the implementation and whose value is not valid for that key.</p><p>See: <a href="#err.inline.C0079">p:archive</a>, <a href="#err.inline.C0079.1">p:archive-manifest</a>, <a href="#err.inline.C0079.2">p:cast-content-type</a>, <a href="#err.inline.C0079.3">p:unarchive</a></p></dd><dt id="err.C0080"><code class="errqname">err:XC0080</code></dt><dd><p>It is a dynamic error if the number of documents on the archive does not match the expected number of archive input documents for the given format and command.</p><p>See: <a href="#err.inline.C0080">Handling of ZIP archives</a></p></dd><dt id="err.C0081"><code class="errqname">err:XC0081</code></dt><dd><p>It is a dynamic error if the content type of a document on the archive does not match the given archive format as specified in the format option.</p><p>See: <a href="#err.inline.C0081">p:archive</a>, <a href="#err.inline.C0081.1">p:archive-manifest</a></p></dd><dt id="err.C0082"><code class="errqname">err:XC0082</code></dt><dd><p>It is a dynamic error if more than one document appears on the source port of a p:archive step with a base URI mentioned in one of the non-ignored c:entry/@href attributes.</p><p>See: <a href="#err.inline.C0082">The archive manifest</a></p></dd><dt id="err.C0083"><code class="errqname">err:XC0083</code></dt><dd><p>It is a dynamic error if the c:entry/@href attribute in a p:archive step manifest is not specified and the c:file element has no child nodes.</p><p>See: <a href="#err.inline.C0083">The archive manifest</a></p></dd><dt id="err.C0084"><code class="errqname">err:XC0084</code></dt><dd><p>It is a dynamic error if documents appear on the p:archive step's source port that have duplicate or no base URI's.</p><p>See: <a href="#err.inline.C0084">p:archive</a></p></dd><dt id="err.C0085"><code class="errqname">err:XC0085</code></dt><dd><p>It is a dynamic error if the format of the archive cannot be understood, determined and/or processed.</p><p>See: <a href="#err.inline.C0085">p:archive-manifest</a></p></dd><dt id="err.C0092"><code class="errqname">err:XC0092</code></dt><dd><p>It is a dynamic error if as a consequence of changing or removing the namespace of an attribute the attribute's name is not unique on the respective element.</p><p>See: <a href="#err.inline.C0092">p:namespace-rename</a></p></dd><dt id="err.C0102"><code class="errqname">err:XC0102</code></dt><dd><p>It is a dynamic error if an implementation does not support directory listing for a specified scheme.</p><p>See: <a href="#err.inline.C0102">p:directory-list</a></p></dd><dt id="err.C075"><code class="errqname">err:XC075</code></dt><dd><p>In all cases except when the input document is a c:data element, it is a dynamic error if the content-type is not supplied.</p><p>See: <a href="#err.inline.C075">p:cast-content-type</a></p></dd></dl></div></div></section><article id="conformance" class="appendix"><header class="appendix-titlepage"><h2>A Conformance</h2></header><div class="content"><p>Conformant processors <span class="rfc2119" id="conformance.2.1">must</span> implement all of the features described in this specification except those that are explicitly identified as optional.</p><p>Some aspects of processor behavior are not completely specified; those features are either <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em> or <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</p><p><span id="dt-implementation-dependent" class="termdef">[Definition: An <em class="glossterm">implementation-dependent</em> feature is one where the implementation has discretion in how it is performed. Implementations are not required to document or explain how <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em> features are performed.]</span></p><p><span id="dt-implementation-defined" class="termdef">[Definition: An <em class="glossterm">implementation-defined</em> feature is one where the implementation has discretion in how it is performed. Conformant implementations <span class="rfc2119" id="dt-implementation-defined.2">must</span> document how <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> features are performed.]</span></p><section class="section" id="implementation-defined"><div class="section-titlepage"><h2>A.1 Implementation-defined features</h2></div><div class="content"><p>The following features are implementation-defined:</p><ol class="features"><li class="add_version" style="display: none;">The list of formats supported by the p:archive step is implementation-defined. See <a href="#c.archive" title="p:archive">Section 2.3, “p:archive”</a>.</li><li class="modify_version"><span class="deltaxml-new" style="background:#90EE90">The list of formats supported by the p:archive step is implementation-defined. See </span><a href="#c.archive" title="p:archive"><span class="deltaxml-new" style="background:#90EE90">Section 2.3, “p:archive”</span></a><span class="deltaxml-new" style="background:#90EE90">.</span></li><li class="add_version" style="display: none;">The list of archive formats that can be modified by p:archive is implementation-defined. See <a href="#c.archive" title="p:archive">Section 2.3, “p:archive”</a>.</li><li class="modify_version"><span class="deltaxml-new" style="background:#90EE90">The list of archive formats that can be modified by p:archive is implementation-defined. See </span><a href="#c.archive" title="p:archive"><span class="deltaxml-new" style="background:#90EE90">Section 2.3, “p:archive”</span></a><span class="deltaxml-new" style="background:#90EE90">.</span></li><li>The semantics of any additional attributes, elements and their values are implementation-defined. See <a href="#c.archive" title="p:archive">Section 2.3, “p:archive”</a>.</li><li>It is implementation-defined what other formats are supported. See <a href="#c.archive" title="p:archive">Section 2.3, “p:archive”</a>.</li><li>The semantics of the keys and the allowed values for these keys are implementation-defined. See <a href="#c.archive" title="p:archive">Section 2.3, “p:archive”</a>.</li><li>The c:archive root element may contain additional implementation-defined attributes. See <a href="#cv.archive-manifest" title="The archive manifest">Section 2.3.1, “The archive manifest”</a>.</li><li>The default compression method is implementation-defined. See <a href="#cv.archive-manifest" title="The archive manifest">Section 2.3.1, “The archive manifest”</a>.</li><li>It is implementation-defined what other compression methods are supported. See <a href="#cv.archive-manifest" title="The archive manifest">Section 2.3.1, “The archive manifest”</a>.</li><li>The default compression method is implementation-defined. See <a href="#cv.archive-manifest" title="The archive manifest">Section 2.3.1, “The archive manifest”</a>.</li><li>It is implementation-defined what compression levels are supported. See <a href="#cv.archive-manifest" title="The archive manifest">Section 2.3.1, “The archive manifest”</a>.</li><li>The c:entry elements may contain additional implementation-defined attributes. See <a href="#cv.archive-manifest" title="The archive manifest">Section 2.3.1, “The archive manifest”</a>.</li><li class="add_version" style="display: none;">The actual parameter names supported by p:archive for a particular format are implementation-defined. See <a href="#cv.archive-zips" title="Handling of ZIP archives">Section 2.3.2, “Handling of ZIP archives”</a>.</li><li class="modify_version"><span class="deltaxml-new" style="background:#90EE90">The actual parameter names supported by p:archive for a particular format are implementation-defined. See </span><a href="#cv.archive-zips" title="Handling of ZIP archives"><span class="deltaxml-new" style="background:#90EE90">Section 2.3.2, “Handling of ZIP archives”</span></a><span class="deltaxml-new" style="background:#90EE90">.</span></li><li>It is implementation-defined what other formats are supported. See <a href="#c.archive-manifest" title="p:archive-manifest">Section 2.4, “p:archive-manifest”</a>.</li><li>It is implementation-defined how the step determines the archive's format. See <a href="#c.archive-manifest" title="p:archive-manifest">Section 2.4, “p:archive-manifest”</a>.</li><li>The semantics of the keys and the allowed values for these keys are implementation-defined. See <a href="#c.archive-manifest" title="p:archive-manifest">Section 2.4, “p:archive-manifest”</a>.</li><li class="add_version" style="display: none;">Additional information provided for entries in p:archive-manifest is implementation-defined. See <a href="#c.archive-manifest" title="p:archive-manifest">Section 2.4, “p:archive-manifest”</a>.</li><li class="modify_version"><span class="deltaxml-new" style="background:#90EE90">Additional information provided for entries in p:archive-manifest is implementation-defined. See </span><a href="#c.archive-manifest" title="p:archive-manifest"><span class="deltaxml-new" style="background:#90EE90">Section 2.4, “p:archive-manifest”</span></a><span class="deltaxml-new" style="background:#90EE90">.</span></li><li>The semantics of the keys and the allowed values for these keys are implementation-defined. See <a href="#c.cast-content-type" title="p:cast-content-type">Section 2.5, “p:cast-content-type”</a>.</li><li>Casting an HTML document that isn’t already an XPath data model document into XML is implementation-defined. See <a href="#c.cast-content-type" title="p:cast-content-type">Section 2.5, “p:cast-content-type”</a>.</li><li>The precise nature of the conversion from JSON to XML is implementation-defined. See <a href="#c.cast-content-type" title="p:cast-content-type">Section 2.5, “p:cast-content-type”</a>.</li><li>The precise nature of the conversion from XML to JSON is implementation-defined. See <a href="#c.cast-content-type" title="p:cast-content-type">Section 2.5, “p:cast-content-type”</a>.</li><li>Casting from an XML media type to a non-XML media type when the input document is not a c:data document is implementation-defined. See <a href="#c.cast-content-type" title="p:cast-content-type">Section 2.5, “p:cast-content-type”</a>.</li><li>Casting from one non-XML media type to another non-XML media type is implementation-defined. See <a href="#c.cast-content-type" title="p:cast-content-type">Section 2.5, “p:cast-content-type”</a>.</li><li>Implementations of p:compare must support the deep-equal method; other supported methods are implementation-defined. See <a href="#c.compare" title="p:compare">Section 2.6, “p:compare”</a>.</li><li>If fail-if-not-equal is false, and the documents differ, an implementation-defined summary of the differences between the two documents may appear on the differences port. See <a href="#c.compare" title="p:compare">Section 2.6, “p:compare”</a>.</li><li>Conformant processors must support directory paths whose scheme is file. It is implementation-defined what other schemes are supported by p:directory-list, and what the interpretation of 'directory', 'file' and 'contents' is for those schemes. See <a href="#c.directory-list" title="p:directory-list">Section 2.9, “p:directory-list”</a>.</li><li>Any file or directory determined to be special by the p:directory-list step may be output using a c:other element but the criteria for marking a file as special are implementation-defined. See <a href="#c.directory-list" title="p:directory-list">Section 2.9, “p:directory-list”</a>.</li><li>The precise meaning of these properties are implementation-defined and may vary according to the URI scheme of the path. See <a href="#dir-list-details" title="Directory list details">Section 2.9.1, “Directory list details”</a>.</li><li>Any other attributes on c:file, c:directory, or c:other are implementation-defined. See <a href="#dir-list-details" title="Directory list details">Section 2.9.1, “Directory list details”</a>.</li><li>It is implementation-defined what other algorithms are supported. See <a href="#c.hash" title="p:hash">Section 2.13, “p:hash”</a>.</li><li>The interpretation of auth-method values on c:request other than “Basic” or “Digest” is implementation-defined. See <a href="#cv.request" title="Specifying a request">Section 2.14.1, “Specifying a request”</a>.</li><li>Whether or not, and to what extent, “multipart/byte-ranges” responses are supported is implementation-defined.) See <a href="#c.request_body" title="Request Entity body conversion">Section 2.14.2, “Request Entity body conversion”</a>.</li><li>An implementation may support encodings other than base64 but these encodings and their names are implementation-defined. See <a href="#c.request_body" title="Request Entity body conversion">Section 2.14.2, “Request Entity body conversion”</a>.</li><li>Pipeline authors that need to preserve cookies across several p:http-request calls in the same pipeline or across multiple invocations of the same or different pipelines will have to rely on implementation-defined mechanisms. See <a href="#cookies" title="Cookies">Section 2.14.3.2, “Cookies”</a>.</li><li>In the absence of an explicit type, the content type is implementation-defined See <a href="#c.load" title="p:load">Section 2.18, “p:load”</a>.</li><li>Additional XML parameters are implementation-defined. See <a href="#c.load.xml" title="Loading XML data">Section 2.18.1, “Loading XML data”</a>.</li><li>Text parameters are implementation-defined. See <a href="#c.load.text" title="Loading text data">Section 2.18.2, “Loading text data”</a>.</li><li>Additional JSON parameters are implementation-defined. See <a href="#c.load.json" title="Loading JSON data">Section 2.18.3, “Loading JSON data”</a>.</li><li>The precise way in which HTML documents are parsed into the XPath data model is implementation-defined. See <a href="#c.load.html" title="Loading HTML data">Section 2.18.4, “Loading HTML data”</a>.</li><li>HTML parameters are implementation-defined. See <a href="#c.load.html" title="Loading HTML data">Section 2.18.4, “Loading HTML data”</a>.</li><li>How a processor interprets other media types is implementation-defined. See <a href="#c.load.binary" title="Loading binary data">Section 2.18.5, “Loading binary data”</a>.</li><li>Parameters for other media types are implementation-defined. See <a href="#c.load.binary" title="Loading binary data">Section 2.18.5, “Loading binary data”</a>.</li><li>Support for other collations is implementation-defined. See <a href="#c.text-sort" title="p:text-sort">Section 2.34, “p:text-sort”</a>.</li><li>It is implementation-defined what other formats are supported. See <a href="#c.unarchive" title="p:unarchive">Section 2.36, “p:unarchive”</a>.</li><li>The semantics of the keys and the allowed values for these keys are implementation-defined. See <a href="#c.unarchive" title="p:unarchive">Section 2.36, “p:unarchive”</a>.</li><li>Behavior of p:unescape-markup for content-types other than application/xml is implementation-defined. See <a href="#c.unescape-markup" title="p:unescape-markup">Section 2.37, “p:unescape-markup”</a>.</li><li>If the version is not specified, the version of UUID computed is implementation-defined. See <a href="#c.uuid" title="p:uuid">Section 2.39, “p:uuid”</a>.</li><li>Support for other versions of UUID, and the mechanism by which the necessary inputs are made available for computing other versions, is implementation-defined. See <a href="#c.uuid" title="p:uuid">Section 2.39, “p:uuid”</a>.</li><li>Support for XQueryX is implementation-defined. See <a href="#c.xquery" title="p:xquery">Section 2.45, “p:xquery”</a>.</li><li>Otherwise, the interpretation of the query is implementation-defined. See <a href="#c.xquery" title="p:xquery">Section 2.45, “p:xquery”</a>.</li><li>The point in time returned as the current dateTime is implementation-defined. See <a href="#c.xquery" title="p:xquery">Section 2.45, “p:xquery”</a>.</li><li>The implicit timezone is implementation-defined. See <a href="#c.xquery" title="p:xquery">Section 2.45, “p:xquery”</a>.</li></ol></div></section><section id="implementation-dependent" class="section"><div class="section-titlepage"><h2>A.2 Implementation-dependent features</h2></div><div class="content"><p>The following features are implementation-dependent:</p><ol class="features"><li>The interpretation of a multipart message inside another multipart message is implementation-dependent. See <a href="#c.response_body" title="Converting Response Entity Bodies">Section 2.14.4, “Converting Response Entity Bodies”</a>.</li><li>If the IRI reference specified by the base-uri option on p:make-absolute-uris is absent and the input document has no base URI, the results are implementation-dependent. See <a href="#c.make-absolute-uris" title="p:make-absolute-uris">Section 2.19, “p:make-absolute-uris”</a>.</li><li>The order of the parameters is implementation-dependent. See <a href="#c.www-form-urlencode" title="p:www-form-urlencode">Section 2.43, “p:www-form-urlencode”</a>.</li><li>The set of available documents (those that may be retrieved with a URI) is implementation-dependent. See <a href="#c.xquery" title="p:xquery">Section 2.45, “p:xquery”</a>.</li><li>The set of available collections is implementation-dependent. See <a href="#c.xquery" title="p:xquery">Section 2.45, “p:xquery”</a>.</li><li>The order in which result documents appear on the secondary port is implementation-dependent. See <a href="#c.xslt" title="p:xslt">Section 2.46, “p:xslt”</a>.</li><li>How XSLT message termination errors are reported to the XProc processor is implementation-dependent. See <a href="#c.xslt" title="p:xslt">Section 2.46, “p:xslt”</a>.</li></ol></div></section></div></article><article id="references" class="appendix"><header class="appendix-titlepage"><h2>B References</h2></header><div class="content"><section id="normative-references" class="section"><div class="section-titlepage"><h2>B.1 Normative References</h2></div><div class="content"><div id="normative-references.2" class="bibliolist"><div id="xproc30" class="bibliomixed"><p>[<span class="abbrev">XProc 3.0</span>] <a href="http://spec.xproc.org/"><span class="citetitle"><cite>XProc 3.0: An XML Pipeline Language</cite></span></a>. Norman Walsh, Achim Berndzen, Gerrit Imsieke and Erik Siegel, editors. </p></div><div id="xmlschema-2" class="bibliomixed"><p>[<span class="abbrev">W3C XML Schema: Part 2</span>] <a href="http://www.w3.org/TR/xmlschema-2/"><span class="citetitle"><cite>XML Schema Part 2: Datatypes Second Edition</cite></span></a>. Paul V. Biron and Ashok Malhotra, editors. World Wide Web Consortium, 28 October 2004. </p></div><div id="xpath31" class="bibliomixed"><p>[<span class="abbrev">XPath 3.1</span>] <a href="http://www.w3.org/TR/xpath31/"><span class="citetitle"><cite>XML Path Language (XPath) 3.1</cite></span></a>. Jonathan Robie, Michael Dyck, Josh Spiegel, editors. W3C Recommendation. 21 March 2017.</p></div><div id="xpath31-functions" class="bibliomixed"><p>[<span class="abbrev">XPath and XQuery Functions and Operators 3.1</span>] <a href="https://www.w3.org/TR/xpath-functions-31/"><span class="citetitle"><cite>XPath and XQuery Functions and Operators 3.1</cite></span></a>. Michael Kay, editor. W3C Recommendation. 21 March 2017</p></div><div id="xinclude" class="bibliomixed"><p>[<span class="abbrev">XInclude</span>] <a href="http://www.w3.org/TR/xinclude/"><span class="citetitle"><cite>XML Inclusions (XInclude) Version 1.0 (Second Edition)</cite></span></a>. Jonathan Marsh, David Orchard, and Daniel Veillard, editors. W3C Recommendation. 15 November 2006.</p></div><div id="xml-serialization-31" class="bibliomixed"><p>[<span class="abbrev">Serialization</span>] <a href="https://www.w3.org/TR/xslt-xquery-serialization-31/"><span class="citetitle"><cite>XSLT and XQuery Serialization 3.1</cite></span></a>. Andrew Coleman and C. M. Sperberg-McQueen, editors. W3C Recommendation. 21 March 2017.</p></div><div id="xquery10" class="bibliomixed"><p>[<span class="abbrev">XQuery 1.0</span>] <a href="http://www.w3.org/TR/xquery/"><span class="citetitle"><cite>XQuery 1.0: An XML Query Language</cite></span></a>. Scott Boag, Don Chamberlin, Mary Fernández, et. al., editors. W3C Recommendation. 23 January 2007.</p></div><div id="rfc1321" class="bibliomixed"><p>[<span class="abbrev">MD5</span>] <a href="https://doi.org/10.17487/RFC1321"><span class="citetitle"><cite>RFC 1321: The MD5 Message-Digest Algorithm</cite></span></a>. R. Rivest. Network Working Group, IETF, April 1992.</p></div><div id="rfc2045" class="bibliomixed"><p class="error">@@FIXME:UNREFERENCED [<span class="abbrev">RFC 2045</span>] <a href="https://doi.org/10.17487/RFC2045"><span class="citetitle"><cite>RFC 2045: MIME (Multipurpose Internet Mail Extensions) Part One: Mechanisms for Specifying and Describing the Format of Internet Message Bodies</cite></span></a>. N. Freed, N. Borenstein, editors. Internet Engineering Task Force. November, 1996.</p></div><div id="rfc2046" class="bibliomixed"><p>[<span class="abbrev">RFC 2046</span>] <a href="https://doi.org/10.17487/RFC2046"><span class="citetitle"><cite>RFC 2046: Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</cite></span></a>. N. Freed, N. Borenstein, editors. Internet Engineering Task Force. November, 1996.</p></div><div id="rfc2119" class="bibliomixed"><p>[<span class="abbrev">RFC 2119</span>] <a href="https://doi.org/10.17487/RFC2119"><span class="citetitle"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></span></a>. S. Bradner. Network Working Group, IETF, Mar 1997. </p></div><div id="rfc2616" class="bibliomixed"><p>[<span class="abbrev">RFC 2616</span>] <a href="https://doi.org/10.17487/RFC2616"><span class="citetitle"><cite>RFC 2616: Hypertext Transfer Protocol — HTTP/1.1</cite></span></a>. R. Fielding, J. Gettys, J. Mogul, et. al., editors. Internet Engineering Task Force. June, 1999.</p></div><div id="rfc2617" class="bibliomixed"><p>[<span class="abbrev">RFC 2617</span>] <a href="https://doi.org/10.17487/RFC2617"><span class="citetitle"><cite>RFC 2617: HTTP Authentication: Basic and Digest Access Authentication</cite></span></a>. J. Franks, P. Hallam-Baker, J. Hostetler, S. Lawrence, P. Leach, A. Luotonen, L. Stewart. June, 1999 .</p></div><div id="unicodetr17" class="bibliomixed"><p>[<span class="abbrev">Unicode TR#17</span>] <a href="http://unicode.org/reports/tr17/"><span class="citetitle"><cite>Unicode Technical Report #17: Character Encoding Model</cite></span></a>. Ken Whistler, Mark Davis, and Asmus Freytag, authors. The Unicode Consortium. 11 November 2008.</p></div><div id="tidy" class="bibliomixed"><p>[<span class="abbrev">HTML Tidy</span>] <a href="http://tidy.sourceforge.net/"><span class="citetitle"><cite>HTML Tidy Library Project</cite></span></a>. SourceForge project. </p></div><div id="tagsoup" class="bibliomixed"><p>[<span class="abbrev">TagSoup</span>] <a href="http://ccil.org/~cowan/XML/tagsoup/"><span class="citetitle"><cite>TagSoup - Just Keep On Truckin'</cite></span></a>. John Cowan. </p></div><div id="bib.uuid" class="bibliomixed"><p>[<span class="abbrev">UUID</span>] <a href="http://www.itu.int/ITU-T/studygroups/com17/oid.html"><span class="citetitle"><cite>ITU X.667: Information technology - Open Systems Interconnection - Procedures for the operation of OSI Registration Authorities: Generation and registration of Universally Unique Identifiers (UUIDs) and their use as ASN.1 Object Identifier components</cite></span></a>. 2004.</p></div><div id="bib.sha" class="bibliomixed"><p>[<span class="abbrev">SHA1</span>] <a href="http://www.itl.nist.gov/fipspubs/fip180-1.htm"><span class="citetitle"><cite>Federal Information Processing Standards Publication 180-1: Secure Hash Standard</cite></span></a>. 1995.</p></div><div id="zip" class="bibliomixed"><p>[<span class="abbrev">ZIP</span>] <a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT"><span class="citetitle"><cite>.ZIP File Format Specification</cite></span></a>.</p></div></div></div></section><section id="informative-references" class="section"><div class="section-titlepage"><h2>B.2 Informative References</h2></div><div class="content"><div id="informative-references.2" class="bibliolist"><div id="bib.crc" class="bibliomixed"><p>[<span class="abbrev">CRC32</span>] “32-Bit Cyclic Redundancy Codes for Internet Applications”, <span class="citetitle"><cite>The International Conference on Dependable Systems and Networks: 459</cite></span>. <span class="biblioid">10.1109/DSN.2002.1028931</span>. P. Koopman. June 2002. </p></div></div></div></section></div></article><article id="glossary" class="appendix"><header class="appendix-titlepage"><h2>C Glossary</h2></header><div class="content"><div class="glosslist"><dl><dt id="glossary.2.1" class="glossentry"><em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em></dt><dd class="glossdef"><p>A <em class="firstterm">dynamic error</em> is one which occurs while a pipeline is being evaluated.</p></dd><dt id="glossary.2.2" class="glossentry"><em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em></dt><dd class="glossdef"><p>An <em class="firstterm">implementation-defined</em> feature is one where the implementation has discretion in how it is performed. Conformant implementations <span class="rfc2119" id="glossary.2.2.2.1.2">must</span> document how <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> features are performed.</p></dd><dt id="glossary.2.3" class="glossentry"><em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em></dt><dd class="glossdef"><p>An <em class="firstterm">implementation-dependent</em> feature is one where the implementation has discretion in how it is performed. Implementations are not required to document or explain how <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em> features are performed.</p></dd><dt id="glossary.2.4" class="glossentry"><em class="glossterm"><a href="#dt-selection-pattern"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-new" style="background:#90EE90">A </span><em class="firstterm"><span class="deltaxml-new" style="background:#90EE90">selection pattern</span></em><span class="deltaxml-new" style="background:#90EE90"> is an XSLT selection pattern. FIXME:</span></p></dd></dl></div></div></article><article id="ancillary-files" class="appendix"><header class="appendix-titlepage"><h2>D Ancillary files</h2></header><div class="content"><p>This specification includes by reference a number of ancillary files.</p><div class="variablelist"><dl><dt><span class="term"><a href="steps.xpl">steps.xpl</a></span></dt><dd><p>An XProc step library for the declared steps. </p></dd></dl></div></div></article><article id="credits" class="appendix"><header class="appendix-titlepage"><h2>E Credits</h2></header><div class="content"><p>This document is derived from <a href="https://www.w3.org/TR/2010/REC-xproc-20100511/">XProc: An XML Pipeline Language</a> published by the W3C. It was developed by the <em class="citetitle">XML Processing Model Working Group</em> and edited by Norman Walsh, Alex Miłowski, and Henry Thompson.</p><p>The editors of this specification extend their gratitude to everyone who contributed to this document and all of the versions that came before it.</p></div></article></article><script src="js/prism.js"></script></body></html>