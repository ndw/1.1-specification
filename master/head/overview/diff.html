<?xml version="1.0" encoding="UTF-8"?><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><!--Generated by the DeltaXML.com xhtml-outfilter.xsl--><!--Using XSL Processor: Saxonica--><meta charset="utf-8" /><link rel="alternate" title="XML" href="specification.xml" /><link rel="alternate" title="Latest editor's draft" href="http://www.w3.org/XML/XProc/docs/langspec.html" /><link rel="alternate" title="Latest Public Working Draft" href="http://www.w3.org/TR/xproc/" /><meta name="generator" content="DocBook XSL 2.0 Stylesheets V2.3.9" /><meta name="description" content="Abstract This specification provides an overview of the XProc specifications." /><link href="css/prism.css" rel="stylesheet" type="text/css" /><link href="css/db-prism.css" rel="stylesheet" type="text/css" /><link rel="stylesheet" type="text/css" href="css/base.css" /><link rel="stylesheet" type="text/css" href="css/xproc.css" /><link rel="stylesheet" type="text/css" href="css/base.css" /><link rel="stylesheet" type="text/css" href="css/print.css" media="print" /><script type="text/javascript" src="js/dbmodnizr.js"></script><title>-[[XProc 3.0: An XML Pipeline Language]]-</title><title>+[[XProc 3.0 Overview]]+</title><style type="text/css">
          body { margin-top: 50px }
          a.button { background: #DDD; border: 2px outset black; padding: 2px; margin: 2px; font-family: sans-serif; font-size: small;}
          a.button:hover { cursor:pointer; }
          a.button:active { border-style: inset; }
        </style><script type="text/javascript">
            function view(doc) {
              var allSpans=document.getElementsByTagName("*");
              if(doc=="old") {
                for(i=0;i!=allSpans.length;i++) {
                  var displayType= "inline";
                  if (allSpans[i].localName == "tr") {
                    displayType= "table-row";
                  } else if (allSpans[i].localName == "li") {
                    displayType= "list-item";
                  }
                  var name=allSpans[i].className;
                  if(name=="deltaxml-new" || name=="deltaxml-new-img" || name=="deltaxml-new-format" || name=="add_version" || name=="modify_version") {
                    allSpans[i].style.display="none";
                  } else if (name=="deltaxml-old" || name=="deltaxml-old-img" || name=="deltaxml-old-format" || name=="delete_version") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#FFF";
                    //need to take border off images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="none";
                    }
                  }
                }
              } else if(doc=="new") {
                for(i=0;i!=allSpans.length;i++) {
                  var displayType= "inline";
                  if (allSpans[i].localName == "tr") {
                    displayType= "table-row";
                  } else if (allSpans[i].localName == "li") {
                    displayType= "list-item";
                  }
                  var name=allSpans[i].className;
                  if(name=="deltaxml-new" || name=="deltaxml-new-img" || name=="deltaxml-new-format" || name=="add_version") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#FFF";
                    //need to take border off images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="none";
                    }
                  } else if (name=="deltaxml-old" || name=="deltaxml-old-img" || name=="deltaxml-old-format" || name=="delete_version" || name=="modify_version") {
                    allSpans[i].style.display="none";
                   }
                }
              } else if(doc=="both") {
                for(i=0;i!=allSpans.length;i++) {
                  var displayType= "inline";
                  if (allSpans[i].localName == "tr") {
                    displayType= "table-row";
                  } else if (allSpans[i].localName == "li") {
                    displayType= "list-item";
                  }
                  var name=allSpans[i].className;
                  if(name=="deltaxml-new" || name=="deltaxml-new-format" || name=="deltaxml-new-img") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#90EE90";
                    //need to add border to images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="2px solid green";
                    }
                  } else if(name=="deltaxml-old" || name=="deltaxml-old-format" || name=="deltaxml-old-img") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#FF5555";
                    //need to add border to images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="2px solid red";
                    }
                  } else if (name=="add_version" || name=="delete_version") {
                    allSpans[i].style.display="none";
                  } else if (name=="modify_version") {
                    allSpans[i].style.display= displayType;
                  }
                }
              }
            }
  
        </script></head><body><div style="position:fixed; clear:both; top:0px"><p><a class="button" onclick="view('old')">
              View Old
            </a><a class="button" onclick="view('new')">
              View New
            </a><a class="button" onclick="view('both')">
              View Both
            </a></p></div><article class="specification"><div class="head" id="spec.head"><h1><span class="deltaxml-old" style="background:#FF5555">XProc 3.0: An XML Pipeline Language</span></h1><h1><span class="deltaxml-new" style="background:#90EE90">XProc 3.0 Overview</span></h1><h2>Editor's Draft <time datetime="2019-02-12T21:21:07Z">12 February 2019 at 21:<span class="deltaxml-old" style="background:#FF5555">14</span><span class="deltaxml-new" style="background:#90EE90">21</span> UTC (<a href="https://github.com/ndw/3.0-specification/commit/1b04e601424966617427fcfddf19745868bae3ee">build <span class="deltaxml-old" style="background:#FF5555">770</span><span class="deltaxml-new" style="background:#90EE90">454</span></a>)</time></h2><dl><dt>This Version:</dt><dd><a href="https://ndw.github.io/3.0-specification/master/head/">https://<span class="deltaxml-old" style="background:#FF5555">xproc.github.io</span><span class="deltaxml-new" style="background:#90EE90">ndw.github.io</span>/3.0-specification/master/head/<span class="deltaxml-old" style="background:#FF5555">xproc/</span></a></dd><dt>Latest Version:</dt><dd><a href="http://spec.xproc.org/master/head/">http://spec.xproc.org/master/head/<span class="deltaxml-old" style="background:#FF5555">xproc/</span></a></dd><dt>Editors:</dt><dd><span class="personname">Norman Walsh</span></dd><dd><span class="personname">Achim Berndzen</span></dd><dd><span class="personname">Gerrit Imsieke</span></dd><dd><span class="personname">Erik Siegel</span></dd><dt>Repository:</dt><dd><a href="http://github.com/ndw/3.0-specification">This specification on GitHub</a></dd><dd><a href="http://github.com/xproc/3.0-specification/issues">Report an issue</a></dd><dt>Changes:</dt><dd><a href="diff.html">Diff against current “status quo” draft</a></dd><dd><a href="http://github.com/ndw/3.0-specification/commits/master">Commits for this specification</a></dd></dl><p>This document is also available in these non-normative formats: <a href="specification.xml">XML</a>, automatic <a href="diff.html">change markup</a> from the previous draft courtesy of <a href="http://www.deltaxml.com/">DeltaXML</a>.</p><p class="copyright"><span class="copyright">Copyright © <span class="years">2018</span> <span class="holders"><span class="holder">@@FIXME:</span></span></span></p><hr /><div class="abstract"><h2>Abstract</h2><p><span class="deltaxml-old" style="background:#FF5555">This specification describes the syntax and semantics of </span><em class="citetitle"><span class="deltaxml-old" style="background:#FF5555">XProc 3.0: An XML Pipeline Language</span></em><span class="deltaxml-old" style="background:#FF5555">, a language for describing operations to be performed on documents.</span></p><p><span class="deltaxml-old" style="background:#FF5555">An XML Pipeline specifies a sequence of operations to be performed on documents. Pipelines generally accept documents as input and produce documents as output. Pipelines are made up of simple steps which perform atomic operations on documents and constructs such as conditionals, iterations, and exception handlers which control which steps are executed.</span></p><p><span class="deltaxml-new" style="background:#90EE90">This specification provides an overview of the XProc specifications.</span></p></div><div class="status"><h2>Status of this Document</h2><p><strong>This document is an editor's draft that has no official standing.</strong></p><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document.</em></p><p>This document is derived from <a href="https://www.w3.org/TR/2010/REC-xproc-20100511/">XProc: An XML Pipeline Language</a> published by the W3C.<span class="deltaxml-new" style="background:#90EE90"> See also </span><a href="#credits" title="Credits"><span class="deltaxml-new" style="background:#90EE90">Appendix A, </span><i><span class="deltaxml-new" style="background:#90EE90">Credits</span></i></a><span class="deltaxml-new" style="background:#90EE90">.</span></p></div></div><hr /><div class="lists-of-titles"><div class="toc"><h2 id="TableOfContents">Table of Contents</h2><ul class="toc"><li><span style="display: none;" class="delete_version"><span>1 <a href="#introduction">Introduction</a></span><ul class="toc"><li><span>1.1 <a href="#intro-examples">Pipeline examples</a></span></li></ul></span><span style="display: none;" class="add_version"><span>1 <a href="#introduction">Introduction</a></span></span><span class="modify_version"><span>1 <a href="#introduction">Introduction</a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">1.1 </span><a href="#intro-examples"><span class="deltaxml-old" style="background:#FF5555">Pipeline examples</span></a></span></li></ul></span></li><li><span style="display: none;" class="delete_version"><span>2 <a href="#pipeline-concepts">Pipeline Concepts</a></span><ul class="toc"><li><span>2.1 <a href="#step-concept">Steps</a></span><ul class="toc"><li><span>2.1.1 <a href="#step-names">Step names</a></span></li></ul></li></ul></span><span style="display: none;" class="add_version"><span>2 <a href="#language">XProc 3.0</a></span></span><span class="modify_version"><span>2 <a href="#pipeline-concepts"><span class="deltaxml-old" style="background:#FF5555">Pipeline Concepts</span></a><a href="#language"><span class="deltaxml-new" style="background:#90EE90">XProc 3.0</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">2.1 </span><a href="#step-concept"><span class="deltaxml-old" style="background:#FF5555">Steps</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">2.1.1 </span><a href="#step-names"><span class="deltaxml-old" style="background:#FF5555">Step names</span></a></span></li></ul></li></ul></span></li><li><span style="display: none;" class="delete_version"><span>3 <a href="#documents">Documents</a></span><ul class="toc"><li><span>3.1 <a href="#document-types">Document Types</a></span><ul class="toc"><li><span>3.1.1 <a href="#xml-documents">XML Documents</a></span></li><li><span>3.1.2 <a href="#html-documents">HTML Documents</a></span></li><li><span>3.1.3 <a href="#text-documents">Text Documents</a></span></li><li><span>3.1.4 <a href="#json-documents">JSON Documents</a></span></li><li><span>3.1.5 <a href="#other-documents">Other documents</a></span></li></ul></li><li><span>3.2 <a href="#documents.9">Creating documents from XDM step results</a></span></li><li><span>3.3 <a href="#media-type-match">Matching Media Types</a></span></li></ul></span><span style="display: none;" class="add_version"><span>3 <a href="#steps">Additional Steps</a></span></span><span class="modify_version"><span>3 <a href="#documents"><span class="deltaxml-old" style="background:#FF5555">Documents</span></a><a href="#steps"><span class="deltaxml-new" style="background:#90EE90">Additional Steps</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">3.1 </span><a href="#document-types"><span class="deltaxml-old" style="background:#FF5555">Document Types</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">3.1.1 </span><a href="#xml-documents"><span class="deltaxml-old" style="background:#FF5555">XML Documents</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">3.1.2 </span><a href="#html-documents"><span class="deltaxml-old" style="background:#FF5555">HTML Documents</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">3.1.3 </span><a href="#text-documents"><span class="deltaxml-old" style="background:#FF5555">Text Documents</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">3.1.4 </span><a href="#json-documents"><span class="deltaxml-old" style="background:#FF5555">JSON Documents</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">3.1.5 </span><a href="#other-documents"><span class="deltaxml-old" style="background:#FF5555">Other documents</span></a></span></li></ul></li><li><span><span class="deltaxml-old" style="background:#FF5555">3.2 </span><a href="#documents.9"><span class="deltaxml-old" style="background:#FF5555">Creating documents from XDM step results</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">3.3 </span><a href="#media-type-match"><span class="deltaxml-old" style="background:#FF5555">Matching Media Types</span></a></span></li></ul></span></li><li class="delete_version" style="display: none;"><span>4 <a href="#input-output">Inputs and Outputs</a></span><ul class="toc"><li><span>4.1 <a href="#external-docs">External Documents</a></span></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">4 </span><a href="#input-output"><span class="deltaxml-old" style="background:#FF5555">Inputs and Outputs</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">4.1 </span><a href="#external-docs"><span class="deltaxml-old" style="background:#FF5555">External Documents</span></a></span></li></ul></li><li class="delete_version" style="display: none;"><span>5 <a href="#primary-input-output">Primary Inputs and Outputs</a></span></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">5 </span><a href="#primary-input-output"><span class="deltaxml-old" style="background:#FF5555">Primary Inputs and Outputs</span></a></span></li><li class="delete_version" style="display: none;"><span>6 <a href="#connections">Connections</a></span><ul class="toc"><li><span>6.1 <a href="#namespace-fixup">Namespace Fixup on XML Outputs</a></span></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">6 </span><a href="#connections"><span class="deltaxml-old" style="background:#FF5555">Connections</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">6.1 </span><a href="#namespace-fixup"><span class="deltaxml-old" style="background:#FF5555">Namespace Fixup on XML Outputs</span></a></span></li></ul></li><li class="delete_version" style="display: none;"><span>7 <a href="#initiating">Initiating a pipeline</a></span><ul class="toc"><li><span>7.1 <a href="#static-expressions">Evaluating expressions during static analysis</a></span></li><li><span>7.2 <a href="#dynamic-evaluation">Dynamic evaluation of the pipeline</a></span><ul class="toc"><li><span>7.2.1 <a href="#environment">Environment</a></span></li><li><span>7.2.2 <a href="#xpath-context">XPath in XProc</a></span></li></ul></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">7 </span><a href="#initiating"><span class="deltaxml-old" style="background:#FF5555">Initiating a pipeline</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">7.1 </span><a href="#static-expressions"><span class="deltaxml-old" style="background:#FF5555">Evaluating expressions during static analysis</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">7.2 </span><a href="#dynamic-evaluation"><span class="deltaxml-old" style="background:#FF5555">Dynamic evaluation of the pipeline</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">7.2.1 </span><a href="#environment"><span class="deltaxml-old" style="background:#FF5555">Environment</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">7.2.2 </span><a href="#xpath-context"><span class="deltaxml-old" style="background:#FF5555">XPath in XProc</span></a></span></li></ul></li></ul></li><li class="delete_version" style="display: none;"><span>8 <a href="#xpath-extension-functions">XPath Extension Functions</a></span><ul class="toc"><li><span>8.1 <a href="#f.system-property">System Properties</a></span></li><li><span>8.2 <a href="#f.step-available">Step Available</a></span></li><li><span>8.3 <a href="#f.iteration-position">Iteration Position</a></span></li><li><span>8.4 <a href="#f.iteration-size">Iteration Size</a></span></li><li><span>8.5 <a href="#f.version-available">Version Available</a></span></li><li><span>8.6 <a href="#f.xpath-version-available">XPath Version Available</a></span></li><li><span>8.7 <a href="#f.document-properties">Document properties</a></span></li><li><span>8.8 <a href="#f.document-properties-document">Document properties document</a></span></li><li><span>8.9 <a href="#f.document-property">Document property</a></span></li><li><span>8.10 <a href="#f.urify">Transform filesystem paths into URIs</a></span></li><li><span>8.11 <a href="#f.function-library-importable">Function library importable</a></span></li><li><span>8.12 <a href="#other-xpath-extension-functions">Other XPath Extension Functions</a></span></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">8 </span><a href="#xpath-extension-functions"><span class="deltaxml-old" style="background:#FF5555">XPath Extension Functions</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">8.1 </span><a href="#f.system-property"><span class="deltaxml-old" style="background:#FF5555">System Properties</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">8.2 </span><a href="#f.step-available"><span class="deltaxml-old" style="background:#FF5555">Step Available</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">8.3 </span><a href="#f.iteration-position"><span class="deltaxml-old" style="background:#FF5555">Iteration Position</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">8.4 </span><a href="#f.iteration-size"><span class="deltaxml-old" style="background:#FF5555">Iteration Size</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">8.5 </span><a href="#f.version-available"><span class="deltaxml-old" style="background:#FF5555">Version Available</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">8.6 </span><a href="#f.xpath-version-available"><span class="deltaxml-old" style="background:#FF5555">XPath Version Available</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">8.7 </span><a href="#f.document-properties"><span class="deltaxml-old" style="background:#FF5555">Document properties</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">8.8 </span><a href="#f.document-properties-document"><span class="deltaxml-old" style="background:#FF5555">Document properties document</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">8.9 </span><a href="#f.document-property"><span class="deltaxml-old" style="background:#FF5555">Document property</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">8.10 </span><a href="#f.urify"><span class="deltaxml-old" style="background:#FF5555">Transform filesystem paths into URIs</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">8.11 </span><a href="#f.function-library-importable"><span class="deltaxml-old" style="background:#FF5555">Function library importable</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">8.12 </span><a href="#other-xpath-extension-functions"><span class="deltaxml-old" style="background:#FF5555">Other XPath Extension Functions</span></a></span></li></ul></li><li class="delete_version" style="display: none;"><span>9 <a href="#psvi-support">PSVIs in XProc</a></span></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">9 </span><a href="#psvi-support"><span class="deltaxml-old" style="background:#FF5555">PSVIs in XProc</span></a></span></li><li class="delete_version" style="display: none;"><span>10 <a href="#value-templates">Value Templates</a></span><ul class="toc"><li><span>10.1 <a href="#attribute-value-templates">Attribute Value Templates</a></span></li><li><span>10.2 <a href="#text-value-templates">Text Value Templates</a></span></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">10 </span><a href="#value-templates"><span class="deltaxml-old" style="background:#FF5555">Value Templates</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">10.1 </span><a href="#attribute-value-templates"><span class="deltaxml-old" style="background:#FF5555">Attribute Value Templates</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">10.2 </span><a href="#text-value-templates"><span class="deltaxml-old" style="background:#FF5555">Text Value Templates</span></a></span></li></ul></li><li class="delete_version" style="display: none;"><span>11 <a href="#variables-options-background">Variables and Options</a></span><ul class="toc"><li><span>11.1 <a href="#variables">Variables</a></span></li><li><span>11.2 <a href="#options">Options</a></span></li><li><span>11.3 <a href="#statics">Static Options and Variables</a></span></li><li><span>11.4 <a href="#varopt-types">Variable and option types</a></span></li><li><span>11.5 <a href="#qname-handling">QName handling</a></span></li><li><span>11.6 <a href="#opt-bindings">Namespaces on variables and options</a></span></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">11 </span><a href="#variables-options-background"><span class="deltaxml-old" style="background:#FF5555">Variables and Options</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">11.1 </span><a href="#variables"><span class="deltaxml-old" style="background:#FF5555">Variables</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">11.2 </span><a href="#options"><span class="deltaxml-old" style="background:#FF5555">Options</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">11.3 </span><a href="#statics"><span class="deltaxml-old" style="background:#FF5555">Static Options and Variables</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">11.4 </span><a href="#varopt-types"><span class="deltaxml-old" style="background:#FF5555">Variable and option types</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">11.5 </span><a href="#qname-handling"><span class="deltaxml-old" style="background:#FF5555">QName handling</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">11.6 </span><a href="#opt-bindings"><span class="deltaxml-old" style="background:#FF5555">Namespaces on variables and options</span></a></span></li></ul></li><li class="delete_version" style="display: none;"><span>12 <a href="#security-considerations">Security Considerations</a></span></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">12 </span><a href="#security-considerations"><span class="deltaxml-old" style="background:#FF5555">Security Considerations</span></a></span></li><li class="delete_version" style="display: none;"><span>13 <a href="#versioning-considerations">Versioning Considerations</a></span></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">13 </span><a href="#versioning-considerations"><span class="deltaxml-old" style="background:#FF5555">Versioning Considerations</span></a></span></li><li class="delete_version" style="display: none;"><span>14 <a href="#syntax">Syntax Overview</a></span><ul class="toc"><li><span>14.1 <a href="#namespaces">XProc Namespaces</a></span></li><li><span>14.2 <a href="#scoping">Scoping of Names</a></span></li><li><span>14.3 <a href="#xml-base-attribute">Base URIs and xml:base</a></span></li><li><span>14.4 <a href="#xml-id-attribute">Unique identifiers</a></span></li><li><span>14.5 <a href="#syntax-docs-ports">Associating Documents with Ports</a></span></li><li><span>14.6 <a href="#documentation">Documentation</a></span></li><li><span>14.7 <a href="#annotations">Processor annotations</a></span></li><li><span>14.8 <a href="#extension-attributes">Extension attributes</a></span></li><li><span>14.9 <a href="#common-attr">Common Attributes</a></span><ul class="toc"><li><span>14.9.1 <a href="#expand-text-attribute">Expand text attributes</a></span></li><li><span>14.9.2 <a href="#use-when">Conditional Element Exclusion</a></span></li><li><span>14.9.3 <a href="#depends">Additional dependent connections</a></span></li><li><span>14.9.4 <a href="#timeout">Controlling long running steps</a></span></li><li><span>14.9.5 <a href="#messages">Status and debugging output</a></span></li></ul></li><li><span>14.10 <a href="#syntax-summaries">Syntax Summaries</a></span></li><li><span>14.11 <a href="#common-errors">Common errors</a></span></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">14 </span><a href="#syntax"><span class="deltaxml-old" style="background:#FF5555">Syntax Overview</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">14.1 </span><a href="#namespaces"><span class="deltaxml-old" style="background:#FF5555">XProc Namespaces</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.2 </span><a href="#scoping"><span class="deltaxml-old" style="background:#FF5555">Scoping of Names</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.3 </span><a href="#xml-base-attribute"><span class="deltaxml-old" style="background:#FF5555">Base URIs and xml:base</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.4 </span><a href="#xml-id-attribute"><span class="deltaxml-old" style="background:#FF5555">Unique identifiers</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.5 </span><a href="#syntax-docs-ports"><span class="deltaxml-old" style="background:#FF5555">Associating Documents with Ports</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.6 </span><a href="#documentation"><span class="deltaxml-old" style="background:#FF5555">Documentation</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.7 </span><a href="#annotations"><span class="deltaxml-old" style="background:#FF5555">Processor annotations</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.8 </span><a href="#extension-attributes"><span class="deltaxml-old" style="background:#FF5555">Extension attributes</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.9 </span><a href="#common-attr"><span class="deltaxml-old" style="background:#FF5555">Common Attributes</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">14.9.1 </span><a href="#expand-text-attribute"><span class="deltaxml-old" style="background:#FF5555">Expand text attributes</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.9.2 </span><a href="#use-when"><span class="deltaxml-old" style="background:#FF5555">Conditional Element Exclusion</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.9.3 </span><a href="#depends"><span class="deltaxml-old" style="background:#FF5555">Additional dependent connections</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.9.4 </span><a href="#timeout"><span class="deltaxml-old" style="background:#FF5555">Controlling long running steps</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.9.5 </span><a href="#messages"><span class="deltaxml-old" style="background:#FF5555">Status and debugging output</span></a></span></li></ul></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.10 </span><a href="#syntax-summaries"><span class="deltaxml-old" style="background:#FF5555">Syntax Summaries</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">14.11 </span><a href="#common-errors"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></span></li></ul></li><li class="delete_version" style="display: none;"><span>15 <a href="#steps">Steps</a></span><ul class="toc"><li><span>15.1 <a href="#pipelines">Pipelines</a></span><ul class="toc"><li><span>15.1.1 <a href="#example-pipeline">Example</a></span></li></ul></li><li><span>15.2 <a href="#p.for-each">p:for-each</a></span><ul class="toc"><li><span>15.2.1 <a href="#for-each-xpath-context">XPath Context</a></span></li><li><span>15.2.2 <a href="#example-for-each">Example</a></span></li></ul></li><li><span>15.3 <a href="#p.viewport">p:viewport</a></span><ul class="toc"><li><span>15.3.1 <a href="#viewport-xpath-context">XPath Context</a></span></li><li><span>15.3.2 <a href="#example-viewport">Example</a></span></li></ul></li><li><span>15.4 <a href="#p.choose">p:choose</a></span><ul class="toc"><li><span>15.4.1 <a href="#p.when">p:when</a></span></li><li><span>15.4.2 <a href="#p.otherwise">p:otherwise</a></span></li><li><span>15.4.3 <a href="#example-choose">Example</a></span></li></ul></li><li><span>15.5 <a href="#p.if">p:if</a></span></li><li><span>15.6 <a href="#p.group">p:group</a></span><ul class="toc"><li><span>15.6.1 <a href="#example-group">Example</a></span></li></ul></li><li><span>15.7 <a href="#p.try">p:try</a></span><ul class="toc"><li><span>15.7.1 <a href="#p.catch">p:catch</a></span></li><li><span>15.7.2 <a href="#p.finally">p:finally</a></span></li><li><span>15.7.3 <a href="#err-vocab">The Error Vocabulary</a></span></li><li><span>15.7.4 <a href="#example-try">Example</a></span></li></ul></li><li><span>15.8 <a href="#p.atomic">Atomic Steps</a></span></li><li><span>15.9 <a href="#p.extension">Extension Steps</a></span></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">15 </span><a href="#steps"><span class="deltaxml-old" style="background:#FF5555">Steps</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">15.1 </span><a href="#pipelines"><span class="deltaxml-old" style="background:#FF5555">Pipelines</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">15.1.1 </span><a href="#example-pipeline"><span class="deltaxml-old" style="background:#FF5555">Example</span></a></span></li></ul></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.2 </span><a href="#p.for-each"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">15.2.1 </span><a href="#for-each-xpath-context"><span class="deltaxml-old" style="background:#FF5555">XPath Context</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.2.2 </span><a href="#example-for-each"><span class="deltaxml-old" style="background:#FF5555">Example</span></a></span></li></ul></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.3 </span><a href="#p.viewport"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">15.3.1 </span><a href="#viewport-xpath-context"><span class="deltaxml-old" style="background:#FF5555">XPath Context</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.3.2 </span><a href="#example-viewport"><span class="deltaxml-old" style="background:#FF5555">Example</span></a></span></li></ul></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.4 </span><a href="#p.choose"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">15.4.1 </span><a href="#p.when"><span class="deltaxml-old" style="background:#FF5555">p:when</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.4.2 </span><a href="#p.otherwise"><span class="deltaxml-old" style="background:#FF5555">p:otherwise</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.4.3 </span><a href="#example-choose"><span class="deltaxml-old" style="background:#FF5555">Example</span></a></span></li></ul></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.5 </span><a href="#p.if"><span class="deltaxml-old" style="background:#FF5555">p:if</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.6 </span><a href="#p.group"><span class="deltaxml-old" style="background:#FF5555">p:group</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">15.6.1 </span><a href="#example-group"><span class="deltaxml-old" style="background:#FF5555">Example</span></a></span></li></ul></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.7 </span><a href="#p.try"><span class="deltaxml-old" style="background:#FF5555">p:try</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">15.7.1 </span><a href="#p.catch"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.7.2 </span><a href="#p.finally"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.7.3 </span><a href="#err-vocab"><span class="deltaxml-old" style="background:#FF5555">The Error Vocabulary</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.7.4 </span><a href="#example-try"><span class="deltaxml-old" style="background:#FF5555">Example</span></a></span></li></ul></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.8 </span><a href="#p.atomic"><span class="deltaxml-old" style="background:#FF5555">Atomic Steps</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">15.9 </span><a href="#p.extension"><span class="deltaxml-old" style="background:#FF5555">Extension Steps</span></a></span></li></ul></li><li class="delete_version" style="display: none;"><span>16 <a href="#other-elements">Other pipeline elements</a></span><ul class="toc"><li><span>16.1 <a href="#p.input">p:input</a></span></li><li><span>16.2 <a href="#p.with-input">p:with-input</a></span><ul class="toc"><li><span>16.2.1 <a href="#conn-prec">Connection precedence</a></span></li></ul></li><li><span>16.3 <a href="#p.output">p:output</a></span><ul class="toc"><li><span>16.3.1 <a href="#serialization">Serialization parameters</a></span></li></ul></li><li><span>16.4 <a href="#variables-options">Variables and Options</a></span><ul class="toc"><li><span>16.4.1 <a href="#p.variable">p:variable</a></span></li><li><span>16.4.2 <a href="#p.option">p:option</a></span></li><li><span>16.4.3 <a href="#p.with-option">p:with-option</a></span></li></ul></li><li><span>16.5 <a href="#p.declare-step">p:declare-step</a></span><ul class="toc"><li><span>16.5.1 <a href="#declare-pipelines">Declaring pipelines</a></span></li><li><span>16.5.2 <a href="#declare-atomic-steps">Declaring atomic steps</a></span></li></ul></li><li><span>16.6 <a href="#p.library">p:library</a></span></li><li><span>16.7 <a href="#p.import">p:import</a></span></li><li><span>16.8 <a href="#p.import-functions">p:import-functions</a></span></li><li><span>16.9 <a href="#p.pipe">p:pipe</a></span></li><li><span>16.10 <a href="#p.inline">p:inline</a></span><ul class="toc"><li><span>16.10.1 <a href="#inline-xml-content">Inline XML content</a></span></li><li><span>16.10.2 <a href="#inline-text">Inline text content</a></span></li><li><span>16.10.3 <a href="#inline-json">Inline JSON content</a></span></li><li><span>16.10.4 <a href="#inline-others">Other inline content</a></span></li><li><span>16.10.5 <a href="#implicit-inlines">Implicit inlines</a></span></li></ul></li><li><span>16.11 <a href="#p.document">p:document</a></span></li><li><span>16.12 <a href="#p.empty">p:empty</a></span></li><li><span>16.13 <a href="#p.documentation">p:documentation</a></span></li><li><span>16.14 <a href="#p.pipeinfo">p:pipeinfo</a></span></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">16 </span><a href="#other-elements"><span class="deltaxml-old" style="background:#FF5555">Other pipeline elements</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">16.1 </span><a href="#p.input"><span class="deltaxml-old" style="background:#FF5555">p:input</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.2 </span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">16.2.1 </span><a href="#conn-prec"><span class="deltaxml-old" style="background:#FF5555">Connection precedence</span></a></span></li></ul></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.3 </span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">16.3.1 </span><a href="#serialization"><span class="deltaxml-old" style="background:#FF5555">Serialization parameters</span></a></span></li></ul></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.4 </span><a href="#variables-options"><span class="deltaxml-old" style="background:#FF5555">Variables and Options</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">16.4.1 </span><a href="#p.variable"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.4.2 </span><a href="#p.option"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.4.3 </span><a href="#p.with-option"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></a></span></li></ul></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.5 </span><a href="#p.declare-step"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">16.5.1 </span><a href="#declare-pipelines"><span class="deltaxml-old" style="background:#FF5555">Declaring pipelines</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.5.2 </span><a href="#declare-atomic-steps"><span class="deltaxml-old" style="background:#FF5555">Declaring atomic steps</span></a></span></li></ul></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.6 </span><a href="#p.library"><span class="deltaxml-old" style="background:#FF5555">p:library</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.7 </span><a href="#p.import"><span class="deltaxml-old" style="background:#FF5555">p:import</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.8 </span><a href="#p.import-functions"><span class="deltaxml-old" style="background:#FF5555">p:import-functions</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.9 </span><a href="#p.pipe"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.10 </span><a href="#p.inline"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">16.10.1 </span><a href="#inline-xml-content"><span class="deltaxml-old" style="background:#FF5555">Inline XML content</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.10.2 </span><a href="#inline-text"><span class="deltaxml-old" style="background:#FF5555">Inline text content</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.10.3 </span><a href="#inline-json"><span class="deltaxml-old" style="background:#FF5555">Inline JSON content</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.10.4 </span><a href="#inline-others"><span class="deltaxml-old" style="background:#FF5555">Other inline content</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.10.5 </span><a href="#implicit-inlines"><span class="deltaxml-old" style="background:#FF5555">Implicit inlines</span></a></span></li></ul></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.11 </span><a href="#p.document"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.12 </span><a href="#p.empty"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.13 </span><a href="#p.documentation"><span class="deltaxml-old" style="background:#FF5555">p:documentation</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">16.14 </span><a href="#p.pipeinfo"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></a></span></li></ul></li><li class="delete_version" style="display: none;"><span>17 <a href="#errors">Errors</a></span><ul class="toc"><li><span>17.1 <a href="#static-errors">Static Errors</a></span></li><li><span>17.2 <a href="#dynamic-errors">Dynamic Errors</a></span></li><li><span>17.3 <a href="#step-errors">Step Errors</a></span></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">17 </span><a href="#errors"><span class="deltaxml-old" style="background:#FF5555">Errors</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">17.1 </span><a href="#static-errors"><span class="deltaxml-old" style="background:#FF5555">Static Errors</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">17.2 </span><a href="#dynamic-errors"><span class="deltaxml-old" style="background:#FF5555">Dynamic Errors</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">17.3 </span><a href="#step-errors"><span class="deltaxml-old" style="background:#FF5555">Step Errors</span></a></span></li></ul></li><li><span style="display: none;" class="delete_version"><span>A <a href="#conformance">Conformance</a></span><ul class="toc"><li><span>A.1 <a href="#implementation-defined">Implementation-defined features</a></span></li><li><span>A.2 <a href="#implementation-dependent">Implementation-dependent features</a></span></li><li><span>A.3 <a href="#infoset-conformance">Infoset Conformance</a></span></li></ul></span><span style="display: none;" class="add_version"><span>A <a href="#credits">Credits</a></span></span><span class="modify_version"><span>A <a href="#conformance"><span class="deltaxml-old" style="background:#FF5555">Conformance</span></a><a href="#credits"><span class="deltaxml-new" style="background:#90EE90">Credits</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">A.1 </span><a href="#implementation-defined"><span class="deltaxml-old" style="background:#FF5555">Implementation-defined features</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">A.2 </span><a href="#implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">Implementation-dependent features</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">A.3 </span><a href="#infoset-conformance"><span class="deltaxml-old" style="background:#FF5555">Infoset Conformance</span></a></span></li></ul></span></li><li class="delete_version" style="display: none;"><span>B <a href="#xproc-and-step-xpath-context">XPath contexts in XProc</a></span><ul class="toc"><li><span>B.1 <a href="#xproc-xpath-context-31">Processor XPath Context</a></span></li><li><span>B.2 <a href="#step-xpath-context-31">Step XPath Context</a></span></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">B </span><a href="#xproc-and-step-xpath-context"><span class="deltaxml-old" style="background:#FF5555">XPath contexts in XProc</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">B.1 </span><a href="#xproc-xpath-context-31"><span class="deltaxml-old" style="background:#FF5555">Processor XPath Context</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">B.2 </span><a href="#step-xpath-context-31"><span class="deltaxml-old" style="background:#FF5555">Step XPath Context</span></a></span></li></ul></li><li class="delete_version" style="display: none;"><span>C <a href="#references">References</a></span><ul class="toc"><li><span>C.1 <a href="#normative-references">Normative References</a></span></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">C </span><a href="#references"><span class="deltaxml-old" style="background:#FF5555">References</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">C.1 </span><a href="#normative-references"><span class="deltaxml-old" style="background:#FF5555">Normative References</span></a></span></li></ul></li><li class="delete_version" style="display: none;"><span>D <a href="#glossary">Glossary</a></span></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">D </span><a href="#glossary"><span class="deltaxml-old" style="background:#FF5555">Glossary</span></a></span></li><li class="delete_version" style="display: none;"><span>E <a href="#language-summary">Pipeline Language Summary</a></span></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">E </span><a href="#language-summary"><span class="deltaxml-old" style="background:#FF5555">Pipeline Language Summary</span></a></span></li><li class="delete_version" style="display: none;"><span>F <a href="#errors-list">List of Error Codes</a></span><ul class="toc"><li><span>F.1 <a href="#app.static-errors">Static Errors</a></span></li><li><span>F.2 <a href="#app.dynamic-errors">Dynamic Errors</a></span></li><li><span>F.3 <a href="#app.step-errors">Step Errors</a></span></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">F </span><a href="#errors-list"><span class="deltaxml-old" style="background:#FF5555">List of Error Codes</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">F.1 </span><a href="#app.static-errors"><span class="deltaxml-old" style="background:#FF5555">Static Errors</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">F.2 </span><a href="#app.dynamic-errors"><span class="deltaxml-old" style="background:#FF5555">Dynamic Errors</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">F.3 </span><a href="#app.step-errors"><span class="deltaxml-old" style="background:#FF5555">Step Errors</span></a></span></li></ul></li><li class="delete_version" style="display: none;"><span>G <a href="#namespace-fixup-guidance">Guidance on Namespace Fixup (Non-Normative)</a></span></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">G </span><a href="#namespace-fixup-guidance"><span class="deltaxml-old" style="background:#FF5555">Guidance on Namespace Fixup (Non-Normative)</span></a></span></li><li class="delete_version" style="display: none;"><span>H <a href="#handling-imports">Handling Circular and Re-entrant Library Imports (Non-Normative)</a></span></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">H </span><a href="#handling-imports"><span class="deltaxml-old" style="background:#FF5555">Handling Circular and Re-entrant Library Imports (Non-Normative)</span></a></span></li><li class="delete_version" style="display: none;"><span>I <a href="#parallelism">Sequential steps, parallelism, and side-effects</a></span></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">I </span><a href="#parallelism"><span class="deltaxml-old" style="background:#FF5555">Sequential steps, parallelism, and side-effects</span></a></span></li><li class="delete_version" style="display: none;"><span>J <a href="#xproc-media-type">The <code class="code">application/xproc+xml</code> media type</a></span><ul class="toc"><li><span>J.1 <a href="#media-type-registration">Registration of MIME media type application/xproc+xml</a></span></li><li><span>J.2 <a href="#fragid">Fragment Identifiers</a></span></li></ul></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">J </span><a href="#xproc-media-type"><span class="deltaxml-old" style="background:#FF5555">The </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">application/xproc+xml</span></code><span class="deltaxml-old" style="background:#FF5555"> media type</span></a></span><ul class="toc"><li><span><span class="deltaxml-old" style="background:#FF5555">J.1 </span><a href="#media-type-registration"><span class="deltaxml-old" style="background:#FF5555">Registration of MIME media type application/xproc+xml</span></a></span></li><li><span><span class="deltaxml-old" style="background:#FF5555">J.2 </span><a href="#fragid"><span class="deltaxml-old" style="background:#FF5555">Fragment Identifiers</span></a></span></li></ul></li><li class="delete_version" style="display: none;"><span>K <a href="#ancillary-files">Ancillary files</a></span></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">K </span><a href="#ancillary-files"><span class="deltaxml-old" style="background:#FF5555">Ancillary files</span></a></span></li><li class="delete_version" style="display: none;"><span>L <a href="#credits">Credits</a></span></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">L </span><a href="#credits"><span class="deltaxml-old" style="background:#FF5555">Credits</span></a></span></li><li class="delete_version" style="display: none;"><span>M <a href="#changelog">Change Log</a></span></li><li class="modify_version"><span><span class="deltaxml-old" style="background:#FF5555">M </span><a href="#changelog"><span class="deltaxml-old" style="background:#FF5555">Change Log</span></a></span></li></ul></div></div><section class="section" id="introduction"><div class="section-titlepage"><h2>1 Introduction</h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">An XML Pipeline specifies a sequence of operations to be performed on a collection of input documents. Pipelines take documents (XML, JSON, text, images, etc.) as their input and produce documents as their output.</span></p><p><span class="deltaxml-old" style="background:#FF5555">A </span><em class="glossterm"><a href="#dt-pipeline"><span class="deltaxml-old" style="background:#FF5555">pipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555"> consists of steps. Like pipelines, steps take documents as their inputs and produce documents as their outputs. The inputs of a step come from the web, from the pipeline document, from the inputs to the pipeline itself, or from the outputs of other steps in the pipeline. The outputs from a step are consumed by other steps, are outputs of the pipeline as a whole, or are discarded.</span></p><p><span class="deltaxml-old" style="background:#FF5555">There are two kinds of steps: </span><em class="glossterm"><a href="#dt-atomic-step"><span class="deltaxml-old" style="background:#FF5555">atomic steps</span></a></em><span class="deltaxml-old" style="background:#FF5555"> and </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound steps</span></a></em><span class="deltaxml-old" style="background:#FF5555">. Atomic steps carry out a single operation and have no substructure as far as the pipeline is concerned. Compound steps control the execution of other steps, which they include in the form of one or more subpipelines.</span></p><p><span class="deltaxml-old" style="background:#FF5555">[</span><a href="#steps30"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Steps 3.0</span></span></a><span class="deltaxml-old" style="background:#FF5555">] defines a standard library of steps. Pipeline implementations </span><span class="rfc2119" id="introduction.5.2"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> support additional types of steps as well. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The media type for pipeline documents is </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xml</span></code><span class="deltaxml-old" style="background:#FF5555">. Often, pipeline documents are identified by the extension </span><code class="filename"><span class="deltaxml-old" style="background:#FF5555">.xpl</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">In this specification the words </span><span class="rfc2119" id="introduction.7.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555">, </span><span class="rfc2119" id="introduction.7.2"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555">, </span><span class="rfc2119" id="introduction.7.3"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555">, </span><span class="rfc2119" id="introduction.7.4"><span class="deltaxml-old" style="background:#FF5555">should not</span></span><span class="deltaxml-old" style="background:#FF5555">, </span><span class="rfc2119" id="introduction.7.5"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> and </span><span class="rfc2119" id="introduction.7.6"><span class="deltaxml-old" style="background:#FF5555">recommended</span></span><span class="deltaxml-old" style="background:#FF5555"> are to be interpreted as described in [</span><a href="#rfc2119"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 2119</span></span></a><span class="deltaxml-old" style="background:#FF5555">].</span></p><section id="intro-examples" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">1.1 Pipeline examples</span></h3></div><div class="content"><p><a href="#fig-xival" title="A simple, linear XInclude/Validate pipeline"><span class="deltaxml-old" style="background:#FF5555">Figure 1, “A simple, linear XInclude/Validate pipeline”</span></a><span class="deltaxml-old" style="background:#FF5555"> is a graphical representation of a simple pipeline that performs XInclude processing and validation on a document.</span></p><figure id="fig-xival" class="figure-wrapper"><div class="figure"><div id="fig-xival.2" title="A simple, linear XInclude/Validate pipeline" class="mediaobject"><span class="deltaxml-old-img"><img style="border: 2px solid red" src="graphics/sch-xinclude-validate-pipeline.png" alt="A simple, linear XInclude/Validate pipeline" /></span></div></div><div class="title"><span class="deltaxml-old" style="background:#FF5555">Figure 1. A simple, linear XInclude/Validate pipeline</span></div></figure><p><span class="deltaxml-old" style="background:#FF5555">This is a pipeline that consists of two atomic steps, XInclude and Validate with XML Schema. The pipeline itself has two inputs, “source” (a source document) and “schemas” (a sequence of W3C XML Schemas). The XInclude step reads the pipeline input “source” and produces a result document. The Validate with XML Schema step reads the pipeline input “schemas” and the result of the XInclude step and produces its own result document. The result of the validation, “result”, is the result of the pipeline. (For consistency across the step vocabulary, the standard input is usually named “source” and the standard output is usually named “result”.) </span></p><p><span class="deltaxml-old" style="background:#FF5555">The pipeline document determines how the steps are connected together inside the pipeline, that is, how the output of one step becomes the input of another.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The pipeline document for this pipeline is shown in </span><a href="#ex1" title="A simple, linear XInclude/Validate pipeline"><span class="deltaxml-old" style="background:#FF5555">Example 1, “A simple, linear XInclude/Validate pipeline”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><figure id="ex1" class="example-wrapper"><div class="title"><span class="deltaxml-old" style="background:#FF5555">Example 1. A simple, linear XInclude/Validate pipeline</span></div><div class="example"><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" name="xinclude-and-validate" version="3.0"&gt; &lt;p:input port="source" primary="true"/&gt; &lt;p:input port="schemas" sequence="true"/&gt; &lt;p:output port="result"&gt; &lt;p:pipe step="validated" port="result"/&gt; &lt;/p:output&gt; &lt;p:xinclude name="included"&gt; &lt;p:with-input port="source"&gt; &lt;p:pipe step="xinclude-and-validate" port="source"/&gt; &lt;/p:with-input&gt; &lt;/p:xinclude&gt; &lt;p:validate-with-xml-schema name="validated"&gt; &lt;p:with-input port="source"&gt; &lt;p:pipe step="included" port="result"/&gt; &lt;/p:with-input&gt; &lt;p:with-input port="schema"&gt; &lt;p:pipe step="xinclude-and-validate" port="schemas"/&gt; &lt;/p:with-input&gt; &lt;/p:validate-with-xml-schema&gt; &lt;/p:declare-step&gt;</span></code></pre></div></figure><p><a href="#ex1" title="A simple, linear XInclude/Validate pipeline"><span class="deltaxml-old" style="background:#FF5555">Example 1, “A simple, linear XInclude/Validate pipeline”</span></a><span class="deltaxml-old" style="background:#FF5555"> is very verbose. It makes all of the connections seen in the figure explicit. In practice, pipelines do not have to be this verbose. By default, where inputs and outputs are connected between sequential sibling steps, they do not have to be made explicit.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The same pipeline, using XProc defaults, is shown in </span><a href="#ex1-abbr" title="A simple, linear XInclude/Validate pipeline (simplified)"><span class="deltaxml-old" style="background:#FF5555">Example 2, “A simple, linear XInclude/Validate pipeline (simplified)”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><figure id="ex1-abbr" class="example-wrapper"><div class="title"><span class="deltaxml-old" style="background:#FF5555">Example 2. A simple, linear XInclude/Validate pipeline (simplified)</span></div><div class="example"><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" name="xinclude-and-validate" version="3.0"&gt; &lt;p:input port="source" primary="true"/&gt; &lt;p:input port="schemas" sequence="true"/&gt; &lt;p:output port="result"/&gt; &lt;p:xinclude/&gt; &lt;p:validate-with-xml-schema&gt; &lt;p:with-input port="schema"&gt; &lt;p:pipe step="xinclude-and-validate" port="schemas"/&gt; &lt;/p:with-input&gt; &lt;/p:validate-with-xml-schema&gt; &lt;/p:declare-step&gt;</span></code></pre></div></figure><p><a href="#fig-style-proc" title="A validate and transform pipeline"><span class="deltaxml-old" style="background:#FF5555">Figure 2, “A validate and transform pipeline”</span></a><span class="deltaxml-old" style="background:#FF5555"> is a more complex example: it performs schema validation with an appropriate schema and then styles the validated document.</span></p><figure id="fig-style-proc" class="figure-wrapper"><div class="figure"><div id="fig-style-proc.2" title="A validate and transform pipeline" class="mediaobject"><span class="deltaxml-old-img"><img style="border: 2px solid red" src="graphics/sch-transform.png" alt="A validate and transform pipeline" /></span></div></div><div class="title"><span class="deltaxml-old" style="background:#FF5555">Figure 2. A validate and transform pipeline</span></div></figure><p><span class="deltaxml-old" style="background:#FF5555">The heart of this example is the conditional. The “choose” step evaluates an XPath expression over a test document. Based on the result of that expression, one or another branch is run. In this example, each branch consists of a single validate step.</span></p><figure id="ex2" class="example-wrapper"><div class="title"><span class="deltaxml-old" style="background:#FF5555">Example 3. A validate and transform pipeline</span></div><div class="example"><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" name="xinclude-and-validate" version="3.0"&gt; &lt;p:input port="source"/&gt; &lt;p:input port="schemas" sequence="true"/&gt; &lt;p:output port="result"/&gt; &lt;p:choose&gt; &lt;p:when test="/*[@version &amp;lt; 2.0]"&gt; &lt;p:validate-with-xml-schema&gt; &lt;p:with-input port="schema" href="v1schema.xsd"/&gt; &lt;/p:validate-with-xml-schema&gt; &lt;/p:when&gt; &lt;p:otherwise&gt; &lt;p:validate-with-xml-schema&gt; &lt;p:with-input port="schema" href="v2schema.xsd"/&gt; &lt;/p:validate-with-xml-schema&gt; &lt;/p:otherwise&gt; &lt;/p:choose&gt; &lt;p:xslt&gt; &lt;p:with-input port="stylesheet" href="stylesheet.xsl"/&gt; &lt;/p:xslt&gt; &lt;/p:declare-step&gt;</span></code></pre></div></figure><p><span class="deltaxml-old" style="background:#FF5555">This example, like the preceding, relies on XProc defaults for simplicity. It is always valid to write the fully explicit form if you prefer. This example also takes advantage of using the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute directly on </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555"> as a shortcut for the </span><a href="#p.document"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code></a><span class="deltaxml-old" style="background:#FF5555"> connection.</span></p></div></section><p><span class="deltaxml-new" style="background:#90EE90">@@FIXME:</span></p></div></section><section id="pipeline-concepts" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">2 Pipeline Concepts</span></h2></div><div class="content"><p><span id="dt-pipeline" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">pipeline</span></em><span class="deltaxml-old" style="background:#FF5555"> is a set of connected steps, with outputs of one step flowing into inputs of another.]</span></span><span class="deltaxml-old" style="background:#FF5555"> A pipeline is itself a </span><em class="glossterm"><a href="#dt-step"><span class="deltaxml-old" style="background:#FF5555">step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> and must satisfy the constraints on steps. Connections between steps occur where the input of one step is connected to the output of another. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The result of evaluating a pipeline (or </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555">) is the result of evaluating the steps that it contains, in an order consistent with the connections between them. A pipeline must behave as if it evaluated each step each time it is encountered. Unless otherwise indicated, implementations </span><span class="rfc2119" id="pipeline-concepts.3.2"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> assume that steps are functional (that is, that their outputs depend only on their </span><a href="#input-output"><span class="deltaxml-old" style="background:#FF5555">inputs</span></a><span class="deltaxml-old" style="background:#FF5555"> and </span><em class="glossterm"><a href="#dt-option"><span class="deltaxml-old" style="background:#FF5555">options</span></a></em><span class="deltaxml-old" style="background:#FF5555">) or side-effect free.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The pattern of connections between steps will not always completely determine their order of evaluation. </span><span id="impl-1"><span class="deltaxml-old" style="background:#FF5555">The evaluation order of steps not connected to one another is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em></span><span class="deltaxml-old" style="background:#FF5555">.</span></p><section id="step-concept" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">2.1 Steps</span></h3></div><div class="content"><p><span id="dt-step" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">step</span></em><span class="deltaxml-old" style="background:#FF5555"> is the basic computational unit of a pipeline.]</span></span><span class="deltaxml-old" style="background:#FF5555"> A typical step has inputs, from which it receives documents to process, outputs, to which it sends result documents, and options which influence its behavior.</span></p><p><span class="deltaxml-old" style="background:#FF5555">There are two kinds of steps: atomic and compound:</span></p><p><span id="dt-atomic-step" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: An </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">atomic step</span></em><span class="deltaxml-old" style="background:#FF5555"> is a step that performs a unit of processing on its input, such as validation or transformation, and has no internal </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555">.]</span></span><span class="deltaxml-old" style="background:#FF5555"> Atomic steps carry out fundamental operations and can perform arbitrary amounts of computation, but they are indivisible.</span></p><p><span class="deltaxml-old" style="background:#FF5555">There are many </span><em><span class="deltaxml-old" style="background:#FF5555">types</span></em><span class="deltaxml-old" style="background:#FF5555"> of atomic steps. The standard library of atomic steps is described in [</span><a href="#steps30"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Steps 3.0</span></span></a><span class="deltaxml-old" style="background:#FF5555">], but implementations </span><span class="rfc2119" id="step-concept.5.3"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> provide others as well. </span><span id="impl-2"><span class="deltaxml-old" style="background:#FF5555">It is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555"> what additional step types, if any, are provided. </span></span><span class="deltaxml-old" style="background:#FF5555"> Each use, or instance, of an atomic step invokes the processing defined by that type of step. A pipeline may contain instances of many types of steps and many instances of the same type of step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Compound steps, on the other hand, control and organize the flow of documents through a pipeline, providing familiar programming language functionality such as conditionals, iterators and exception handling. They contain other steps, whose evaluation they control.</span></p><p><span id="dt-compound-step" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">compound step</span></em><span class="deltaxml-old" style="background:#FF5555"> is a step that contains one or more </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipelines</span></a></em><span class="deltaxml-old" style="background:#FF5555">.]</span></span><span class="deltaxml-old" style="background:#FF5555"> That is, a compound step differs from an atomic step in that its semantics are at least partially determined by the steps that it contains.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Compound steps either directly contain a single subpipeline or contain several subpipelines and select one or more to evaluate dynamically. In the latter case, alternate subpipelines are identified by non-step wrapper elements that each contain a single subpipeline. </span></p><p><span id="dt-container" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">container</span></em><span class="deltaxml-old" style="background:#FF5555"> is either a compound step or one of the non-step wrapper elements in a compound step that contains several subpipelines.]</span></span><span id="dt-contained-steps" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The steps that occur directly within a container are called that step’s </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">contained steps</span></em><span class="deltaxml-old" style="background:#FF5555">. In other words, “container” and “contained steps” are inverse relationships.]</span></span><span id="dt-ancestors" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">ancestors</span></em><span class="deltaxml-old" style="background:#FF5555"> of a step, if it has any, are its </span><em class="glossterm"><a href="#dt-container"><span class="deltaxml-old" style="background:#FF5555">container</span></a></em><span class="deltaxml-old" style="background:#FF5555"> and the ancestors of its container.]</span></span></p><p><span id="dt-subpipeline" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: Sibling steps and variables (and the connections between them) form a </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></em><span class="deltaxml-old" style="background:#FF5555">.]</span></span><span id="dt-last-step" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">last step</span></em><span class="deltaxml-old" style="background:#FF5555"> in a subpipeline is its last step in document order.]</span></span></p><p class="element-syntax element-syntax-language-construct hanging-indent"><code class="code"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></code><span class="deltaxml-old" style="background:#FF5555"> = (</span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555">|</span><a href="#p.for-each"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code></a><span class="deltaxml-old" style="background:#FF5555">|</span><a href="#p.viewport"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code></a><span class="deltaxml-old" style="background:#FF5555">|</span><a href="#p.choose"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code></a><span class="deltaxml-old" style="background:#FF5555">|</span><a href="#p.if"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:if</span></code></a><span class="deltaxml-old" style="background:#FF5555">|</span><a href="#p.group"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:group</span></code></a><span class="deltaxml-old" style="background:#FF5555">|</span><a href="#p.try"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code></a><span class="deltaxml-old" style="background:#FF5555">|</span><code class="code"><a href="#p.atomic"><span class="deltaxml-old" style="background:#FF5555">p:</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">standard-step</span></code></em></a></code><span class="deltaxml-old" style="background:#FF5555">|</span><code class="code"><a href="#p.atomic"><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">pfx:user-pipeline</span></code></em></a></code><span class="deltaxml-old" style="background:#FF5555">)+ </span></p><div id="note-udp" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">When a user-defined pipeline is invoked, (identified with </span><code class="code"><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">pfx:user-pipeline</span></code></em></code><span class="deltaxml-old" style="background:#FF5555"> in the preceding syntax summary) it appears as an atomic step. A pipeline </span><em><span class="deltaxml-old" style="background:#FF5555">declaration</span></em><span class="deltaxml-old" style="background:#FF5555"> may contain a subpipeline, but the invocation of that pipeline is atomic and does not contain a subpipeline.</span></p></div></div><p><span class="deltaxml-old" style="background:#FF5555">Steps have “ports” into which inputs and outputs are connected. Each step has a number of input ports and a number of output ports; a step can have zero input ports and/or zero output ports. The names of all ports on each step must be unique on that step (you can't have two input ports named “source”, nor can you have an input port named “schema” and an output port named “schema”). </span></p><p><span class="deltaxml-old" style="background:#FF5555">A Step may have zero or more </span><a href="#options"><span class="deltaxml-old" style="background:#FF5555">options</span></a><span class="deltaxml-old" style="background:#FF5555">, all with unique names.</span></p><p><span class="deltaxml-old" style="background:#FF5555">All of the different instances of steps (atomic or compound) in a pipeline can be distinguished from one another by name. If the pipeline author does not provide a name for a step, a default name is </span><a href="#step-names"><span class="deltaxml-old" style="background:#FF5555">manufactured automatically</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><section id="step-names" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">2.1.1 Step names</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">name</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute on any step can be used to give it a name. </span><span class="assert" id="unique-names"><span class="deltaxml-old" style="background:#FF5555">The name </span><span class="rfc2119" id="unique-names.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be unique within its scope, see </span><a href="#scoping" title="Scoping of Names"><span class="deltaxml-old" style="background:#FF5555">Section 14.2, “Scoping of Names”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">If the pipeline author does not provide an explicit name, the processor manufactures a default name. All default names are of the form “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">!1</span></code><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">.m</span></code></em><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">.n</span></code></em><span class="deltaxml-old" style="background:#FF5555">…” where “</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">m</span></code></em><span class="deltaxml-old" style="background:#FF5555">” is the position (in the sense of counting sibling elements) of the step's highest ancestor element within the pipeline document or library which contains it, “</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">n</span></code></em><span class="deltaxml-old" style="background:#FF5555">” is the position of the next-highest ancestor, and so on, including all of the elements in the pipeline document (that were not </span><em class="glossterm"><a href="#dt-effectively-excluded"><span class="deltaxml-old" style="background:#FF5555">effectively excluded</span></a></em><span class="deltaxml-old" style="background:#FF5555">). For example, consider the pipeline in </span><a href="#ex2" title="A validate and transform pipeline"><span class="deltaxml-old" style="background:#FF5555">Example 3, “A validate and transform pipeline”</span></a><span class="deltaxml-old" style="background:#FF5555">. The </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> step has no name, so it gets the default name “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">!1</span></code><span class="deltaxml-old" style="background:#FF5555">”; the </span><a href="#p.choose"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code></a><span class="deltaxml-old" style="background:#FF5555"> gets the name “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">!1.1</span></code><span class="deltaxml-old" style="background:#FF5555">”; the first </span><a href="#p.when"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code></a><span class="deltaxml-old" style="background:#FF5555"> gets the name “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">!1.1.1</span></code><span class="deltaxml-old" style="background:#FF5555">”; the </span><a href="#p.otherwise"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:otherwise</span></code></a><span class="deltaxml-old" style="background:#FF5555"> gets the name “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">!1.1.2</span></code><span class="deltaxml-old" style="background:#FF5555">”, etc. If the </span><a href="#p.choose"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code></a><span class="deltaxml-old" style="background:#FF5555"> had a name, it would not have received a default name, but it would still have been counted and its first </span><a href="#p.when"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code></a><span class="deltaxml-old" style="background:#FF5555"> would still have been “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">!1.1.1</span></code><span class="deltaxml-old" style="background:#FF5555">”.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Providing every step in the pipeline with an interoperable name has several benefits:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">It allows implementers to refer to all steps in an interoperable fashion, for example, in error messages.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Pragmatically, we say that </span><em class="glossterm"><a href="#dt-readable-ports"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></a></em><span class="deltaxml-old" style="background:#FF5555"> are identified by a step name/port name pair. By manufacturing names for otherwise anonymous steps, we include implicit connections without changing our model.</span></p></li></ol></div><p><span class="deltaxml-old" style="background:#FF5555">In a valid pipeline that runs successfully to completion, the manufactured names aren't visible (except perhaps in debugging or logging output).</span></p><div id="def-name-ncname" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">The format for defaulted names does not conform to the requirements of an </span><a href="http://www.w3.org/TR/xml-names/#NT-NCName"><span class="deltaxml-old" style="background:#FF5555">NCName</span></a><span class="deltaxml-old" style="background:#FF5555">. This is an explicit design decision; it prevents pipelines from using the defaulted names on </span><a href="#p.pipe"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements. If an explicit connection requires a step name, the pipeline author must name the step. </span></p></div></div></div></section></div></section></div></section><section id="documents" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">3 Documents</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">An XProc pipeline processes documents. </span><span id="dt-document" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">document</span></em><span class="deltaxml-old" style="background:#FF5555"> is a </span><em class="glossterm"><a href="#dt-representation"><span class="deltaxml-old" style="background:#FF5555">representation</span></a></em><span class="deltaxml-old" style="background:#FF5555"> and its </span><em class="glossterm"><a href="#dt-document-properties"><span class="deltaxml-old" style="background:#FF5555">document properties</span></a></em><span class="deltaxml-old" style="background:#FF5555">.]</span></span><span class="deltaxml-old" style="background:#FF5555">. </span><span id="dt-representation" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">representation</span></em><span class="deltaxml-old" style="background:#FF5555"> is a data structure used by an XProc processor to refer to the actual document content.]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">Documents have associated with them a set of properties. The properties are key/value pairs. </span><span id="dt-document-properties" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">document properties</span></em><span class="deltaxml-old" style="background:#FF5555"> are exposed to the XProc pipeline as a map (</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">map(xs:QName, item()*)</span></code><span class="deltaxml-old" style="background:#FF5555">).]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">Several property keys are defined by this specification:</span></p><div class="variablelist"><dl><dt><span class="term"><code class="code"><span class="deltaxml-old" style="background:#FF5555">content-type</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of the “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">content-type</span></code><span class="deltaxml-old" style="background:#FF5555">” key identifies the media type ([</span><a href="#rfc2046"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 2046</span></span></a><span class="deltaxml-old" style="background:#FF5555">]) of the representation. The “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">content-type</span></code><span class="deltaxml-old" style="background:#FF5555">” </span><span class="rfc2119" id="documents.5.1.2.1.4"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> always be present. The processor is responsible for assuring that the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">content-type</span></code><span class="deltaxml-old" style="background:#FF5555"> property matches the content type of each document produced on every output port. </span></p></dd><dt><span class="term"><code class="code"><span class="deltaxml-old" style="background:#FF5555">base-uri</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of the “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">base-uri</span></code><span class="deltaxml-old" style="background:#FF5555">” key identifies the base URI of the document. If no such key is present, the document has no base URI. The processor is responsible for assuring that the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">base-uri</span></code><span class="deltaxml-old" style="background:#FF5555"> property matches the base URI of each document produced on every output port. </span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">Other property keys may also be present, including user defined properties.</span></p><p><span class="deltaxml-old" style="background:#FF5555">An output port may have several connections. In this case the document(s) that appear on that port are sent to each of the connections. In principle, a distinct copy of each document is sent to each connection. Critically, any changes made to one copy </span><span class="rfc2119" id="documents.7.1"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> be visible in any other copy. In the interest of efficiency, if an implementation can isolate such changes, it is not required to make actual copies. </span></p><section id="document-types" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">3.1 Document Types</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">XProc 3.0 has been designed to make it possible to process any kind of document. Each document has a representation in the [</span><a href="#xpath-datamodel"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XQuery and XPath Data Model 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. This is necessary so that any kind of document can be passed as an argument to XPath functions, such as </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document-properties</span></code><span class="deltaxml-old" style="background:#FF5555">. Practically speaking, there are five kinds of documents:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><a href="#xml-documents"><span class="deltaxml-old" style="background:#FF5555">XML documents</span></a></p></li><li><p><a href="#html-documents"><span class="deltaxml-old" style="background:#FF5555">HTML documents</span></a></p></li><li><p><a href="#text-documents"><span class="deltaxml-old" style="background:#FF5555">Text documents</span></a></p></li><li><p><a href="#json-documents"><span class="deltaxml-old" style="background:#FF5555">JSON documents</span></a></p></li><li><p><a href="#other-documents"><span class="deltaxml-old" style="background:#FF5555">Other documents</span></a></p></li></ol></div><section id="xml-documents" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">3.1.1 XML Documents</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Representations of XML documents are general instances of the XDM. They are documents that contain a mixture of other node types (elements, text, comments, and processing instructions). This definition is intentionally broader than the definition of a well-formed XML document because it is often convenient for intermediate stages in a pipeline to produce more-or-less arbitrary fragments of XML that can be combined together by later stages. XML documents are identified by an XML media type. </span><span id="dt-XML-media-type" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xml</span></code><span class="deltaxml-old" style="background:#FF5555">” and “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/xml</span></code><span class="deltaxml-old" style="background:#FF5555"> media types and all media types of the form “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">something</span></code></em><span class="deltaxml-old" style="background:#FF5555">+xml</span></code><span class="deltaxml-old" style="background:#FF5555">” (except for “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xhtml+xml</span></code><span class="deltaxml-old" style="background:#FF5555">” which is explicitly an </span><em class="glossterm"><a href="#dt-HTML-media-type"><span class="deltaxml-old" style="background:#FF5555">HTML media type</span></a></em><span class="deltaxml-old" style="background:#FF5555">) are </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">XML media types</span></em><span class="deltaxml-old" style="background:#FF5555">. ]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">In order to be consistent with the XPath data model, all general and external parsed entities </span><span class="rfc2119" id="xml-documents.3.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be fully expanded in XML documents; they </span><span class="rfc2119" id="xml-documents.3.2"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> contain any representation of [</span><a href="#xml-infoset-rec"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Infoset</span></span></a><span class="deltaxml-old" style="background:#FF5555">] </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[unexpanded entity reference information items]</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span id="impl-3"><span class="deltaxml-old" style="background:#FF5555">The level of support for typed values in XDM instances in an XProc pipeline is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">When an XML document is serialized, it </span><span class="rfc2119" id="xml-documents.5.1"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> be serialized using the XML serializer (see [</span><a href="#xml-serialization-31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Serialization</span></span></a><span class="deltaxml-old" style="background:#FF5555">]) by default. </span></p></div></section><section id="html-documents" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">3.1.2 HTML Documents</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Representations of HTML documents are general instances of the XDM. Within XProc, they are </span><a href="#xml-documents"><span class="deltaxml-old" style="background:#FF5555">XML documents</span></a><span class="deltaxml-old" style="background:#FF5555">. HTML documents are identified by an HTML media type. </span><span id="dt-HTML-media-type" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/html</span></code><span class="deltaxml-old" style="background:#FF5555">” and “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xhtml+xml</span></code><span class="deltaxml-old" style="background:#FF5555"> media types are </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">HTML media types</span></em><span class="deltaxml-old" style="background:#FF5555">. ]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">The distinction between XML documents and HTML documents is apparent in two places:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">When an HTML document is </span><em><span class="deltaxml-old" style="background:#FF5555">parsed</span></em><span class="deltaxml-old" style="background:#FF5555">, for example when it is the result of querying a web service or is loaded from a file on disk, an HTML parser </span><span class="rfc2119" id="html-documents.4.1.1.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be used. An HTML parser will construct a balanced tree even if the HTML document would not be seen as well-formed XML if it was parsed by an XML parser. An HTML parser may also add elements not found in the original (for example table body elements inside tables). </span></p><div id="inline-html" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">The HTML parsing rules only apply when the content is parsed. HTML content in an unencoded </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> must be well-formed XML (because it is literally in the pipeline) and will not be transformed in any way.</span></p></div></div></li><li><p><span class="deltaxml-old" style="background:#FF5555">When an HTML document is serialized, it </span><span class="rfc2119" id="html-documents.4.2.1.1"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> be serialized using the HTML serializer (see [</span><a href="#xml-serialization-31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Serialization</span></span></a><span class="deltaxml-old" style="background:#FF5555">]) by default. </span></p></li></ol></div></div></section><section id="text-documents" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">3.1.3 Text Documents</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Representations of text documents are XDM documents that contain a single text node. Text documents are identified by a text media type. </span><span id="dt-text-media-type" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: Media types of the form “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">something</span></code></em></code><span class="deltaxml-old" style="background:#FF5555">” are </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">text media types</span></em><span class="deltaxml-old" style="background:#FF5555"> with the exception of “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/xml</span></code><span class="deltaxml-old" style="background:#FF5555">” which is an XML media type. and “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/html</span></code><span class="deltaxml-old" style="background:#FF5555">” which is an HTML media type. ]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">When a text document is serialized, it </span><span class="rfc2119" id="text-documents.3.1"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> be serialized using the Text serializer (see [</span><a href="#xml-serialization-31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Serialization</span></span></a><span class="deltaxml-old" style="background:#FF5555">]) by default.</span></p></div></section><section id="json-documents" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">3.1.4 JSON Documents</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Representations of JSON documents are instances of the XDM. They are maps, arrays, or atomic values. JSON documents are identified by a JSON media type. </span><span id="dt-JSON-media-type" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/json</span></code><span class="deltaxml-old" style="background:#FF5555">” media type and all media types of the form “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">something</span></code></em><span class="deltaxml-old" style="background:#FF5555">+json</span></code><span class="deltaxml-old" style="background:#FF5555">” are </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">JSON media types</span></em><span class="deltaxml-old" style="background:#FF5555">. ]</span></span></p><div id="json-documents-xdm" class="note editorial admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Editorial Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">This definition doesn’t say that JSON documents are represented by </span><em><span class="deltaxml-old" style="background:#FF5555">document nodes</span></em><span class="deltaxml-old" style="background:#FF5555"> that contain something (because document nodes can’t contain maps or arrays). Can we get away with that?</span></p></div></div><p><span class="deltaxml-old" style="background:#FF5555">When a JSON document is serialized, it </span><span class="rfc2119" id="json-documents.4.1"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> be serialized using the JSON serializer (see [</span><a href="#xml-serialization-31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Serialization</span></span></a><span class="deltaxml-old" style="background:#FF5555">]) by default.</span></p></div></section><section id="other-documents" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">3.1.5 Other documents</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Representations of other kinds of documents are empty XDM documents. </span><span id="impl-4"><span class="deltaxml-old" style="background:#FF5555">The </span><em><span class="deltaxml-old" style="background:#FF5555">underlying</span></em><span class="deltaxml-old" style="background:#FF5555"> representations of other kinds of documents are </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span><span class="deltaxml-old" style="background:#FF5555"> Other kinds of documents are identified by media types that are not </span><em class="glossterm"><a href="#dt-XML-media-type"><span class="deltaxml-old" style="background:#FF5555">XML media types</span></a></em><span class="deltaxml-old" style="background:#FF5555">, </span><em class="glossterm"><a href="#dt-HTML-media-type"><span class="deltaxml-old" style="background:#FF5555">HTML media types</span></a></em><span class="deltaxml-old" style="background:#FF5555">, </span><em class="glossterm"><a href="#dt-text-media-type"><span class="deltaxml-old" style="background:#FF5555">text media types</span></a></em><span class="deltaxml-old" style="background:#FF5555">, or </span><em class="glossterm"><a href="#dt-JSON-media-type"><span class="deltaxml-old" style="background:#FF5555">JSON media types</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span></p><p><span id="impl-5"><span class="deltaxml-old" style="background:#FF5555">Serialization of other kinds of documents is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span><span class="deltaxml-old" style="background:#FF5555"> The stored sequence of octets </span><span class="rfc2119" id="other-documents.3.2"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> be consistent with the media type: an </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">image/png</span></code><span class="deltaxml-old" style="background:#FF5555"> image should be a PNG image, etc. </span></p></div></section></div></section><section id="documents.9" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">3.2 Creating documents from XDM step results</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Some steps like </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:xslt</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:xquery</span></code><span class="deltaxml-old" style="background:#FF5555"> etc. create new XDM instances, that are converted into documents before appearing on the output port of that particular step. The following rules apply:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">If the result is a single text node, it is wrapped in a document node and the document's content-type is </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/plain</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the result is any other node (except for a document node), a document node is wrapped around the node and the document's content-type is </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xml</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the result is a document node, content-type "application/xml" is used.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the result is a </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">map</span></code><span class="deltaxml-old" style="background:#FF5555"> or an </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">array</span></code><span class="deltaxml-old" style="background:#FF5555">, a JSON document is created and content-type </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/json</span></code><span class="deltaxml-old" style="background:#FF5555"> is used.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the result is an atomic value, a binary document is created and content-type </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/vnd.xproc+atomic</span></code><span class="deltaxml-old" style="background:#FF5555"> is used.</span></p></li></ul></div></div></section><section id="media-type-match" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">3.3 Matching Media Types</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">When an input document arrives on a port, it must be match at least one of the media types specified on that input port. It matches if the port specifies no media types or if the media type of the input document is compatible with at least one of the specified media types. Two media types are compatible if:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">They are both </span><em class="glossterm"><a href="#dt-XML-media-type"><span class="deltaxml-old" style="background:#FF5555">XML media types</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">application/xml</span></code><span class="deltaxml-old" style="background:#FF5555"> is compatible with </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">image/svg+xml</span></code><span class="deltaxml-old" style="background:#FF5555">), </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">they are both </span><em class="glossterm"><a href="#dt-text-media-type"><span class="deltaxml-old" style="background:#FF5555">text media types</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">text/plain</span></code><span class="deltaxml-old" style="background:#FF5555"> is compatible with </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">text/csv</span></code><span class="deltaxml-old" style="background:#FF5555">), </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">or they are equal when compared with the Unicode codepoint collation (</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">image/png</span></code><span class="deltaxml-old" style="background:#FF5555"> is compatible with </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">image/png</span></code><span class="deltaxml-old" style="background:#FF5555">).</span></p></li><li><p><span id="impl-6"><span class="deltaxml-old" style="background:#FF5555">It is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555"> what additional content types are considered equal.</span></span></p></li></ol></div><p><a id="err.inline.D0038"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0038"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0038</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if an input document arrives on a port and it does not match the allowed media types.</span></p></div></section></div></section><section id="input-output" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">4 Inputs and Outputs</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Most steps have one or more inputs and one or more outputs. </span><a href="#fig-atomic-step" title="An atomic step"><span class="deltaxml-old" style="background:#FF5555">Figure 3, “An atomic step”</span></a><span class="deltaxml-old" style="background:#FF5555"> illustrates symbolically an </span><em class="glossterm"><a href="#dt-atomic-step"><span class="deltaxml-old" style="background:#FF5555">atomic step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> with two inputs and one output.</span></p><figure id="fig-atomic-step" class="figure-wrapper"><div class="figure"><div id="fig-atomic-step.2" title="An atomic step with two inputs and one output" class="mediaobject"><span class="deltaxml-old-img"><img style="border: 2px solid red" src="graphics/atomic-step.png" alt="An atomic step with two inputs and one output" /></span></div></div><div class="title"><span class="deltaxml-old" style="background:#FF5555">Figure 3. An atomic step</span></div></figure><p><span class="deltaxml-old" style="background:#FF5555">All atomic steps are defined by a </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555">. The declaration of an atomic step type defines the input ports, output ports, and options of all steps of that type. For example, every </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:validate-with-xml-schema</span></code><span class="deltaxml-old" style="background:#FF5555"> step has two inputs, named “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">source</span></code><span class="deltaxml-old" style="background:#FF5555">” and “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">schema</span></code><span class="deltaxml-old" style="background:#FF5555">”, one output named “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">result</span></code><span class="deltaxml-old" style="background:#FF5555">”, and the same set of options. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Like atomic steps, top level, user-defined pipelines also have declarations.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The situation is slightly more complicated for the other compound steps because they don't have separate declarations; each instance of the compound step serves as its own declaration. On these compound steps, the number and names of the outputs can be different on each instance of the step.</span></p><p><a href="#fig-compound-step" title="A compound step"><span class="deltaxml-old" style="background:#FF5555">Figure 4, “A compound step”</span></a><span class="deltaxml-old" style="background:#FF5555"> illustrates symbolically a compound step with a subpipeline with one output. As you can see from the diagram, the output from the compound step comes from one of the outputs of the subpipeline within the step.</span></p><figure id="fig-compound-step" class="figure-wrapper"><div class="figure"><div id="fig-compound-step.2" title="A compound step with two inputs and one output" class="mediaobject"><span class="deltaxml-old-img"><img style="border: 2px solid red" src="graphics/compound-step.png" alt="A compound step with two inputs and one output" /></span></div></div><div class="title"><span class="deltaxml-old" style="background:#FF5555">Figure 4. A compound step</span></div></figure><p><span id="dt-declared-inputs" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The input ports declared on a step are its </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">declared inputs</span></em><span class="deltaxml-old" style="background:#FF5555">.]</span></span><span id="dt-declared-outputs" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The output ports declared on a step are its </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">declared outputs</span></em><span class="deltaxml-old" style="background:#FF5555">.]</span></span><span class="deltaxml-old" style="background:#FF5555"> When a step is used in a pipeline, it is connected to other steps through its inputs and outputs. </span></p><p><span class="deltaxml-old" style="background:#FF5555">When a step is used, all of the </span><em class="glossterm"><a href="#dt-declared-inputs"><span class="deltaxml-old" style="background:#FF5555">declared inputs</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the step </span><span class="rfc2119" id="input-output.10.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be connected. Each connection binds the input to a data source (see </span><a href="#connections" title="Connections"><span class="deltaxml-old" style="background:#FF5555">Section 6, “Connections”</span></a><span class="deltaxml-old" style="background:#FF5555">). </span><a id="err.inline.S0003"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0003"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0003</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if any declared input is not connected.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="glossterm"><a href="#dt-declared-outputs"><span class="deltaxml-old" style="background:#FF5555">declared outputs</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of a step are only connected when they are used by another step or expression. Any documents produced on an unconnected output port are discarded.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Primary input and primary output ports may be implicitly connected if no explicit connection is given, see </span><a href="#primary-input-output" title="Primary Inputs and Outputs"><span class="deltaxml-old" style="background:#FF5555">Section 5, “Primary Inputs and Outputs”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Output ports on compound steps have a dual nature: from the perspective of the compound step's siblings, its outputs are just ordinary outputs and can be connected the same as other </span><em class="glossterm"><a href="#dt-declared-outputs"><span class="deltaxml-old" style="background:#FF5555">declared outputs</span></a></em><span class="deltaxml-old" style="background:#FF5555">. From the perspective of the subpipeline inside the compound step, they behave like inputs and can be connected just like other inputs.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Within a compound step, the </span><em class="glossterm"><a href="#dt-declared-outputs"><span class="deltaxml-old" style="background:#FF5555">declared outputs</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the step can be connected to any of the various available outputs of </span><em class="glossterm"><a href="#dt-contained-steps"><span class="deltaxml-old" style="background:#FF5555">contained steps</span></a></em><span class="deltaxml-old" style="background:#FF5555"> as well as other data sources (see </span><a href="#connections" title="Connections"><span class="deltaxml-old" style="background:#FF5555">Section 6, “Connections”</span></a><span class="deltaxml-old" style="background:#FF5555">). If a (non-primary) output port of a compound step is left unconnected, it produces an empty sequence of documents from the perspective of its siblings.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Each input and output on a step is declared to accept or produce either a single document or a sequence of documents. It </span><em><span class="deltaxml-old" style="background:#FF5555">is not</span></em><span class="deltaxml-old" style="background:#FF5555"> an error to connect a port that is declared to produce a sequence of documents to a port that is declared to accept only a single document. It is, however, an error if the former step does not produce exactly one document at run time.</span></p><p><span class="deltaxml-old" style="background:#FF5555">It is also not an error to connect a port that is declared to produce a single document to a port that is declared to accept a sequence. A single document is the same as a sequence of one document.</span></p><p><span class="deltaxml-old" style="background:#FF5555">An output port may have more than one connection: it may be connected to more than one input port, more than one of its container's output ports, or both. At runtime this will result in the outputs being sent to each of those places.</span></p><p><span id="dt-signature" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">signature</span></em><span class="deltaxml-old" style="background:#FF5555"> of a step is the set of inputs, outputs, and options that it is declared to accept.]</span></span><span class="deltaxml-old" style="background:#FF5555"> The declaration for a step provides a fixed signature which all its instances share.</span></p><div class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">Within the context of what can be defined by XProc pipelines, step signatures are fixed and shared by all instances. There is no mechanism for a pipeline author to declare that an atomic step has a signature that varies. However, implementors may provide such mechanisms and other specifications may depend upon them. For example, the standard </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:run</span></code><span class="deltaxml-old" style="background:#FF5555"> step violates this constraint in that the name and number of its output ports depends on its inputs and may vary between invocations. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Such steps are “magic” and XProc 3.0 makes no effort to provide a mechanism to define them.</span></p></div></div><p><span id="dt-matches" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A step </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">matches</span></em><span class="deltaxml-old" style="background:#FF5555"> its signature if and only if it specifies an input for each declared input, it specifies no inputs that are not declared, it specifies an option for each option that is declared to be required, and it specifies no options that are not declared.]</span></span><span class="deltaxml-old" style="background:#FF5555"> In other words, every input and required option </span><span class="rfc2119" id="input-output.20.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be specified and only inputs and options that are declared </span><span class="rfc2119" id="input-output.20.3"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> be specified. Options that aren't required do not have to be specified.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Steps </span><span class="rfc2119" id="input-output.21.1"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> also produce error, warning, and informative messages. These messages are captured and provided on the </span><code class="port"><span class="deltaxml-old" style="background:#FF5555">error</span></code><span class="deltaxml-old" style="background:#FF5555"> port inside of a </span><a href="#p.catch"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span><span id="impl-7"><span class="deltaxml-old" style="background:#FF5555">Outside of a </span><a href="#p.try"><span class="deltaxml-old" style="background:#FF5555">try/catch</span></a><span class="deltaxml-old" style="background:#FF5555">, the disposition of error messages is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em></span><span class="deltaxml-old" style="background:#FF5555">. </span></p><p><span id="impl-8"><span class="deltaxml-old" style="background:#FF5555">How inputs are connected to documents outside the pipeline is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p><p><span id="impl-9"><span class="deltaxml-old" style="background:#FF5555">How pipeline outputs are connected to documents outside the pipeline is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">Input ports </span><span class="rfc2119" id="input-output.24.1"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> specify a content type, or list of content types, that they accept. Input documents must </span><a href="#media-type-match"><span class="deltaxml-old" style="background:#FF5555">match</span></a><span class="deltaxml-old" style="background:#FF5555"> the specified content types.</span></p><section id="external-docs" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">4.1 External Documents</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">It's common for some of the documents used in processing a pipeline to be read from URIs. Sometimes this occurs directly, for example with a </span><a href="#p.document"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element. Sometimes it occurs indirectly, for example if an implementation allows the URI of a pipeline input to be specified on the command line or if an </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:xslt</span></code><span class="deltaxml-old" style="background:#FF5555"> step encounters an </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">xsl:import</span></code><span class="deltaxml-old" style="background:#FF5555"> in the stylesheet that it is processing. It's also common for some of the documents produced in processing a pipeline to be written to locations which have, or at least could have, a URI. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The process of dereferencing a URI to retrieve a document is often more interesting than it seems at first. On the web, it may involve caches, proxies, and various forms of indirection. </span><span id="impl-10"><span class="deltaxml-old" style="background:#FF5555">Resolving a URI locally may involve resolvers of various sorts and possibly appeal to </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555"> mechanisms such as catalog files.</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">In XProc, the situation is made even more interesting by the fact that many intermediate results produced by steps in the pipeline have base URIs. </span><span id="impl-11"><span class="deltaxml-old" style="background:#FF5555">Whether (and when and how) or not the intermediate results that pass between steps are ever written to a filesystem is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p><p><span id="impl-12"><span class="deltaxml-old" style="background:#FF5555">In Version 3.0 of XProc, how (or if) implementers provide local resolution mechanisms and how (or if) they provide access to intermediate results by URI is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">Version 3.0 of XProc does not require implementations to guarantee that multiple attempts to dereference the same URI always produce the same results.</span></p><div id="note-unsatisfying" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">On the one hand, this is a somewhat unsatisfying state of affairs because it leaves room for interoperability problems. On the other, it is not expected to cause such problems very often in practice. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If these problems arise in practice, implementers are encouraged to use the existing extension mechanisms to give users the control needed to circumvent them. Should such mechanisms become widespread, a standard mechanism could be added in some future version of the language.</span></p></div></div></div></section></div></section><section id="primary-input-output" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">5 Primary Inputs and Outputs</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Each step may have one input port designated as the primary input port and one output port designated as the primary output port.</span></p><p><span id="dt-primary-input-port" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: If a step has an input port which is explicitly marked “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">primary='true'</span></code><span class="deltaxml-old" style="background:#FF5555">”, or if it has exactly one document input port and that port is </span><em><span class="deltaxml-old" style="background:#FF5555">not</span></em><span class="deltaxml-old" style="background:#FF5555"> explicitly marked “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">primary='false'</span></code><span class="deltaxml-old" style="background:#FF5555">”, then that input port is the </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">primary input port</span></em><span class="deltaxml-old" style="background:#FF5555"> of the step.]</span></span><span class="deltaxml-old" style="background:#FF5555"> If a step has a single input port and that port is explicitly marked “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">primary='false'</span></code><span class="deltaxml-old" style="background:#FF5555">”, or if a step has more than one input port and none is explicitly marked as the primary, then the primary input port of that step is undefined. A step can have at most one primary input port.</span></p><p><span id="dt-primary-output-port" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: If a step has an output port which is explicitly marked “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">primary='true'</span></code><span class="deltaxml-old" style="background:#FF5555">”, or if it has exactly one document output port and that port is </span><em><span class="deltaxml-old" style="background:#FF5555">not</span></em><span class="deltaxml-old" style="background:#FF5555"> explicitly marked “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">primary='false'</span></code><span class="deltaxml-old" style="background:#FF5555">”, then that output port is the </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">primary output port</span></em><span class="deltaxml-old" style="background:#FF5555"> of the step.]</span></span><span class="deltaxml-old" style="background:#FF5555"> If a step has a single output port and that port is explicitly marked “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">primary='false'</span></code><span class="deltaxml-old" style="background:#FF5555">”, or if a step has more than one output port and none is explicitly marked as the primary, then the primary output port of that step is undefined. A step can have at most one primary output port.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The special significance of primary input and output ports is that they are connected automatically by the processor if no explicit connection is given. Generally speaking, if two steps appear sequentially in a subpipeline, then the primary output of the first step will automatically be connected to the primary input of the second.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Additionally, if a container, that can have declared outputs, has no declared outputs and the </span><em class="glossterm"><a href="#dt-last-step"><span class="deltaxml-old" style="background:#FF5555">last step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> in its subpipeline has an unconnected primary output, then an implicit primary output port will be added to the compound step (and consequently the last step's primary output will be connected to it). This implicit output port has no name. It inherits the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">sequence</span></code><span class="deltaxml-old" style="background:#FF5555"> and the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">content-types</span></code><span class="deltaxml-old" style="background:#FF5555"> properties of the port connected to it. This rule does not apply to </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555">; step declarations must provide explicit names for all of their outputs.</span></p></div></section><section id="connections" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">6 Connections</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Steps are connected together by their input ports, output ports, and bindings to variables and options. Variables and options also behave something like steps, connected together by the input on which they receive their context and by references to them by name elsewhere. </span><a id="err.inline.S0001"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0001"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0001</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if there are any loops in the connections between steps, variables, and options: no step, variable, or option can be connected to itself nor can there be any sequence of connections through other steps that leads back to itself.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Consider </span><a href="#fig-depends" title="Dependencies between steps, variables, and options"><span class="deltaxml-old" style="background:#FF5555">Figure 5, “Dependencies between steps, variables, and options”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><figure id="fig-depends" class="figure-wrapper"><div class="figure"><div id="fig-depends.2" title="Dependencies between steps, variables, and options" class="mediaobject"><span class="deltaxml-old-img"><img style="border: 2px solid red" src="graphics/depends.png" alt="Dependencies between steps, variables, and options" /></span></div></div><div class="title"><span class="deltaxml-old" style="background:#FF5555">Figure 5. Dependencies between steps, variables, and options</span></div></figure><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">Step1 has no connections. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Step2 is connected to Step1 by an explicit dependency, see </span><a href="#depends" title="Additional dependent connections"><span class="deltaxml-old" style="background:#FF5555">Section 14.9.3, “Additional dependent connections”</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Step3 is connected to Step2 because it reads from the output of Step2. It is also transitively connected to Step1 because Step2 is connected to it. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Step4 has no connections. In principle, Step1 and Step4 can be evaluated in parallel or in either order. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Step5 is connected to Step3 because it reads from the output of Step3. It is also transitively connected to Step2 and the connections that Step2 has. Step5 is also connected to Step4 because it’s option “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">option1</span></code><span class="deltaxml-old" style="background:#FF5555">” is connected to “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">someVar</span></code><span class="deltaxml-old" style="background:#FF5555">” which is connected to “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">ecount</span></code><span class="deltaxml-old" style="background:#FF5555">” which reads its context from Step4. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Step6 is connected to Step5 because it reads from the output of Step5. It is also transitively connected to all of the other steps. </span></p></li></ul></div><p><span id="dt-connection" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">connection</span></em><span class="deltaxml-old" style="background:#FF5555"> associates an input or output port with some data source.]</span></span><span class="deltaxml-old" style="background:#FF5555"> Such a connection represents a binding between the port's name and the data source as described by various locations, inline expressions, or readable ports.</span></p><p><span class="deltaxml-old" style="background:#FF5555">An input port can be connected to:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The output port of some other step.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">A fixed, inline document.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">A document read from a URI.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">One of the inputs declared on one of its </span><em class="glossterm"><a href="#dt-ancestors"><span class="deltaxml-old" style="background:#FF5555">ancestors</span></a></em><span class="deltaxml-old" style="background:#FF5555"> or a special port provided by an ancestor compound step, for example, “</span><code class="port"><span class="deltaxml-old" style="background:#FF5555">current</span></code><span class="deltaxml-old" style="background:#FF5555">” in a </span><a href="#p.for-each"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.viewport"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">When an input accepts a sequence of documents, the documents can come from any combination of these locations.</span></p><p><span class="deltaxml-old" style="background:#FF5555">In contrast, output ports are connected when they are referenced by another input port, </span><em class="glossterm"><a href="#dt-declared-outputs"><span class="deltaxml-old" style="background:#FF5555">declared output</span></a></em><span class="deltaxml-old" style="background:#FF5555"> or other expression and may be connected to:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The input port or input context of some other step.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">An option assigned with </span><a href="#p.with-option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or a </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> in a compound step.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">A </span><em class="glossterm"><a href="#dt-value-template"><span class="deltaxml-old" style="background:#FF5555">value template</span></a></em><span class="deltaxml-old" style="background:#FF5555"> in an immediately following step. This can be an AVT in an </span><a href="#option-shortcut"><span class="deltaxml-old" style="background:#FF5555">option shortcut</span></a><span class="deltaxml-old" style="background:#FF5555">, an AVT on a </span><a href="#p.document"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element, or a value template in a </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">One of the outputs declared on its container. </span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">As with an input, the output can be a sequence of documents constructed from any combination of the above.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Within the context of a </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound step</span></a></em><span class="deltaxml-old" style="background:#FF5555">, the </span><em class="glossterm"><a href="#dt-declared-outputs"><span class="deltaxml-old" style="background:#FF5555">declared outputs</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the compound step must describe their connections. The set of possibilities for this connection is exactly the same set as for any other input port within the current </span><em class="glossterm"><a href="#dt-environment"><span class="deltaxml-old" style="background:#FF5555">environment</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p><section id="namespace-fixup" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">6.1 Namespace Fixup on XML Outputs</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">XProc processors are expected, and sometimes required, to perform </span><em class="glossterm"><a href="#dt-namespace-fixup"><span class="deltaxml-old" style="background:#FF5555">namespace fixup</span></a></em><span class="deltaxml-old" style="background:#FF5555"> on XML outputs. Unless the semantics of a step explicitly says otherwise:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The in-scope namespaces associated with a node (even those that are inherited from namespace bindings that appear among its ancestors in the document in which it appears initially) are assumed to travel with that node.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Changes to one part of a tree (wrapping or unwrapping a node or renaming an element, for example) do not change the in-scope namespaces associated with the descendants of the node so changed.</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">As a result, some steps can produce XML documents which have no direct serialization (because they include nodes with conflicting or missing namespace declarations, for example). </span><span id="dt-namespace-fixup" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: To produce a serializable </span><em class="glossterm"><a href="#dt-XML"><span class="deltaxml-old" style="background:#FF5555">XML</span></a></em><span class="deltaxml-old" style="background:#FF5555"> document, the XProc processor must sometimes add additional namespace nodes, perhaps even renaming prefixes, to satisfy the constraints of </span><em class="glossterm"><a href="#dt-Namespaces-in-XML"><span class="deltaxml-old" style="background:#FF5555">Namespaces in XML</span></a></em><span class="deltaxml-old" style="background:#FF5555">. This process is referred to as </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">namespace fixup</span></em><span class="deltaxml-old" style="background:#FF5555">.]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">Implementors are encouraged to perform </span><em class="glossterm"><a href="#dt-namespace-fixup"><span class="deltaxml-old" style="background:#FF5555">namespace fixup</span></a></em><span class="deltaxml-old" style="background:#FF5555"> before passing documents between steps, but they are not required to do so. Conversely, an implementation which </span><em><span class="deltaxml-old" style="background:#FF5555">does</span></em><span class="deltaxml-old" style="background:#FF5555"> serialize between steps and therefore must perform such fixups, or reject documents that cannot be serialized, is also conformant.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Except where the semantics of a step explicitly require changes, processors are required to preserve the information in the documents and fragments they manipulate. In particular, the information corresponding to the [</span><a href="#xml-infoset-rec"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Infoset</span></span></a><span class="deltaxml-old" style="background:#FF5555">] properties </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[attributes]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[base URI]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[children]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[local name]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[namespace name]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[normalized value]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[owner]</span></code><span class="deltaxml-old" style="background:#FF5555">, and </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[parent]</span></code><span class="rfc2119" id="namespace-fixup.6.10"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be preserved.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The information corresponding to </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[prefix]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[in-scope namespaces]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[namespace attributes]</span></code><span class="deltaxml-old" style="background:#FF5555">, and </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[attribute type]</span></code><span class="rfc2119" id="namespace-fixup.7.5"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> be preserved, with changes to the first three only as required for </span><em class="glossterm"><a href="#dt-namespace-fixup"><span class="deltaxml-old" style="background:#FF5555">namespace fixup</span></a></em><span class="deltaxml-old" style="background:#FF5555">. In particular, processors are encouraged to take account of prefix information in creating new namespace bindings, to minimize negative impact on prefixed names in content.</span></p><p><span id="impl-13"><span class="deltaxml-old" style="background:#FF5555">Except for cases which are specifically called out in [</span><a href="#steps30"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Steps 3.0</span></span></a><span class="deltaxml-old" style="background:#FF5555">], the extent to which namespace fixup, and other checks for outputs which cannot be serialized, are performed on intermediate outputs is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">Whenever an implementation serializes XML, for example for pipeline outputs, logging, or as part of steps such as </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:store</span></code><span class="deltaxml-old" style="background:#FF5555"> or </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:http-request</span></code><span class="deltaxml-old" style="background:#FF5555">, it is a dynamic error if that serialization can not be done so as to produce a document which is both well-formed and namespace-well-formed, as specified in </span><em class="glossterm"><a href="#dt-XML"><span class="deltaxml-old" style="background:#FF5555">XML</span></a></em><span class="deltaxml-old" style="background:#FF5555"> and </span><em class="glossterm"><a href="#dt-Namespaces-in-XML"><span class="deltaxml-old" style="background:#FF5555">Namespaces in XML</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></div></section></div></section><section id="initiating" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">7 Initiating a pipeline</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Initiating a pipeline necessarily involves two activities: static analysis and dynamic evaluation. </span><span id="dt-static-analysis" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">Static analysis</span></em><span class="deltaxml-old" style="background:#FF5555"> consists of those tasks that can be performed by inspection of the pipeline alone, including the binding of </span><a href="#statics"><span class="deltaxml-old" style="background:#FF5555">static options and variables</span></a><span class="deltaxml-old" style="background:#FF5555">, computation of serialization properties and document-properties, </span><a href="#use-when"><span class="deltaxml-old" style="background:#FF5555">evaluation of </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">use-when</span></code><span class="deltaxml-old" style="background:#FF5555"> expressions</span></a><span class="deltaxml-old" style="background:#FF5555">, performing a static analysis of all XPath expressions, and detecting static errors.]</span></span><span id="dt-dynamic-evaluation" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">Dynamic evaluation</span></em><span class="deltaxml-old" style="background:#FF5555"> consists of tasks which, in general, cannot be performed out until a source document is available.]</span></span></p><p><a id="err.inline.S0107"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0107"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0107</span></code></a><span class="deltaxml-old" style="background:#FF5555">) in XProc if any XPath expression contains a static error (error in expression syntax, references to unknown variables or functions, etc.). Type errors, even if they are determined during static analysis, </span><span class="rfc2119" id="initiating.3.2"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> be raised statically by the XProc processor. </span></p><p><span id="impl-14"><span class="deltaxml-old" style="background:#FF5555">There may be an </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555"> mechanism for providing default values for static </span><a href="#p.option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code></a><span class="deltaxml-old" style="background:#FF5555">s. If such a mechanism exists, the values provided must match the sequence type declared for the option, if such a declaration exists.</span></span></p><section id="static-expressions" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">7.1 Evaluating expressions during static analysis</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Several kinds of expressions are evaluated during static analysis:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> expressions on static options and static variables.</span></p></li><li><p><a href="#value-templates"><span class="deltaxml-old" style="background:#FF5555">Value templates</span></a><span class="deltaxml-old" style="background:#FF5555"> in the attributes or descendants of </span><a href="#p.input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:input</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#p.output"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and map attributes on those descendants. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Expressions in </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">use-when</span></code><span class="deltaxml-old" style="background:#FF5555"> attributes used for </span><a href="#use-when"><span class="deltaxml-old" style="background:#FF5555">conditional element exclusion</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></li></ol></div><p><span class="deltaxml-old" style="background:#FF5555">For the purposes of evaluating a these expressions, the initial context node, position, and size are all undefined. The </span><em class="glossterm"><a href="#dt-in-scope-bindings"><span class="deltaxml-old" style="background:#FF5555">in-scope bindings</span></a></em><span class="deltaxml-old" style="background:#FF5555"> are limited to the lexically preceding, statically declared options and variables. There are no available collections except the default collection on </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555">s which explicitly create a collection.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The entire expression must be evaluated without reference to the non-static inputs to the pipeline. Expressions can access documents as long as they are available statically.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Consider:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:declare-step version="3.0" xmlns:p="http://www.w3.org/ns/xproc"&gt; &lt;p:input port="source"/&gt; &lt;p:variable name="D" select="count(//*)"/&gt; &lt;p:option name="A" static="true" select="5"/&gt; &lt;p:variable name="B" static="true" select="$A + count(//*)"&gt; &lt;p:document href="doc.xml"/&gt; &lt;/p:variable&gt; … &lt;/p:declare-step&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">The value of </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$A</span></code><span class="deltaxml-old" style="background:#FF5555"> will be 5, unless a different value is provided before static analysis. The value of </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$B</span></code><span class="deltaxml-old" style="background:#FF5555"> will be the value of </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$A</span></code><span class="deltaxml-old" style="background:#FF5555"> plus the number of elements in </span><code class="uri"><span class="deltaxml-old" style="background:#FF5555">doc.xml</span></code><em><span class="deltaxml-old" style="background:#FF5555">which must be successfully resolved during static analysis</span></em><span class="deltaxml-old" style="background:#FF5555">. Although </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$D</span></code><span class="deltaxml-old" style="background:#FF5555"> can reference the document provided dynamically on the </span><code class="port"><span class="deltaxml-old" style="background:#FF5555">source</span></code><span class="deltaxml-old" style="background:#FF5555"> port, any attempt to refer to </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$D</span></code><span class="deltaxml-old" style="background:#FF5555"> in the expression(s) that initialize </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$A</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$B</span></code><span class="deltaxml-old" style="background:#FF5555"> would be an error.</span></p><div class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">There is no guarantee that the document read from </span><code class="uri"><span class="deltaxml-old" style="background:#FF5555">doc.xml</span></code><span class="deltaxml-old" style="background:#FF5555"> during static anlaysis will be the same as the document read later during dynamic evaluation. See </span><a href="#external-docs" title="External Documents"><span class="deltaxml-old" style="background:#FF5555">Section 4.1, “External Documents”</span></a><span class="deltaxml-old" style="background:#FF5555"> for further discussion.</span></p></div></div><p><span class="deltaxml-old" style="background:#FF5555">The results of XProc extension functions may differ during static analysis, as described in the description of each function.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Any errors that occur while evaluating expressions during static analysis will be raised statically.</span></p></div></section><section id="dynamic-evaluation" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">7.2 Dynamic evaluation of the pipeline</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Dynamic evaluation of the pipeline occurs when it begins to process documents. The processor evaluates any expressions necessary to provide all of the input documents and options required. The step processes the input documents and produces outputs which flow through the pipeline.</span></p><section id="environment" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">7.2.1 Environment</span></h4></div><div class="content"><p><span id="dt-environment" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">environment</span></em><span class="deltaxml-old" style="background:#FF5555"> is a context-dependent collection of information available within subpipelines.]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">The environment consists of:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">A set of readable ports. </span><span id="dt-readable-ports" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></em><span class="deltaxml-old" style="background:#FF5555"> are a set of step name/port name pairs.]</span></span><span class="deltaxml-old" style="background:#FF5555"> Inputs and outputs can only be connected to readable ports.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">A default readable port. </span><span id="dt-default-readable-port" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></em><span class="deltaxml-old" style="background:#FF5555">, which may be undefined, is a specific step name/port name pair from the set of readable ports.]</span></span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">A set of in-scope bindings. </span><span id="dt-in-scope-bindings" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">in-scope bindings</span></em><span class="deltaxml-old" style="background:#FF5555"> are a set of name-value pairs, based on </span><em class="glossterm"><a href="#dt-option"><span class="deltaxml-old" style="background:#FF5555">option</span></a></em><span class="deltaxml-old" style="background:#FF5555"> and </span><em class="glossterm"><a href="#dt-variable"><span class="deltaxml-old" style="background:#FF5555">variable</span></a></em><span class="deltaxml-old" style="background:#FF5555"> bindings.]</span></span></p></li></ol></div><p><span id="dt-empty-environment" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">empty environment</span></em><span class="deltaxml-old" style="background:#FF5555"> contains no readable ports, an undefined default readable port, and no in-scope bindings.]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">Unless otherwise specified, the environment of a </span><em class="glossterm"><a href="#dt-contained-steps"><span class="deltaxml-old" style="background:#FF5555">contained step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is its </span><em class="glossterm"><a href="#dt-inherited-environment"><span class="deltaxml-old" style="background:#FF5555">inherited environment</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span><span id="dt-inherited-environment" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">inherited environment</span></em><span class="deltaxml-old" style="background:#FF5555"> of a </span><em class="glossterm"><a href="#dt-contained-steps"><span class="deltaxml-old" style="background:#FF5555">contained step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is an environment that is the same as the environment of its </span><em class="glossterm"><a href="#dt-container"><span class="deltaxml-old" style="background:#FF5555">container</span></a></em><span class="deltaxml-old" style="background:#FF5555"> with the </span><a href="#dt-standard-modifications"><span class="deltaxml-old" style="background:#FF5555">standard modifications</span></a><span class="deltaxml-old" style="background:#FF5555">. ]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><span id="dt-standard-modifications"><span class="deltaxml-old" style="background:#FF5555">standard modifications</span></span><span class="deltaxml-old" style="background:#FF5555"> made to an inherited environment are:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">The declared inputs of the container are added to the </span><em class="glossterm"><a href="#dt-readable-ports"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">In other words, contained steps can see the inputs to their container.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The union of all the declared outputs of all of the step's sibling steps are added to the </span><em class="glossterm"><a href="#dt-readable-ports"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">In other words, sibling steps can see each other's outputs in addition to the outputs visible to their container.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If there is a preceding sibling step element:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">If that preceding sibling has a </span><em class="glossterm"><a href="#dt-primary-output-port"><span class="deltaxml-old" style="background:#FF5555">primary output port</span></a></em><span class="deltaxml-old" style="background:#FF5555">, then that output port becomes the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Otherwise, the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is undefined.</span></p></li></ul></div></li><li><p><span class="deltaxml-old" style="background:#FF5555">If there </span><em><span class="deltaxml-old" style="background:#FF5555">is not</span></em><span class="deltaxml-old" style="background:#FF5555"> a preceding sibling step element: </span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">If the container has a </span><em class="glossterm"><a href="#dt-primary-input-port"><span class="deltaxml-old" style="background:#FF5555">primary input port</span></a></em><span class="deltaxml-old" style="background:#FF5555">, the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is that </span><em class="glossterm"><a href="#dt-primary-input-port"><span class="deltaxml-old" style="background:#FF5555">primary input port</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Otherwise, the default readable port is unchanged.</span></p></li></ul></div></li></ol></div><p><span class="deltaxml-old" style="background:#FF5555">A step with no parent inherits the </span><em class="glossterm"><a href="#dt-empty-environment"><span class="deltaxml-old" style="background:#FF5555">empty environment</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Variables and options are lexically scoped. The environment of a step also includes the </span><em class="glossterm"><a href="#dt-in-scope-bindings"><span class="deltaxml-old" style="background:#FF5555">in-scope bindings</span></a></em><span class="deltaxml-old" style="background:#FF5555"> for all of the variables and options “visible” from its lexical position. Variables and options can shadow each other; only the lexically most recent bindings are visible.</span></p><section id="initial-environment" class="section"><div class="section-titlepage"><h5><span class="deltaxml-old" style="background:#FF5555">7.2.1.1 Initial Environment</span></h5></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">When a pipeline is invoked by a processor, an initial environment is constructed. </span><span id="dt-initial-environment" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: An </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">initial environment</span></em><span class="deltaxml-old" style="background:#FF5555"> is a </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555"> for each of the </span><em class="glossterm"><a href="#dt-readable-ports"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></a></em><span class="deltaxml-old" style="background:#FF5555"> and a set of option bindings used to construct the initial </span><em class="glossterm"><a href="#dt-in-scope-bindings"><span class="deltaxml-old" style="background:#FF5555">in-scope bindings</span></a></em><span class="deltaxml-old" style="background:#FF5555">.]</span></span><span class="deltaxml-old" style="background:#FF5555"> This environment is used in place of the </span><em class="glossterm"><a href="#dt-empty-environment"><span class="deltaxml-old" style="background:#FF5555">empty environment</span></a></em><span class="deltaxml-old" style="background:#FF5555"> that might have otherwise been provided.</span></p><p><span class="deltaxml-old" style="background:#FF5555">An invoked pipeline's </span><em class="glossterm"><a href="#dt-initial-environment"><span class="deltaxml-old" style="background:#FF5555">initial environment</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is different from the environment constructed for the sub-pipeline of a declared step. The initial environment is constructed for the initial invocation of the pipeline by the processor outside the application. Steps that are subsequently invoked construct an environment as specified in </span><a href="#declare-pipelines" title="Declaring pipelines"><span class="deltaxml-old" style="background:#FF5555">Section 16.5.1, “Declaring pipelines”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">When constructing an </span><em class="glossterm"><a href="#dt-initial-environment"><span class="deltaxml-old" style="background:#FF5555">initial environment</span></a></em><span class="deltaxml-old" style="background:#FF5555">, an implementation is free to provide any set of mechanisms to construct connections for the input ports of the invoked step. These mechanisms are not limited to the variety of mechnisms described within this specification. Any extensions are implementation defined.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The set of </span><em class="glossterm"><a href="#dt-in-scope-bindings"><span class="deltaxml-old" style="background:#FF5555">in-scope bindings</span></a></em><span class="deltaxml-old" style="background:#FF5555"> are constructed from a set of option name/value pairs. Each option value can be a simple string value, a specific data type instance (e.g. xs:dateTime), or a more complex value like a map item. How these values are specified is implementation defined.</span></p></div></section></div></section><section id="xpath-context" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">7.2.2 XPath in XProc</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">XProc uses XPath 3.1 as an expression language. XPath expressions are evaluated by the XProc processor in several places: on compound steps, to compute the default values of options and the values of variables; on atomic steps, to compute the actual values of options. </span></p><p><span class="deltaxml-old" style="background:#FF5555">XPath expressions are also passed to some steps. These expressions are evaluated by the implementations of the individual steps.</span></p><p><span class="deltaxml-old" style="background:#FF5555">This distinction can be seen in the following example:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:variable name="home" select="'http://example.com/docs'"/&gt; &lt;p:load name="read-from-home"&gt; &lt;p:with-option name="href" select="concat($home,'/document.xml')"/&gt; &lt;/p:load&gt; &lt;p:split-sequence name="select-chapters" test="@role='chapter'"&gt; &lt;p:with-input port="source" select="//section"/&gt; &lt;/p:split-sequence&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">The select expression on the variable “</span><code class="varname"><span class="deltaxml-old" style="background:#FF5555">home</span></code><span class="deltaxml-old" style="background:#FF5555">” is evaluated by the XProc processor. The value of the variable is “</span><code class="uri"><span class="deltaxml-old" style="background:#FF5555">http://example.com/docs</span></code><span class="deltaxml-old" style="background:#FF5555">”.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="option"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> option of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:load</span></code><span class="deltaxml-old" style="background:#FF5555"> step is evaluated by the XProc processor. The actual </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> option received by the step is simply the string literal “</span><code class="uri"><span class="deltaxml-old" style="background:#FF5555">http://example.com/docs/document.xml</span></code><span class="deltaxml-old" style="background:#FF5555">”. (The select expression on the </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">source</span></code><span class="deltaxml-old" style="background:#FF5555"> input of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:split-sequence</span></code><span class="deltaxml-old" style="background:#FF5555"> step is also evaluated by the XProc processor.) </span></p><p><span class="deltaxml-old" style="background:#FF5555">The XPath expression “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">@role='chapter'</span></code><span class="deltaxml-old" style="background:#FF5555">” is passed literally to the </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">test</span></code><span class="deltaxml-old" style="background:#FF5555"> option on the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:split-sequence</span></code><span class="deltaxml-old" style="background:#FF5555"> step. That's because the nature of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:split-sequence</span></code><span class="deltaxml-old" style="background:#FF5555"> is that </span><em><span class="deltaxml-old" style="background:#FF5555">it evaluates</span></em><span class="deltaxml-old" style="background:#FF5555"> the expression. Only some options on some steps expect XPath expressions. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The XProc processor evaluates all of the XPath expressions in </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> attributes on variables, options, and inputs, in </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">match</span></code><span class="deltaxml-old" style="background:#FF5555"> attributes on </span><a href="#p.viewport"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code></a><span class="deltaxml-old" style="background:#FF5555">, and in </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">test</span></code><span class="deltaxml-old" style="background:#FF5555"> attributes on </span><a href="#p.when"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#p.if"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:if</span></code></a><span class="deltaxml-old" style="background:#FF5555"> steps.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See </span><a href="#xproc-and-step-xpath-context" title="XPath contexts in XProc"><span class="deltaxml-old" style="background:#FF5555">Appendix B, </span><i><span class="deltaxml-old" style="background:#FF5555">XPath contexts in XProc</span></i></a><span class="deltaxml-old" style="background:#FF5555"> for a detailed description of the context.</span></p></div></section></div></section></div></section><section id="xpath-extension-functions" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">8 XPath Extension Functions</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The XProc processor </span><span class="rfc2119" id="xpath-extension-functions.2.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> support the additional functions described in this section in XPath expressions evaluated by the processor.</span></p><p><span class="deltaxml-old" style="background:#FF5555">These functions </span><span class="rfc2119" id="xpath-extension-functions.3.1"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> be supported in XPath expressions evaluated by a step. In the interest of interoperability and to avoid imposing unnecessary constraints on implementors, XPath expressions inside, for example, a template in an XSLT step, cannot be aware of the XProc-defined functions. </span></p><section id="f.system-property" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">8.1 System Properties</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">XPath expressions within a pipeline document can interrogate the processor for information about the current state of the pipeline. Various aspects of the processor are exposed through the </span><a href="#f.system-property"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:system-property</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function:</span></p><div class="funcsynopsis"><span class="funcname"><span class="deltaxml-old" style="background:#FF5555">p:system-property</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">(</span></span><span class="paramname"><span class="deltaxml-old" style="background:#FF5555">$property</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">)</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></span></div><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="varname"><span class="deltaxml-old" style="background:#FF5555">$property</span></code><span class="deltaxml-old" style="background:#FF5555"> string </span><span class="rfc2119" id="f.system-property.4.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> have the form of an </span><a href="https://www.w3.org/TR/xquery-30/#doc-xquery30-EQName"><span class="deltaxml-old" style="background:#FF5555">EQName</span></a><span class="deltaxml-old" style="background:#FF5555">. If it is a QName, it is expanded using the namespace declarations in scope for the expression. </span><a id="err.inline.D0015"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0015"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0015</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a QName is specified and it cannot be resolved with the in-scope namespace declarations. The </span><a href="#f.system-property"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:system-property</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function returns the string representing the value of the system property identified by the EQName. If there is no such property, the empty string </span><span class="rfc2119" id="f.system-property.4.6"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be returned.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Implementations </span><span class="rfc2119" id="f.system-property.5.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> provide the following system properties, which are all in the XProc namespace:</span></p><div class="variablelist"><dl><dt><span class="term"><code class="varname"><span class="deltaxml-old" style="background:#FF5555">p:episode</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Returns a string which </span><span class="rfc2119" id="f.system-property.6.1.2.1.1"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> be unique for each invocation of the pipeline processor. In other words, if a processor is run several times in succession, or if several processors are running simultaneously, each invocation of each processor should get a distinct value from </span><code class="varname"><span class="deltaxml-old" style="background:#FF5555">p:episode</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The unique identifier must be a valid </span><a href="http://www.w3.org/TR/xml/#NT-Name"><span class="deltaxml-old" style="background:#FF5555">XML name</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt><span class="term"><code class="varname"><span class="deltaxml-old" style="background:#FF5555">p:locale</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Returns a string which identifies the current environment (usually the OS) language. This is useful for, for example, message localization purposes. </span><span id="impl-15"><span class="deltaxml-old" style="background:#FF5555">The exact format of the language string is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555"> but </span><span class="rfc2119" id="f.system-property.6.2.2.1.1.2"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> be consistent with the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">xml:lang</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute.</span></span></p></dd><dt><span class="term"><code class="varname"><span class="deltaxml-old" style="background:#FF5555">p:product-name</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Returns a string containing the name of the implementation, as defined by the implementer. This should normally remain constant from one release of the product to the next. It should also be constant across platforms in cases where the same source code is used to produce compatible products for multiple execution platforms.</span></p></dd><dt><span class="term"><code class="varname"><span class="deltaxml-old" style="background:#FF5555">p:product-version</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Returns a string identifying the version of the implementation, as defined by the implementer. This should normally vary from one release of the product to the next, and at the discretion of the implementer it may also vary across different execution platforms. </span></p></dd><dt><span class="term"><code class="varname"><span class="deltaxml-old" style="background:#FF5555">p:vendor</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Returns a string which identifies the vendor of the processor.</span></p></dd><dt><span class="term"><code class="varname"><span class="deltaxml-old" style="background:#FF5555">p:vendor-uri</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Returns a URI which identifies the vendor of the processor. Often, this is the URI of the vendor's web site.</span></p></dd><dt><span class="term"><code class="varname"><span class="deltaxml-old" style="background:#FF5555">p:version</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Returns the version(s) of XProc implemented by the processor as a space-separated list. For example, a processor that supports XProc 1.0 would return “1.0”; a processor that supports XProc 1.0 and 3.0 would return “1.0 3.0”; a processor that supports only XProc 3.0 would return “3.0”.</span></p></dd><dt><span class="term"><code class="varname"><span class="deltaxml-old" style="background:#FF5555">p:xpath-version</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Returns the version(s) of XPath implemented by the processor for evaluating XPath expressions on XProc elements. The result is a space-separated list of versions supported. For example, a processor that only supports XPath 3.1 would return “3.1”; a processor that supports XPath 3.0 and XPath 3.1 could return “3.0 3.1”.</span></p></dd><dt><span class="term"><code class="varname"><span class="deltaxml-old" style="background:#FF5555">p:psvi-supported</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Returns true if the implementation supports passing PSVI annotations between steps, false otherwise.</span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">Implementations may support additional system properties but such properties </span><span class="rfc2119" id="f.system-property.7.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be in a namespace and </span><span class="rfc2119" id="f.system-property.7.2"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> be in the XProc namespace.</span></p><p><span id="impl-16"><span class="deltaxml-old" style="background:#FF5555">The value of the </span><a href="#f.system-property"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:system-property</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function during static analysis is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></div></section><section id="f.step-available" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">8.2 Step Available</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#f.step-available"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:step-available</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function reports whether or not a particular type of step is understood by the processor.</span></p><div class="funcsynopsis"><span class="funcname"><span class="deltaxml-old" style="background:#FF5555">p:step-available</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">(</span></span><span class="paramname"><span class="deltaxml-old" style="background:#FF5555">$step-type</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">)</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:boolean</span></span></div><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="varname"><span class="deltaxml-old" style="background:#FF5555">$step-type</span></code><span class="deltaxml-old" style="background:#FF5555"> string </span><span class="rfc2119" id="f.step-available.4.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> have the form of an </span><a href="https://www.w3.org/TR/xquery-30/#doc-xquery30-EQName"><span class="deltaxml-old" style="background:#FF5555">EQName</span></a><span class="deltaxml-old" style="background:#FF5555">. If it is a QName, it is expanded using the namespace declarations in scope for the expression. The </span><a href="#f.step-available"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:step-available</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function returns true if and only if the processor knows how to evaluate steps of the specified type.</span></p><p><span id="impl-17"><span class="deltaxml-old" style="background:#FF5555">The value of the </span><a href="#f.step-available"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:step-available</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function during static analysis is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></div></section><section id="f.iteration-position" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">8.3 Iteration Position</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Some compound steps, such as </span><a href="#p.for-each"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#p.viewport"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code></a><span class="deltaxml-old" style="background:#FF5555">, process a sequence of documents. The iteration position is the position of the current document in that sequence: the first document has position 1, the second 2, etc. The </span><a href="#f.iteration-position"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-position</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function returns the iteration position of the nearest compound step that processes a sequence of documents.</span></p><div class="funcsynopsis"><span class="funcname"><span class="deltaxml-old" style="background:#FF5555">p:iteration-position</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">(</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">)</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:integer</span></span></div><p><span class="deltaxml-old" style="background:#FF5555">If there is no compound step that processes a sequence of documents among the ancestors of the element on which the expression involving </span><a href="#f.iteration-position"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-position</span></code></a><span class="deltaxml-old" style="background:#FF5555"> occurs, it returns 1.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The value of the </span><a href="#f.iteration-position"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-position</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function during static analysis is 1.</span></p></div></section><section id="f.iteration-size" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">8.4 Iteration Size</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Both </span><a href="#p.for-each"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#p.viewport"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code></a><span class="deltaxml-old" style="background:#FF5555"> process a sequence of documents. The iteration size is the total number of documents in that sequence. The </span><a href="#f.iteration-size"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-size</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function returns the iteration size of the nearest ancestor compound step that processes a sequence of documents.</span></p><div class="funcsynopsis"><span class="funcname"><span class="deltaxml-old" style="background:#FF5555">p:iteration-size</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">(</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">)</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:integer</span></span></div><p><span class="deltaxml-old" style="background:#FF5555">If there is no </span><a href="#p.for-each"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.viewport"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code></a><span class="deltaxml-old" style="background:#FF5555"> among the ancestors of the element on which the expression involving </span><a href="#f.iteration-size"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-size</span></code></a><span class="deltaxml-old" style="background:#FF5555"> occurs, it returns 1.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The value of the </span><a href="#f.iteration-size"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-size</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function during static analysis is 1.</span></p></div></section><section id="f.version-available" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">8.5 Version Available</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Returns true if and only if the processor supports the version specified.</span></p><div class="funcsynopsis"><span class="funcname"><span class="deltaxml-old" style="background:#FF5555">p:version-available</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">(</span></span><span class="paramname"><span class="deltaxml-old" style="background:#FF5555">$version</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">)</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:boolean</span></span></div><p><span class="deltaxml-old" style="background:#FF5555">A version 1.0 processor will return </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">true()</span></code><span class="deltaxml-old" style="background:#FF5555"> when </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">p:version-available('1.0')</span></code><span class="deltaxml-old" style="background:#FF5555"> is evaluated.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#f.version-available"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:version-available</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function behaves normally during static analysis.</span></p></div></section><section id="f.xpath-version-available" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">8.6 XPath Version Available</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Returns true if and only if the processor supports the XPath version specified.</span></p><div class="funcsynopsis"><span class="funcname"><span class="deltaxml-old" style="background:#FF5555">p:xpath-version-available</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">(</span></span><span class="paramname"><span class="deltaxml-old" style="background:#FF5555">$version</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">)</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:boolean</span></span></div><p><span class="deltaxml-old" style="background:#FF5555">A processor that supports XPath 3.1 will return </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">true()</span></code><span class="deltaxml-old" style="background:#FF5555"> when </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">p:xpath-version-available('3.1')</span></code><span class="deltaxml-old" style="background:#FF5555"> is evaluated.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#f.xpath-version-available"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:xpath-version-available</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function behaves normally during static analysis.</span></p></div></section><section id="f.document-properties" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">8.7 Document properties</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">This function retrieves the </span><em class="glossterm"><a href="#dt-document-properties"><span class="deltaxml-old" style="background:#FF5555">document properties</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of a document as a map.</span></p><div class="funcsynopsis"><span class="funcname"><span class="deltaxml-old" style="background:#FF5555">p:document-properties</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">(</span></span><span class="paramname"><span class="deltaxml-old" style="background:#FF5555">$doc</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">item()</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">)</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">map(xs:QName,item()*)</span></span></div><p><span class="deltaxml-old" style="background:#FF5555">The map returned contains (exclusively) the document properties associated with the </span><em class="parameter"><code><span class="deltaxml-old" style="background:#FF5555">$doc</span></code></em><span class="deltaxml-old" style="background:#FF5555"> specified. If the item is not associated with a document, the resulting map will be empty.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#f.document-properties"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:document-properties</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function behaves normally during static analysis.</span></p></div></section><section id="f.document-properties-document" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">8.8 Document properties document</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">This function retrieves the </span><em class="glossterm"><a href="#dt-document-properties"><span class="deltaxml-old" style="background:#FF5555">document properties</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of a document as an XML document.</span></p><div class="funcsynopsis"><span class="funcname"><span class="deltaxml-old" style="background:#FF5555">p:document-properties-document</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">(</span></span><span class="paramname"><span class="deltaxml-old" style="background:#FF5555">$doc</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">item()</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">)</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">document-node()</span></span></div><p><span class="deltaxml-old" style="background:#FF5555">The document returned is a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">c:document-properties</span></code><span class="deltaxml-old" style="background:#FF5555"> document that contains (exclusively) the document properties associated with the </span><em class="parameter"><code><span class="deltaxml-old" style="background:#FF5555">$doc</span></code></em><span class="deltaxml-old" style="background:#FF5555"> specified. If the item is not associated with a document, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">c:document-properties</span></code><span class="deltaxml-old" style="background:#FF5555"> element will be empty.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The underlying properties are serialized as follows:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">Each property/value pair in the map becomes an element in the document. The property name is used as the name of the element and the value becomes the element content. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the property value is a sequence, then the element is repeated for each item in the sequence. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If a map appears as a value, the property element will have an attribute named </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">map</span></code><span class="deltaxml-old" style="background:#FF5555"> with the value “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">true</span></code><span class="deltaxml-old" style="background:#FF5555">”. </span><span id="impl-18"><span class="deltaxml-old" style="background:#FF5555">It is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555"> how or if a processor attempts to serialize maps that appear in document properties.</span></span><span class="deltaxml-old" style="background:#FF5555"> If the implementation does not serialize maps, the property element will be empty. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If an array appears as a value, the property element will have an attribute named </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">array</span></code><span class="deltaxml-old" style="background:#FF5555"> with the value “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">true</span></code><span class="deltaxml-old" style="background:#FF5555">”. </span><span id="impl-19"><span class="deltaxml-old" style="background:#FF5555">It is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555"> how or if a processor attempts to serialize arrays that appear in document properties.</span></span><span class="deltaxml-old" style="background:#FF5555"> If the implementation does not serialize arrays, the property element will be empty. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">For atomic values other than maps, arrays, and strings, an </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">xsi:type</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is added to the element to identify the type of the value. </span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">If any values in the properties map cannot be serialized, an empty string is used for their value. Construction of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">c:document-properties</span></code><span class="deltaxml-old" style="background:#FF5555"> document never fails.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#f.document-properties-document"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:document-properties-document</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function behaves normally during static analysis.</span></p></div></section><section id="f.document-property" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">8.9 Document property</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">This function retrieves a single value from the </span><em class="glossterm"><a href="#dt-document-properties"><span class="deltaxml-old" style="background:#FF5555">document properties</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of a document.</span></p><div class="funcsynopsis"><span class="funcname"><span class="deltaxml-old" style="background:#FF5555">p:document-property</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">(</span></span><span class="paramname"><span class="deltaxml-old" style="background:#FF5555">$doc</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">item()</span></span><span class="funccomma"><span class="deltaxml-old" style="background:#FF5555">, </span></span><span class="paramname"><span class="deltaxml-old" style="background:#FF5555">$key</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">item()</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">)</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">item()*</span></span></div><p><span class="deltaxml-old" style="background:#FF5555">The item returned is the value of the property named </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$key</span></code><span class="deltaxml-old" style="background:#FF5555"> in the document properties. An empty sequence is returned if </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$doc</span></code><span class="deltaxml-old" style="background:#FF5555"> is not associated with a document or no such key exists. </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$key</span></code><span class="deltaxml-old" style="background:#FF5555"> is interpreted as follows:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">If </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$key</span></code><span class="deltaxml-old" style="background:#FF5555"> is of type </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555">, its value is used unchanged.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$key</span></code><span class="deltaxml-old" style="background:#FF5555"> is an instance of type </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></code><span class="deltaxml-old" style="background:#FF5555"> (or a type derived from </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></code><span class="deltaxml-old" style="background:#FF5555">) its value is transformed into a </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:Qname</span></code><span class="deltaxml-old" style="background:#FF5555"> using the </span><a href="https://www.w3.org/TR/xpath-31/#doc-xpath31-EQName"><span class="deltaxml-old" style="background:#FF5555">XPath EQName production rules</span></a><span class="deltaxml-old" style="background:#FF5555">. That is, it can be written as a local-name only, as a prefix plus local-name or as a URI plus local-name (using the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">Q{}</span></code><span class="deltaxml-old" style="background:#FF5555"> syntax).</span></p><p><a id="err.inline.D0061"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0061"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0061</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$key</span></code><span class="deltaxml-old" style="background:#FF5555"> is of type </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></code><span class="deltaxml-old" style="background:#FF5555"> and cannot be converted into a </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:Qname</span></code><span class="deltaxml-old" style="background:#FF5555">. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$key</span></code><span class="deltaxml-old" style="background:#FF5555"> is of any other type, the function returns the empty sequence.</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#f.document-property"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:document-property</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function behaves normally during static analysis.</span></p></div></section><section id="f.urify" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">8.10 Transform filesystem paths into URIs</span></h3></div><div class="content"><p><a href="#f.urify"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:urify</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is a function that attempts to transform file system paths into file URIs ([</span><a href="#rfc2396"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 2396</span></span></a><span class="deltaxml-old" style="background:#FF5555">]). If a URI is already given as an argument, it </span><span class="rfc2119" id="f.urify.2.3"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> return it unchanged, apart from character escaping and path normalizations that are permitted for (presumptive) file URIs.</span></p><div class="funcsynopsis"><span class="funcname"><span class="deltaxml-old" style="background:#FF5555">p:urify</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">(</span></span><span class="paramname"><span class="deltaxml-old" style="background:#FF5555">$filepath</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></span><span class="funccomma"><span class="deltaxml-old" style="background:#FF5555">, </span></span><span class="paramname"><span class="deltaxml-old" style="background:#FF5555">$basedir</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string?</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">)</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></span></div><div class="funcsynopsis"><span class="funcname"><span class="deltaxml-old" style="background:#FF5555">p:urify</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">(</span></span><span class="paramname"><span class="deltaxml-old" style="background:#FF5555">$filepath</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">)</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></span></div><p><span class="deltaxml-old" style="background:#FF5555">If the single-argument version of the function is used, the result is the same as calling the two-argument version with </span><em class="parameter"><code><span class="deltaxml-old" style="background:#FF5555">$basedir</span></code></em><span class="deltaxml-old" style="background:#FF5555"> set to empty sequence.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The function may be implemented as an operation on strings; it need not try to determine the existence of a file or directory, and it </span><span class="rfc2119" id="f.urify.6.1"><span class="deltaxml-old" style="background:#FF5555">should not</span></span><span class="deltaxml-old" style="background:#FF5555"> follow symbolic links. </span><span id="impl-20"><span class="deltaxml-old" style="background:#FF5555">How </span><a href="#f.urify"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:urify</span></code></a><span class="deltaxml-old" style="background:#FF5555"> transforms its arguments into a URI is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em></span><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The purpose of this function is to resolve a file system path to a URI on the platform that the processor runs on; the function need not resolve, for example, Windows paths when the processor runs on a Unix-like operating system. The function is intended as a convenience for pipeline authors and users for transforming OS specific paths and paths relative to the working directory from which they invoked the processor.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The function should support Unix-like (for example, Linux, Solaris, Mac OS X) and Windows file system paths. For Windows paths, the forward slash and the backslash </span><span class="rfc2119" id="f.urify.8.1"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> be considered equivalent. Operating systems with other filesystem path addressing schemes (for example, VMS or Mac OS) need not be supported.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Each argument may be an operating system path, including paths with drive letters and UNC paths on Windows, or a URI. On non-Windows systems, file URIs that contain an authority component (</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file://hostname/path</span></code><span class="deltaxml-old" style="background:#FF5555">) may be reported as an error.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The function need not make sure that an argument identified as a URI is already a </span><em><span class="deltaxml-old" style="background:#FF5555">correct</span></em><span class="deltaxml-old" style="background:#FF5555"> URI according to [</span><a href="#rfc2396"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 2396</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. It may attempt to correct errors in purported file URIs, such as fixing the missing escaping of a space character. It </span><span class="rfc2119" id="f.urify.10.3"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> leave presumptive non-file URIs unchanged. The scheme-relative URI </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">//hostname/path</span></code><span class="deltaxml-old" style="background:#FF5555">) may be reported as an error on non-Windows platforms, even though the omitted scheme may well be a non-file scheme.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The function may normalize URIs and file system paths by contracting multiple consecutive directory path separator slashes, by eliminating path components </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">.</span></code><span class="deltaxml-old" style="background:#FF5555"> or by letting path components </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">..</span></code><span class="deltaxml-old" style="background:#FF5555"> “consume” their parent path components. Other permitted normalizations contain, but are not limited to, making Windows drive letters uppercase or making the URI scheme lowercase.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The function is allowed to produce URIs that do not strictly conform to [</span><a href="#rfc2396"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 2396</span></span></a><span class="deltaxml-old" style="background:#FF5555">] as long as the URIs can be resolved by the processor and by the standard steps that ship with the processor. Examples for non-conforming yet probably acceptable URIs are file URIs with a single slash instead of three slashes after </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:</span></code><span class="deltaxml-old" style="background:#FF5555"> or URIs that contain unescaped UTF-8 characters whose codepoints are above the ASCII range.</span></p><p><span id="impl-21"><span class="deltaxml-old" style="background:#FF5555">For any URI argument to </span><a href="#f.urify"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:urify</span></code></a><span class="deltaxml-old" style="background:#FF5555">, it is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555"> whether query or fragment components are supported.</span></span><span class="deltaxml-old" style="background:#FF5555"> An implementation may choose to return them unchanged, to silently omit them, or to raise an error. It </span><span class="rfc2119" id="f.urify.13.2"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> return </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">?</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">#</span></code><span class="deltaxml-old" style="background:#FF5555"> escaped though.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If the </span><em class="parameter"><code><span class="deltaxml-old" style="background:#FF5555">$basedir</span></code></em><span class="deltaxml-old" style="background:#FF5555"> argument is omitted or is the empty sequence, the current working directory should be used if available. The </span><em class="parameter"><code><span class="deltaxml-old" style="background:#FF5555">$basedir</span></code></em><span class="deltaxml-old" style="background:#FF5555"> argument or the current working directory need only be considered if the </span><em class="parameter"><code><span class="deltaxml-old" style="background:#FF5555">$filepath</span></code></em><span class="deltaxml-old" style="background:#FF5555"> is determined to be a relative path or URI.</span></p><div id="note-urify-encoding" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">Sometimes file names are created in an encoding that does not match the system’s locale. This function does not aim at solving these issues. Implementations should not try to correct apparent errors that originate from garbled encodings since they will probably not be able to produce file URIs that address the corresponding files correctly.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Likewise it is also possible, in particular on Windows, that the encoding gets garbled when command line arguments are passed to the processor. On modern Windows 10 versions (April 2018 or later), this can be addressed by setting the system locale to UTF-8.</span></p></div></div><div id="ednote-test-p_urify" class="note editorial admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Testing</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">Depending on the system where the tests run on, the results may vary. For example, an implementation may add a trailing slash to the file URI if it recognizes that it represents a directory.</span></p><p><span class="deltaxml-old" style="background:#FF5555">One way to make the test results more predictable is to provide an additional function argument that holds a map with certain overriding parameters, such as the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">file-separator</span></code><span class="deltaxml-old" style="background:#FF5555"> or whether the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">filepath</span></code><span class="deltaxml-old" style="background:#FF5555"> argument represents a directory. However, this is impractical if the implementation relies on external libraries to perform the conversion.</span></p><p><span class="deltaxml-old" style="background:#FF5555">A test suite may therefore specify system-dependent tests that run only on Windows or Linux and that accept function results with or without a trailing slash.</span></p></div></div><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#f.urify"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:urify</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function behaves normally during static analysis.</span></p><section id="f.urify.18" class="simplesect"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">Examples</span></h4></div><div class="content"><div class="itemizedlist"><div class="title"><span class="deltaxml-old" style="background:#FF5555">Windows</span></div><ul><li><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">c:\path\to\file</span></code><span class="deltaxml-old" style="background:#FF5555"> → </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///c:/path/to/file</span></code><span class="deltaxml-old" style="background:#FF5555"> (</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///C:/path/to/file</span></code><span class="deltaxml-old" style="background:#FF5555"> will also be correct, as will </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///c:/path/to/file/</span></code><span class="deltaxml-old" style="background:#FF5555"> be if the implementation detects that </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">c:/path/to/file/</span></code><span class="deltaxml-old" style="background:#FF5555"> is actually a directory)</span></p></li><li><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">\\hostname\path\to\file</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">\\hostname/path/to/file</span></code><span class="deltaxml-old" style="background:#FF5555"> or </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">//hostname/path/to/file</span></code><span class="deltaxml-old" style="background:#FF5555"> → </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file://hostname/path/to/file</span></code></p></li><li><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">C:/Program Files (x86)</span></code><span class="deltaxml-old" style="background:#FF5555"> → </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///C:/Program%20Files%20(x86)</span></code><span class="deltaxml-old" style="background:#FF5555"> (or </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///C:/Program%20Files%20(x86)/</span></code><span class="deltaxml-old" style="background:#FF5555">)</span></p></li><li><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">temp</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">/</span></code><span class="deltaxml-old" style="background:#FF5555"> (two arguments) → </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///C:/temp/</span></code><span class="deltaxml-old" style="background:#FF5555"> (depending on the drive letter of the current working directory, and possibly without the trailing slash)</span></p></li><li><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">[workspace]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">E:\temp</span></code><span class="deltaxml-old" style="background:#FF5555"> → </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///E:/temp/%5Bworkspace%5D/</span></code><span class="deltaxml-old" style="background:#FF5555"> (or without trailing slash)</span></p></li></ul></div><div class="itemizedlist"><div class="title"><span class="deltaxml-old" style="background:#FF5555">Unix-like or Windows</span></div><ul><li><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">x y/rαaßβöů亊.txt</span></code><span class="deltaxml-old" style="background:#FF5555"> → </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">…/x%20y/r%CE%B1a%C3%9F%CE%B2%C3%B6%C5%AF%E4%BA%8A.txt</span></code><span class="deltaxml-old" style="background:#FF5555"> (where </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">…</span></code><span class="deltaxml-old" style="background:#FF5555"> represents the file URI of the current working directory) (or </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">…/x%20y/rαaßβöů亊.txt</span></code><span class="deltaxml-old" style="background:#FF5555"> if unescaped non-ASCII UTF-8 is acceptable on the given processor/OS combination)</span></p><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">@50%.csv</span></code><span class="deltaxml-old" style="background:#FF5555"> → </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">…/@50%25.csv</span></code></p><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">@50%25.csv</span></code><span class="deltaxml-old" style="background:#FF5555"> → </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">…/@50%2525.csv</span></code></p></li></ul></div><div class="itemizedlist"><div class="title"><span class="deltaxml-old" style="background:#FF5555">Unix-like</span></div><ul><li><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">/etc</span></code><span class="deltaxml-old" style="background:#FF5555"> → </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///etc/</span></code><span class="deltaxml-old" style="background:#FF5555"> (or </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///etc</span></code><span class="deltaxml-old" style="background:#FF5555">)</span></p><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:/etc</span></code><span class="deltaxml-old" style="background:#FF5555"> → </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///etc/</span></code><span class="deltaxml-old" style="background:#FF5555"> (or </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///etc</span></code><span class="deltaxml-old" style="background:#FF5555">)</span></p><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">/etc?foo=bar#fragment</span></code><span class="deltaxml-old" style="background:#FF5555"> → </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///etc%3Ffoo=bar%23fragment</span></code></p><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:/etc?foo=bar#fragment</span></code><span class="deltaxml-old" style="background:#FF5555"> → error (or </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///etc?foo=bar#fragment</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///etc</span></code><span class="deltaxml-old" style="background:#FF5555">, or </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///etc/</span></code></p><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">/etc?foo=bar#fragment</span></code><span class="deltaxml-old" style="background:#FF5555"> → </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///etc%3Ffoo=bar%23fragment</span></code></p><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///etc%3Ffoo=bar%23fragment</span></code><span class="deltaxml-old" style="background:#FF5555"> → </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:///etc%3Ffoo=bar%23fragment</span></code></p></li></ul></div></div></section><section id="f.urify.19" class="simplesect"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">Errors</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$filepath</span></code><span class="deltaxml-old" style="background:#FF5555"> is determined to be relative, no </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$basedir</span></code><span class="deltaxml-old" style="background:#FF5555"> is given that can be transformed into an absolute URI and the current working directory is unavailable.</span></p><p><span id="impl-22"><span class="deltaxml-old" style="background:#FF5555">Other </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555"> errors may be thrown by </span><a href="#f.urify"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:urify</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></div></section></div></section><section id="f.function-library-importable" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">8.11 Function library importable</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#f.function-library-importable"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:function-library-importable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function reports whether or not function libraries of a particular type can be imported. </span></p><div class="funcsynopsis"><span class="funcname"><span class="deltaxml-old" style="background:#FF5555">p:function-library-importable</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">(</span></span><span class="paramname"><span class="deltaxml-old" style="background:#FF5555">$library-type</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></span><span class="funcparen"><span class="deltaxml-old" style="background:#FF5555">)</span></span><span class="typeas"><span class="deltaxml-old" style="background:#FF5555"> as </span></span><span class="type"><span class="deltaxml-old" style="background:#FF5555">xs:boolean</span></span></div><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="varname"><span class="deltaxml-old" style="background:#FF5555">$library-type</span></code><span class="deltaxml-old" style="background:#FF5555"> string is interpreted as a content type. If the processor understands (</span><em class="foreignphrase"><span class="deltaxml-old" style="background:#FF5555">i.e.</span></em><span class="deltaxml-old" style="background:#FF5555"> if </span><a href="#p.import-functions"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:import-functions</span></code></a><span class="deltaxml-old" style="background:#FF5555"> understands) how to load function libraries of that type, this function returns </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">true()</span></code><span class="deltaxml-old" style="background:#FF5555">, otherewise it returns </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">false()</span></code><span class="deltaxml-old" style="background:#FF5555">. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#f.function-library-importable"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:function-library-importable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> function behaves normally during static analysis.</span></p></div></section><section id="other-xpath-extension-functions" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">8.12 Other XPath Extension Functions</span></h3></div><div class="content"><p><span id="impl-23"><span class="deltaxml-old" style="background:#FF5555">It is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555"> if the processor supports any other XPath extension functions.</span></span><span class="deltaxml-old" style="background:#FF5555"> Additional extension functions, if any, </span><span class="rfc2119" id="other-xpath-extension-functions.2.2"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> use any of the XProc namespaces. </span></p><p><span id="impl-24"><span class="deltaxml-old" style="background:#FF5555">The value of the any other XPath extension functions during static analysis is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></div></section></div></section><section id="psvi-support" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">9 PSVIs in XProc</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">XML documents flow between steps in an XProc pipeline. </span><a href="#infoset-conformance" title="Infoset Conformance"><span class="deltaxml-old" style="background:#FF5555">Section A.3, “Infoset Conformance”</span></a><span class="deltaxml-old" style="background:#FF5555"> identifies the properties of those documents that </span><span class="rfc2119" id="psvi-support.2.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be available. Implementations </span><span class="rfc2119" id="psvi-support.2.3"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> also have the ability to pass PSVI annotations between steps.</span></p><p><span id="impl-25"><span class="deltaxml-old" style="background:#FF5555">Whether or not the pipeline processor supports passing PSVI annotations between steps is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span><span id="impl-26"><span class="deltaxml-old" style="background:#FF5555">The exact PSVI properties that are preserved when documents are passed between steps is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">A pipeline can use the </span><code class="varname"><span class="deltaxml-old" style="background:#FF5555">p:psvi-supported</span></code><span class="deltaxml-old" style="background:#FF5555"> system property to determine whether or not PSVI properties can be passed between steps.</span></p><p><span class="deltaxml-old" style="background:#FF5555">A pipeline can assert that PSVI support is required with the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">psvi-required</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">On a </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555">, </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">psvi-required</span></code><span class="deltaxml-old" style="background:#FF5555"> indicates whether or not the declared step requires PSVI support. </span><a id="err.inline.D0022"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0022"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0022</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a processor that does not support PSVI annotations attempts to invoke a step which asserts that they are required.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">On a </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555">, the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">psvi-required</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute provides a default value for all of its </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><em><span class="deltaxml-old" style="background:#FF5555">children</span></em><span class="deltaxml-old" style="background:#FF5555"> that do not specify a value themselves.</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">Many of the steps that an XProc pipeline can use are transformative in nature. The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:delete</span></code><span class="deltaxml-old" style="background:#FF5555"> step, for example, can remove elements and attributes; the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:label-elements</span></code><span class="deltaxml-old" style="background:#FF5555"> step can add attributes; etc. If PSVI annotations were always preserved, the use of such steps could result in documents that were inconsistent with their schema annotations.</span></p><p><span class="deltaxml-old" style="background:#FF5555">In order to avoid these inconsistencies, most steps </span><span class="rfc2119" id="psvi-support.8.1"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> produce PSVI annotated results even when PSVI passing is supported.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If PSVI passing is supported, the following constraints apply:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">Implementations </span><span class="rfc2119" id="psvi-support.10.1.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> faithfully transmit any PSVI properties produced on step outputs to the steps to which they are connected.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">When only a subset of the input is processed by a step (because a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> expression appears on an input port or a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">match</span></code><span class="deltaxml-old" style="background:#FF5555"> expression is used to process only part of the input), any PSVI annotations that appear on the selected input </span><span class="rfc2119" id="psvi-support.10.2.1.3"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be preserved in the resulting documents passed to the step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Note that ID/IDREF constraints, and any other whole-document constraints, may not be satisfied within the selected portion, irrespective of what its PSVI properties claim.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If an output of a compound step is connected to an output which includes PSVI properties, those properties </span><span class="rfc2119" id="psvi-support.10.3.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be preserved on the output of the compound step, </span><em><span class="deltaxml-old" style="background:#FF5555">except</span></em><span class="deltaxml-old" style="background:#FF5555"> for the output of </span><a href="#p.viewport"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code></a><span class="deltaxml-old" style="background:#FF5555"> which </span><span class="rfc2119" id="psvi-support.10.3.1.4"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> contain any PSVI properties.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If an implementation supports XPath 2.0 or later, the data model constructed with which to evaluate XPath expressions and match patterns </span><span class="rfc2119" id="psvi-support.10.4.1.1"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> take advantage of as much PSVI information as possible. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Except as specified above, or in the descriptions of individual steps, implementations </span><span class="rfc2119" id="psvi-support.10.5.1.1"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> include PSVI properties in the outputs of steps defined by this specification. </span><span id="impl-27"><span class="deltaxml-old" style="background:#FF5555">It is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555"> what PSVI properties, if any, are produced by extension steps.</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">The exceptions in the standard XProc steps are the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:validate-with-xml-schema</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:validate-with-relax-ng</span></code><span class="deltaxml-old" style="background:#FF5555">, and </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:validate-with-schematron</span></code><span class="deltaxml-old" style="background:#FF5555"> steps, </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:xslt</span></code><span class="deltaxml-old" style="background:#FF5555"> (when XSLT 2.0 is used), </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:xquery</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:identity</span></code><span class="deltaxml-old" style="background:#FF5555">, and </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:split-sequence</span></code><span class="deltaxml-old" style="background:#FF5555">. </span></p></li></ol></div><div id="note-psvi" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">A processor that supports passing PSVI properties between steps is always free to do so. Even if </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">psvi-required="false"</span></code><span class="deltaxml-old" style="background:#FF5555"> is explicitly specified, it is not an error for a step to produce a result that includes additional PSVI properties, provide it does not violate the constraints above.</span></p></div></div></div></section><section id="value-templates" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">10 Value Templates</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">An attribute or text node in a pipeline may, in particular circumstances, contain embedded expressions enclosed between curly brackets. Attributes and text nodes that use (or are permitted to use) this mechanism are referred to respectively as </span><em class="glossterm"><a href="#dt-attribute-value-template"><span class="deltaxml-old" style="background:#FF5555">attribute value templates</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (AVTs) and </span><em class="glossterm"><a href="#dt-text-value-template"><span class="deltaxml-old" style="background:#FF5555">text value templates.</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (TVTs).</span></p><p><span id="dt-value-template" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: Collectively, attribute value templates and text value templates are referred to as </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">value templates</span></em><span class="deltaxml-old" style="background:#FF5555">.]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">A value template is a string that contains zero or more expressions delimited by curly brackets. Outside an expression, a doubled left or right curly bracket (“</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">{{</span></code><span class="deltaxml-old" style="background:#FF5555">” or “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">}}</span></code><span class="deltaxml-old" style="background:#FF5555">”) represents a literal, single bracket and does not start or end an expression. Once an expression begins, it extends to the first unmatched right curly bracket that is not within a string literal or comment.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Value templates are not recursive. Curly brackets inside an expression are part of that expression and are not recognized as nested value templates.</span></p><p><a id="err.inline.S0066"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0066"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0066</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if an expression does not have a closing right curly bracket or if an unescaped right curly bracket occurs outside of an expression. </span></p><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the string contained between matching curly brackets in a value template, when interpreted as an XPath expression, contains errors. The error is signaled using the appropriate XPath error code.</span></p><p><a id="err.inline.D0050"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0050"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0050</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the XPath expression in a value template can not be evaluated. </span></p><p><a id="err.inline.D0051"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0051"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0051</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the XPath expression in an AVT or TVT evaluates to something to other than a sequence containing atomic values or nodes. Function, array and map items are explicitly excluded here because they do not have a string representation. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The context item used for evaluating value templates comes from the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span><a id="err.inline.D0065"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0065"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0065</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to refer to the context item, size, or position in a value template if a sequence of documents appears on the default readable port. If the value template appears in a context where no default readable port exists, then the context item is undefined.</span></p><section id="attribute-value-templates" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">10.1 Attribute Value Templates</span></h3></div><div class="content"><p><span id="dt-attribute-value-template" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: In an attribute that is designated as an </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">attribute value template</span></em><span class="deltaxml-old" style="background:#FF5555">, an expression can be used by surrounding the expression with curly brackets (</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">{}</span></code><span class="deltaxml-old" style="background:#FF5555">), following the general rules for </span><em class="glossterm"><a href="#dt-value-template"><span class="deltaxml-old" style="background:#FF5555">value templates</span></a></em><span class="deltaxml-old" style="background:#FF5555">]</span></span><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Curly brackets are not treated specially in an attribute value in an XProc pipeline unless the attribute is specifically designated as one that permits an attribute value template. Option shortcuts permit attribute value templates. </span><span id="impl-28"><span class="deltaxml-old" style="background:#FF5555">Whether or not an extension attribute permits attribute value templates is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span><span class="deltaxml-old" style="background:#FF5555"> In element syntax summaries in this specification, the value of an attribute that allows attribute value templates is surrounded by curly brackets.</span></p><p><span class="deltaxml-old" style="background:#FF5555">An attribute value template can be seen as an alternating sequence of zero or more “fixed” (non-expression) parts and expression parts.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The result of the attribute value template is the concatenation of the fixed parts and the string-value of the result of evaluating each expression part.</span></p><div id="note-dynerr" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">This process can generate dynamic errors, for example if the sequence contains an element with a complex content type (which cannot be atomized).</span></p></div></div><p><span class="deltaxml-old" style="background:#FF5555">The value of an attribute that contains attribute value templates is a single string (the concatenation of the string values of the evaluated templates and non-template parts) as an </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:untypedAtomic</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p></div></section><section id="text-value-templates" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">10.2 Text Value Templates</span></h3></div><div class="content"><p><span id="dt-text-value-template" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: In a text node that is designated as a </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">text value template</span></em><span class="deltaxml-old" style="background:#FF5555">, expressions can be used by surrounding each expression with curly brackets (</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">{}</span></code><span class="deltaxml-old" style="background:#FF5555">), following the general rules for </span><em class="glossterm"><a href="#dt-value-template"><span class="deltaxml-old" style="background:#FF5555">value templates</span></a></em><span class="deltaxml-old" style="background:#FF5555">.]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">Text nodes that are descendants of a </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and text nodes that are descendants of an element node in an implicit inline may be text value templates. No other text node is a text value template.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Whether or not a text node that may be a text value template is designated one is determined by </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">p:inline-expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> attributes, see </span><a href="#expand-text-attribute" title="Expand text attributes"><span class="deltaxml-old" style="background:#FF5555">Section 14.9.1, “Expand text attributes”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">A text value template can be seen as an alternating sequence of zero or more “fixed” (non-expression) parts and expression parts.</span></p><p><span class="deltaxml-old" style="background:#FF5555">This produces a sequence of strings (the fixed parts) and items (the results of evaluating each expression). Any items that are non-string atomic values are converted to strings by taking their string value. Strings are converted into text nodes.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The result of the text value template is this sequence of nodes.</span></p><div id="unlike-xslt-tvts" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">Unlike XSLT, in XProc, text value templates are not atomized and converted to single text nodes. It is possible to insert nodes with text value templates in XProc, for example, if the XPath expressions refer to variables that have node content.</span></p></div></div><p><span class="deltaxml-old" style="background:#FF5555">If a node to be inserted with a text value template is a document node, all the children of the document node are inserted.</span></p><p><span class="deltaxml-old" style="background:#FF5555">How the nodes are inserted depends on the content type of the </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">If the content type is an </span><em class="glossterm"><a href="#dt-XML-media-type"><span class="deltaxml-old" style="background:#FF5555">XML media type</span></a></em><span class="deltaxml-old" style="background:#FF5555">, the nodes are added to the XML document where they occur. This is analagous to the way element constructors work in [</span><a href="#xquery10"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XQuery 1.0</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If the node is an attribute it is added to an element parent if and only if the attribute either has no preceding nodes in the sequence of nodes or has only attributes as preceding nodes. </span><a id="err.inline.D0052"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0052"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0052</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the XPath expression in a TVT evaluates to an attribute and either the parent is not an element or the attribute has a preceding node that it not an attribute. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the content type is not an </span><em class="glossterm"><a href="#dt-XML-media-type"><span class="deltaxml-old" style="background:#FF5555">XML media type</span></a></em><span class="deltaxml-old" style="background:#FF5555">, each text value template is replaced by the concatenation of the serialization of the nodes that result from evaluating the template.</span></p><p><span class="deltaxml-old" style="background:#FF5555">This serialization is performed with the following serialization parameters:</span></p><figure id="text-value-templates.11.2.3" class="informaltable-wrapper"><div class="informaltable"><table border="0" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">Parameter</span></th><th style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">Value</span></th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">byte-order-mark</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">false</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">cdata-section-elements</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">()</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">doctype-public</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">()</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">doctype-system</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">()</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">encoding</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">“utf-8”</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">escape-uri-attributes</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">false</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">include-content-type</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">false</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">indent</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">false</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">media-type</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">“application/xml”</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">method</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">“xml”</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">normalization-form</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">()</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">omit-xml-declaration</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">true</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">standalone</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">false</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">undeclare-prefixes</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">false</span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">use-character-maps</span></code></td><td style="border-bottom: 1px solid ; "><span class="deltaxml-old" style="background:#FF5555">()</span></td></tr><tr><td style="border-right: 1px solid ; "><code class="option"><span class="deltaxml-old" style="background:#FF5555">version</span></code></td><td><span class="deltaxml-old" style="background:#FF5555">1.0</span></td></tr></tbody></table></div></figure></li></ol></div><p><span class="deltaxml-old" style="background:#FF5555">Interpretation of the character content of the </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> according to the media type occurs after text value templates have been replaced.</span></p><section id="text-value-templates.13" class="simplesect"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">Examples</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Consider the following examples. In each case:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The variable </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">$name</span></code><span class="deltaxml-old" style="background:#FF5555"> is bound to the following XML element:</span></p><pre class="programlisting language-markup"><code><span class="deltaxml-old" style="background:#FF5555"> &lt;name&gt;&lt;given&gt;Mary&lt;/given&gt; &lt;surname&gt;Smith&lt;/surname&gt;&lt;/name&gt;</span></code></pre></li><li><p><span class="deltaxml-old" style="background:#FF5555">The result of evaluating the text value template “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">{$name/node()}</span></code><span class="deltaxml-old" style="background:#FF5555">” is a sequence of three nodes, the given name element, a text node containing a single space, and the surname element.</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">If the media type is an XML media type:</span></p><pre class="programlisting language-none line-numbers"><code><span class="deltaxml-old" style="background:#FF5555"> &lt;p:inline content-type="application/xml"&gt; &lt;attribution&gt;{$name/node()}&lt;/attribution&gt; &lt;/p:inline&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">the result is that sequence of nodes:</span></p><pre class="programlisting language-none"><code><span class="deltaxml-old" style="background:#FF5555"> &lt;attribution&gt;&lt;given&gt;Mary&lt;/given&gt; &lt;surname&gt;Smith&lt;/surname&gt;&lt;/attribution&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">If the media type is not an XML media type:</span></p><pre class="programlisting language-none line-numbers"><code><span class="deltaxml-old" style="background:#FF5555"> &lt;p:inline content-type="application/json"&gt; {{ "name": "{$name/node()}" }} &lt;/p:inline&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">the result is the concatentation of the serialization of the nodes:</span></p><pre class="programlisting language-none"><code><span class="deltaxml-old" style="background:#FF5555"> { "name": "&lt;given&gt;Mary&lt;/given&gt; &lt;surname&gt;Smith&lt;/surname&gt;" }</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">If the string value is desired, instead of escaped markup, write the expression such that it returns the string values:</span></p><pre class="programlisting language-none line-numbers"><code><span class="deltaxml-old" style="background:#FF5555"> &lt;p:inline content-type="application/json"&gt; {{ "name": "{$name/node()/string()}" }} &lt;/p:inline&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">To produce:</span></p><pre class="programlisting language-none"><code><span class="deltaxml-old" style="background:#FF5555"> { "name": "Mary Smith" }</span></code></pre></div></section></div></section></div></section><section id="variables-options-background" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">11 Variables and Options</span></h2></div><div class="content"><section id="variables" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">11.1 Variables</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Pipeline authors can create variables to hold computed values.</span></p><p><span id="dt-variable" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">variable</span></em><span class="deltaxml-old" style="background:#FF5555"> is a name/value pair. The name </span><span class="rfc2119" id="dt-variable.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be an </span><a href="http://www.w3.org/TR/REC-xml-names/#dt-expname"><span class="deltaxml-old" style="background:#FF5555">expanded name</span></a><span class="deltaxml-old" style="background:#FF5555">. The value may be any XPath data model value.]</span></span><span class="deltaxml-old" style="background:#FF5555"> Variable names are always expressed as literal values, pipelines cannot construct variable names dynamically. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The names of variables and options are not distinct and are lexically scoped. </span><span id="dt-shadow" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: We say that a variable </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">shadows</span></em><span class="deltaxml-old" style="background:#FF5555"> another variable (or option) if it has the same name and appears later in the same lexical scope.]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">Consider this pipeline:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0" name="main"&gt; &lt;p:option name="bname" as="xs:integer" select="1"/&gt; &lt;p:message message="NAME1={$bname}"&gt; &lt;p:input port="source"&gt; &lt;p:empty/&gt; &lt;/p:input&gt; &lt;/p:message&gt; &lt;p:variable name="bname" select="$opt + 1"/&gt; &lt;p:message message="NAME2={$bname}"/&gt; &lt;p:variable name="bname" select="7"/&gt; &lt;p:message message="NAME3={$bname}"/&gt; &lt;p:sink/&gt; &lt;/p:declare-step&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">If no overriding value is provided for </span><code class="varname"><span class="deltaxml-old" style="background:#FF5555">$bname</span></code><span class="deltaxml-old" style="background:#FF5555"> at runtime, the pipeline will produce three messages: “NAME1=1”, “NAME2=2”, and “NAME3=7”. (If an overriding value is provided at runtime, “NAME1” will have that value, “NAME2” will have one more than that value, and “NAME3” will have the value 7. </span></p></div></section><section id="options" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">11.2 Options</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Some steps accept options. The value of an option is the default value specified in its declaration, or a value provided by the caller of the step (overriding the default). If it has neither a default value nor a provided value, its value is the empty sequence.</span></p><p><span id="dt-option" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: An </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">option</span></em><span class="deltaxml-old" style="background:#FF5555"> is a name/value pair. The name </span><span class="rfc2119" id="dt-option.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be an </span><a href="http://www.w3.org/TR/REC-xml-names/#dt-expname"><span class="deltaxml-old" style="background:#FF5555">expanded name</span></a><span class="deltaxml-old" style="background:#FF5555">. The value may be any XPath data model value.]</span></span><span class="deltaxml-old" style="background:#FF5555"> Option names are always expressed as literal values, pipelines cannot construct option names dynamically. </span></p><p><span id="impl-29"><span class="deltaxml-old" style="background:#FF5555">How outside values are specified for pipeline options on the pipeline initially invoked by the processor is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span><span class="deltaxml-old" style="background:#FF5555"> In other words, the command line options, APIs, or other mechanisms available to specify such options values are outside the scope of this specification.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Some steps require a set of name/value pairs for the operations they perform. For example, an XSLT stylesheet might have required parameters or an XQuery query might have external variables. In the XProc Step Library, the standard way to pass such values to the step is to use an option named “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">parameters</span></code><span class="deltaxml-old" style="background:#FF5555">” whose value is a map.</span></p></div></section><section id="statics" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">11.3 Static Options and Variables</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Any </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> that is part of the </span><em class="glossterm"><a href="#dt-prologue"><span class="deltaxml-old" style="background:#FF5555">prologue</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of a step (as a direct child of </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> declared before the start of the sub-pipeline) </span><span class="rfc2119" id="statics.2.4"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be declared “static”. Any </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> that is part of the sub-pipeline of a step </span><span class="rfc2119" id="statics.2.6"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> be declared “static”.</span></p><p><span class="deltaxml-old" style="background:#FF5555">A </span><a href="#p.option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> may be declared “static”. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Options and variables that are the direct children of </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="rfc2119" id="statics.4.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be declared static.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The values of static options and variables are computed during </span><a href="#initiating"><span class="deltaxml-old" style="background:#FF5555">static analysis</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></div></section><section id="varopt-types" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">11.4 Variable and option types</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Variables and options may declare that they have a type using the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">as</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. The attribute value </span><span class="rfc2119" id="varopt-types.2.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be an [</span><a href="#xpath31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">] </span><a href="https://www.w3.org/TR/xpath-31/#dt-sequence-type"><span class="deltaxml-old" style="background:#FF5555">sequence type</span></a><span class="deltaxml-old" style="background:#FF5555">. </span><a id="err.inline.S0096"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0096"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0096</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the sequence type is not syntactically valid. The sequence type </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">item()*</span></code><span class="deltaxml-old" style="background:#FF5555"> is assumed if no explicit type is provided. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If a variable or option declares a type, the supplied value of the variable or option is converted to the required type, using the function conversion rules specified by XPath 3.1. </span><a id="err.inline.D0036"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0036"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0036</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the supplied value of a variable or option cannot be converted to the required type.</span></p></div></section><section id="qname-handling" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">11.5 QName handling</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Some steps have options whose values are QNames, for example “</span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">attribute-name</span></code><span class="deltaxml-old" style="background:#FF5555">” on </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:add-attribute</span></code><span class="deltaxml-old" style="background:#FF5555">. If the type </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555"> was strictly enforced, they would be tedious to specify. As a convenience for pipeline authors, the values of variables or options declared with the type </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555"> are processed specially. The type </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555"> is treated as </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:anyAtomicType</span></code><span class="deltaxml-old" style="background:#FF5555"> for the purpose of atomization. The value (or values) are converted to </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555">s:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">If the value supplied for the option is an instance of </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555"> then that value is used. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the value supplied for the option is an instance of </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></code><span class="deltaxml-old" style="background:#FF5555"> (or a type derived from </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></code><span class="deltaxml-old" style="background:#FF5555">), the QName is constructed by following the </span><a href="https://www.w3.org/TR/xpath-31/#doc-xpath31-EQName"><span class="deltaxml-old" style="background:#FF5555">EQName production rules</span></a><span class="deltaxml-old" style="background:#FF5555"> in [</span><a href="#xpath31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. That is, it can be written as a local-name only, as a prefix plus local-name, or as a URI qualified name (using the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">Q{namespace}local-name</span></code><span class="deltaxml-old" style="background:#FF5555"> syntax). </span><a id="err.inline.D0061.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0061"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0061</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the string value is not syntactically an EQName. </span><a id="err.inline.D0069"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0069"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0069</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the string value contains a colon and the designated prefix is not declared in the in-scope namespaces. </span></p></li><li><p><a id="err.inline.D0068"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0068"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0068</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the supplied value is neither an instance of </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555"> nor an instance of </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></code><span class="deltaxml-old" style="background:#FF5555">. </span></p></li></ol></div><p><span class="deltaxml-old" style="background:#FF5555">As an additional convenience, if the specified sequence type of an option or a variable is a map with </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555"> keys (</span><code class="type"><span class="deltaxml-old" style="background:#FF5555">map(xs:QName, …)</span></code><span class="deltaxml-old" style="background:#FF5555">), the supplied map value is processed specially. This makes it possible to pass in maps using (easier to write) </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></code><span class="deltaxml-old" style="background:#FF5555"> type keys that are converted automatically into the required </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555"> keys.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Every key/value pair in a map supplied to a variable or an option with sequence type </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">map(xs:QName, …)</span></code><span class="deltaxml-old" style="background:#FF5555"> is processed as follows:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">If the entry's key is of type </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555">, the entry is left unchanged.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the entry's key is an instance of type </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></code><span class="deltaxml-old" style="background:#FF5555"> (or a type derived from </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></code><span class="deltaxml-old" style="background:#FF5555">) it is transformed into an </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:Qname</span></code><span class="deltaxml-old" style="background:#FF5555"> using the </span><a href="https://www.w3.org/TR/xpath-31/#doc-xpath31-EQName"><span class="deltaxml-old" style="background:#FF5555">XPath EQName production rules</span></a><span class="deltaxml-old" style="background:#FF5555">. That is, it can be written as a local-name only, as a prefix plus local-name or as a URI plus local-name (using the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">Q{}</span></code><span class="deltaxml-old" style="background:#FF5555"> syntax).</span></p><p><a id="err.inline.D0061.2"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0061"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0061</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the entry's key is of type </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></code><span class="deltaxml-old" style="background:#FF5555"> and cannot be converted into a </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:Qname</span></code><span class="deltaxml-old" style="background:#FF5555">. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the entry's key is of any other type, the entry is ignored and will be removed from the map.</span></p></li></ul></div></div></section><section id="opt-bindings" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">11.6 Namespaces on variables and options</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Variable and option values carry with them not only their literal or computed value but also a set of namespaces. To see why this is necessary, consider the following step:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:delete xmlns:p="http://www.w3.org/ns/xproc"&gt; &lt;p:with-option name="match" select="'html:div'" xmlns:html="http://www.w3.org/1999/xhtml"/&gt; &lt;/p:delete&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:delete</span></code><span class="deltaxml-old" style="background:#FF5555"> step will delete elements that match the expression “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">html:div</span></code><span class="deltaxml-old" style="background:#FF5555">”, but that expression can only be correctly interpreted if there's a namespace binding for the prefix “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">html</span></code><span class="deltaxml-old" style="background:#FF5555">” so that binding has to travel with the option.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The default namespace bindings associated with a variable or option value are computed as follows:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">If the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute was used to specify the value and it consisted of a single </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">VariableReference</span></code><span class="deltaxml-old" style="background:#FF5555"> (per [</span><a href="#xpath31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">]), then the namespace bindings from the referenced option or variable are used.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute was used to specify the value and it evaluated to a node-set, then the in-scope namespaces from the first node in the selected node-set (or, if it's not an element, its parent) are used.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The expression is evaluated in the appropriate context, See </span><a href="#xpath-context" title="XPath in XProc"><span class="deltaxml-old" style="background:#FF5555">Section 7.2.2, “XPath in XProc”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Otherwise, the in-scope namespaces from the element providing the value are used. (For options specified using </span><a href="#option-shortcut"><span class="deltaxml-old" style="background:#FF5555">syntactic shortcuts</span></a><span class="deltaxml-old" style="background:#FF5555">, the step element itself is providing the value.)</span></p></li></ol></div><p><span class="deltaxml-old" style="background:#FF5555">The default namespace is never included in the namespace bindings for a variable or option value. Unqualified names are always in no-namespace.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Unfortunately, in more complex situations, there may be no single variable or option that can reliably be expected to have the correct set of namespace bindings. Consider this pipeline:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" xmlns:ex="http://example.org/ns/ex" xmlns:h="http://www.w3.org/1999/xhtml" type="ex:delete-in-div" version="3.0"&gt; &lt;p:input port="source"/&gt; &lt;p:output port="result"/&gt; &lt;p:option name="divchild" required="true"/&gt; &lt;p:delete&gt; &lt;p:with-option name="match" select="concat('h:div/',$divchild)"/&gt; &lt;/p:delete&gt; &lt;/p:declare-step&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">It defines an atomic step (“</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">ex:delete-in-div</span></code><span class="deltaxml-old" style="background:#FF5555">”) that deletes elements that occur inside of XHTML div elements. It might be used as follows:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;ex:delete-in-div xmlns:p="http://www.w3.org/ns/xproc" xmlns:ex="http://example.org/ns/ex" xmlns:html="http://www.w3.org/1999/xhtml" divchild="html:p[@class='delete']"/&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">In this case, the </span><code class="varname"><span class="deltaxml-old" style="background:#FF5555">match</span></code><span class="deltaxml-old" style="background:#FF5555"> option passed to the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:delete</span></code><span class="deltaxml-old" style="background:#FF5555"> step needs </span><em><span class="deltaxml-old" style="background:#FF5555">both</span></em><span class="deltaxml-old" style="background:#FF5555"> the namespace binding of “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">h</span></code><span class="deltaxml-old" style="background:#FF5555">” specified in the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">ex:delete-in-div</span></code><span class="deltaxml-old" style="background:#FF5555"> pipeline definition </span><em><span class="deltaxml-old" style="background:#FF5555">and</span></em><span class="deltaxml-old" style="background:#FF5555"> the namespace binding of “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">html</span></code><span class="deltaxml-old" style="background:#FF5555">” specified in the </span><code class="varname"><span class="deltaxml-old" style="background:#FF5555">divchild</span></code><span class="deltaxml-old" style="background:#FF5555"> option on the call of that pipeline. It's not sufficient to provide just one of the sets of bindings.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If pipeline authors cannot arrange for all of the necessary namespace bindings to be in scope, then EQNames can be used to remove the dependency on namespace bindings:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;ex:delete-in-div xmlns:p="http://www.w3.org/ns/xproc" xmlns:ex="http://example.org/ns/ex" divchild="q{http://www.w3.org/1999/xhtml}p[@class='delete']"/&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">In this example, the expression will match “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">p</span></code><span class="deltaxml-old" style="background:#FF5555">” elements in the XHTML namespace irrespective of any bindings that may or may not be in scope.</span></p></div></section></div></section><section id="security-considerations" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">12 Security Considerations</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">An XProc pipeline may attempt to access arbitrary network resources: steps such as </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:load</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:http-request</span></code><span class="deltaxml-old" style="background:#FF5555"> can attempt to read from an arbitrary URI; steps such as </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:store</span></code><span class="deltaxml-old" style="background:#FF5555"> can attempt to write to an arbitrary location; </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:exec</span></code><span class="deltaxml-old" style="background:#FF5555"> can attempt to execute an arbitrary program. Note, also, that some steps, such as </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:xslt</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:xquery</span></code><span class="deltaxml-old" style="background:#FF5555">, include extension mechanisms which may attempt to execute arbitrary code. </span></p><p><span class="deltaxml-old" style="background:#FF5555">In some environments, it may be inappropriate to provide the XProc pipeline with access to these resources. In a server environment, for example, it may be impractical to allow pipelines to store data. In environments where the pipeline cannot be trusted, allowing the pipeline to access arbitrary resources or execute arbitrary code may be a security risk.</span></p><p><a id="err.inline.D0021"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0021"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0021</span></code></a><span class="deltaxml-old" style="background:#FF5555">) for a pipeline to attempt to access a resource for which it has insufficient privileges or perform a step which is forbidden. </span><span id="impl-30"><span class="deltaxml-old" style="background:#FF5555">Which steps are forbidden, what privileges are needed to access resources, and under what circumstances these security constraints apply is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">Steps in a pipeline may call themselves recursively which could result in pipelines which will never terminate.</span></p><p><span class="deltaxml-old" style="background:#FF5555">A conformant XProc processor may limit the resources available to any or all steps in a pipeline. A conformant implementation may raise dynamic errors, or take any other corrective action, for any security problems that it detects.</span></p></div></section><section id="versioning-considerations" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">13 Versioning Considerations</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A pipeline author </span><span class="rfc2119" id="versioning-considerations.2.1"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> identify the version of XProc for which a particular pipeline was authored by setting the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">version</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">version</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute can be specified on </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555">. If specified, the value of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">version</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute </span><span class="rfc2119" id="versioning-considerations.2.7"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:decimal</span></code><span class="deltaxml-old" style="background:#FF5555">. </span><a id="err.inline.S0063"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0063"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0063</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the value of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">version</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is not a </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:decimal</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The version of XProc defined by this specification is “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">3.0</span></code><span class="deltaxml-old" style="background:#FF5555">”.</span></p><p><span class="deltaxml-old" style="background:#FF5555">A pipeline author </span><span class="rfc2119" id="versioning-considerations.4.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> identify the version of XProc on the document element of a pipeline document. </span><a id="err.inline.S0062"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0062"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0062</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a required </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">version</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is not present.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The version identified applies to the element on which the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">version</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute appears and all of its descendants, unless or until another version is explicitly identified.</span></p><p><span class="deltaxml-old" style="background:#FF5555">XProc 3.0 takes a draconian approach to versioning. </span><a id="err.inline.S0060"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0060"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0060</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the processor encounters an explicit request for a version of the language other than “3.0”. </span></p></div></section><section id="syntax" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">14 Syntax Overview</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">This section describes the normative XML syntax of XProc. This syntax is sufficient to represent all the aspects of a pipeline, as set out in the preceding sections. </span><span id="dt-XML" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: XProc is intended to work equally well with [</span><a href="#xml10"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XML 1.0</span></span></a><span class="deltaxml-old" style="background:#FF5555">] and [</span><a href="#xml11"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XML 1.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. Unless otherwise noted, the term “</span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">XML</span></em><span class="deltaxml-old" style="background:#FF5555">” refers equally to both versions.]</span></span><span id="dt-Namespaces-in-XML" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: Unless otherwise noted, the term </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">Namespaces in XML</span></em><span class="deltaxml-old" style="background:#FF5555"> refers equally to [</span><a href="#xmlns10"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Namespaces 1.0</span></span></a><span class="deltaxml-old" style="background:#FF5555">] and [</span><a href="#xmlns11"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Namespaces 1.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">].]</span></span><span id="impl-31"><span class="deltaxml-old" style="background:#FF5555">Support for pipeline documents written in XML 1.1 and pipeline inputs and outputs that use XML 1.1 is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">Elements in a pipeline document represent the pipeline, the steps it contains, the connections between those steps, the steps and connections contained within them, and so on. Each step is represented by an element; a combination of elements and attributes specify how the inputs and outputs of each step are connected and how options are passed. Outside of inline documents (</span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements explicitly or implicitly), text nodes that consist entirely of whitespace and XML comments are ignored. XML processing instructions are also generally ignored. </span><span id="impl-32"><span class="deltaxml-old" style="background:#FF5555">It is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555"> if any processing instructions are significant to an implementation.</span></span><span class="deltaxml-old" style="background:#FF5555"> In an inline document, all markup is treated as if it was a quoted part of the inline document and no special semantics apply except as noted elsewhere in this specification.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Conceptually, we can speak of steps as objects that have inputs and outputs, that are connected together and which may contain additional steps. Syntactically, we need a mechanism for specifying these relationships.</span></p><p><em class="glossterm"><a href="#dt-container"><span class="deltaxml-old" style="background:#FF5555">Containment</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is represented naturally using nesting of XML elements. If a particular element identifies a </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> then the step elements that are its immediate children form its </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The connections between steps are expressed using names and references to those names.</span></p><section id="namespaces" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">14.1 XProc Namespaces</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">There are three namespaces associated with XProc:</span></p><div class="variablelist"><dl><dt><span class="term"><code class="uri"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/ns/xproc</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The namespace of the XProc XML vocabulary described by this specification; by convention, the namespace prefix “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">p:</span></code><span class="deltaxml-old" style="background:#FF5555">” is used for this namespace.</span></p></dd><dt><span class="term"><code class="uri"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/ns/xproc-step</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The namespace used for documents that are inputs to and outputs from several standard and optional steps described in this specification. Some steps, such as </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:http-request</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:store</span></code><span class="deltaxml-old" style="background:#FF5555">, have defined input or output vocabularies. We use this namespace for all of those documents. The conventional prefix “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">c:</span></code><span class="deltaxml-old" style="background:#FF5555">” is used for this namespace.</span></p></dd><dt><span class="term"><code class="uri"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/ns/xproc-error</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The namespace used for errors. The conventional prefix “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">err:</span></code><span class="deltaxml-old" style="background:#FF5555">” is used for this namespace. </span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">This specification also makes use of the prefix “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:</span></code><span class="deltaxml-old" style="background:#FF5555">” to refer to the [</span><a href="#xmlschema-1"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">W3C XML Schema: Part 1</span></span></a><span class="deltaxml-old" style="background:#FF5555">] namespace </span><code class="uri"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/2001/XMLSchema</span></code><span class="deltaxml-old" style="background:#FF5555"> and the prefix “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xsi:</span></code><span class="deltaxml-old" style="background:#FF5555">” to refer to the namepace </span><code class="uri"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/2001/XMLSchema-instance</span></code></p></div></section><section id="scoping" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">14.2 Scoping of Names</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Names are used to identify step types, steps, ports, options and variables. Step types, options, and variables are named with EQNames. Steps and ports are named with NCNames. The scope of a name is a measure of where it is available in a pipeline. </span><span id="dt-visible" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: If two names are in the same scope, we say that they are </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">visible</span></em><span class="deltaxml-old" style="background:#FF5555"> to each other. ]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">Six kinds of things are named in XProc:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><span class="deltaxml-old" style="background:#FF5555"> Step types, </span></li><li><span class="deltaxml-old" style="background:#FF5555"> Steps, </span></li><li><span class="deltaxml-old" style="background:#FF5555"> Input ports, </span></li><li><span class="deltaxml-old" style="background:#FF5555"> Output ports, </span></li><li><span class="deltaxml-old" style="background:#FF5555"> Options and variables </span></li></ol></div><p><span class="deltaxml-old" style="background:#FF5555">The scope of the names of the step types is the pipeline in which they are declared, including any declarations imported from libraries via </span><a href="#p.import"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:import</span></code></a><span class="deltaxml-old" style="background:#FF5555">. Nested pipelines inherit the step types in scope for their parent.</span></p><p><span class="deltaxml-old" style="background:#FF5555">In other words, the step types that are in scope in a </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> are:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The standard, built-in types (</span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#p.choose"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code></a><span class="deltaxml-old" style="background:#FF5555">, etc.). </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Any implementation-provided types. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Any step types declared in the </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> children of the pipeline element. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The types of any </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555">s that are imported. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Any types that are in the scope of any </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555"> that is imported. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Any step types that are in scope for the pipeline's parent </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555">, if it has one. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The type of the pipeline itself, if it has one. </span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">The step types that are in scope in a </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555"> are:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The standard, built-in types (</span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#p.choose"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code></a><span class="deltaxml-old" style="background:#FF5555">, etc.). </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Any implementation-provided types. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Any step types declared in the library (the </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> children of the </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element). </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The types of </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555">s that are imported into the library. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Any types that are in the scope of any </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555"> that is imported. </span></p></li></ul></div><p><a id="err.inline.S0036"></a><span class="deltaxml-old" style="background:#FF5555">All the step types in a pipeline or library </span><span class="rfc2119" id="scoping.10.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> have unique names: it is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0036"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0036</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if any step type name is built-in and/or declared or defined more than once in the same scope.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The scope of the names of the steps themselves is determined by the </span><em class="glossterm"><a href="#dt-environment"><span class="deltaxml-old" style="background:#FF5555">environment</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of each step. In general, the name of a step, the names of its sibling steps, the names of any steps that it contains directly, the names of its ancestors, and the names of the siblings of its ancestors are all in a common scope. </span><a id="err.inline.S0002"></a><span class="deltaxml-old" style="background:#FF5555">All steps in the same scope </span><span class="rfc2119" id="scoping.11.2.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> have unique names: it is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0002"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0002</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if two steps with the same name appear in the same scope.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The scope of an input or output port name is the step on which it is defined. The names of all the ports on any step </span><span class="rfc2119" id="scoping.12.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be unique.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Taken together, these uniqueness constraints guarantee that the combination of a step name and a port name uniquely identifies exactly one port on exactly one in-scope step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The scope of option and variable names is determined by where they are declared. When an option is declared with </span><a href="#p.option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> (or a variable with </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555">), unless otherwise specified, its scope consists of the sibling elements that follow its declaration and the descendants of those siblings. </span></p></div></section><section id="xml-base-attribute" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">14.3 Base URIs and xml:base</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">If a relative URI appears in an option of type </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:anyURI</span></code><span class="deltaxml-old" style="background:#FF5555">, the base URI against which it </span><span class="rfc2119" id="xml-base-attribute.2.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be made absolute is the base URI of the </span><a href="#p.option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element. If the option value is specified using a </span><a href="#option-shortcut"><span class="deltaxml-old" style="background:#FF5555">syntactic shortcut</span></a><span class="deltaxml-old" style="background:#FF5555">, the base URI of the step element on which the shortcut attribute appears </span><span class="rfc2119" id="xml-base-attribute.2.5"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be used. In general, whenever a relative URI appears in an </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:anyURI</span></code><span class="deltaxml-old" style="background:#FF5555">, its base URI is the base URI of the nearest ancestor element.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The pipeline author can control the base URIs of elements within the pipeline document with the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">xml:base</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">xml:base</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute </span><span class="rfc2119" id="xml-base-attribute.3.3"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> appear on any element in a pipeline and has the semantics outlined in [</span><a href="#xml-base"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XML Base</span></span></a><span class="deltaxml-old" style="background:#FF5555">].</span></p></div></section><section id="xml-id-attribute" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">14.4 Unique identifiers</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A pipeline author can provide a globally unique identifier for any element in a pipeline with the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">xml:id</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">xml:id</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute </span><span class="rfc2119" id="xml-id-attribute.3.2"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> appear on any element in a pipeline and has the semantics outlined in [</span><a href="#xml-id"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">xml:id</span></span></a><span class="deltaxml-old" style="background:#FF5555">].</span></p></div></section><section id="syntax-docs-ports" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">14.5 Associating Documents with Ports</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555"> A document or a sequence of documents can be connected to a port in four ways: </span><em class="glossterm"><a href="#dt-by-source"><span class="deltaxml-old" style="background:#FF5555">by source</span></a></em><span class="deltaxml-old" style="background:#FF5555">, </span><em class="glossterm"><a href="#dt-by-URI"><span class="deltaxml-old" style="background:#FF5555">by URI</span></a></em><span class="deltaxml-old" style="background:#FF5555">, by providing an </span><em class="glossterm"><a href="#dt-inline-document"><span class="deltaxml-old" style="background:#FF5555">inline document</span></a></em><span class="deltaxml-old" style="background:#FF5555">, or by making it </span><em class="glossterm"><a href="#dt-empty-sequence"><span class="deltaxml-old" style="background:#FF5555">explicitly empty</span></a></em><span class="deltaxml-old" style="background:#FF5555">. Each of these mechanisms is allowed where connections may be made, except that </span><a href="#p.input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:input</span></code></a><span class="deltaxml-old" style="background:#FF5555"> may not include a connection </span><em class="glossterm"><a href="#dt-by-source"><span class="deltaxml-old" style="background:#FF5555">by source</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p><div class="variablelist"><dl><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Specified by URI</span></span></dt><dd><p><span id="dt-by-URI" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A document is specified </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">by URI</span></em><span class="deltaxml-old" style="background:#FF5555"> if it is referenced with a URI.]</span></span><span class="deltaxml-old" style="background:#FF5555"> The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute on the </span><a href="#p.document"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element is used to refer to documents by URI.</span></p><p><span class="deltaxml-old" style="background:#FF5555">In this example, the input to the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:identity</span></code><span class="deltaxml-old" style="background:#FF5555"> step named “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">otherstep</span></code><span class="deltaxml-old" style="background:#FF5555">” comes from “</span><code class="uri"><span class="deltaxml-old" style="background:#FF5555">http://example.com/input.xml</span></code><span class="deltaxml-old" style="background:#FF5555">”. </span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:output port="result"/&gt; &lt;p:identity name="otherstep"&gt; &lt;p:with-input port="source"&gt; &lt;p:document href="http://example.com/input.xml"/&gt; &lt;/p:with-input&gt; &lt;/p:identity&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">See the description of </span><a href="#p.document"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code></a><span class="deltaxml-old" style="background:#FF5555"> for a complete description of how URIs may be specified.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Specified by source</span></span></dt><dd><p><span id="dt-by-source" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A document is specified </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">by source</span></em><span class="deltaxml-old" style="background:#FF5555"> if it references a specific port on another step.]</span></span><span class="deltaxml-old" style="background:#FF5555"> The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">step</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">port</span></code><span class="deltaxml-old" style="background:#FF5555"> attributes on the </span><a href="#p.pipe"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element are used for this purpose. </span></p><p><span class="deltaxml-old" style="background:#FF5555">In this example, the “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">source</span></code><span class="deltaxml-old" style="background:#FF5555">” input to the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:xinclude</span></code><span class="deltaxml-old" style="background:#FF5555"> step named “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">expand</span></code><span class="deltaxml-old" style="background:#FF5555">” comes from the “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">result</span></code><span class="deltaxml-old" style="background:#FF5555">” port of the step named “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">otherstep</span></code><span class="deltaxml-old" style="background:#FF5555">”.</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;!-- there's no otherstep so this isn't expected to work... --&gt; &lt;p:xinclude name="expand"&gt; &lt;p:with-input port="source"&gt; &lt;p:pipe step="otherstep" port="result"/&gt; &lt;/p:with-input&gt; &lt;/p:xinclude&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">See the description of </span><a href="#p.pipe"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code></a><span class="deltaxml-old" style="background:#FF5555"> for a complete description of the ports that can be connected.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Specified inline</span></span></dt><dd><p><span id="dt-inline-document" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: An </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">inline document</span></em><span class="deltaxml-old" style="background:#FF5555"> is specified directly in the body of the element to which it connects.]</span></span><span class="deltaxml-old" style="background:#FF5555"> The content of the </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element is used for this purpose. </span></p><p><span class="deltaxml-old" style="background:#FF5555">In this example, the “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">stylesheet</span></code><span class="deltaxml-old" style="background:#FF5555">” input to the XSLT step named “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xform</span></code><span class="deltaxml-old" style="background:#FF5555">” comes from the content of the </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element itself.</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:xslt name="xform"&gt; &lt;p:with-input port="stylesheet"&gt; &lt;p:inline&gt; &lt;xsl:stylesheet version="1.0"&gt; ... &lt;/xsl:stylesheet&gt; &lt;/p:inline&gt; &lt;/p:with-input&gt; &lt;/p:xslt&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">Inline documents are considered “quoted”. The pipeline processor passes them literally to the port, even if they contain elements from the XProc namespace or other namespaces that would have other semantics outside of the </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See the description of </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> for a complete description of how inline documents may be specified.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Specified explicitly empty</span></span></dt><dd><p><span id="dt-empty-sequence" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: An </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">empty sequence</span></em><span class="deltaxml-old" style="background:#FF5555"> of documents is specified with the </span><a href="#p.empty"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element.]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">In this example, the “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">source</span></code><span class="deltaxml-old" style="background:#FF5555">” input to the XSLT 2.0 step named “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">generate</span></code><span class="deltaxml-old" style="background:#FF5555">” is explicitly empty:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:xslt name="generate" version="2.0"&gt; &lt;p:with-input port="source"&gt; &lt;p:empty/&gt; &lt;/p:with-input&gt; &lt;p:with-input port="stylesheet"&gt; &lt;p:inline&gt; &lt;xsl:stylesheet version="2.0"&gt; ... &lt;/xsl:stylesheet&gt; &lt;/p:inline&gt; &lt;/p:with-input&gt; &lt;p:with-option name="template-name" select="'someName'"/&gt; &lt;/p:xslt&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">If you omit the connection on a primary input port, a connection to the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> will be assumed. Making the connection explicitly empty guarantees that the connection will be to an empty sequence of documents.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See the description of </span><a href="#p.empty"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></code></a><span class="deltaxml-old" style="background:#FF5555"> for a complete description of empty connections.</span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">Note that a </span><a href="#p.input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:input</span></code></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">, or </span><a href="#p.output"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element may contain more than one </span><a href="#p.pipe"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#p.document"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code></a><span class="deltaxml-old" style="background:#FF5555">, or </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element. If more than one </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is provided, then the specified sequence of documents is made available on that port in the same order as the connections.</span></p></div></section><section id="documentation" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">14.6 Documentation</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Pipeline authors may add documentation to their pipeline documents with the </span><a href="#p.documentation"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:documentation</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element. Except when it appears as a descendant of </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">, the </span><a href="#p.documentation"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:documentation</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element is completely ignored by pipeline processors, it exists simply for documentation purposes. If a </span><a href="#p.documentation"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:documentation</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is provided as a descendant of </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">, it has no special semantics, it is treated literally as part of the document to be provided on that port. The </span><a href="#p.documentation"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:documentation</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element has no special semantics when it appears in documents that flow through the pipeline.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Pipeline processors that inspect the contents of </span><a href="#p.documentation"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:documentation</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements and behave differently on the basis of what they find are </span><em><span class="deltaxml-old" style="background:#FF5555">not conformant</span></em><span class="deltaxml-old" style="background:#FF5555">. Processor extensions </span><span class="rfc2119" id="documentation.3.3"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be specified with </span><a href="#p.pipeinfo"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></div></section><section id="annotations" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">14.7 Processor annotations</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Pipeline authors may add annotations to their pipeline documents with the </span><a href="#p.pipeinfo"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element. </span><span id="impl-33"><span class="deltaxml-old" style="background:#FF5555">The semantics of </span><a href="#p.pipeinfo"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements are </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span><span class="deltaxml-old" style="background:#FF5555"> Processors </span><span class="rfc2119" id="annotations.2.3"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> specify a way for their annotations to be identified, perhaps with </span><a href="#extension-attributes"><span class="deltaxml-old" style="background:#FF5555">extension attributes</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Where </span><a href="#p.documentation"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:documentation</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is intended for human consumption, </span><a href="#p.pipeinfo"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements are intended for processor consumption. A processor might, for example, use annotations to identify some particular aspect of an implementation, to request additional, perhaps non-standard features, to describe parallelism constraints, etc.</span></p><p><span class="deltaxml-old" style="background:#FF5555">When a </span><a href="#p.pipeinfo"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></code></a><span class="deltaxml-old" style="background:#FF5555"> appears as a descendant of </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">, it has no special semantics; in that context it </span><span class="rfc2119" id="annotations.4.3"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be treated literally as part of the document to be provided on that port. The </span><a href="#p.pipeinfo"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element has no special semantics when it appears in documents that flow through the pipeline. </span></p></div></section><section id="extension-attributes" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">14.8 Extension attributes</span></h3></div><div class="content"><p><span id="dt-extension-attribute" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: An element from the XProc namespace </span><span class="rfc2119" id="dt-extension-attribute.1"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> have any attribute not from the XProc namespace, provided that the expanded-QName of the attribute has a non-null namespace URI. Such an attribute is called an </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">extension attribute</span></em><span class="deltaxml-old" style="background:#FF5555">.]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">The presence of an extension attribute must not cause the connections between steps to differ from the connections that would arise in the absence of the attribute. They must not cause the processor to fail to signal an error that would be signaled in the absence of the attribute.</span></p><p><span class="deltaxml-old" style="background:#FF5555">A processor which encounters an extension attribute that it does not implement </span><span class="rfc2119" id="extension-attributes.4.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> behave as if the attribute was not present.</span></p></div></section><section id="common-attr" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">14.9 Common Attributes</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Several attributes can be used on any XProc step, or even any element in a pipeline. For convenience, they are all summarized here.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Attributes from the XML namespace are allowed anywhere. In particular:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">An </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">xml:id</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is allowed on any element. It has the semantics of [</span><a href="#xml-id"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">xml:id</span></span></a><span class="deltaxml-old" style="background:#FF5555">].</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">An </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">xml:base</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is allowed on any element. It has the semantics of [</span><a href="#xml-base"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XML Base</span></span></a><span class="deltaxml-old" style="background:#FF5555">].</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">The remaining elements are sometimes in no namespace and sometimes explicitly in the XProc namespace. They are in no namespace when they appear on an XProc element; they are in the XProc namespace when they are on an element in any other namespace. In this way, they do not conflict with the names used in other vocabularies. </span><a id="err.inline.S0097"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0097"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0097</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if an attribute in the XProc namespace appears on an element in the XProc namespace. </span></p><section id="expand-text-attribute" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">14.9.1 Expand text attributes</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]inline-expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> attributes control whether or not text and attribute nodes in descendant </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements and implicit inlines are designated as value templates. Note that they control both text </span><em><span class="deltaxml-old" style="background:#FF5555">and</span></em><span class="deltaxml-old" style="background:#FF5555"> attribute value templates.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute can appear on all elements in the pipeline. It controls whether or not descendant inlines are designated as value templates. If the attribute </span><em><span class="deltaxml-old" style="background:#FF5555">itself</span></em><span class="deltaxml-old" style="background:#FF5555"> appears among the descendants of a </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> (or implicit inline), then it is a regular attribute and has no special semantics. In this case, the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]inline-expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute comes into play. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]inline-expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute appearing as descendant of a </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or in an implicit inline is treated as a special attribute, with the same semantics as the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. The attribute will not be part of the result of the </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or implicit inline.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> or </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]inline-expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute appears on more than one element among the ancestors of a text or attribute node in a </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element or implicit inline, only the value on the nearest ancestor is considered.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If the nearest </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> or </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]inline-expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute has the value “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">false</span></code><span class="deltaxml-old" style="background:#FF5555">”, then the text and attribute nodes in a </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element or implicit inline are not value templates. If it has the value “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">true</span></code><span class="deltaxml-old" style="background:#FF5555">”, or if no such attribute is present among ancestors, then the text and attribute nodes </span><em><span class="deltaxml-old" style="background:#FF5555">are</span></em><span class="deltaxml-old" style="background:#FF5555"> value templates.</span></p></div></section><section id="use-when" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">14.9.2 Conditional Element Exclusion</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]use-when</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute controls whether or not an element (and its descendants) appear in the pipeline. The value of the attribute </span><span class="rfc2119" id="p.use-when.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> contain an XPath expression that can be evaluated statically (See </span><a href="#statics" title="Static Options and Variables"><span class="deltaxml-old" style="background:#FF5555">Section 11.3, “Static Options and Variables”</span></a><span class="deltaxml-old" style="background:#FF5555">.) </span><span id="dt-effectively-excluded" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: If the effective boolean value of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]use-when</span></code><span class="deltaxml-old" style="background:#FF5555"> expression is false, then the element and all of its descendants are </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">effectively excluded</span></em><span class="deltaxml-old" style="background:#FF5555"> from the pipeline document.]</span></span><span class="deltaxml-old" style="background:#FF5555"> If a node is effectively excluded, the processor </span><span class="rfc2119" id="p.use-when.5"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> behave as if the element was not present in the document. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Conditional element exclusion occurs during </span><a href="#initiating"><span class="deltaxml-old" style="background:#FF5555">static analysis</span></a><span class="deltaxml-old" style="background:#FF5555"> of the pipeline.</span></p><div id="note-excl-use-when" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">The effective exclusion of </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]use-when</span></code><span class="deltaxml-old" style="background:#FF5555"> processing occurs after XML parsing and has no effect on well-formedness or validation errors which will be reported in the usual way.</span></p></div></div></div></section><section id="depends" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">14.9.3 Additional dependent connections</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]depends</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute can appear on any step invocation. It adds an explicit dependency between steps. The value of the attribute is a space separated list of step names. </span><a id="err.inline.S0073"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0073"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0073</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if any specified name is not the name of an in-scope step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">In most pipelines, the dependencies that arise naturally from the connections between steps are sufficient. If step “B” consumes the output of step “A”, then clearly “A” must run before “B”. However, it is sometimes the case that one step depends on another in ways that are not apparent in the connections. Consider, for example, a pipeline that interacts with two different web services. It may very well be the case that one web service has to run before the other, even though the latter does not consume any output from the former.</span></p><p><span class="deltaxml-old" style="background:#FF5555">When </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]depends</span></code><span class="deltaxml-old" style="background:#FF5555"> is used, if step “Y” depends on step “X”, then “X” must run before “Y”. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The connections specified by the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]depends</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute apply </span><em><span class="deltaxml-old" style="background:#FF5555">in addition to</span></em><span class="deltaxml-old" style="background:#FF5555"> the dependencies that arise naturally from connections between steps. Taken together with the input and output connections, the graph must not contain any loops. </span></p></div></section><section id="timeout" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">14.9.4 Controlling long running steps</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]timeout</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute allows a pipeline author to suggest a length of time beyond which the pipeline processor should consider that a step has taken an excessive amount of time.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The value of the </span><code class="option"><span class="deltaxml-old" style="background:#FF5555">[p:]timeout</span></code><span class="deltaxml-old" style="background:#FF5555"> option must be a </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:nonNegativeInteger</span></code><span class="deltaxml-old" style="background:#FF5555">. It is interpreted as a number of seconds. The value zero may be used to indicate that no limit is expressed (this is the same as omitting the attribute, but may sometimes be more convenient for pipeline authors). </span></p><p><a id="err.inline.D0053"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0053"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0053</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a step runs longer than its timeout value.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The precise amount of time a step takes to perform its task depends on many factors (the hardware running the processor, the processor's execution strategy, the system load etc.) This feature can not be used as an exact timing tool in XProc. Developers are advised to calculate the value for </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]timeout</span></code><span class="deltaxml-old" style="background:#FF5555"> generously, so the dynamic error is raised only in extreme cases.</span></p><p><span id="impl-34"><span class="deltaxml-old" style="background:#FF5555">It is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555"> whether a processor supports timeouts, and if it does, how precisely and precisely how the execution time of a step is measured.</span></span></p></div></section><section id="messages" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">14.9.5 Status and debugging output</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]message</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute can appear on any step invocation. It’s value is treated as an attribute value template (irrespective of any enclosing </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> setting) and the computed value is made available.</span></p><p><span id="impl-35"><span class="deltaxml-old" style="background:#FF5555">Precisely what “made available” means is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span><span class="deltaxml-old" style="background:#FF5555"> It will often be as simple as printing the message on some output channel. But for embedded systems or other environments where “print it for the user” is meaningless or inconvenient, some other mechanism may be used. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If a processor can make the message available, it </span><span class="rfc2119" id="messages.4.1"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> do so before execution of the step begins.</span></p></div></section></div></section><section id="syntax-summaries" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">14.10 Syntax Summaries</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The description of each element in the pipeline namespace is accompanied by a syntactic summary that provides a quick overview of the element's syntax:</span></p><p class="element-syntax element-syntax-language-example"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:some-element</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">reqd-attribute</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">some-type</span></var><span class="deltaxml-old" style="background:#FF5555">  some-attribute? = </span><var><span class="deltaxml-old" style="background:#FF5555">some-type</span></var><span class="deltaxml-old" style="background:#FF5555">  avt-attribute? = { </span><var><span class="deltaxml-old" style="background:#FF5555">some-type</span></var><span class="deltaxml-old" style="background:#FF5555"> }&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><var><span class="deltaxml-old" style="background:#FF5555">some</span></var><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">elements</span></var><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">allowed</span></var><span class="deltaxml-old" style="background:#FF5555">)*,</span><span class="deltaxml-old" style="background:#FF5555">    </span><var><span class="deltaxml-old" style="background:#FF5555">other-elements?</span></var><span class="deltaxml-old" style="background:#FF5555">&lt;/p:some-element&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The content model fragments in these tableaux are presented in a simple, compact notation. In brief:</span></p><div class="variablelist"><dl><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Attributes</span></span></dt><dd><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">Required attributes are bold. Optional attributes are followed by a question mark.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If an attribute value is an attribute value template, its type is shown in curly brackets: “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">{ some-type }</span></code><span class="deltaxml-old" style="background:#FF5555">”. If </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">some-type</span></code><span class="deltaxml-old" style="background:#FF5555"> is </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555"> or a map type with key type </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555"> the conversion described in </span><a href="#qname-handling" title="QName handling"><span class="deltaxml-old" style="background:#FF5555">Section 11.5, “QName handling”</span></a><span class="deltaxml-old" style="background:#FF5555"> applies.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">An attribute value with a map type marks an </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></code><span class="deltaxml-old" style="background:#FF5555"> expected to deliver a map of the indicated type. If the map type has key type </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555"> the conversion described in </span><a href="#qname-handling" title="QName handling"><span class="deltaxml-old" style="background:#FF5555">Section 11.5, “QName handling”</span></a><span class="deltaxml-old" style="background:#FF5555"> applies.</span></p></li></ul></div></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Elements</span></span></dt><dd><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">A name represent exactly one occurrence of an element with that name.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Parentheses are used for grouping. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Elements or groups separated by a comma (“,”) represent an ordered sequence: a followed by b followed by c: (a,b,c).</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Elements or groups separated by a vertical bar (“|”) represent a choice: a or b or c: (a | b | c).</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Elements or groups separated by an ampersand (“&amp;”) represent an unordered sequence: a and b and c, in any order: (a &amp; b &amp; c).</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">An element or group followed by a question mark (“?”) is optional; it may or may not occur but if it occurs it can occur only once.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">An element or group followed by an asterisk (“*”) is optional and may be repeated; it may or may not occur and if it occurs it can occur any number of times. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">An element or group followed by a plus (“+”) is required and may be repeated; it must occur at least once, and it can occur any number of times. </span></p></li></ul></div></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">For clarity of exposition, the common attributes (see </span><a href="#common-attr" title="Common Attributes"><span class="deltaxml-old" style="background:#FF5555">Section 14.9, “Common Attributes”</span></a><span class="deltaxml-old" style="background:#FF5555">) are elided from the summaries as are the </span><a href="#p.documentation"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:documentation</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#p.pipeinfo"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements, which are allowed anywhere, and attributes that are </span><a href="#option-shortcut"><span class="deltaxml-old" style="background:#FF5555">syntactic shortcuts for option values</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The types given for attributes should be understood as follows:</span></p><div class="itemizedlist"><ul><li><p><code class="type"><span class="deltaxml-old" style="background:#FF5555">ID</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">NCName</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">NMTOKEN</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">NMTOKENS</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">anyURI</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">boolean</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">integer</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">string</span></code><span class="deltaxml-old" style="background:#FF5555">: As per [</span><a href="#xmlschema-2"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">W3C XML Schema: Part 2</span></span></a><span class="deltaxml-old" style="background:#FF5555">] including whitespace normalization as appropriate.</span></p></li><li><p><code class="type"><span class="deltaxml-old" style="background:#FF5555">EQName</span></code><span class="deltaxml-old" style="background:#FF5555">: With whitespace normalization as per [</span><a href="#xmlschema-2"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">W3C XML Schema: Part 2</span></span></a><span class="deltaxml-old" style="background:#FF5555">] for QNames. Note, however, that QNames that have no prefix are always in no-namespace, irrespective of the default namespace. </span></p></li><li><p><code class="type"><span class="deltaxml-old" style="background:#FF5555">EQNameList</span></code><span class="deltaxml-old" style="background:#FF5555">: As a whitespace separated list of EQNames, per the definition above. </span></p></li><li><p><code class="type"><span class="deltaxml-old" style="background:#FF5555">PrefixList</span></code><span class="deltaxml-old" style="background:#FF5555">: As a list with </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[item type]</span></code><code class="type"><span class="deltaxml-old" style="background:#FF5555">NMTOKEN</span></code><span class="deltaxml-old" style="background:#FF5555">, per [</span><a href="#xmlschema-2"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">W3C XML Schema: Part 2</span></span></a><span class="deltaxml-old" style="background:#FF5555">], including whitespace normalization. </span></p></li><li><p><code class="type"><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></code><span class="deltaxml-old" style="background:#FF5555">: As a </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">PrefixList</span></code><span class="deltaxml-old" style="background:#FF5555"> per the definition above, with the following extensions: the tokens </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">#all</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">#default</span></code><span class="deltaxml-old" style="background:#FF5555"> may appear. </span></p></li><li><p><code class="type"><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">XSLTSelectionPattern</span></code><span class="deltaxml-old" style="background:#FF5555">: As a string per [</span><a href="#xmlschema-2"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">W3C XML Schema: Part 2</span></span></a><span class="deltaxml-old" style="background:#FF5555">], including whitespace normalization, and the further requirement to be a conformant Expression per [</span><a href="#xpath31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">] or selection pattern per [</span><a href="#xslt30"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XSLT 3.0</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. </span></p></li><li><p><code class="type"><span class="deltaxml-old" style="background:#FF5555">MediaTypes</span></code><span class="deltaxml-old" style="background:#FF5555">: As a whitespace separated list of media types as defined in [</span><a href="#rfc2046"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 2046</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. </span></p></li></ul></div></div></section><section id="common-errors" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">14.11 Common errors</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A number of errors apply generally:</span></p><div class="itemizedlist"><ul><li><p><a id="err.inline.S0059"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0059"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0059</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the pipeline element is not </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></li><li><p><a id="err.inline.S0008"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0008"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0008</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if any element in the XProc namespace has attributes not defined by this specification unless they are </span><em class="glossterm"><a href="#dt-extension-attribute"><span class="deltaxml-old" style="background:#FF5555">extension attributes</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span></p></li><li><p><a id="err.inline.S0038"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0038"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0038</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if any required attribute is not provided. </span></p></li><li><p><a id="err.inline.S0077"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0077"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0077</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the value on an attribute of an XProc element does not satisfy the type required for that attribute. </span></p></li><li><p><a id="err.inline.D0028"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0028"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0028</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if any attribute value does not satisfy the type required for that attribute.</span></p></li><li><p><a id="err.inline.S0044"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0044"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0044</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if any step contains an atomic step for which there is no visible declaration.</span></p></li><li><p><a id="err.inline.S0037"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0037"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0037</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if any user extension step or any element in the XProc namespace other than </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> directly contains text nodes that do not consist entirely of whitespace. </span></p></li><li><p><a id="err.inline.D0019"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0019"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0019</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if any option value does not satisfy the type required for that option. </span></p></li><li><p><a id="err.inline.S0015"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0015"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0015</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a compound step has no </span><em class="glossterm"><a href="#dt-contained-steps"><span class="deltaxml-old" style="background:#FF5555">contained steps</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span></p></li><li><p><a id="err.inline.D0012"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0012"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0012</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if any attempt is made to dereference a URI where the scheme of the URI reference is not supported. Implementations are encouraged to support as many schemes as is practical and, in particular, they </span><span class="rfc2119" id="common-errors.3.10.1.2"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> support both the </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">file:</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">http(s):</span></code><span class="deltaxml-old" style="background:#FF5555"> schemes. </span><span id="impl-36"><span class="deltaxml-old" style="background:#FF5555">The set of URI schemes actually supported is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></li><li><p><a id="err.inline.D0030"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0030"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0030</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a step is unable or incapable of performing its function. This is a general error code for “step failed” (e.g., if the input isn't of the expected type or if attempting to process the input causes the implementation to abort). Users and implementers who create extension steps are encouraged to use this code for general failures.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">In most steps which use a select expression or match pattern, any kind of node can be identified by the expression or pattern. However, some expressions and patterns on some steps are only applicable to some kinds of nodes (e.g., it doesn't make sense to speak of adding attributes to a comment!). </span></p><p><a id="err.inline.C0023"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.C0023"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XC0023</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a select expression or match pattern returns a node type that is not allowed by the step. </span></p></li><li><p><a id="err.inline.S0100"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0100"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0100</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the pipeline document does not conform to the grammar for pipeline documents. This is a general error code indicating that the pipeline is syntactically incorrect in some way not identified more precisely in this specification. </span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">If an XProc processor can determine statically that a dynamic error will </span><em><span class="deltaxml-old" style="background:#FF5555">always</span></em><span class="deltaxml-old" style="background:#FF5555"> occur, it </span><span class="rfc2119" id="common-errors.4.2"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> report that error statically provided that the error </span><em><span class="deltaxml-old" style="background:#FF5555">does not</span></em><span class="deltaxml-old" style="background:#FF5555"> occur among the descendants of a </span><a href="#p.try"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code></a><span class="deltaxml-old" style="background:#FF5555">. Dynamic errors inside a </span><a href="#p.try"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code></a><span class="rfc2119" id="common-errors.4.6"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> be reported statically. They must be raised dynamically so that </span><a href="#p.catch"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code></a><span class="deltaxml-old" style="background:#FF5555"> processing can be performed on them. </span></p></div></section></div></section><section id="language" class="section"><div class="section-titlepage"><h2><span class="deltaxml-new" style="background:#90EE90">2 XProc 3.0</span></h2></div><div class="content"><p><span class="deltaxml-new" style="background:#90EE90">XProc 3.0 is defined normatively by two specifications:</span></p><div class="itemizedlist"><ul><li><p><cite><a href="xproc/"><span class="deltaxml-new" style="background:#90EE90">XProc 3.0: An XML Pipeline Language</span></a></cite><span class="deltaxml-new" style="background:#90EE90"> defines the semantics of XProc pipelines.</span></p></li><li><p><cite><a href="steps/"><span class="deltaxml-new" style="background:#90EE90">XProc 3.0: Standard Step Library</span></a></cite><span class="deltaxml-new" style="background:#90EE90"> defines the required atomic steps. All conformant implementations implement these steps. </span></p></li></ul></div></div></section><section class="section" id="steps"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">15 Steps</span></h2><h2><span class="deltaxml-new" style="background:#90EE90">3 Additional Steps</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">This section describes the core language steps of XProc; the full vocabulary of standard, atomic steps is described in [</span><a href="#steps30"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Steps 3.0</span></span></a><span class="deltaxml-old" style="background:#FF5555">].</span></p><section id="pipelines" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">15.1 Pipelines</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The document element of a pipeline document is </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> which declares a pipeline that can be evaluated by an XProc processor.</span></p><p><span class="deltaxml-old" style="background:#FF5555">It encapsulates the behavior of a </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555">. Its children declare inputs, outputs, and options that the pipeline exposes and identify the steps in its subpipeline. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Viewed from the outside, a </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is a black box which performs some calculation on its inputs and produces its outputs. From the pipeline author's perspective, the computation performed by the pipeline is described in terms of </span><em class="glossterm"><a href="#dt-contained-steps"><span class="deltaxml-old" style="background:#FF5555">contained steps</span></a></em><span class="deltaxml-old" style="background:#FF5555"> which read the pipeline's inputs and produce the pipeline's outputs.</span></p><p><span class="deltaxml-old" style="background:#FF5555">A </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element can also be nested inside other </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements in which case it simply declares a pipeline that will be run elsewhere.</span></p><p><span class="deltaxml-old" style="background:#FF5555">For more details, see </span><a href="#p.declare-step" title="p:declare-step"><span class="deltaxml-old" style="background:#FF5555">Section 16.5, “p:declare-step”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><section id="example-pipeline" class="section tocsuppress"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">15.1.1 Example</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A pipeline might accept a document as input; perform XInclude, validation, and transformation; and produce the transformed document as its output.</span></p><figure id="ex.p.pipeline" class="example-wrapper"><div class="title"><span class="deltaxml-old" style="background:#FF5555">Example 4. A Sample Pipeline Document</span></div><div class="example"><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt; &lt;p:input port="source"/&gt; &lt;p:output port="result"/&gt; &lt;p:xinclude/&gt; &lt;p:validate-with-xml-schema&gt; &lt;p:with-input port="schema"&gt; &lt;p:document href="http://example.com/path/to/schema.xsd"/&gt; &lt;/p:with-input&gt; &lt;/p:validate-with-xml-schema&gt; &lt;p:xslt&gt; &lt;p:with-input port="stylesheet"&gt; &lt;p:document href="http://example.com/path/to/stylesheet.xsl"/&gt; &lt;/p:with-input&gt; &lt;/p:xslt&gt; &lt;/p:declare-step&gt;</span></code></pre></div></figure></div></section></div></section><section id="p.for-each" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">15.2 p:for-each</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A for-each is specified by the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> element. It is a </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> that processes a sequence of documents, applying its </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555"> to each document in turn.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:for-each</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555">? &amp; </span><span class="deltaxml-old" style="background:#FF5555">      </span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*),</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:for-each&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">When a pipeline needs to process a sequence of documents using a subpipeline that only processes a single document, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> construct can be used as a wrapper around that subpipeline. The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> will apply that subpipeline to each document in the sequence in turn.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The result of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> is a sequence of documents produced by processing each individual document in the input sequence. If the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> has one or more output ports, what appears on each of those ports is the sequence of documents that is the concatenation of the sequence produced by each iteration of the loop on the port to which it is connected. If the iteration source for a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> is an empty sequence, then the subpipeline is never run and an empty sequence is produced on all of the outputs. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> has a single anonymous input: its </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is provided by the </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">. If no iteration sequence is explicitly provided, then the iteration source is read from the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The processor provides each document, one at a time, to the </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555"> represented by the children of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> on a port named </span><code class="port"><span class="deltaxml-old" style="background:#FF5555">current</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">For each declared output, the processor collects all the documents that are produced for that output from all the iterations, in order, into a sequence. The result of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> on that output is that sequence of documents.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The environment inherited by the </span><em class="glossterm"><a href="#dt-contained-steps"><span class="deltaxml-old" style="background:#FF5555">contained steps</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> is the </span><em class="glossterm"><a href="#dt-inherited-environment"><span class="deltaxml-old" style="background:#FF5555">inherited environment</span></a></em><span class="deltaxml-old" style="background:#FF5555"> with these modifications:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The port named “</span><code class="port"><span class="deltaxml-old" style="background:#FF5555">current</span></code><span class="deltaxml-old" style="background:#FF5555">” on the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> is added to the </span><em class="glossterm"><a href="#dt-readable-ports"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The port named “</span><code class="port"><span class="deltaxml-old" style="background:#FF5555">current</span></code><span class="deltaxml-old" style="background:#FF5555">” on the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> is made the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">If the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> has a </span><em class="glossterm"><a href="#dt-primary-output-port"><span class="deltaxml-old" style="background:#FF5555">primary output port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (explicit or </span><a href="#primary-input-output"><span class="deltaxml-old" style="background:#FF5555">supplied by default</span></a><span class="deltaxml-old" style="background:#FF5555">) and that port has no </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555">, then it is connected to the </span><em class="glossterm"><a href="#dt-primary-output-port"><span class="deltaxml-old" style="background:#FF5555">primary output port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the </span><em class="glossterm"><a href="#dt-last-step"><span class="deltaxml-old" style="background:#FF5555">last step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> in the </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span><a id="err.inline.S0006"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0006"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0006</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the primary output port has no explicit connection and the </span><em class="glossterm"><a href="#dt-last-step"><span class="deltaxml-old" style="background:#FF5555">last step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> in the subpipeline does not have a primary output port.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Note that outputs declared for a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> serve a dual role. Inside the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555">, they are used to read results from the subpipeline. Outside the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555">, they provide the aggregated results.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">sequence</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute on a </span><a href="#p.output"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code></a><span class="deltaxml-old" style="background:#FF5555"> inside a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code><span class="deltaxml-old" style="background:#FF5555"> only applies inside the step. From the outside, all of the outputs produce sequences.</span></p><section id="for-each-xpath-context" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">15.2.1 XPath Context</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Within a </span><a href="#p.for-each"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code></a><span class="deltaxml-old" style="background:#FF5555">, the </span><a href="#f.iteration-position"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-position</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#f.iteration-size"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-size</span></code></a><span class="deltaxml-old" style="background:#FF5555"> are taken from the sequence of documents that will be processed by the </span><a href="#p.for-each"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code></a><span class="deltaxml-old" style="background:#FF5555">. The total number of documents is the </span><a href="#f.iteration-size"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-size</span></code></a><span class="deltaxml-old" style="background:#FF5555">; the ordinal value of the current document (the document appearing on the </span><code class="port"><span class="deltaxml-old" style="background:#FF5555">current</span></code><span class="deltaxml-old" style="background:#FF5555"> port) is the </span><a href="#f.iteration-position"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-position</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><div id="impl1" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note to implementers</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">In the case where no XPath expression that must be evaluated by the processor makes any reference to </span><a href="#f.iteration-size"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-size</span></code></a><span class="deltaxml-old" style="background:#FF5555">, its value does not actually have to be calculated (and the entire input sequence does not, therefore, need to be buffered so that its size can be calculated before processing begins).</span></p></div></div></div></section><section id="example-for-each" class="section tocsuppress"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">15.2.2 Example</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><a href="#p.for-each"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code></a><span class="deltaxml-old" style="background:#FF5555"> might accept a sequence of chapters as its input, process each chapter in turn with XSLT, a step that accepts only a single input document, and produce a sequence of formatted chapters as its output.</span></p><figure id="ex.p.for-each" class="example-wrapper"><div class="title"><span class="deltaxml-old" style="background:#FF5555">Example 5. A Sample For-Each</span></div><div class="example"><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:for-each name="chapters"&gt; &lt;p:with-input select="//chapter"/&gt; &lt;p:output port="html-results"&gt; &lt;p:pipe step="make-html" port="result"/&gt; &lt;/p:output&gt; &lt;p:output port="fo-results"&gt; &lt;p:pipe step="make-fo" port="result"/&gt; &lt;/p:output&gt; &lt;p:xslt name="make-html"&gt; &lt;p:with-input port="stylesheet" href="http://example.com/xsl/html.xsl"/&gt; &lt;/p:xslt&gt; &lt;p:xslt name="make-fo"&gt; &lt;p:with-input port="source" pipe="chapters@current"/&gt; &lt;p:with-input port="stylesheet" href="http://example.com/xsl/fo.xsl"/&gt; &lt;/p:xslt&gt; &lt;/p:for-each&gt;</span></code></pre></div></figure><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">//chapter</span></code><span class="deltaxml-old" style="background:#FF5555"> elements of the document are selected. Each chapter is transformed into HTML and XSL Formatting Objects using an XSLT step. The resulting HTML and FO documents are aggregated together and appear on the </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">html-results</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">fo-results</span></code><span class="deltaxml-old" style="background:#FF5555"> ports, respectively, of the </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">chapters</span></code><span class="deltaxml-old" style="background:#FF5555"> step itself.</span></p></div></section></div></section><section id="p.viewport" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">15.3 p:viewport</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A viewport is specified by the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> element. It is a </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> that processes a single XML document, applying its </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555"> to one or more subtrees of the document. </span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:viewport</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">match</span></strong><span class="deltaxml-old" style="background:#FF5555"> = { </span><var><span class="deltaxml-old" style="background:#FF5555">XSLTSelectionPattern</span></var><span class="deltaxml-old" style="background:#FF5555"> }&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555">? &amp; </span><span class="deltaxml-old" style="background:#FF5555">      </span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">?),</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:viewport&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The result of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> is a copy of the original document where the selected subtrees have been replaced by the results of applying the subpipeline to them.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> has a single anonymous input: its </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is provided by the </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">. If no document is explicitly provided, then the viewport source is read from the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555">. If the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> input is a sequence, each document in the sequence is processed in turn producing a sequence on the output.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">match</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute specifies an XSLT match pattern. Each matching node in the source document is wrapped in a document node, as necessary, and provided, one at a time, to the viewport's </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555"> on a port named </span><code class="port"><span class="deltaxml-old" style="background:#FF5555">current</span></code><span class="deltaxml-old" style="background:#FF5555">. The base URI of the resulting document that is passed to the subpipeline is the base URI of the matched element or document. </span><a id="err.inline.D0010"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0010"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0010</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">match</span></code><span class="deltaxml-old" style="background:#FF5555"> expression on </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> does not match an element or document. </span></p><p><span class="deltaxml-old" style="background:#FF5555">After a match is found, the entire subtree rooted at that match is processed as a unit. No further attempts are made to match nodes among the descendants of any matched node.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The environment inherited by the </span><em class="glossterm"><a href="#dt-contained-steps"><span class="deltaxml-old" style="background:#FF5555">contained steps</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> is the </span><em class="glossterm"><a href="#dt-inherited-environment"><span class="deltaxml-old" style="background:#FF5555">inherited environment</span></a></em><span class="deltaxml-old" style="background:#FF5555"> with these modifications:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The port named “</span><code class="port"><span class="deltaxml-old" style="background:#FF5555">current</span></code><span class="deltaxml-old" style="background:#FF5555">” on the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> is added to the </span><em class="glossterm"><a href="#dt-readable-ports"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The port named “</span><code class="port"><span class="deltaxml-old" style="background:#FF5555">current</span></code><span class="deltaxml-old" style="background:#FF5555">” on the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> is made the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> must contain a single, </span><em class="glossterm"><a href="#dt-primary-output-port"><span class="deltaxml-old" style="background:#FF5555">primary output port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> declared explicitly or </span><a href="#primary-input-output"><span class="deltaxml-old" style="background:#FF5555">supplied by default</span></a><span class="deltaxml-old" style="background:#FF5555">. If that port has no </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555">, then it is connected to the </span><em class="glossterm"><a href="#dt-primary-output-port"><span class="deltaxml-old" style="background:#FF5555">primary output port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the </span><em class="glossterm"><a href="#dt-last-step"><span class="deltaxml-old" style="background:#FF5555">last step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> in the </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span><a id="err.inline.S0006.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0006"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0006</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the primary output port is unconnected and the </span><em class="glossterm"><a href="#dt-last-step"><span class="deltaxml-old" style="background:#FF5555">last step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> in the subpipeline does not have a primary output port.</span></p><p><span class="deltaxml-old" style="background:#FF5555">What appears on the output from the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> will be a copy of the input document where each matching node is replaced by the result of applying the subpipeline to the subtree rooted at that node. In other words, if the match pattern matches a particular element then that element is wrapped in a document node and provided on the </span><code class="port"><span class="deltaxml-old" style="background:#FF5555">current</span></code><span class="deltaxml-old" style="background:#FF5555"> port, the subpipeline in the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> is evaluated, and the result that appears on the </span><code class="port"><span class="deltaxml-old" style="background:#FF5555">output</span></code><span class="deltaxml-old" style="background:#FF5555"> port replaces the matched element. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If no documents appear on the </span><code class="port"><span class="deltaxml-old" style="background:#FF5555">output</span></code><span class="deltaxml-old" style="background:#FF5555"> port, the matched element will effectively be deleted. If exactly one document appears, the contents of that document will replace the matched element. If a sequence of documents appears, then the contents of each document in that sequence (in the order it appears in the sequence) will replace the matched element.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The output of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> itself is a single document that appears on a port named “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">result</span></code><span class="deltaxml-old" style="background:#FF5555">”. Note that the semantics of </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> are special. The </span><code class="port"><span class="deltaxml-old" style="background:#FF5555">output</span></code><span class="deltaxml-old" style="background:#FF5555"> port in the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code><span class="deltaxml-old" style="background:#FF5555"> is used only to access the results of the subpipeline. The output of the step itself appears on a port with the fixed name “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">result</span></code><span class="deltaxml-old" style="background:#FF5555">” that is never explicitly declared.</span></p><section id="viewport-xpath-context" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">15.3.1 XPath Context</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Within a </span><a href="#p.viewport"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code></a><span class="deltaxml-old" style="background:#FF5555">, the </span><a href="#f.iteration-position"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-position</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#f.iteration-size"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-size</span></code></a><span class="deltaxml-old" style="background:#FF5555"> are taken from the sequence of documents that will be processed by the </span><a href="#p.viewport"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code></a><span class="deltaxml-old" style="background:#FF5555">. The total number of documents is the </span><a href="#f.iteration-size"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-size</span></code></a><span class="deltaxml-old" style="background:#FF5555">; the ordinal value of the current document (the document appearing on the </span><code class="port"><span class="deltaxml-old" style="background:#FF5555">current</span></code><span class="deltaxml-old" style="background:#FF5555"> port) is the </span><a href="#f.iteration-position"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-position</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><div id="impl2" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note to implementers</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">In the case where no XPath expression that must be evaluated by the processor makes any reference to </span><a href="#f.iteration-size"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:iteration-size</span></code></a><span class="deltaxml-old" style="background:#FF5555">, its value does not actually have to be calculated (and the entire input sequence does not, therefore, need to be buffered so that its size can be calculated before processing begins).</span></p></div></div></div></section><section id="example-viewport" class="section tocsuppress"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">15.3.2 Example</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><a href="#p.viewport"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code></a><span class="deltaxml-old" style="background:#FF5555"> might accept an XHTML document as its input, add an </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">hr</span></code><span class="deltaxml-old" style="background:#FF5555"> element at the beginning of all </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">div</span></code><span class="deltaxml-old" style="background:#FF5555"> elements that have the class value “chapter”, and return an XHTML document that is the same as the original except for that change.</span></p><figure id="ex.p.viewport" class="example-wrapper"><div class="title"><span class="deltaxml-old" style="background:#FF5555">Example 6. A Sample Viewport</span></div><div class="example"><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:viewport match="h:div[@class='chapter']" xmlns:h="http://www.w3.org/1999/xhtml"&gt; &lt;p:insert position="first-child"&gt; &lt;p:with-input port="insertion"&gt; &lt;hr xmlns="http://www.w3.org/1999/xhtml"/&gt; &lt;/p:with-input&gt; &lt;/p:insert&gt; &lt;/p:viewport&gt;</span></code></pre></div></figure><p><span class="deltaxml-old" style="background:#FF5555">The nodes which match </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">h:div[@class='chapter']</span></code><span class="deltaxml-old" style="background:#FF5555"> in the input document are selected. An </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">hr</span></code><span class="deltaxml-old" style="background:#FF5555"> is inserted as the first child of each </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">h:div</span></code><span class="deltaxml-old" style="background:#FF5555"> and the resulting version replaces the original </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">h:div</span></code><span class="deltaxml-old" style="background:#FF5555">. The result of the whole step is a copy of the input document with a horizontal rule as the first child of each selected </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">h:div</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p></div></section></div></section><section id="p.choose" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">15.4 p:choose</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A choose step is specified by the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code><span class="deltaxml-old" style="background:#FF5555"> element. It is a </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> that contains several, alternate subpipelines. One subpipeline is selected based on the evaluation of XPath expressions.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:choose</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555">?,</span><span class="deltaxml-old" style="background:#FF5555">     ((</span><a href="#p.when"><span class="deltaxml-old" style="background:#FF5555">p:when</span></a><span class="deltaxml-old" style="background:#FF5555">+,</span><span class="deltaxml-old" style="background:#FF5555">       </span><a href="#p.otherwise"><span class="deltaxml-old" style="background:#FF5555">p:otherwise</span></a><span class="deltaxml-old" style="background:#FF5555">?) | </span><span class="deltaxml-old" style="background:#FF5555">      (</span><a href="#p.when"><span class="deltaxml-old" style="background:#FF5555">p:when</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">       </span><a href="#p.otherwise"><span class="deltaxml-old" style="background:#FF5555">p:otherwise</span></a><span class="deltaxml-old" style="background:#FF5555">)))</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:choose&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code><span class="deltaxml-old" style="background:#FF5555"> contains an arbitrary number of alternative </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipelines</span></a></em><span class="deltaxml-old" style="background:#FF5555">, exactly one of which will be evaluated. </span><a id="err.inline.S0074"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0074"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0074</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code><span class="deltaxml-old" style="background:#FF5555"> has neither a </span><a href="#p.when"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code></a><span class="deltaxml-old" style="background:#FF5555"> nor a </span><a href="#p.otherwise"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:otherwise</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The list of alternative subpipelines consists of zero or more subpipelines guarded by an XPath expression, followed optionally by a single default subpipeline.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code><span class="deltaxml-old" style="background:#FF5555"> considers each subpipeline in turn and selects the first (and only the first) subpipeline for which the guard expression evaluates to true in its context. After a subpipeline is selected, no further guard expressions are evaluated. If there are no subpipelines for which the expression evaluates to true then, if a default subpipeline was specified, it is selected, otherwise, no subpipeline runs and an empty sequence appears on all of the outputs.</span></p><p><span class="deltaxml-old" style="background:#FF5555">After a </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is selected, it is evaluated as if only it had been present.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The outputs of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code><span class="deltaxml-old" style="background:#FF5555"> are taken from the outputs of the selected </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555">. The outputs </span><em><span class="deltaxml-old" style="background:#FF5555">available</span></em><span class="deltaxml-old" style="background:#FF5555"> from the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code><span class="deltaxml-old" style="background:#FF5555"> are union of all of the outputs declared in any of its alternative subpipelines. In order to maintain consistency with respect to the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555">, if any subpipeline has a </span><em class="glossterm"><a href="#dt-primary-output-port"><span class="deltaxml-old" style="background:#FF5555">primary output port</span></a></em><span class="deltaxml-old" style="background:#FF5555">, even implicitly, then </span><em><span class="deltaxml-old" style="background:#FF5555">every</span></em><span class="deltaxml-old" style="background:#FF5555"> subpipline must have a primary output port with the same name. In some cases, this may require making the implicit primary output explicit in order to assure that it has the same name. </span><a id="err.inline.S0102"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0102"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0102</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if alternative subpipelines have different primary output ports. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Consider a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code><span class="deltaxml-old" style="background:#FF5555"> that has two alternative subpipelines where one declares output ports “A” and “B” and the other declares output ports “B” and “C”. The outputs available from the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code><span class="deltaxml-old" style="background:#FF5555"> are “A”, “B”, and “C”. No documents appear on any outputs not declared in the subpipline actually selected.</span></p><p><span class="deltaxml-old" style="background:#FF5555">As a convenience to authors, it is not an error if some subpipelines declare outputs that can produce sequences and some do not. Each output of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code><span class="deltaxml-old" style="background:#FF5555"> is declared to produce a sequence. The content types that can appear on the port are the union of the content types that might be produced by any of the </span><a href="#p.when"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or the </span><a href="#p.otherwise"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:otherwise</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code><span class="deltaxml-old" style="background:#FF5555"> can specify the context node against which the XPath expressions that occur on each branch are evaluated. The context node is specified as a </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555"> in the </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">. If no explicit connection is provided, the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is used. If the context node is connected to </span><a href="#p.empty"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></code></a><span class="deltaxml-old" style="background:#FF5555">, or is unconnected and the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is undefined, the context item is undefined. </span><a id="err.inline.D0005"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0005"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0005</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if more than one document appears on the connection for this input port. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Each conditional </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is represented by a </span><a href="#p.when"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element. The default branch is represented by a </span><a href="#p.otherwise"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:otherwise</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element. These elements are not sibling steps in the usual sense, the names of sibling </span><a href="#p.when"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements and the </span><a href="#p.otherwise"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:otherwise</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element are not in </span><a href="#scoping"><span class="deltaxml-old" style="background:#FF5555">the same scope</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><section id="p.when" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">15.4.1 p:when</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A when specifies one subpipeline guarded by a test expression. </span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:when</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">test</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  collection? = { </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555"> }&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555">?,</span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:when&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">Each </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code><span class="deltaxml-old" style="background:#FF5555"> branch of the </span><a href="#p.choose"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code></a><span class="deltaxml-old" style="background:#FF5555"> has a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">test</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute which </span><span class="rfc2119" id="p.when.4.4"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> contain an XPath expression. That XPath expression's effective boolean value is the guard for the </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555"> contained within that </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code><span class="deltaxml-old" style="background:#FF5555"> can specify a context node against which its </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">test</span></code><span class="deltaxml-old" style="background:#FF5555"> expression is to be evaluated. That context node is specified as a </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555"> for the </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">. If no context is specified on the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code><span class="deltaxml-old" style="background:#FF5555">, the context of the </span><a href="#p.choose"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is used.</span></p><p><a id="err.inline.D0005.1"></a><span class="deltaxml-old" style="background:#FF5555">If the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">collection</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is not specified, or if its value is false, it is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0005"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0005</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if more than one document appears on the connection for the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code><span class="deltaxml-old" style="background:#FF5555"> test expression. If the collection attribute has the value true, then the default collection will contain all of the documents that appeared on that input and the context item will be undefined. </span></p></div></section><section id="p.otherwise" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">15.4.2 p:otherwise</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">An otherwise specifies the default branch; the subpipeline selected if no test expression on any preceding </span><a href="#p.when"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code></a><span class="deltaxml-old" style="background:#FF5555"> evaluates to true.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:otherwise</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:otherwise&gt;</span></code></p></div></section><section id="example-choose" class="section tocsuppress"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">15.4.3 Example</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><a href="#p.choose"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code></a><span class="deltaxml-old" style="background:#FF5555"> might test the version attribute of the document element and validate with an appropriate schema.</span></p><figure id="ex.p.choose" class="example-wrapper"><div class="title"><span class="deltaxml-old" style="background:#FF5555">Example 7. A Sample Choose</span></div><div class="example"><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:choose name="version"&gt; &lt;p:when test="/*[@version = 2]"&gt; &lt;p:validate-with-xml-schema&gt; &lt;p:with-input port="schema" href="v2schema.xsd"/&gt; &lt;/p:validate-with-xml-schema&gt; &lt;/p:when&gt; &lt;p:when test="/*[@version = 1]"&gt; &lt;p:validate-with-xml-schema&gt; &lt;p:with-input port="schema" href="v1schema.xsd"/&gt; &lt;/p:validate-with-xml-schema&gt; &lt;/p:when&gt; &lt;p:when test="/*[@version]"&gt; &lt;p:identity/&gt; &lt;/p:when&gt; &lt;p:otherwise&gt; &lt;p:error code="NOVERSION"&gt; &lt;p:with-input port="source"&gt; &lt;p:inline&gt; &lt;message&gt;Required version attribute missing.&lt;/message&gt; &lt;/p:inline&gt; &lt;/p:with-input&gt; &lt;/p:error&gt; &lt;/p:otherwise&gt; &lt;/p:choose&gt;</span></code></pre></div></figure></div></section></div></section><section id="p.if" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">15.5 p:if</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:if</span></code><span class="deltaxml-old" style="background:#FF5555"> specifies a single subpipeline guarded by a test expression.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:if</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">test</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  collection? = { </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555"> }&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555">?,</span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:if&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:if</span></code><span class="deltaxml-old" style="background:#FF5555"> has a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">test</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute which </span><span class="rfc2119" id="p.if.4.3"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> contain an XPath expression. That XPath expression's effective boolean value is the guard for the </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555"> contained within it. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:if</span></code><span class="deltaxml-old" style="background:#FF5555"> can specify a context node against which its </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">test</span></code><span class="deltaxml-old" style="background:#FF5555"> expression is to be evaluated. That context node is specified as a </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555"> for the </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">. If no context is specified on the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:if</span></code><span class="deltaxml-old" style="background:#FF5555">, the context comes from the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><a id="err.inline.D0005.2"></a><span class="deltaxml-old" style="background:#FF5555">If the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">collection</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is not specified, or if its value is false, it is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0005"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0005</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if more than one document appears on the connection for the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:if</span></code><span class="deltaxml-old" style="background:#FF5555"> test expression. If the collection attribute has the value true, then the default collection will contain all of the documents that appeared on that input and the context item will be undefined. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If the effective boolean value of the test expression is true, then the subpipline will be run. If it is not run, then none of the output ports on the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:if</span></code><span class="deltaxml-old" style="background:#FF5555"> will produce any documents.</span></p></div></section><section id="p.group" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">15.6 p:group</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A group is specified by the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:group</span></code><span class="deltaxml-old" style="background:#FF5555"> element. It is a </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> that encapsulates the behavior of its </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:group</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:group&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:group</span></code><span class="deltaxml-old" style="background:#FF5555"> is a convenience wrapper for a collection of steps. </span></p><section id="example-group" class="section tocsuppress"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">15.6.1 Example</span></h4></div><div class="content"><figure id="ex.p.group" class="example-wrapper"><div class="title"><span class="deltaxml-old" style="background:#FF5555">Example 8. An Example Group</span></div><div class="example"><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:group&gt; &lt;p:variable name="db-key" select="'some-long-string-of-nearly-random-characters'"/&gt; &lt;p:choose&gt; &lt;p:when test="/config/output = 'fo'"&gt; &lt;p:xslt&gt; &lt;p:with-option name="parameters" select="map {'key': $db-key }"/&gt; &lt;p:with-input port="stylesheet" href="fo.xsl"/&gt; &lt;/p:xslt&gt; &lt;/p:when&gt; &lt;p:when test="/config/output = 'svg'"&gt; &lt;p:xslt&gt; &lt;p:with-option name="parameters" select="map {'key': $db-key }"/&gt; &lt;p:with-input port="stylesheet" href="svg.xsl"/&gt; &lt;/p:xslt&gt; &lt;/p:when&gt; &lt;p:otherwise&gt; &lt;p:xslt&gt; &lt;p:with-option name="parameters" select="map {'key': $db-key }"/&gt; &lt;p:with-input port="stylesheet" href="html.xsl"/&gt; &lt;/p:xslt&gt; &lt;/p:otherwise&gt; &lt;/p:choose&gt; &lt;/p:group&gt;</span></code></pre></div></figure></div></section></div></section><section id="p.try" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">15.7 p:try</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A try/catch step is specified by the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> element. It is a </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> that isolates its initial subpipeline, preventing dynamic errors that arise within it from being exposed to the rest of the pipeline. The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> includes alternate recovery subpipelines, and may include a “finally” subpipeline to perform post-processing irrespective of the outcome of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:try</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">,</span><span class="deltaxml-old" style="background:#FF5555">     ((</span><a href="#p.catch"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></a><span class="deltaxml-old" style="background:#FF5555">+,</span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.finally"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></a><span class="deltaxml-old" style="background:#FF5555">?) | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.catch"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.finally"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></a><span class="deltaxml-old" style="background:#FF5555">)))</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:try&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The step begins with the initial subpipeline; the recovery (or “catch”) pipelines are identified with </span><a href="#p.catch"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements; a “finally” pipeline is identified with a </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element.</span></p><p><a id="err.inline.S0075"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0075"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0075</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> does not have at least one subpipeline step, at least one of </span><a href="#p.catch"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555">, and at most one </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> step evaluates the initial subpipeline and, if no errors occur, the outputs of that pipeline are the outputs of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> step. However, if any errors occur, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> abandons the first subpipeline, discarding any output that it might have generated, and considers the recovery subpipelines. If there is no matching recovery subpipeline, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> fails. </span></p><div class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">If the initial subpipeline fails, none of its outputs will be visible outside of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555">, but it's still possible for steps in the partially evaluated pipeline to have side effects that are visible outside the processor. For example, a web server might record that some interaction was performed, or a file on the local file system might have been modified.</span></p></div></div><p><span class="deltaxml-old" style="background:#FF5555">If a recovery subpipeline is evaluated, the outputs of the recovery subpipeline are the outputs of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> step. If the recovery subpipeline is evaluated and a step within that subpipeline fails, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> fails.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Irrespective of whether the initial subpipeline succeeds or fails, if any recovery pipeline is selected, and whether it succeeds or fails, the </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> block is </span><em><span class="deltaxml-old" style="background:#FF5555">always</span></em><span class="deltaxml-old" style="background:#FF5555"> run after all other processing of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> has finished.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The outputs of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> are taken from the outputs of the initial </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555"> or the recovery subpipline if an error occurred in the initial subpipeline. The outputs </span><em><span class="deltaxml-old" style="background:#FF5555">available</span></em><span class="deltaxml-old" style="background:#FF5555"> from the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> are union of all of the outputs declared (explicitly or implicitly in the absence of any </span><a href="#p.output"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements if the </span><em class="glossterm"><a href="#dt-last-step"><span class="deltaxml-old" style="background:#FF5555">last step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> has a primary output port) in any of its alternative subpipelines. In order to maintain consistency with respect to the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555">, if any subpipeline has a </span><em class="glossterm"><a href="#dt-primary-output-port"><span class="deltaxml-old" style="background:#FF5555">primary output port</span></a></em><span class="deltaxml-old" style="background:#FF5555">, even implicitly, then </span><em><span class="deltaxml-old" style="background:#FF5555">every</span></em><span class="deltaxml-old" style="background:#FF5555"> subpipline must have a primary output port with the same name. In some cases, this may require making the implicit primary output explicit in order to assure that it has the same name. </span><a id="err.inline.S0102.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0102"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0102</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if alternative subpipelines have different primary output ports. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Consider a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> that has an initial subpipeline that declares output ports “A” and “B” and a recovery subpipeline that declares output ports “B” and “C”. The outputs available from the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> are “A”, “B”, and “C”. No documents appear on any outputs not declared in the subpipeline whose results are actually returned.</span></p><p><span class="deltaxml-old" style="background:#FF5555">As a convenience to authors, it is not an error if an output port can produce a sequence in the initial subpipeline but not in the recovery subpipeline, or vice versa. Each output of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> is declared to produce a sequence. The content types that can appear on the port are the union of the content types that might be produced by the initial subpipeline and any of the recovery subpipelines. </span></p><p><span class="deltaxml-old" style="background:#FF5555">A pipeline author can cause an error to occur with the </span><a href="#cv.error"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:error</span></code></a><span class="deltaxml-old" style="background:#FF5555"> step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If we assume that an absent </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> always succeeds, evaluation of a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> falls into one of these cases:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">If the initial pipeline succeeds:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">If the </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> succeeds, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> succeeds and the outputs of the initial subpipeline are the outputs of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555">. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> fails, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> fails and the error raised by the </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is reported as the cause of the failure.</span></p></li></ul></div></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the initial pipeline fails and a recovery subpipeline is selected:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">If the recovery pipeline succeeds:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">If the </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> succeeds, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> succeeds and the outputs of the recovery subpipeline are the outputs of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555">. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> fails, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> fails and the error raised by the </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is reported as the cause of the failure.</span></p></li></ul></div></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the recovery pipeline fails:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">If the </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> succeeds, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> fails and the error raised by the recovery subpipeline is reported as the cause of the failure.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> fails, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> fails and the error raised by the </span><em><span class="deltaxml-old" style="background:#FF5555">recovery subpipeline</span></em><span class="rfc2119" id="p.try.15.2.2.2.2.2.1.4"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be reported as the cause of the failure. The error raised by the finally pipeline </span><span class="rfc2119" id="p.try.15.2.2.2.2.2.1.5"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> also be reported in addition to the error raised by the recovery pipeline.</span></p></li></ul></div></li></ul></div></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the initial pipeline fails and a recovery subpipeline is not selected:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">If the </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> succeeds, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> fails and the error raised by the initial subpipeline is reported as the cause of the failure.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If the </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> fails, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code><span class="deltaxml-old" style="background:#FF5555"> fails and the error raised by the </span><em><span class="deltaxml-old" style="background:#FF5555">initial subpipeline</span></em><span class="rfc2119" id="p.try.15.3.2.2.1.4"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be reported as the cause of the failure. The error raised by the finally pipeline </span><span class="rfc2119" id="p.try.15.3.2.2.1.5"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> also be reported in addition to the error raised by the initial subpipeline.</span></p></li></ul></div></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#p.catch"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements are not sibling steps, the names of sibling </span><a href="#p.catch"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements and the </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element are not in </span><a href="#scoping"><span class="deltaxml-old" style="background:#FF5555">the same scope</span></a><span class="deltaxml-old" style="background:#FF5555">. The elements of the initial subpipeline are also not in the same scope as the </span><a href="#p.catch"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#p.finally"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements or their descendants.</span></p><section id="p.catch" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">15.7.1 p:catch</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code><span class="deltaxml-old" style="background:#FF5555"> is a recovery subpipeline.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:catch</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  code? = </span><var><span class="deltaxml-old" style="background:#FF5555">EQNameList</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:catch&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The environment inherited by the </span><em class="glossterm"><a href="#dt-contained-steps"><span class="deltaxml-old" style="background:#FF5555">contained steps</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code><span class="deltaxml-old" style="background:#FF5555"> is the </span><em class="glossterm"><a href="#dt-inherited-environment"><span class="deltaxml-old" style="background:#FF5555">inherited environment</span></a></em><span class="deltaxml-old" style="background:#FF5555"> with this modification:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The port named “</span><code class="port"><span class="deltaxml-old" style="background:#FF5555">error</span></code><span class="deltaxml-old" style="background:#FF5555">” on the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code><span class="deltaxml-old" style="background:#FF5555"> is added to the </span><em class="glossterm"><a href="#dt-readable-ports"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">All except the last </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code><span class="deltaxml-old" style="background:#FF5555"> pipeline </span><span class="rfc2119" id="p.catch.6.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> have a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">code</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. </span><a id="err.inline.S0064"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0064"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0064</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">code</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is missing from any but the last </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code><span class="deltaxml-old" style="background:#FF5555"> or if any error code occurs in more than one </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">code</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute among sibling </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code><span class="deltaxml-old" style="background:#FF5555"> elements. </span><a id="err.inline.S0083"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0083"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0083</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the value of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">code</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is not a whitespace separated list of EQNames.</span></p><p><span class="deltaxml-old" style="background:#FF5555">When a </span><a href="#p.try"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code></a><span class="deltaxml-old" style="background:#FF5555"> considers the recovery subpipelines, if any of the specified error codes in a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code><span class="deltaxml-old" style="background:#FF5555"> match the error that was raised in the initial subpipeline, then that </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code><span class="deltaxml-old" style="background:#FF5555"> is selected as the recovery pipeline. If the last </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code><span class="deltaxml-old" style="background:#FF5555"> does not have a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">code</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute, it is selected if no other </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code><span class="deltaxml-old" style="background:#FF5555"> has a matching error code. </span></p><p><span class="deltaxml-old" style="background:#FF5555">What appears on the </span><code class="port"><span class="deltaxml-old" style="background:#FF5555">error</span></code><span class="deltaxml-old" style="background:#FF5555"> input port is an </span><a href="#err-vocab"><span class="deltaxml-old" style="background:#FF5555">error document</span></a><span class="deltaxml-old" style="background:#FF5555">. The error document may contain messages generated by steps that were part of the initial subpipeline. Not all messages that appear are indicative of errors; for example, it is common for all </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">xsl:message</span></code><span class="deltaxml-old" style="background:#FF5555"> output from the XSLT component to appear on the </span><code class="port"><span class="deltaxml-old" style="background:#FF5555">error</span></code><span class="deltaxml-old" style="background:#FF5555"> input port. It is possible that the component which fails may not produce any messages at all. It is also possible that the failure of one component may cause others to fail so that there may be multiple failure messages in the document.</span></p></div></section><section id="p.finally" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">15.7.2 p:finally</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The last thing that the </span><a href="#p.try"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code></a><span class="deltaxml-old" style="background:#FF5555"> step does is evaluate the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code><span class="deltaxml-old" style="background:#FF5555"> pipeline.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:finally</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:finally&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The environment inherited by the </span><em class="glossterm"><a href="#dt-contained-steps"><span class="deltaxml-old" style="background:#FF5555">contained steps</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code><span class="deltaxml-old" style="background:#FF5555"> is the </span><em class="glossterm"><a href="#dt-inherited-environment"><span class="deltaxml-old" style="background:#FF5555">inherited environment</span></a></em><span class="deltaxml-old" style="background:#FF5555"> with this modification:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The port named “</span><code class="port"><span class="deltaxml-old" style="background:#FF5555">error</span></code><span class="deltaxml-old" style="background:#FF5555">” on the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code><span class="deltaxml-old" style="background:#FF5555"> is added to the </span><em class="glossterm"><a href="#dt-readable-ports"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">If no error occurred, there will be no documents on the </span><code class="port"><span class="deltaxml-old" style="background:#FF5555">error</span></code><span class="deltaxml-old" style="background:#FF5555"> port. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code><span class="deltaxml-old" style="background:#FF5555"> exists only to handle recovery and resource cleanup tasks. Because the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code><span class="deltaxml-old" style="background:#FF5555"> will always be evaluated, it must not have output ports that might conflict with the output ports of either the initial subpipline or any </span><a href="#p.catch"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span><a id="err.inline.S0072"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0072"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0072</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the name of any output port on the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></code><span class="deltaxml-old" style="background:#FF5555"> is the same as the name of any other output port in the </span><a href="#p.try"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or any of its sibling </span><a href="#p.catch"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements.</span></p></div></section><section id="err-vocab" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">15.7.3 The Error Vocabulary</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">In general, it is very difficult to predict error behavior. Step failure may be catastrophic (programmer error), or it may be the result of user error, resource failures, etc. Steps may detect more than one error, and the failure of one step may cause other steps to fail as well.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#p.try"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code></a><span class="deltaxml-old" style="background:#FF5555">/</span><a href="#p.catch"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code></a><span class="deltaxml-old" style="background:#FF5555"> mechanism gives pipeline authors the opportunity to process the errors that caused the </span><a href="#p.try"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code></a><span class="deltaxml-old" style="background:#FF5555"> to fail. In order to facilitate some modicum of interoperability among processors, errors that are reported on the </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">error</span></code><span class="deltaxml-old" style="background:#FF5555"> input port of a </span><a href="#p.catch"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code></a><span class="rfc2119" id="err-vocab.3.6"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> conform to the format described here. </span></p><section id="cv.errors" class="section"><div class="section-titlepage"><h5><span class="deltaxml-old" style="background:#FF5555">15.7.3.1 c:errors</span></h5></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The error vocabulary consists of a root element, </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">c:errors</span></code><span class="deltaxml-old" style="background:#FF5555"> which contains zero or more </span><a href="#cv.error"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">c:error</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements.</span></p><p class="element-syntax element-syntax-error-vocabulary"><code><span class="deltaxml-old" style="background:#FF5555">&lt;c:errors&gt;</span><span class="deltaxml-old" style="background:#FF5555">    </span><a href="#cv.error"><span class="deltaxml-old" style="background:#FF5555">c:error</span></a><span class="deltaxml-old" style="background:#FF5555">*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/c:errors&gt;</span></code></p></div></section><section id="cv.error" class="section"><div class="section-titlepage"><h5><span class="deltaxml-old" style="background:#FF5555">15.7.3.2 c:error</span></h5></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Each specific error is represented by an </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">c:error</span></code><span class="deltaxml-old" style="background:#FF5555"> element:</span></p><p class="element-syntax element-syntax-error-vocabulary"><code><span class="deltaxml-old" style="background:#FF5555">&lt;c:error</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  type? = </span><var><span class="deltaxml-old" style="background:#FF5555">EQName</span></var><span class="deltaxml-old" style="background:#FF5555">  code? = </span><var><span class="deltaxml-old" style="background:#FF5555">EQName</span></var><span class="deltaxml-old" style="background:#FF5555">  href? = </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555">  line? = </span><var><span class="deltaxml-old" style="background:#FF5555">integer</span></var><span class="deltaxml-old" style="background:#FF5555">  column? = </span><var><span class="deltaxml-old" style="background:#FF5555">integer</span></var><span class="deltaxml-old" style="background:#FF5555">  offset? = </span><var><span class="deltaxml-old" style="background:#FF5555">integer</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    </span><var><span class="deltaxml-old" style="background:#FF5555">anyNode</span></var><span class="deltaxml-old" style="background:#FF5555">*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/c:error&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">name</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">type</span></code><span class="deltaxml-old" style="background:#FF5555"> attributes identify the name and type, respectively, of the step which failed.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">code</span></code><span class="deltaxml-old" style="background:#FF5555"> is an EQName which identifies the error. For steps which have defined error codes, this is an opportunity for the step to identify the error in a machine-processable fashion. Many steps omit this because they do not include the concept of errors identified by EQNames.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If the error was caused by a specific document, or by the location of some erroneous construction in a specific document, the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">line</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">column</span></code><span class="deltaxml-old" style="background:#FF5555">, and </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">offset</span></code><span class="deltaxml-old" style="background:#FF5555"> attributes identify this location. Generally, the error location is identified either with line and column numbers or with an offset from the beginning of the document, but not usually both.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The content of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">c:error</span></code><span class="deltaxml-old" style="background:#FF5555"> element is any well-formed XML. Specific steps, or specific implementations, may provide more detail about the format of the content of an error message.</span></p></div></section><section id="error-example" class="section"><div class="section-titlepage"><h5><span class="deltaxml-old" style="background:#FF5555">15.7.3.3 Error Example</span></h5></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Consider the following XSLT stylesheet:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0"&gt; &lt;xsl:template match="/"&gt; &lt;xsl:message terminate="yes"&gt; &lt;xsl:text&gt;This stylesheet is &lt;/xsl:text&gt; &lt;emph&gt;pointless&lt;/emph&gt; &lt;xsl:text&gt;.&lt;/xsl:text&gt; &lt;/xsl:message&gt; &lt;/xsl:template&gt; &lt;/xsl:stylesheet&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">If it was used in a step named “xform” in a </span><a href="#p.try"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code></a><span class="deltaxml-old" style="background:#FF5555">, the following error document might be produced:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;c:errors xmlns:c="http://www.w3.org/ns/xproc-step"&gt; &lt;c:error name="xform" type="p:xslt" href="style.xsl" line="6"&gt;This stylesheet is &lt;emph&gt;pointless&lt;/emph&gt;.&lt;/c:error&gt; &lt;/c:errors&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">It is not an error for steps to generate non-standard error output as long as it is well-formed.</span></p></div></section></div></section><section id="example-try" class="section tocsuppress"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">15.7.4 Example</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A pipeline might attempt to process a document by dispatching it to some web service. If the web service succeeds, then those results are passed to the rest of the pipeline. However, if the web service cannot be contacted or reports an error, the </span><a href="#p.catch"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></code></a><span class="deltaxml-old" style="background:#FF5555"> step can provide some sort of default for the rest of the pipeline.</span></p><figure id="ex.p.trycatch" class="example-wrapper"><div class="title"><span class="deltaxml-old" style="background:#FF5555">Example 9. An Example Try/Catch</span></div><div class="example"><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:try&gt; &lt;p:http-request&gt; &lt;p:with-input port="source"&gt; &lt;p:inline&gt; &lt;c:request method="post" href="http://example.com/form-action"&gt; &lt;c:body content-type="application/x-www-form-urlencoded"&gt;name=W3C&amp;amp;spec=XProc&lt;/c:body&gt; &lt;/c:request&gt; &lt;/p:inline&gt; &lt;/p:with-input&gt; &lt;/p:http-request&gt; &lt;p:catch&gt; &lt;p:identity&gt; &lt;p:with-input port="source"&gt; &lt;p:inline&gt; &lt;c:error&gt;HTTP Request Failed&lt;/c:error&gt; &lt;/p:inline&gt; &lt;/p:with-input&gt; &lt;/p:identity&gt; &lt;/p:catch&gt; &lt;/p:try&gt;</span></code></pre></div></figure></div></section></div></section><section id="p.atomic" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">15.8 Atomic Steps</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">In addition to the six step types described in the preceding sections, XProc provides a standard library of atomic step types. The full vocabulary of standards steps is described in [</span><a href="#steps30"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Steps 3.0</span></span></a><span class="deltaxml-old" style="background:#FF5555">].</span></p><p><span class="deltaxml-old" style="background:#FF5555">All of the standard, atomic steps are invoked in the same way:</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;</span><var><span class="deltaxml-old" style="background:#FF5555">p:atomic-step</span></var><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.with-option"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></a><span class="deltaxml-old" style="background:#FF5555">)*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/</span><var><span class="deltaxml-old" style="background:#FF5555">p:atomic-step</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">Where “</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">p:atomic-step</span></code></em><span class="deltaxml-old" style="background:#FF5555">” </span><span class="rfc2119" id="p.atomic.5.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be in the XProc namespace and </span><span class="rfc2119" id="p.atomic.5.3"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be declared in either the standard library for the XProc version supported by the processor or explicitly imported by the surrounding pipeline (see </span><a href="#versioning-considerations" title="Versioning Considerations"><span class="deltaxml-old" style="background:#FF5555">Section 13, “Versioning Considerations”</span></a><span class="deltaxml-old" style="background:#FF5555">). </span></p></div></section><section id="p.extension" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">15.9 Extension Steps</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Pipeline authors may also have access to additional steps not defined or described by this specification. Atomic extension steps are invoked just like standard steps:</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;</span><var><span class="deltaxml-old" style="background:#FF5555">pfx:atomic-step</span></var><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.with-option"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></a><span class="deltaxml-old" style="background:#FF5555">)*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/</span><var><span class="deltaxml-old" style="background:#FF5555">pfx:atomic-step</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">Extension steps </span><span class="rfc2119" id="p.extension.4.1"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> be in the XProc namespace and there </span><span class="rfc2119" id="p.extension.4.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a </span><em class="glossterm"><a href="#dt-visible"><span class="deltaxml-old" style="background:#FF5555">visible</span></a></em><span class="deltaxml-old" style="background:#FF5555"> step declaration at the point of use (see </span><a href="#scoping" title="Scoping of Names"><span class="deltaxml-old" style="background:#FF5555">Section 14.2, “Scoping of Names”</span></a><span class="deltaxml-old" style="background:#FF5555">).</span></p><p><span class="deltaxml-old" style="background:#FF5555">If the relevant step declaration has no </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555">, then that step invokes the declared atomic step, which the processor must know how to perform. These steps are implementation-defined extensions. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If the relevant step declaration has a </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555">, then that step runs the declared subpipeline. These steps are user- or implementation-defined extensions. Pipelines can refer to themselves (recursion is allowed), to pipelines defined in imported libraries, and to other pipelines in the same library if they are in a library.</span></p><p><a id="err.inline.S0010"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0010"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0010</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a pipeline contains a step whose specified inputs, outputs, and options do not </span><em class="glossterm"><a href="#dt-matches"><span class="deltaxml-old" style="background:#FF5555">match</span></a></em><span class="deltaxml-old" style="background:#FF5555"> the </span><em class="glossterm"><a href="#dt-signature"><span class="deltaxml-old" style="background:#FF5555">signature</span></a></em><span class="deltaxml-old" style="background:#FF5555"> for steps of that type.</span></p><p><a id="err.inline.D0017"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0017"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0017</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the running pipeline attempts to invoke a step which the processor does not know how to perform.</span></p><p><span id="impl-37"><span class="deltaxml-old" style="background:#FF5555">The presence of other </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound steps</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">; XProc provides no standard mechanism for defining them or describing what they can contain.</span></span><a id="err.inline.S0048"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0048"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0048</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to use a declared step as a </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound step</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></div></section><p><span class="deltaxml-new" style="background:#90EE90">There are many additional, optional XProc steps.</span></p><div class="itemizedlist"><ul><li><p><cite><a href="validation/"><span class="deltaxml-new" style="background:#90EE90">XProc 3.0: validation steps</span></a></cite></p></li><li><p><cite><a href="os/"><span class="deltaxml-new" style="background:#90EE90">XProc 3.0: operating system steps</span></a></cite></p></li><li><p><cite><a href="file/"><span class="deltaxml-new" style="background:#90EE90">XProc 3.0: file steps</span></a></cite></p></li><li><p><cite><a href="text/"><span class="deltaxml-new" style="background:#90EE90">XProc 3.0: text steps</span></a></cite></p></li><li><p><cite><a href="run/"><span class="deltaxml-new" style="background:#90EE90">XProc 3.0: dynamic pipeline execution</span></a></cite></p></li><li><p><cite><a href="paged-media/"><span class="deltaxml-new" style="background:#90EE90">XProc 3.0: paged media steps</span></a></cite></p></li></ul></div></div></section><section id="other-elements" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">16 Other pipeline elements</span></h2></div><div class="content"><section id="p.input" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.1 p:input</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The declaration of an input identifies the name of the port, whether or not the port accepts a sequence, whether or not the port is a </span><em class="glossterm"><a href="#dt-primary-input-port"><span class="deltaxml-old" style="background:#FF5555">primary input port</span></a></em><span class="deltaxml-old" style="background:#FF5555">, what content types it accepts, and may provide a connection to default inputs for the port.</span></p><p><span class="deltaxml-old" style="background:#FF5555">An input </span><em><span class="deltaxml-old" style="background:#FF5555">declaration</span></em><span class="deltaxml-old" style="background:#FF5555"> has the following form:</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:input</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">port</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  sequence? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  primary? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  select? = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  content-types? = </span><var><span class="deltaxml-old" style="background:#FF5555">ContentTypes</span></var><span class="deltaxml-old" style="background:#FF5555">  href? = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.empty"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.document"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.inline"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a><span class="deltaxml-old" style="background:#FF5555">)*) | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">anyElement</span></var><span class="deltaxml-old" style="background:#FF5555">*)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:input&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The attributes that can appear on </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:input</span></code><span class="deltaxml-old" style="background:#FF5555"> are </span><a href="#common-attr"><span class="deltaxml-old" style="background:#FF5555">the common attributes</span></a><span class="deltaxml-old" style="background:#FF5555"> and:</span></p><div class="variablelist"><dl><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">port</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">port</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute defines the name of the port. </span><a id="err.inline.S0011"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0011"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0011</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to identify two ports with the same name on the same step.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">sequence</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">sequence</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute determines whether or not a sequence of documents is allowed on the port. </span><a id="err.inline.D0006"></a><span class="deltaxml-old" style="background:#FF5555">If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">sequence</span></code><span class="deltaxml-old" style="background:#FF5555"> is not specified, or has the value false, then it is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0006"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0006</span></code></a><span class="deltaxml-old" style="background:#FF5555">) unless exactly one document appears on the declared port.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">primary</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">primary</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is used to identify the </span><em class="glossterm"><a href="#dt-primary-input-port"><span class="deltaxml-old" style="background:#FF5555">primary input port</span></a></em><span class="deltaxml-old" style="background:#FF5555">. An input port is a </span><em class="glossterm"><a href="#dt-primary-input-port"><span class="deltaxml-old" style="background:#FF5555">primary input port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> if </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">primary</span></code><span class="deltaxml-old" style="background:#FF5555"> is specified with the value </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">true</span></code><span class="deltaxml-old" style="background:#FF5555"> or if the step has only a single input port and </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">primary</span></code><span class="deltaxml-old" style="background:#FF5555"> is not specified. </span><a id="err.inline.S0030"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0030"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0030</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to specify that more than one input port is the primary.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If a connection is provided in the declaration, then </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> may be used to select a portion of the input identified by the </span><a href="#p.empty"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></code></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#p.document"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code></a><span class="deltaxml-old" style="background:#FF5555">, or </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements in the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:input</span></code><span class="deltaxml-old" style="background:#FF5555">. This select expression </span><span class="rfc2119" id="p.input.6.4.2.1.6"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be an XPath expression. The selected nodes are returned as separate documents. If such a document consists exclusively of text nodes, then it has a content type of </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/plain</span></code><span class="deltaxml-old" style="background:#FF5555">, otherwise it has a content type of </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xml</span></code><span class="deltaxml-old" style="background:#FF5555">. </span><a id="err.inline.D0016"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0016"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0016</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the select expression on a p:input or p:with-input returns anything other than document nodes, element nodes, processing instruction nodes, comment nodes, text nodes or an empty sequence.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> expression applies </span><em><span class="deltaxml-old" style="background:#FF5555">only</span></em><span class="deltaxml-old" style="background:#FF5555"> if the default connection is used. If an explicit connection is provided by the caller, then the default select expression is ignored.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">content-types</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">content-types</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute lists one or more (space separated) content types that this input port will accept. If the attribute is not specified, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">*/*</span></code><span class="deltaxml-old" style="background:#FF5555"> is assumed. A content type must be of the form “</span><code class="literal"><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">type</span></code></em><span class="deltaxml-old" style="background:#FF5555">/</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">subtype</span></code></em><span class="deltaxml-old" style="background:#FF5555">+</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">ext</span></code></em></code><span class="deltaxml-old" style="background:#FF5555">” where any of </span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">type</span></code></em><span class="deltaxml-old" style="background:#FF5555">, </span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">subtype</span></code></em><span class="deltaxml-old" style="background:#FF5555">, and </span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">ext</span></code></em><span class="deltaxml-old" style="background:#FF5555"> can be specified as “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">*</span></code><span class="deltaxml-old" style="background:#FF5555">” meaning “any”. The “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">+</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">ext</span></code></em></code><span class="deltaxml-old" style="background:#FF5555">” is optional. Here are some examples of content types for matching:</span></p><div class="itemizedlist"><ul><li><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/plain</span></code><span class="deltaxml-old" style="background:#FF5555">, plain text documents</span></p></li><li><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/*</span></code><span class="deltaxml-old" style="background:#FF5555">, any kind of text document.</span></p></li><li><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">*/*+xml</span></code><span class="deltaxml-old" style="background:#FF5555">, any XML content type. </span></p></li><li><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">*/*</span></code><span class="deltaxml-old" style="background:#FF5555">, any content type. </span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">The media type of input documents must </span><a href="#media-type-match"><span class="deltaxml-old" style="background:#FF5555">match</span></a><span class="deltaxml-old" style="background:#FF5555"> the allowed content types.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">As described in </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555"> allows the pipeline author to exclude some namespace declarations in inline content, see </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">On a </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> for an atomic step, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:input</span></code><span class="deltaxml-old" style="background:#FF5555"> can only declare the input port. </span><a id="err.inline.S0042"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0042"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0042</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to attempt to provide a connection for an input port on the declaration of an atomic step. On </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555">, any binding provided in </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:input</span></code><span class="deltaxml-old" style="background:#FF5555"> is a default connection for the port, if no other connection is provided, see </span><a href="#conn-prec" title="Connection precedence"><span class="deltaxml-old" style="background:#FF5555">Section 16.2.1, “Connection precedence”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#p.pipe"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element is explicitly excluded from a declaration because it would make the default value of an input dependent on the execution of some part of the pipeline. If a runtime binding is provided for an input port, implementations </span><span class="rfc2119" id="note-pipe-excl.2"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> attempt to dereference the default bindings.</span></p></div></section><section id="p.with-input" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.2 p:with-input</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">An input </span><em><span class="deltaxml-old" style="background:#FF5555">connection</span></em><span class="deltaxml-old" style="background:#FF5555"> has the following form:</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:with-input</span><span class="deltaxml-old" style="background:#FF5555">  port? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  select? = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  href? = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  pipe? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.empty"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.document"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.pipe"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.inline"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a><span class="deltaxml-old" style="background:#FF5555">)*) | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">anyElement</span></var><span class="deltaxml-old" style="background:#FF5555">*)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:with-input&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The attributes that can appear on </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code><span class="deltaxml-old" style="background:#FF5555"> are </span><a href="#common-attr"><span class="deltaxml-old" style="background:#FF5555">the common attributes</span></a><span class="deltaxml-old" style="background:#FF5555"> and:</span></p><div class="variablelist"><dl><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">port</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">port</span></code><span class="deltaxml-old" style="background:#FF5555"> is specified, then this is a binding for the specified port. If no port is specified, then:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">In a </span><a href="#p.viewport"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.for-each"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></code></a><span class="deltaxml-old" style="background:#FF5555">, it is a binding for the step's single, anonymous input port.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">In a </span><a href="#p.choose"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.when"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code></a><span class="deltaxml-old" style="background:#FF5555">, it is a binding for the context item for the test expression(s).</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Elsewhere, it is a binding for the primary input port of the step in which it occurs. </span><a id="err.inline.S0065"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0065"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0065</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if there is no primary input port. </span></p></li></ul></div><p><a id="err.inline.S0086"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0086"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0086</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to provide more than one p:with-input for the same port. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If no connection is provided for a </span><em class="glossterm"><a href="#dt-primary-input-port"><span class="deltaxml-old" style="background:#FF5555">primary input port</span></a></em><span class="deltaxml-old" style="background:#FF5555">, the input will be connected to the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span><a id="err.inline.S0032"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0032"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0032</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if no connection is provided and the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is undefined.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> expression </span><span class="rfc2119" id="p.with-input.5.2.2.1.2"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> also be provided with a connection. The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> expression, if specified, applies the specified XPath select expression to the document(s) that are read.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If the result from applying the select expression to the document(s) is an atomic value, a text node with the corresponding string value is created.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Each selected node is wrapped in a document (unless it is a document) and provided to the input port. In other words,</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:with-input port="source"&gt; &lt;p:document href="http://example.org/input.html"/&gt; &lt;/p:with-input&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">provides a single document, but</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:with-input port="source" select="//html:div" xmlns:html="http://www.w3.org/1999/xhtml"&gt; &lt;p:document href="http://example.org/input.html"/&gt; &lt;/p:with-input&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">provides a sequence of zero or more documents, one for each </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">html:div</span></code><span class="deltaxml-old" style="background:#FF5555"> in </span><code class="uri"><span class="deltaxml-old" style="background:#FF5555">http://example.org/input.html</span></code><span class="deltaxml-old" style="background:#FF5555">. (Note that in the case of nested </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">html:div</span></code><span class="deltaxml-old" style="background:#FF5555"> elements, this will result in the same content being returned in several documents.)</span></p><p><span class="deltaxml-old" style="background:#FF5555">A select expression can equally be applied to input read from another step. This input:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:with-input port="source" select="//html:div" xmlns:html="http://www.w3.org/1999/xhtml"&gt; &lt;p:pipe step="origin" port="result"/&gt; &lt;/p:with-input&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">provides a sequence of zero or more documents, one for each </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">html:div</span></code><span class="deltaxml-old" style="background:#FF5555"> in the document (or each of the documents) that is read from the </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">result</span></code><span class="deltaxml-old" style="background:#FF5555"> port of the step named </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">origin</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The base URI of the document that results from a select expression is the base URI of the matched element or document. The document does not have a base URI if it results from selecting an atomic value.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If a document constructed by selection consists exclusively of text nodes, then it has a content type of </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/plain</span></code><span class="deltaxml-old" style="background:#FF5555">, otherwise it has a content type of </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xml</span></code><span class="deltaxml-old" style="background:#FF5555">. If the selection result is a map or an array, it is a JSON document. </span><a id="err.inline.D0016.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0016"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0016</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the select expression on a p:input or p:with-input returns attribute nodes or function items.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is a shortcut for a </span><a href="#p.document"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code></a><span class="deltaxml-old" style="background:#FF5555"> child with an </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute having the same value as this </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. </span></p><p><a id="err.inline.S0081"></a><span class="deltaxml-old" style="background:#FF5555">If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> is specified, it is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0081"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0081</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if any child elements other than </span><a href="#p.documentation"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:documentation</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#p.pipeinfo"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></code></a><span class="deltaxml-old" style="background:#FF5555"> are present.</span></p><p><a id="err.inline.S0085"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0085"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0085</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if both a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute and a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">pipe</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute are present.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">pipe</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">pipe</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is a shortcut for one or more </span><a href="#p.pipe"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code></a><span class="deltaxml-old" style="background:#FF5555"> children. The attribute value </span><span class="rfc2119" id="p.with-input.5.4.2.1.3"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be whitespace-separated list of tokens or empty. </span><a id="err.inline.S0090"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0090"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0090</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the value of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">pipe</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute contains any tokens not of the form </span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">port-name</span></code></em><span class="deltaxml-old" style="background:#FF5555">, </span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">port-name@step-name</span></code></em><span class="deltaxml-old" style="background:#FF5555">, or </span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">@step-name</span></code></em><span class="deltaxml-old" style="background:#FF5555">. If “</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">port-name</span></code></em><span class="deltaxml-old" style="background:#FF5555">” is omitted, the connection is to the primary output port of the step named “</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">step-name</span></code></em><span class="deltaxml-old" style="background:#FF5555">”. If “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">@</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">step-name</span></code></em></code><span class="deltaxml-old" style="background:#FF5555">” is omitted, the connection is to the specified port on the same step as the step associated with the default readable port. If the value is empty, the connection is to the default readable port.</span></p><p><a id="err.inline.S0082"></a><span class="deltaxml-old" style="background:#FF5555">If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">pipe</span></code><span class="deltaxml-old" style="background:#FF5555"> is specified, it is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0082"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0082</span></code></a><span class="deltaxml-old" style="background:#FF5555">) any child elements other than </span><a href="#p.documentation"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:documentation</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#p.pipeinfo"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></code></a><span class="deltaxml-old" style="background:#FF5555"> are present.</span></p><p><a id="err.inline.S0085.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0085"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0085</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if both an </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute and a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">pipe</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute are present.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555"> allows the pipeline author to exclude some namespace declarations in inline content, see </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code><span class="deltaxml-old" style="background:#FF5555"> element with no children (</span><em class="foreignphrase"><span class="deltaxml-old" style="background:#FF5555">e.g.</span></em><span class="deltaxml-old" style="background:#FF5555">, “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">&lt;p:with-input/&gt;</span></code><span class="deltaxml-old" style="background:#FF5555">”) is treated implicitly as if it contained only “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">&lt;p:pipe/&gt;</span></code><span class="deltaxml-old" style="background:#FF5555">”, which is in turn equivalent to a binding to the default readable port. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code><span class="deltaxml-old" style="background:#FF5555"> contains elements not in the XProc namespace, they are </span><a href="#implicit-inlines"><span class="deltaxml-old" style="background:#FF5555">implicit inlines</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><section id="conn-prec" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">16.2.1 Connection precedence</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">XProc 3.0 introduces a number of new connection defaulting mechanisms to make pipeline authoring easier. Defaults only apply if there’s no explicit connection, and they apply differently to primary and secondary inputs.</span></p><div class="variablelist"><dl><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Primary input ports</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">For a given primary input port:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">If there is a </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555"> for that port and it provides a binding, even an implicit one, that binding is used. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If there’s no </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555"> for that port and there is a default readable port, the input will be connected to the default readable port. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If there’s no </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555"> for that port and there’s no default readable port, then the default connection from the declaration’s </span><a href="#p.input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:input</span></code></a><span class="deltaxml-old" style="background:#FF5555"> will be used. It will be a static error if there is no default connection. </span></p></li></ol></div></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Secondary input ports</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">For a given secondary input port:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">If there is a </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555"> for that port and it provides a binding, even an implicit one, that binding is used. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If there’s no </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555"> for that port then the default connection from the declaration’s </span><a href="#p.input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:input</span></code></a><span class="deltaxml-old" style="background:#FF5555"> will be used. It will be a static error if there is no default connection. </span></p></li></ol></div></dd></dl></div></div></section></div></section><section id="p.output" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.3 p:output</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code><span class="deltaxml-old" style="background:#FF5555"> identifies an output port.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:output</span><span class="deltaxml-old" style="background:#FF5555">  port? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  sequence? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  primary? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  content-types? = </span><var><span class="deltaxml-old" style="background:#FF5555">ContentTypes</span></var><span class="deltaxml-old" style="background:#FF5555"> /&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The attributes that can appear on </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code><span class="deltaxml-old" style="background:#FF5555"> are </span><a href="#common-attr"><span class="deltaxml-old" style="background:#FF5555">the common attributes</span></a><span class="deltaxml-old" style="background:#FF5555"> and:</span></p><div class="variablelist"><dl><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">port</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">port</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute defines the name of the port. </span><a id="err.inline.S0011.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0011"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0011</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to identify two ports with the same name on the same step.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">sequence</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">An output declaration can indicate if a sequence of documents is allowed to appear on the declared port. If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">sequence</span></code><span class="deltaxml-old" style="background:#FF5555"> is specified with the value </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">true</span></code><span class="deltaxml-old" style="background:#FF5555">, then a sequence is allowed. </span><a id="err.inline.D0007"></a><span class="deltaxml-old" style="background:#FF5555">If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">sequence</span></code><span class="deltaxml-old" style="background:#FF5555"> is not specified on </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code><span class="deltaxml-old" style="background:#FF5555">, or has the value false, then it is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0007"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0007</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the step does not produce exactly one document on the declared port.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">primary</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">primary</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is used to identify the primary output port. An output port is a primary output port if </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">primary</span></code><span class="deltaxml-old" style="background:#FF5555"> is specified with the value </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">true</span></code><span class="deltaxml-old" style="background:#FF5555"> or if the step has only a single output port and primary is not specified. </span><a id="err.inline.S0014"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0014"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0014</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to identify more than one output port as primary.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">content-types</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">An output declaration can indicate the content types of the documents appearing on that port. If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">content-types</span></code><span class="deltaxml-old" style="background:#FF5555"> is specified then only documents matching these content types are allowed to appear on that port. If the attribute is not specified, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">*/*</span></code><span class="deltaxml-old" style="background:#FF5555"> is assumed. </span><a id="err.inline.D0042"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0042"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0042</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a document arrives on an output port whose content type is not accepted by the output port specification.</span></p><div class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">Implementations are free to perform static checking of the connected ports and indicate that the content types of the connected ports will not match, however they </span><span class="rfc2119" id="p.output.5.4.2.2.2.1"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> raise an error statically. </span></p></div></div></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">On </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound steps</span></a></em><span class="deltaxml-old" style="background:#FF5555">, the declaration </span><span class="rfc2119" id="p.output.6.2"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> be accompanied by a </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555"> for the output.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:output</span><span class="deltaxml-old" style="background:#FF5555">  port? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  sequence? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  primary? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  content-types? = </span><var><span class="deltaxml-old" style="background:#FF5555">ContentTypes</span></var><span class="deltaxml-old" style="background:#FF5555">  href? = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  pipe? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.empty"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.document"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.pipe"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.inline"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a><span class="deltaxml-old" style="background:#FF5555">)*) | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">anyElement</span></var><span class="deltaxml-old" style="background:#FF5555">*)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:output&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The additional attributes that can appear on an output declaration on a compound step are:</span></p><div class="variablelist"><dl><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">As described in </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">pipe</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">As described in </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555"> allows the pipeline author to exclude some namespace declarations in inline content, see </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">Finally, on a </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> that declares a pipeline, the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code><span class="deltaxml-old" style="background:#FF5555"> can specify serialization options. </span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:output</span><span class="deltaxml-old" style="background:#FF5555">  port? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  sequence? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  primary? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  content-types? = </span><var><span class="deltaxml-old" style="background:#FF5555">ContentTypes</span></var><span class="deltaxml-old" style="background:#FF5555">  href? = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  pipe? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">  serialization? = </span><var><span class="deltaxml-old" style="background:#FF5555">map(xs:QName,item()*)</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.empty"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.document"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.pipe"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.inline"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a><span class="deltaxml-old" style="background:#FF5555">)*) | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">anyElement</span></var><span class="deltaxml-old" style="background:#FF5555">*)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:output&gt;</span></code></p><div class="variablelist"><dl><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">serialization</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">serialization</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute can be used to provide </span><a href="#serialization"><span class="deltaxml-old" style="background:#FF5555">serialization parameters</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd></dl></div><p><a id="err.inline.S0029"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0029"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0029</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to specify a connection for a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code><span class="deltaxml-old" style="background:#FF5555"> inside a </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> for an atomic step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If a connection is provided for a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code><span class="deltaxml-old" style="background:#FF5555">, documents are </span><em><span class="deltaxml-old" style="background:#FF5555">read from</span></em><span class="deltaxml-old" style="background:#FF5555"> that connection and those documents form the output that </span><em><span class="deltaxml-old" style="background:#FF5555">is written</span></em><span class="deltaxml-old" style="background:#FF5555"> to the output port. In other words, placing a </span><a href="#p.document"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code></a><span class="deltaxml-old" style="background:#FF5555"> inside a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code><span class="deltaxml-old" style="background:#FF5555"> causes the processor to </span><em><span class="deltaxml-old" style="background:#FF5555">read that document</span></em><span class="deltaxml-old" style="background:#FF5555"> and provide it on the output port. It </span><em><span class="deltaxml-old" style="background:#FF5555">does not</span></em><span class="deltaxml-old" style="background:#FF5555"> cause the processor to </span><em><span class="deltaxml-old" style="background:#FF5555">write</span></em><span class="deltaxml-old" style="background:#FF5555"> the output to that document.</span></p><section id="serialization" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">16.3.1 Serialization parameters</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">serialization</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute allows the user to request serialization parameters on an output port. These parameters control XML serialization as defined by [</span><a href="#xml-serialization-31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Serialization</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If the pipeline processor serializes the output on a port, it </span><span class="rfc2119" id="serialization.3.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> use the serialization parameters specified. If the processor is not serializing (if, for example, the pipeline has been called from another pipeline), then serialization does not apply. The serialization parameter map is computed (and must therefore be statically and syntactically valid), but the processor </span><span class="rfc2119" id="serialization.3.2"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> raise an error if the output could not be serialized with those parameters. </span></p><p><span id="impl-38"><span class="deltaxml-old" style="background:#FF5555">The default value of any serialization parameters not specified on a particular output is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span><span class="deltaxml-old" style="background:#FF5555"> However if the serialization parameter </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">method</span></code><span class="deltaxml-old" style="background:#FF5555"> is not specified the processor </span><span class="rfc2119" id="serialization.4.3"><span class="deltaxml-old" style="background:#FF5555">should</span></span><span class="deltaxml-old" style="background:#FF5555"> select a method based on the document's </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">content-type</span></code><span class="deltaxml-old" style="background:#FF5555"> property:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">For documents with content types </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xml</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/xml</span></code><span class="deltaxml-old" style="background:#FF5555">, and </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/*+xml</span></code><span class="deltaxml-old" style="background:#FF5555"> (except for </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xhtml+xml</span></code><span class="deltaxml-old" style="background:#FF5555">), serialization method </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xml</span></code><span class="deltaxml-old" style="background:#FF5555"> should be used.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">For documents with content type </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xhtml+xml</span></code><span class="deltaxml-old" style="background:#FF5555"> serialization method </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xhtml</span></code><span class="deltaxml-old" style="background:#FF5555"> should be used.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">For documents with content type </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/html</span></code><span class="deltaxml-old" style="background:#FF5555"> serialization method </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">html</span></code><span class="deltaxml-old" style="background:#FF5555"> should be used.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">For documents with </span><em class="glossterm"><a href="#dt-text-media-type"><span class="deltaxml-old" style="background:#FF5555">text media types</span></a></em><span class="deltaxml-old" style="background:#FF5555"> serialization method </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text</span></code><span class="deltaxml-old" style="background:#FF5555"> should be used.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">For documents with </span><em class="glossterm"><a href="#dt-JSON-media-type"><span class="deltaxml-old" style="background:#FF5555">JSON media types</span></a></em><span class="deltaxml-old" style="background:#FF5555"> serialization method </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">json</span></code><span class="deltaxml-old" style="background:#FF5555"> should be used.</span></p></li><li><p><span id="impl-39"><span class="deltaxml-old" style="background:#FF5555">The serialization method for documents with other media types is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">If serialization method </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xml</span></code><span class="deltaxml-old" style="background:#FF5555"> is choosen either explicitly or implicitly, the following default values </span><span class="rfc2119" id="serialization.6.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be used:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">Parameter </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">version</span></code><span class="deltaxml-old" style="background:#FF5555"> is set to </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">1.0</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Parameter </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">encoding</span></code><span class="deltaxml-old" style="background:#FF5555"> is set to </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">UTF-8</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Parameter </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">omit-xml-declaration</span></code><span class="deltaxml-old" style="background:#FF5555"> is set to </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">true</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">These default values also apply to serialization method </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">XHTML</span></code><span class="deltaxml-old" style="background:#FF5555"> (if it is supported).</span></p><p><a id="err.inline.D0020"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0020"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0020</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the combination of serialization options specified or defaulted is not allowed. Implementations </span><span class="rfc2119" id="serialization.9.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> check that all of the specified serialization options are allowed if they serialize the specified output. If the specified output is not being serialized implementations </span><span class="rfc2119" id="serialization.9.3"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> but are not required to check that the specified options are allowed.</span></p><p><span class="deltaxml-old" style="background:#FF5555">For XML outputs, see </span><a href="#xproc-xml-serialization" title="XML serialization"><span class="deltaxml-old" style="background:#FF5555">Section 16.3.1.1, “XML serialization”</span></a><span class="deltaxml-old" style="background:#FF5555">. For non-XML outputs, see </span><a href="#xproc-non-xml-serialization" title="Non-XML serialization"><span class="deltaxml-old" style="background:#FF5555">Section 16.3.1.2, “Non-XML serialization”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><section id="xproc-xml-serialization" class="section"><div class="section-titlepage"><h5><span class="deltaxml-old" style="background:#FF5555">16.3.1.1 XML serialization</span></h5></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The names and values of XML serialization parameters are defined by [</span><a href="#xml-serialization-31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Serialization</span></span></a><span class="deltaxml-old" style="background:#FF5555">].</span></p><p><span class="deltaxml-old" style="background:#FF5555">The following parameters may be present in the serialization map:</span></p><div class="variablelist"><dl><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">byte-order-mark</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.1.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a boolean. If it's not specified, the default varies by encoding: for UTF-16 it's true, for all others, it's false.</span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">cdata-section-elements</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.2.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a list of </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">EQName</span></code><span class="deltaxml-old" style="background:#FF5555">s. They are interpreted as element names.</span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">doctype-public</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.3.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a string. The public identifier of the doctype.</span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">doctype-system</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.4.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be an </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">anyURI</span></code><span class="deltaxml-old" style="background:#FF5555">. The system identifier of the doctype. It need not be absolute, and is not resolved.</span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">encoding</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">A character set name. </span><span id="impl-40"><span class="deltaxml-old" style="background:#FF5555">If no </span><code class="option"><span class="deltaxml-old" style="background:#FF5555">encoding</span></code><span class="deltaxml-old" style="background:#FF5555"> is specified, the encoding used is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">. If the </span><code class="option"><span class="deltaxml-old" style="background:#FF5555">method</span></code><span class="deltaxml-old" style="background:#FF5555"> is “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xml</span></code><span class="deltaxml-old" style="background:#FF5555">” or “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xhtml</span></code><span class="deltaxml-old" style="background:#FF5555">”, the implementation defined encoding </span><span class="rfc2119" id="xproc-xml-serialization.4.5.2.1.1.6"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be either UTF-8 or UTF-16.</span></span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">escape-uri-attributes</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.6.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a boolean. It is ignored unless the specified method is “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xhtml</span></code><span class="deltaxml-old" style="background:#FF5555">” or “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">html</span></code><span class="deltaxml-old" style="background:#FF5555">”.</span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">include-content-type</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.7.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a boolean. It is ignored unless the specified method is “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xhtml</span></code><span class="deltaxml-old" style="background:#FF5555">” or “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">html</span></code><span class="deltaxml-old" style="background:#FF5555">”.</span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">indent</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.8.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a boolean.</span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">media-type</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.9.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a string. It specifies the media type (MIME content type). If not specified, the default varies according to the </span><code class="option"><span class="deltaxml-old" style="background:#FF5555">method</span></code><span class="deltaxml-old" style="background:#FF5555">:</span></p><div class="variablelist"><dl><dt><span class="term"><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xml</span></code></span></dt><dd><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xml</span></code></p></dd><dt><span class="term"><code class="literal"><span class="deltaxml-old" style="background:#FF5555">html</span></code></span></dt><dd><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/html</span></code></p></dd><dt><span class="term"><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xhtml</span></code></span></dt><dd><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xhtml+xml</span></code></p></dd><dt><span class="term"><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text</span></code></span></dt><dd><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/plain</span></code></p></dd><dt><span class="term"><code class="literal"><span class="deltaxml-old" style="background:#FF5555">json</span></code></span></dt><dd><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/json</span></code></p></dd></dl></div><p><span id="impl-41"><span class="deltaxml-old" style="background:#FF5555">For methods other than </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xml</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">html</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xhtml</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text</span></code><span class="deltaxml-old" style="background:#FF5555">, and </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">json</span></code><span class="deltaxml-old" style="background:#FF5555">; the </span><code class="option"><span class="deltaxml-old" style="background:#FF5555">media-type</span></code><span class="deltaxml-old" style="background:#FF5555"> is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span></span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">method</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.10.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be an </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">EQName</span></code><span class="deltaxml-old" style="background:#FF5555">. It specifies the serialization method.</span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">normalization-form</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.11.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be an NMTOKEN, one of the enumerated values </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">NFC</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">NFD</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">NFKC</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">NFKD</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">fully-normalized</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">none</span></code><span class="deltaxml-old" style="background:#FF5555"> or an implementation-defined value.</span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">omit-xml-declaration</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.12.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a boolean.</span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">standalone</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.13.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be an NMTOKEN, one of the enumerated values </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">true</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">false</span></code><span class="deltaxml-old" style="background:#FF5555">, or </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">omit</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">undeclare-prefixes</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.14.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a boolean.</span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">use-character-maps</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.15.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a map (</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">map(xs:string, xs:string)</span></code><span class="deltaxml-old" style="background:#FF5555">). The keys are the characters to be mapped (as </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></code><span class="deltaxml-old" style="background:#FF5555"> instances). The corresponding value for each key is the string to be substituted for that character. </span></p></dd><dt><span class="term"><code class="option"><span class="deltaxml-old" style="background:#FF5555">version</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The value of this option </span><span class="rfc2119" id="xproc-xml-serialization.4.16.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a string.</span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">In order to be consistent with the rest of this specification, boolean values for the serialization parameters must use one of the XML Schema lexical forms for boolean: "true", "false", "1", or "0". This is different from the [</span><a href="#xml-serialization-31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Serialization</span></span></a><span class="deltaxml-old" style="background:#FF5555">] specification which uses “yes” and “no”. No change in semantics is implied by this different spelling.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="option"><span class="deltaxml-old" style="background:#FF5555">method</span></code><span class="deltaxml-old" style="background:#FF5555"> option controls the serialization method used by this component with standard values of 'html', 'xml', 'xhtml', 'text' and 'json' but only the 'xml' value is required to be supported. The interpretation of the remaining options is as specified in [</span><a href="#xml-serialization-31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Serialization</span></span></a><span class="deltaxml-old" style="background:#FF5555">].</span></p><p><span id="impl-42"><span class="deltaxml-old" style="background:#FF5555">Implementations may support other method values but their results are </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">A minimally conforming implementation must support the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">xml</span></code><span class="deltaxml-old" style="background:#FF5555"> output method with the following option values:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">version</span></code><span class="deltaxml-old" style="background:#FF5555"> must support the value </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">1.0</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">encoding</span></code><span class="deltaxml-old" style="background:#FF5555"> must support the values </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">UTF-8</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">omit-xml-declaration</span></code><span class="deltaxml-old" style="background:#FF5555"> must be supported. If the value is not specified or has the value </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">no</span></code><span class="deltaxml-old" style="background:#FF5555">, an XML declaration must be produced.</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">All other option values may be ignored for the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">xml</span></code><span class="deltaxml-old" style="background:#FF5555"> output method.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If a processor chooses to implement an option for serialization, it must conform to the semantics defined in the [</span><a href="#xml-serialization-31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Serialization</span></span></a><span class="deltaxml-old" style="background:#FF5555">] specification.</span></p></div></section><section id="xproc-non-xml-serialization" class="section"><div class="section-titlepage"><h5><span class="deltaxml-old" style="background:#FF5555">16.3.1.2 Non-XML serialization</span></h5></div><div class="content"><p><span id="impl-43"><span class="deltaxml-old" style="background:#FF5555">The names and values of non-XML serialization parameters are </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></div></section></div></section></div></section><section id="variables-options" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.4 Variables and Options</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Variables and options provide a mechanism for pipeline authors to construct temporary results and hold onto them for reuse.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Variables are created in compound steps and, like XSLT variables, are single assignment, though they may be shadowed by subsequent declarations of other variables with the same name.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Options can be declared on atomic or compound steps. The value of an option can be specified by the caller invoking the step. Any value specified by the caller takes precedence over the default value of the option.</span></p><section id="p.variable" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">16.4.1 p:variable</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code><span class="deltaxml-old" style="background:#FF5555"> declares a variable and associates a value with it. Variable declarations may optionally specify the type of the variable using an [</span><a href="#xpath31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">] </span><a href="https://www.w3.org/TR/xpath-31/#dt-sequence-type"><span class="deltaxml-old" style="background:#FF5555">sequence Type</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:variable</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">name</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">EQName</span></var><span class="deltaxml-old" style="background:#FF5555">  as? = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathSequenceType</span></var><span class="deltaxml-old" style="background:#FF5555">  static? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">select</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  collection? = { </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  href? = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  pipe? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">  visibility? = </span><var><span class="deltaxml-old" style="background:#FF5555">private|public</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.empty"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.document"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.pipe"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.inline"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a><span class="deltaxml-old" style="background:#FF5555">)*) | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">anyElement</span></var><span class="deltaxml-old" style="background:#FF5555">*)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:variable&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The attributes that can appear on </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code><span class="deltaxml-old" style="background:#FF5555"> are </span><a href="#common-attr"><span class="deltaxml-old" style="background:#FF5555">the common attributes</span></a><span class="deltaxml-old" style="background:#FF5555"> and:</span></p><div class="variablelist"><dl><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">name</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The name of the variable </span><span class="rfc2119" id="p.variable.5.1.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be an EQName. If it does not contain a prefix then it is in no namespace. </span><a id="err.inline.S0028"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0028"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0028</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to declare an option or variable in the XProc namespace. </span><a id="err.inline.S0087"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0087"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0087</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the name attribute on </span><a href="#p.option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code><span class="deltaxml-old" style="background:#FF5555"> has a prefix which is not bound to a namespace. </span></p><p><a id="err.inline.S0088"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0088"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0088</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the qualified name of a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code><em class="glossterm"><a href="#dt-shadow"><span class="deltaxml-old" style="background:#FF5555">shadows</span></a></em><span class="deltaxml-old" style="background:#FF5555"> the name of a static variable or option. </span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">as</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The type of the value may be specified in the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">as</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute using an XProc sequence type, see </span><a href="#varopt-types" title="Variable and option types"><span class="deltaxml-old" style="background:#FF5555">Section 11.4, “Variable and option types”</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">static</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">An indication of whether the variable is to be evaluated statically or not. See </span><a href="#statics" title="Static Options and Variables"><span class="deltaxml-old" style="background:#FF5555">Section 11.3, “Static Options and Variables”</span></a><span class="deltaxml-old" style="background:#FF5555">. If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">static</span></code><span class="deltaxml-old" style="background:#FF5555"> is not specified, it defaults to “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">false</span></code><span class="deltaxml-old" style="background:#FF5555">”.</span></p><p><a id="err.inline.S0098"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0098"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0098</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a variable is declared as static and the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code><span class="deltaxml-old" style="background:#FF5555"> has a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">pipe</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute or </span><a href="#p.pipe"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code></a><span class="deltaxml-old" style="background:#FF5555"> children.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The variable's value is specified with a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute </span><span class="rfc2119" id="p.variable.5.4.2.1.3"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be specified. The content of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is an XPath expression which will be evaluated to provide the value of the variable. </span><a id="err.inline.S0094"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0094"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0094</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code><span class="deltaxml-old" style="background:#FF5555"> does not have a select attribute. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> expression is evaluated as an XPath expression using the appropriate context as described in </span><a href="#xpath-context" title="XPath in XProc"><span class="deltaxml-old" style="background:#FF5555">Section 7.2.2, “XPath in XProc”</span></a><span class="deltaxml-old" style="background:#FF5555">, for the enclosing </span><em class="glossterm"><a href="#dt-container"><span class="deltaxml-old" style="background:#FF5555">container</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span><span id="impl-44"><span class="deltaxml-old" style="background:#FF5555">The precise details about what XPath expressions are allowed (for example, can the expression declare a function) is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">collection</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">collection</span></code><span class="deltaxml-old" style="background:#FF5555"> is unspecified or has the value </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">false</span></code><span class="deltaxml-old" style="background:#FF5555">, then it has no effect. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">collection</span></code><span class="deltaxml-old" style="background:#FF5555"> is </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">true</span></code><span class="deltaxml-old" style="background:#FF5555">, the context item is undefined. All of the documents that appear on the connection for the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code><span class="deltaxml-old" style="background:#FF5555"> will be available as the default collection within </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> expression.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">visibility</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code><span class="deltaxml-old" style="background:#FF5555"> is a child of a </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555">, the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">visibility</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute controls whether the variable is visible to an importing pipeline. If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">visibility</span></code><span class="deltaxml-old" style="background:#FF5555"> is set to “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">private</span></code><span class="deltaxml-old" style="background:#FF5555">”, the variable is visible inside the </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555"> but not visible to any pipeline importing the </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555">. If the visibility attribute is missing, “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">public</span></code><span class="deltaxml-old" style="background:#FF5555">” is assumed. </span><a id="err.inline.S0093"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0093"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0093</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">visibility</span></code><span class="deltaxml-old" style="background:#FF5555"> is specified on a </span><a href="#p.option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code><span class="deltaxml-old" style="background:#FF5555"> that is not a child of </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">As described in </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">pipe</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">As described in </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555"> allows the pipeline author to exclude some namespace declarations in inline content, see </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">Steps are connected together by their input and output ports. Variables are connected to steps by their input, which provides the context node for the expression, and by the expressions that contain references to them. Any step which contains a reference to a variable effectively consumes the “output” of the variable. </span><a id="err.inline.S0076"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0076"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0076</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if there are any loops in the connections between steps and variables: no step can refer to a variable if there is any sequence of connections from that step that leads back to the input that provides the context node for the expression that defines the value of the variable. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">collection</span></code><span class="deltaxml-old" style="background:#FF5555"> is true, the context item for the expression is undefined. Otherwise, the context item for the expression comes from the document connections, if they are specified. If they are not specified, the context item comes from the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (computed as if </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code><span class="deltaxml-old" style="background:#FF5555"> was an atomic step). If no </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> exists, the context item is undefined.</span></p><p><a id="err.inline.D0026"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0026"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0026</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> expression makes reference to the context node, size, or position when the context item is undefined. </span><a id="err.inline.D0065.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0065"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0065</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to refer to the context item, size, or position if a sequence of documents appears on the connection that provides the context. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Since all </span><em class="glossterm"><a href="#dt-in-scope-bindings"><span class="deltaxml-old" style="background:#FF5555">in-scope bindings</span></a></em><span class="deltaxml-old" style="background:#FF5555"> are present in the Processor XPath Context as variable bindings, </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> expressions may refer to the value of </span><em class="glossterm"><a href="#dt-in-scope-bindings"><span class="deltaxml-old" style="background:#FF5555">in-scope bindings</span></a></em><span class="deltaxml-old" style="background:#FF5555"> by variable reference.</span></p></div></section><section id="p.option" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">16.4.2 p:option</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code><span class="deltaxml-old" style="background:#FF5555"> declares an option and associates a default value with it. Option declarations may optionally specify the type of the option using an [</span><a href="#xpath31"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">] </span><a href="https://www.w3.org/TR/xpath-31/#dt-sequence-type"><span class="deltaxml-old" style="background:#FF5555">sequence Type</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:option</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">name</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">EQName</span></var><span class="deltaxml-old" style="background:#FF5555">  as? = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathSequenceType</span></var><span class="deltaxml-old" style="background:#FF5555">  values? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  static? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  required? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  select? = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  visibility? = </span><var><span class="deltaxml-old" style="background:#FF5555">private|public</span></var><span class="deltaxml-old" style="background:#FF5555"> /&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The attributes that can appear on </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code><span class="deltaxml-old" style="background:#FF5555"> are </span><a href="#common-attr"><span class="deltaxml-old" style="background:#FF5555">the common attributes</span></a><span class="deltaxml-old" style="background:#FF5555"> and:</span></p><div class="variablelist"><dl><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">name</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The name of the option </span><span class="rfc2119" id="p.option.5.1.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be an EQName. If it does not contain a prefix then it is in no namespace. </span><a id="err.inline.S0028.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0028"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0028</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to declare an option or variable in the XProc namespace. </span><a id="err.inline.S0087.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0087"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0087</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the name attribute on </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> has a prefix which is not bound to a namespace. </span></p><p><a id="err.inline.S0088.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0088"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0088</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the qualified name of a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code><em class="glossterm"><a href="#dt-shadow"><span class="deltaxml-old" style="background:#FF5555">shadows</span></a></em><span class="deltaxml-old" style="background:#FF5555"> the name of a static variable or option. </span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">as</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The type of the value may be specified in the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">as</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute using an XProc sequence type, see </span><a href="#varopt-types" title="Variable and option types"><span class="deltaxml-old" style="background:#FF5555">Section 11.4, “Variable and option types”</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">values</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">A list of acceptable values may be specified in the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">values</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. If specified, the value of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">values</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute </span><span class="rfc2119" id="p.option.5.3.2.1.3"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a list of atomic values expressed as an XPath sequence, for example: </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">('one', 'two', 'three')</span></code><span class="deltaxml-old" style="background:#FF5555">. </span><a id="err.inline.S0101"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0101"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0101</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the values list is not an XPath sequence of atomic values. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The values list is an additional constraint on the acceptable values for the option. The option value must satisfy the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">as</span></code><span class="deltaxml-old" style="background:#FF5555"> type, if one is provided, and must be equal to (XPath “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">eq</span></code><span class="deltaxml-old" style="background:#FF5555">”) one of the listed </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">values</span></code><span class="deltaxml-old" style="background:#FF5555">. It is possible to combine </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">as</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">values</span></code><span class="deltaxml-old" style="background:#FF5555"> in ways that exclude all actual values (for example, </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">as="xs:integer"</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">values="(1.5,’pi’)"</span></code><span class="deltaxml-old" style="background:#FF5555">). Doing so will make it impossible to specify a value for the option.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">static</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">An indication of whether the option is to be evaluated statically or not. See </span><a href="#statics" title="Static Options and Variables"><span class="deltaxml-old" style="background:#FF5555">Section 11.3, “Static Options and Variables”</span></a><span class="deltaxml-old" style="background:#FF5555">. If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">static</span></code><span class="deltaxml-old" style="background:#FF5555"> is not specified, it defaults to “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">false</span></code><span class="deltaxml-old" style="background:#FF5555">”.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">required</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">An option may declare that it is required by specifying the value </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">true</span></code><span class="deltaxml-old" style="background:#FF5555"> for the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">required</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. </span><a id="err.inline.S0018"></a><span class="deltaxml-old" style="background:#FF5555">If an option is required, it is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0018"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0018</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to invoke the step without specifying a value for that option. If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">required</span></code><span class="deltaxml-old" style="background:#FF5555"> is not specified, it defaults to “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">false</span></code><span class="deltaxml-old" style="background:#FF5555">”.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If an option is not required, its default value may be specified with a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. If no default value is specified, the default value is the empty sequence. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If specified, the content of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is an XPath expression which will be evaluated to provide the default value for the option. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The default value of an option is specified with an XPath expression on the </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> that defines the step signature. It must be a statically valid expression at that point. Consequently, if it contains variable references, they can only be references to preceding options on the step. </span><a id="err.inline.D0026.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0026"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0026</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> expression makes reference to the context node, size, or position.</span></p><p><span id="impl-45"><span class="deltaxml-old" style="background:#FF5555">The precise details about what XPath expressions are allowed (for example, can the expression declare a function) is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">visibility</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code><span class="deltaxml-old" style="background:#FF5555"> is a child of a </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555">, the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">visibility</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute controls whether the option is visible to an importing pipeline. If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">visibility</span></code><span class="deltaxml-old" style="background:#FF5555"> is set to “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">private</span></code><span class="deltaxml-old" style="background:#FF5555">”, the option is visible inside the </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555"> but not visible to any pipeline importing the </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555">. If the visibility attribute is missing, “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">public</span></code><span class="deltaxml-old" style="background:#FF5555">” is assumed. </span><a id="err.inline.S0093.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0093"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0093</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">visibility</span></code><span class="deltaxml-old" style="background:#FF5555"> is specified on a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> that is not a child of </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd></dl></div><p><a id="err.inline.S0004"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0004"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0004</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to declare two or more options on the same step with the same name.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The following errors apply to options:</span></p><div class="itemizedlist"><ul><li><p><a id="err.inline.S0017"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0017"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0017</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to specify that an option is both </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">required</span></code><em><span class="deltaxml-old" style="background:#FF5555">and</span></em><span class="deltaxml-old" style="background:#FF5555"> has a default value.</span></p></li><li><p><a id="err.inline.S0095"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0095"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0095</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to specify that an option is both </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">required</span></code><em><span class="deltaxml-old" style="background:#FF5555">and</span></em><span class="deltaxml-old" style="background:#FF5555"> static.</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">The pipeline author may use </span><a href="#p.with-option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> on a step when it is invoked. Values specified with </span><a href="#p.with-option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> override any default values specified.</span></p></div></section><section id="p.with-option" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">16.4.3 p:with-option</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></code><span class="deltaxml-old" style="background:#FF5555"> provides an actual value for an option when a step is invoked.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:with-option</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">name</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">EQName</span></var><span class="deltaxml-old" style="background:#FF5555">  as? = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathSequenceType</span></var><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">select</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  collection? = { </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  href? = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  pipe? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.empty"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.document"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.pipe"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.inline"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a><span class="deltaxml-old" style="background:#FF5555">)*) | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">anyElement</span></var><span class="deltaxml-old" style="background:#FF5555">*)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:with-option&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The attributes that can appear on </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></code><span class="deltaxml-old" style="background:#FF5555"> are </span><a href="#common-attr"><span class="deltaxml-old" style="background:#FF5555">the common attributes</span></a><span class="deltaxml-old" style="background:#FF5555"> and:</span></p><div class="variablelist"><dl><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">name</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The name of the option </span><span class="rfc2119" id="p.with-option.5.1.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be a EQName. If it does not contain a prefix then it is in no namespace. </span><a id="err.inline.S0031"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0031"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0031</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to use an option name in </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></code><span class="deltaxml-old" style="background:#FF5555"> if the step type being invoked has not declared an option with that name. </span></p><p><a id="err.inline.S0080"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0080"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0080</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to include more than one </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></code><span class="deltaxml-old" style="background:#FF5555"> with the same option name as part of the same step invocation.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">as</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The type of the value may be specified in the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">as</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute using an XProc sequence type, see </span><a href="#varopt-types" title="Variable and option types"><span class="deltaxml-old" style="background:#FF5555">Section 11.4, “Variable and option types”</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The actual value is specified with a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute </span><span class="rfc2119" id="p.with-option.5.3.2.1.3"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be specified. The value of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is an XPath expression which will be evaluated to provide the value of the variable.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">collection</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">collection</span></code><span class="deltaxml-old" style="background:#FF5555"> is unspecified or has the value </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">false</span></code><span class="deltaxml-old" style="background:#FF5555">, then it has no effect.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">collection</span></code><span class="deltaxml-old" style="background:#FF5555"> is </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">true</span></code><span class="deltaxml-old" style="background:#FF5555">, the context item is undefined. All of the documents that appear on the connection for the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></code><span class="deltaxml-old" style="background:#FF5555"> will be available as the default collection within </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> expression.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">As described in </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">pipe</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">As described in </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555"> allows the pipeline author to exclude some namespace declarations in inline content, see </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">Any </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></code><span class="deltaxml-old" style="background:#FF5555"> which contains a reference to a variable effectively consumes the “output” of the </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> that defines that variable. </span><a id="err.inline.S0076.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0076"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0076</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if there are any loops in the connections between steps and variables: no step can refer to a variable if there is any sequence of connections from that step that leads back to the input that provides the context node for the expression that defines the value of the variable. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">collection</span></code><span class="deltaxml-old" style="background:#FF5555"> is true, the context item for the expression is undefined. Otherwise, the context item for the expression comes from the document connections, if they are specified. If they are not specified, the context item comes from the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the step. If no </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> exists, the context item is undefined.</span></p><p><a id="err.inline.D0026.2"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0026"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0026</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> expression makes reference to the context node, size, or position when the context item is undefined. </span><a id="err.inline.D0065.2"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0065"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0065</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to refer to the context item, size, or position if a sequence of documents appears on the connection that provides the context. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Since all </span><em class="glossterm"><a href="#dt-in-scope-bindings"><span class="deltaxml-old" style="background:#FF5555">in-scope bindings</span></a></em><span class="deltaxml-old" style="background:#FF5555"> are present in the Processor XPath Context as variable bindings, </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">select</span></code><span class="deltaxml-old" style="background:#FF5555"> expressions may refer to the value of </span><em class="glossterm"><a href="#dt-in-scope-bindings"><span class="deltaxml-old" style="background:#FF5555">in-scope bindings</span></a></em><span class="deltaxml-old" style="background:#FF5555"> by variable reference. </span></p><p><a id="err.inline.S0092"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0092"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0092</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></code><span class="deltaxml-old" style="background:#FF5555"> attempts to change the value of an option that is declared static. See </span><a href="#statics" title="Static Options and Variables"><span class="deltaxml-old" style="background:#FF5555">Section 11.3, “Static Options and Variables”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><section id="option-shortcut" class="section"><div class="section-titlepage"><h5><span class="deltaxml-old" style="background:#FF5555">16.4.3.1 Syntactic Shortcut for Option Values</span></h5></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Namespace qualified attributes on a step are </span><em class="glossterm"><a href="#dt-extension-attribute"><span class="deltaxml-old" style="background:#FF5555">extension attributes</span></a></em><span class="deltaxml-old" style="background:#FF5555">. Attributes, other than </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">name</span></code><span class="deltaxml-old" style="background:#FF5555">, that are not namespace qualified are treated as a syntactic shortcut for specifying the value of an option. In other words, the following two steps are equivalent:</span></p><p><span class="deltaxml-old" style="background:#FF5555">The first step uses the standard </span><a href="#p.with-option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> syntax:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;ex:stepType&gt; &lt;p:with-option name="option-name" select="'some value'"/&gt; &lt;/ex:stepType&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">The second step uses the syntactic shortcut:</span></p><pre class="programlisting language-markup"><code><span class="deltaxml-old" style="background:#FF5555">&lt;ex:stepType option-name="some value"/&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">There are some limitations to this shortcut syntax:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">It only applies to option names that are not in a namespace.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">It only applies to option names that are not otherwise used on the step, such as “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">name</span></code><span class="deltaxml-old" style="background:#FF5555">”.</span></p></li></ol></div><p><span class="deltaxml-old" style="background:#FF5555">For the value of an option's syntactic shortcut attribute, the following applies:</span></p><div class="itemizedlist"><ul><li><p><span id="dt-map-attribute" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">map attribute</span></em><span class="deltaxml-old" style="background:#FF5555"> is an option's syntactic shortcut attribute for which the option's sequence type is a map or array.]</span></span><span class="deltaxml-old" style="background:#FF5555"> The attribute's value is interpreted directly as an XPath expression, which must result in a value of the applicable datatype.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">For any other option's sequence type it is considered an </span><em class="glossterm"><a href="#dt-attribute-value-template"><span class="deltaxml-old" style="background:#FF5555">attribute value template</span></a></em><span class="deltaxml-old" style="background:#FF5555">. The context node for the attribute value template comes from the default readable port for the step on which they occur. If there is no such port, the context node is undefined.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The attribute's string value, after the attribute value template expansion, is used as the value of the option. It must be possible to convert this string to the option's sequence type.</span></p></li></ul></div><p><a id="err.inline.S0027"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0027"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0027</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if an option is specified with both the shortcut form and the long form. </span><a id="err.inline.S0031.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0031"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0031</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to use an option on an </span><em class="glossterm"><a href="#dt-atomic-step"><span class="deltaxml-old" style="background:#FF5555">atomic step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> that is not declared on steps of that type. </span><a id="err.inline.S0092.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0092"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0092</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to specify a value for an option that is declared static. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The syntactic shortcuts apply equally to standard atomic steps and extension atomic steps.</span></p></div></section></div></section></div></section><section id="p.declare-step" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.5 p:declare-step</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code><span class="deltaxml-old" style="background:#FF5555"> provides the type and </span><em class="glossterm"><a href="#dt-signature"><span class="deltaxml-old" style="background:#FF5555">signature</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of a pipeline or an </span><em class="glossterm"><a href="#dt-atomic-step"><span class="deltaxml-old" style="background:#FF5555">atomic step</span></a></em><span class="deltaxml-old" style="background:#FF5555">. Pipelines contain a subpipeline which defines what the declared step does. Atomic steps have an implementation defined elsewhere in some other way.</span></p><p><span id="impl-46"><span class="deltaxml-old" style="background:#FF5555">When a declared step is evaluated directly by the XProc processor (as opposed to occurring as an atomic step in some </span><em class="glossterm"><a href="#dt-container"><span class="deltaxml-old" style="background:#FF5555">container</span></a></em><span class="deltaxml-old" style="background:#FF5555">), how the input and output ports are connected to documents is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">A step declaration is not a </span><a href="#step-concept"><span class="deltaxml-old" style="background:#FF5555">step</span></a><span class="deltaxml-old" style="background:#FF5555"> in its own right. Sibling steps cannot refer to the inputs or outputs of a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code><span class="deltaxml-old" style="background:#FF5555"> using </span><a href="#p.pipe"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code></a><span class="deltaxml-old" style="background:#FF5555">; only instances of the type can be referenced.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Most pipeline authors use the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code><span class="deltaxml-old" style="background:#FF5555"> element to declare a pipeline.</span></p><section id="declare-pipelines" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">16.5.1 Declaring pipelines</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">When a </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> declares a pipeline, that pipeline encapsulates the behavior of the specified </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555">. Its children declare inputs, outputs, and options that the pipeline exposes and identify the steps in its subpipeline.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:declare-step</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  type? = </span><var><span class="deltaxml-old" style="background:#FF5555">EQName</span></var><span class="deltaxml-old" style="background:#FF5555">  psvi-required? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  xpath-version? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">  version? = "3.0"</span><span class="deltaxml-old" style="background:#FF5555">  visibility? = </span><var><span class="deltaxml-old" style="background:#FF5555">private|public</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.import"><span class="deltaxml-old" style="background:#FF5555">p:import</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.import-functions"><span class="deltaxml-old" style="background:#FF5555">p:import-functions</span></a><span class="deltaxml-old" style="background:#FF5555">)*,</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.input"><span class="deltaxml-old" style="background:#FF5555">p:input</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.option"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.variable"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a><span class="deltaxml-old" style="background:#FF5555">)*,</span><span class="deltaxml-old" style="background:#FF5555">    </span><a href="#p.declare-step"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">    </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">?</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:declare-step&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The attributes that can appear on </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> are </span><a href="#common-attr"><span class="deltaxml-old" style="background:#FF5555">the common attributes</span></a><span class="deltaxml-old" style="background:#FF5555"> and:</span></p><div class="variablelist"><dl><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">name</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">name</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute provides a name for the step. This name can be used within the subpipeline to refer back to the declaration, for example, to read from its inputs. </span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">type</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">type</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute provides a type for the step. The value of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">type</span></code><span class="deltaxml-old" style="background:#FF5555"> can be from any namespace provided that the expanded-QName of the value has a non-null namespace URI. </span><a id="err.inline.S0025"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0025"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0025</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the expanded-QName value of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">type</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is in no namespace or in the XProc namespace. Except as described in </span><a href="#versioning-considerations" title="Versioning Considerations"><span class="deltaxml-old" style="background:#FF5555">Section 13, “Versioning Considerations”</span></a><span class="deltaxml-old" style="background:#FF5555">, the XProc namespace </span><span class="rfc2119" id="declare-pipelines.5.2.2.1.5"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> be used in the type of steps. Neither users nor implementers may define additional steps in the XProc namespace. </span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">psvi-required</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">psvi-required</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute allows the author to declare that a step relies on the processor's ability to pass PSVI annotations between steps, see </span><a href="#psvi-support" title="PSVIs in XProc"><span class="deltaxml-old" style="background:#FF5555">Section 9, “PSVIs in XProc”</span></a><span class="deltaxml-old" style="background:#FF5555">. If the attribute is not specified, the value “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">false</span></code><span class="deltaxml-old" style="background:#FF5555">” is assumed. </span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">xpath-version</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The requested </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">xpath-version</span></code><span class="rfc2119" id="declare-pipelines.5.4.2.1.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be used to evaluate XPath expressions subject to the constraints outlined in </span><a href="#xpath-context" title="XPath in XProc"><span class="deltaxml-old" style="background:#FF5555">Section 7.2.2, “XPath in XProc”</span></a><span class="deltaxml-old" style="background:#FF5555">. If the attribute is not specified, the value “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">3.1</span></code><span class="deltaxml-old" style="background:#FF5555">” is assumed.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The a description of </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555">, see </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">version</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">version</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute identifies the version of XProc for which this step declaration was authored. If the </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> has no ancestors in the XProc namespace, then it </span><span class="rfc2119" id="declare-pipelines.5.6.2.1.3"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> have a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">version</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. </span><a id="err.inline.S0062.1"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0062"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0062</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a required version attribute is not present. See </span><a href="#versioning-considerations" title="Versioning Considerations"><span class="deltaxml-old" style="background:#FF5555">Section 13, “Versioning Considerations”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">visibility</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If the </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is a child of a </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555"> the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">visibility</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute controls whether the step is visible to an importing pipeline. If </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">visibility</span></code><span class="deltaxml-old" style="background:#FF5555"> is set to </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">private</span></code><span class="deltaxml-old" style="background:#FF5555">, the step type is only visible inside the </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and is not visible to any pipeline importing the </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555">. If the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">visibility</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is missing, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">public</span></code><span class="deltaxml-old" style="background:#FF5555"> is assumed. If the </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is not a child of a </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555"> the attribute has no effect and is ignored. </span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">In the general case, the children of a </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> can be grouped into several sections. All of these sections, except the subpipeline, may be empty.</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">Imports must come first.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The prologue follows the imports. </span><span id="dt-prologue" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">prologue</span></em><span class="deltaxml-old" style="background:#FF5555"> consists of the </span><a href="#p.input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:input</span></code></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#p.output"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code></a><span class="deltaxml-old" style="background:#FF5555">, and </span><a href="#p.option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements. The prologue may also contain </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements, but if it does, they must be declared statically.]</span></span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The prologue may be followed by any number of inline </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements that declare additional steps.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Finally, there must be at least one step in the subpipeline.</span></p></li></ol></div><div class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">In the absence of any inline declared steps, it is possible for the prologue to end with a </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and the subpipeline to begin with a </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555">. This does not introduce any ambiguity. In this case, the first non-static variable marks the beginning of the subpipeline. </span></p></div></div><p><span class="deltaxml-old" style="background:#FF5555">Neither options nor variables in the prologue may shadow each other. </span><a id="err.inline.S0091"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0091"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0091</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a </span><a href="#p.option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> declared before the subpipeline begins shadows another option or variable declared within the same </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555">. (Within the subpipeline, variables may shadow options and lexically preceding (non-static) variables.) </span></p><p><span class="deltaxml-old" style="background:#FF5555">The prologue ends with additional </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements, if any, and is followed by the subpipeline. Any step imported or declared in the prologue of a pipeline may be invoked as a step within the subpipeline of that pipeline.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The environment inherited by the </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is the </span><em class="glossterm"><a href="#dt-empty-environment"><span class="deltaxml-old" style="background:#FF5555">empty environment</span></a></em><span class="deltaxml-old" style="background:#FF5555"> with these modifications:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">All of the declared inputs are added to the </span><em class="glossterm"><a href="#dt-readable-ports"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></a></em><span class="deltaxml-old" style="background:#FF5555"> in the environment.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">If a </span><em class="glossterm"><a href="#dt-primary-input-port"><span class="deltaxml-old" style="background:#FF5555">primary input port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is declared, that port is the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555">, otherwise the default readable port is undefined.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="glossterm"><a href="#dt-in-scope-bindings"><span class="deltaxml-old" style="background:#FF5555">in-scope bindings</span></a></em><span class="deltaxml-old" style="background:#FF5555"> at the beginning of a </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> are limited to the lexically preceding, statically declared options and variables.</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">If a </span><em class="glossterm"><a href="#dt-primary-output-port"><span class="deltaxml-old" style="background:#FF5555">primary output port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is declared and that port has no </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555">, then it is connected to the </span><em class="glossterm"><a href="#dt-primary-output-port"><span class="deltaxml-old" style="background:#FF5555">primary output port</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the </span><em class="glossterm"><a href="#dt-last-step"><span class="deltaxml-old" style="background:#FF5555">last step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> in the </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span><a id="err.inline.S0006.2"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0006"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0006</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the primary output port is unconnected and the </span><em class="glossterm"><a href="#dt-last-step"><span class="deltaxml-old" style="background:#FF5555">last step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> in the subpipeline does not have a primary output port.</span></p></div></section><section id="declare-atomic-steps" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">16.5.2 Declaring atomic steps</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The distinction between an atomic step declaration and a pipeline declaration hinges on the presence or absense of a subpipeline. An atomic step declaration does not have a subpipeline. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Atomic step declarations may not import other pipelines or functions, may not declare static variables, and may not declare additional steps. In other words, the content of an atomic step declaration consists exclusively of </span><a href="#p.input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:input</span></code></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#p.output"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code></a><span class="deltaxml-old" style="background:#FF5555">, and </span><a href="#p.option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:declare-step</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  type? = </span><var><span class="deltaxml-old" style="background:#FF5555">EQName</span></var><span class="deltaxml-old" style="background:#FF5555">  psvi-required? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  xpath-version? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">  version? = "3.0"</span><span class="deltaxml-old" style="background:#FF5555">  visibility? = </span><var><span class="deltaxml-old" style="background:#FF5555">private|public</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.input"><span class="deltaxml-old" style="background:#FF5555">p:input</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.option"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a><span class="deltaxml-old" style="background:#FF5555">)*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:declare-step&gt;</span></code></p><p><span id="impl-47"><span class="deltaxml-old" style="background:#FF5555">Implementations may use </span><em class="glossterm"><a href="#dt-extension-attribute"><span class="deltaxml-old" style="background:#FF5555">extension attributes</span></a></em><span class="deltaxml-old" style="background:#FF5555"> to provide </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555"> information about a declared step.</span></span><span class="deltaxml-old" style="background:#FF5555"> For example, such an attribute might identify the code which implements steps of this type.</span></p><p><span class="deltaxml-old" style="background:#FF5555">It is not an error for a pipeline to include declarations for steps that a particular processor does not know how to implement. It is, of course, an error to attempt to evaluate such steps.</span></p></div></section></div></section><section id="p.library" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.6 p:library</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code><span class="deltaxml-old" style="background:#FF5555"> is a collection of static variables, static options, and step declarations.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:library</span><span class="deltaxml-old" style="background:#FF5555">  psvi-required? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  xpath-version? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">  version? = "3.0"&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.import"><span class="deltaxml-old" style="background:#FF5555">p:import</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.import-functions"><span class="deltaxml-old" style="background:#FF5555">p:import-functions</span></a><span class="deltaxml-old" style="background:#FF5555">)*,</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.declare-step"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.variable"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.option"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a><span class="deltaxml-old" style="background:#FF5555">)*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:library&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">version</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute identifies the version of XProc for which this library was authored. If the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code><span class="deltaxml-old" style="background:#FF5555"> has no ancestors in the XProc namespace, then it </span><span class="rfc2119" id="p.library.4.3"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> have a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">version</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. See </span><a href="#versioning-considerations" title="Versioning Considerations"><span class="deltaxml-old" style="background:#FF5555">Section 13, “Versioning Considerations”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The requested </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">xpath-version</span></code><span class="rfc2119" id="p.library.5.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be used to evaluate XPath expressions subject to the constraints outlined in </span><a href="#xpath-context" title="XPath in XProc"><span class="deltaxml-old" style="background:#FF5555">Section 7.2.2, “XPath in XProc”</span></a><span class="deltaxml-old" style="background:#FF5555">. If the attribute is not specified, the value “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">3.1</span></code><span class="deltaxml-old" style="background:#FF5555">” is assumed. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">psvi-required</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute allows the author to declare that a step relies on the processor's ability to pass PSVI annotations between steps, see </span><a href="#psvi-support" title="PSVIs in XProc"><span class="deltaxml-old" style="background:#FF5555">Section 9, “PSVIs in XProc”</span></a><span class="deltaxml-old" style="background:#FF5555">. If the attribute is not specified, the value “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">false</span></code><span class="deltaxml-old" style="background:#FF5555">” is assumed. </span></p><p><span class="deltaxml-old" style="background:#FF5555">For a description of </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">psvi-required</span></code><span class="deltaxml-old" style="background:#FF5555">, see </span><a href="#psvi-support" title="PSVIs in XProc"><span class="deltaxml-old" style="background:#FF5555">Section 9, “PSVIs in XProc”</span></a><span class="deltaxml-old" style="background:#FF5555">; for </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">xpath-version</span></code><span class="deltaxml-old" style="background:#FF5555">, see </span><a href="#xpath-context" title="XPath in XProc"><span class="deltaxml-old" style="background:#FF5555">Section 7.2.2, “XPath in XProc”</span></a><span class="deltaxml-old" style="background:#FF5555">; for </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555">, see </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><div id="note-step-decl" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">The steps declared in a pipeline library are referred to by their type. It is not an error to put a </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> without a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">type</span></code><span class="deltaxml-old" style="background:#FF5555"> in a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code><span class="deltaxml-old" style="background:#FF5555">, but there is no standard mechanism for instantiating it or referring to it. It is effectively invisible.</span></p></div></div><p><span class="deltaxml-old" style="background:#FF5555">Libraries can import pipelines and/or other libraries. See also </span><a href="#handling-imports" title="Handling Circular and Re-entrant Library Imports (Non-Normative)"><span class="deltaxml-old" style="background:#FF5555">Appendix H, </span><i><span class="deltaxml-old" style="background:#FF5555">Handling Circular and Re-entrant Library Imports (Non-Normative)</span></i></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></div></section><section id="p.import" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.7 p:import</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">An </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:import</span></code><span class="deltaxml-old" style="background:#FF5555"> loads a pipeline or pipeline library, making it available in the pipeline or library which contains the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:import</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:import</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">href</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> /&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">An import statement loads the specified IRI and makes any pipelines declared within it available to the current pipeline. </span></p><p><a id="err.inline.S0052"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0052"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0052</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the URI of a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:import</span></code><span class="deltaxml-old" style="background:#FF5555"> cannot be retrieved or if, once retrieved, it does not point to a </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555">. </span><a id="err.inline.S0053"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0053"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0053</span></code></a><span class="deltaxml-old" style="background:#FF5555">) to import a single pipeline if that pipeline does not have a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">type</span></code><span class="deltaxml-old" style="background:#FF5555">. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Attempts to retrieve the library identified by the URI value may be redirected at the parser level (for example, in an entity resolver) or below (at the protocol level, for example, via an HTTP Location: header). In the absence of additional information outside the scope of this specification within the resource, the base URI of the library is always the URI of the actual resource returned. In other words, it is the URI of the resource retrieved after all redirection has occurred.</span></p><p><span class="deltaxml-old" style="background:#FF5555">As imports are processed, a processor may encounter new </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:import</span></code><span class="deltaxml-old" style="background:#FF5555"> elements whose library URI is the same as one it has already processed in some other context. This may happen as a consequence of resolving the URI. If the actual base URI is the same as one that has already been processed, the implementation must recognize it as the same library and should not need to process the resource. Also, a duplicate, circular chain of imports, or a re-entrant import is not an error and implementations must take the necessary steps to avoid infinite loops and/or incorrect notification of duplicate step definitions. It is not an error for a library to import itself. An example of such steps is listed in </span><a href="#handling-imports" title="Handling Circular and Re-entrant Library Imports (Non-Normative)"><span class="deltaxml-old" style="background:#FF5555">Appendix H, </span><i><span class="deltaxml-old" style="background:#FF5555">Handling Circular and Re-entrant Library Imports (Non-Normative)</span></i></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">A library is considered the same library if the URI of the resource retrieved is the same. If a pipeline or library author uses two different URI values that resolve to the same resource, they must not be considered the same imported library.</span></p></div></section><section id="p.import-functions" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.8 p:import-functions</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">An </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:import-functions</span></code><span class="deltaxml-old" style="background:#FF5555"> element identifies a library of externally defined functions to be imported into the pipeline. After the functions have been imported, they are available in the processor XPath context.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:import-functions</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">href</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555">  content-type? = </span><var><span class="deltaxml-old" style="background:#FF5555">ContentType</span></var><span class="deltaxml-old" style="background:#FF5555">  namespace? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555"> /&gt;</span></code></p><div class="variablelist"><dl><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute identifies the URI of the function library. </span><a id="err.inline.S0103"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0103"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0103</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the URI of a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:import-functions</span></code><span class="deltaxml-old" style="background:#FF5555"> element cannot be retrieved or if, once retrieved, it points to a library that the processor cannot import. </span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">content-type</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">content-type</span></code><span class="deltaxml-old" style="background:#FF5555"> specifies what kind of library is expected at the URI. </span><span id="impl-48"><span class="deltaxml-old" style="background:#FF5555">If no type is specified, the way that the processor determines the type of the library is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">namespace</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">namespace</span></code><span class="deltaxml-old" style="background:#FF5555"> is specified, it must be a whitespace separated list of namespace URIs. Only functions in those namespaces will be loaded. </span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">The ability to import functions is optional. </span><span id="impl-49"><span class="deltaxml-old" style="background:#FF5555">Whether or not a processor can import functions, and if it can, what kinds of function libraries it can import from is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span><span class="deltaxml-old" style="background:#FF5555"> Pipeline authors can use </span><a href="#f.function-library-importable"><code class="function"><span class="deltaxml-old" style="background:#FF5555">p:function-library-importable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> to test whether or not a particular kind of library can be loaded. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Importing functions from a library implies loading and processing that library according to its conventions (loading imports, resolving dependencies, etc.). </span><a id="err.inline.S0104"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0104"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0104</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the processor cannot load the function library. This may occur because the format is unknown, because it is a version of the library that the processor does not recognize, or if it’s uninterpretable for any other reason. </span><a id="err.inline.S0106"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0106"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0106</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the processor detects that a particular library is unloadable. This may occur if the processor is, in principle, able to load libraries of the specified format, but detects that the particuar library requested is somehow ill-formed (syntactically invalid, has unsatisfiable dependencies or circular imports, etc.). </span></p><p><span class="deltaxml-old" style="background:#FF5555">Imported functions must be unique (they must not have the same name, namespace, and arity). </span><a id="err.inline.S0105"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0105"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0105</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a function imported from a library has the same name and arity as a function already imported. </span></p></div></section><section id="p.pipe" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.9 p:pipe</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code><span class="deltaxml-old" style="background:#FF5555"> connects an input to a port on another step.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:pipe</span><span class="deltaxml-old" style="background:#FF5555">  step? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  port? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555"> /&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code><span class="deltaxml-old" style="background:#FF5555"> element connects to a readable port of another step. It identifies the readable port to which it connects with the name of the step in the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">step</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute and the name of the port on that step in the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">port</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. </span><a id="err.inline.S0099"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0099"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0099</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">step</span></code><span class="deltaxml-old" style="background:#FF5555"> or </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">port</span></code><span class="deltaxml-old" style="background:#FF5555"> are not valid instances of </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">NCName</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">step</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is not specified, it defaults to the step which provides the default readable port. If the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">port</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is not specified, it defaults to the primary output port of the step identified (explicitly or implicitly).</span></p><p><a id="err.inline.S0067"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0067"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0067</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">step</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is not specified, and there is no default readable port. </span><a id="err.inline.S0068"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0068"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0068</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">port</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is not specified, and the step identified has no primary output port. </span></p><p><a id="err.inline.S0022"></a><span class="deltaxml-old" style="background:#FF5555">In all cases except when the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code><span class="deltaxml-old" style="background:#FF5555"> is within an </span><a href="#p.output"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code></a><span class="deltaxml-old" style="background:#FF5555"> of a </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound step</span></a></em><span class="deltaxml-old" style="background:#FF5555">, it is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0022"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0022</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the port identified by the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code><span class="deltaxml-old" style="background:#FF5555"> is not in the </span><em class="glossterm"><a href="#dt-readable-ports"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the step that contains the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code><span class="deltaxml-old" style="background:#FF5555"> that is a </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555"> for an </span><a href="#p.output"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code></a><span class="deltaxml-old" style="background:#FF5555"> of a </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> may connect to one of the readable ports of the compound step or to an output port on one of the compound step's </span><em class="glossterm"><a href="#dt-contained-steps"><span class="deltaxml-old" style="background:#FF5555">contained steps</span></a></em><span class="deltaxml-old" style="background:#FF5555">. In other words, the output of a compound step can simply be a copy of one of the available inputs or it can be the output of one of its children.</span></p><p><a id="err.inline.S0078"></a><span class="deltaxml-old" style="background:#FF5555">When the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code><span class="deltaxml-old" style="background:#FF5555"> is within an </span><a href="#p.output"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code></a><span class="deltaxml-old" style="background:#FF5555"> of a </span><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound step</span></a></em><span class="deltaxml-old" style="background:#FF5555">, it is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0078"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0078</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the port identified by the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></code><span class="deltaxml-old" style="background:#FF5555"> is not in the </span><em class="glossterm"><a href="#dt-readable-ports"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the compound step and is not a readable port of a contained step. </span></p></div></section><section id="p.inline" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.10 p:inline</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code><span class="deltaxml-old" style="background:#FF5555"> provides a document inline.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:inline</span><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">  content-type? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  document-properties? = </span><var><span class="deltaxml-old" style="background:#FF5555">map(xs:QName,item()*)</span></var><span class="deltaxml-old" style="background:#FF5555">  encoding? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    </span><var><span class="deltaxml-old" style="background:#FF5555">anyNode</span></var><span class="deltaxml-old" style="background:#FF5555">*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:inline&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">content-type</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute can be used to set the content type of the provided document; the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">document-properties</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute can be used to set the </span><em class="glossterm"><a href="#dt-document-properties"><span class="deltaxml-old" style="background:#FF5555">document properties</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the provided document.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The document's content type is determined statically. If a </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">content-type</span></code><span class="deltaxml-old" style="background:#FF5555"> is specified, that is the content type. Otherwise, the content type is “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xml</span></code><span class="deltaxml-old" style="background:#FF5555">”. </span></p><p><a id="err.inline.D0062"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0062"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0062</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">document-properties</span></code><span class="deltaxml-old" style="background:#FF5555"> map contains a </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">content-type</span></code><span class="deltaxml-old" style="background:#FF5555"> key and that key has a value that differs from the statically determined content type.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The base URI of the document is the base URI of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code><span class="deltaxml-old" style="background:#FF5555"> element.</span></p><p><span class="deltaxml-old" style="background:#FF5555">How the content of a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code><span class="deltaxml-old" style="background:#FF5555"> element is interpreted depends on the document's content type and the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">encoding</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. </span></p><p><a id="err.inline.D0054"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0054"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0054</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if an encoding is specified and the content type is an </span><em class="glossterm"><a href="#dt-XML-media-type"><span class="deltaxml-old" style="background:#FF5555">XML media type</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span></p><p><a id="err.inline.D0055"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0055"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0055</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the content type value specifies a character set and the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">encoding</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is absent. </span></p><p><a id="err.inline.D0039"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0039"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0039</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">encoding</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is present and content type value specifies a character set that is not supported by the implementation. </span></p><p><a id="err.inline.D0056"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0056"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0056</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if an encoding is specified and the content of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code><span class="deltaxml-old" style="background:#FF5555"> contains any XML markup. </span><a id="err.inline.D0063"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0063"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0063</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code><span class="deltaxml-old" style="background:#FF5555"> contains any XML markup and has a content type that is not an </span><em class="glossterm"><a href="#dt-XML-media-type"><span class="deltaxml-old" style="background:#FF5555">XML media type</span></a></em><span class="deltaxml-old" style="background:#FF5555">. In other words, in these cases, the entire content must be a single text node. CDATA sections and character references do not count as markup for this purpose because they will already have been replaced by the XML parser that read the pipeline.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">encoding</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is present, the content must be decoded. The encoding value “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">base64</span></code><span class="deltaxml-old" style="background:#FF5555">” </span><span class="rfc2119" id="p.inline.13.3"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be supported and identifies the content as being base64-encoded. </span><span id="impl-50"><span class="deltaxml-old" style="background:#FF5555">An implementation may support encodings other than </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">base64</span></code><span class="deltaxml-old" style="background:#FF5555">, but these encodings and their names are </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span><a id="err.inline.S0069"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0069"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0069</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the encoding specified is not supported by the implementation. </span><a id="err.inline.D0040"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0040"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0040</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the body is not correctly encoded per the value of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">encoding</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If an </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">encoding</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is present, value templates are never expanded. The value of </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> is irrelevant and always ignored.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The interpretation of the (possibily decoded) content depends on the document's content type. </span></p><div class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">In the presence of </span><em class="glossterm"><a href="#dt-text-value-template"><span class="deltaxml-old" style="background:#FF5555">text value templates</span></a></em><span class="deltaxml-old" style="background:#FF5555">, it is not possible to interpret the non-XML characters until the templates have been expanded.</span></p></div></div><section id="inline-xml-content" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">16.10.1 Inline XML content</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">If the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">document-properties</span></code><span class="deltaxml-old" style="background:#FF5555"> is not specified or the map does not contain a key "content-type" or specifies an </span><em class="glossterm"><a href="#dt-XML-media-type"><span class="deltaxml-old" style="background:#FF5555">XML media type</span></a></em><span class="deltaxml-old" style="background:#FF5555">, then the content is XML. A new XML document is created by wrapping a document node around the nodes which appear as children of </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555">. Any preceding or following whitespace-only text nodes will be discarded.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The in-scope namespaces of the inline document differ from the in-scope namespace of the content of the </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element in that bindings for all its </span><em><span class="deltaxml-old" style="background:#FF5555">excluded namespaces</span></em><span class="deltaxml-old" style="background:#FF5555">, as defined below, are removed:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The XProc namespace itself (</span><code class="uri"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/ns/xproc</span></code><span class="deltaxml-old" style="background:#FF5555">) is excluded.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">A namespace URI designated by using an </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute on the enclosing </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is excluded.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">A namespace URI designated by using an </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute on any ancestor </span><a href="#p.declare-step"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.library"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:library</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is also excluded. (In other words, the effect of several </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555"> attributes among the ancestors of </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is cumulative.)</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">The value of each prefix in the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute is interpreted as follows:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The value of the attribute is either </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">#all</span></code><span class="deltaxml-old" style="background:#FF5555">, or a whitespace-separated list of tokens, each of which is either a namespace prefix or </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">#default</span></code><span class="deltaxml-old" style="background:#FF5555">. The namespace bound to each of the prefixes is designated as an excluded namespace. </span><a id="err.inline.S0057"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0057"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0057</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute does not contain a list of tokens or if any of those tokens (except </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">#all</span></code><span class="deltaxml-old" style="background:#FF5555"> or </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">#default</span></code><span class="deltaxml-old" style="background:#FF5555">) is not a prefix bound to a namespace in the in-scope namespaces of the element on which it occurs.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The default namespace of the element on which </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555"> occurs may be designated as an excluded namespace by including </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">#default</span></code><span class="deltaxml-old" style="background:#FF5555"> in the list of namespace prefixes. </span><a id="err.inline.S0058"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0058"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0058</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the value </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">#default</span></code><span class="deltaxml-old" style="background:#FF5555"> is used within the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute and there is no default namespace in scope. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The value </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">#all</span></code><span class="deltaxml-old" style="background:#FF5555"> indicates that all namespaces that are in scope for the element on which </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">exclude-inline-prefixes</span></code><span class="deltaxml-old" style="background:#FF5555"> occurs are designated as excluded namespaces.</span></p></li></ul></div><p><span class="deltaxml-old" style="background:#FF5555">The XProc processor </span><span class="rfc2119" id="inline-xml-content.7.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> include all in-scope prefixes that are not explicitly excluded. If the namespace associated with an excluded prefix is used in the expanded-QName of a descendant element or attribute, the processor </span><span class="rfc2119" id="inline-xml-content.7.2"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> include that prefix anyway, or it may generate a new prefix.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Consider this example:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" xmlns:c="http://www.w3.org/ns/xproc-step" version="3.0"&gt; &lt;p:output port="result" serialization="map { 'indent': true() }"/&gt; &lt;p:identity xmlns:a="http://example.com/a" xmlns:b="http://example.com/b" xmlns:c="http://example.com/c"&gt; &lt;p:with-input port="source"&gt; &lt;p:inline exclude-inline-prefixes="a b"&gt; &lt;doc&gt; &lt;b:part/&gt; &lt;/doc&gt; &lt;/p:inline&gt; &lt;/p:with-input&gt; &lt;/p:identity&gt; &lt;/p:declare-step&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">which might produce a result like this:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;doc xmlns:c="http://example.com/c"&gt; &lt;b:part xmlns:b="http://example.com/b"/&gt; &lt;/doc&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">The declaration for “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">c</span></code><span class="deltaxml-old" style="background:#FF5555">” must be present because it was not excluded. The “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">part</span></code><span class="deltaxml-old" style="background:#FF5555">” element uses the namespace bound to “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">b</span></code><span class="deltaxml-old" style="background:#FF5555">”, so </span><em><span class="deltaxml-old" style="background:#FF5555">some</span></em><span class="deltaxml-old" style="background:#FF5555"> binding must be present. In this example, the original prefix has been preserved, but it would be equally correct if a different prefix had been used.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The text-node descendants of a </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> may be </span><a href="#text-value-templates"><span class="deltaxml-old" style="background:#FF5555">text value templates</span></a><span class="deltaxml-old" style="background:#FF5555">. Attribute descendants may be </span><a href="#attribute-value-templates"><span class="deltaxml-old" style="background:#FF5555">attribute value templates</span></a><span class="deltaxml-old" style="background:#FF5555">. This is controlled by the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> and the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">p:inline-expand-text</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. See </span><a href="#expand-text-attribute" title="Expand text attributes"><span class="deltaxml-old" style="background:#FF5555">Section 14.9.1, “Expand text attributes”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></div></section><section id="inline-text" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">16.10.2 Inline text content</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">If the document's content type is a </span><em class="glossterm"><a href="#dt-text-media-type"><span class="deltaxml-old" style="background:#FF5555">text media type</span></a></em><span class="deltaxml-old" style="background:#FF5555">, then the content is text. A new text document is created by joining the text nodes which appear as children of p:inline together to a single text node and wrapping a document node around it. Any preceding or following whitespace-only text nodes will be preserved.</span></p></div></section><section id="inline-json" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">16.10.3 Inline JSON content</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">If the document's content type is a </span><em class="glossterm"><a href="#dt-JSON-media-type"><span class="deltaxml-old" style="background:#FF5555">JSON media type</span></a></em><span class="deltaxml-old" style="background:#FF5555">, then the context is JSON. A new JSON document is created by joining the text values of children of p:inline together and parse it as JSON.</span></p><p><a id="err.inline.D0057"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0057"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0057</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the text content does not conform to the JSON grammar.</span></p></div></section><section id="inline-others" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">16.10.4 Other inline content</span></h4></div><div class="content"><p><span id="impl-51"><span class="deltaxml-old" style="background:#FF5555">How a processor interprets other media types is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span></span></p></div></section><section id="implicit-inlines" class="section"><div class="section-titlepage"><h4><span class="deltaxml-old" style="background:#FF5555">16.10.5 Implicit inlines</span></h4></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">As an authoring convenience, if one or more element nodes, optionally preceded and/or followed by whitespace, in any namespace other than the XProc namespace, occurs where a </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is allowed, each is treated as if it was enclosed within a </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element (with no attributes). Any preceding or following whitespace is discarded. Elements in the XProc namespace are forbidden except for </span><a href="#p.documentation"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:documentation</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#p.pipeinfo"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></code></a><span class="deltaxml-old" style="background:#FF5555"> which are ignored.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The following example demonstrates this implicit behaviour:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:identity name="identity" code="my:implicitinline1"&gt; &lt;p:with-input port="source"&gt; &lt;para xmlns="http://docbook.org/ns/docbook"&gt;Some text&lt;/para&gt; &lt;para xmlns="http://docbook.org/ns/docbook"&gt;Some other text&lt;/para&gt; &lt;/p:with-input&gt; &lt;/p:identity&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">Is interpreted as follows:</span></p><pre class="programlisting language-markup line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:identity name="identity" code="my:implicitinline2"&gt; &lt;p:with-input port="source"&gt; &lt;p:inline&gt;&lt;para xmlns="http://docbook.org/ns/docbook"&gt;Some text&lt;/para&gt;&lt;/p:inline&gt; &lt;p:inline&gt;&lt;para xmlns="http://docbook.org/ns/docbook"&gt;Some other text&lt;/para&gt;&lt;/p:inline&gt; &lt;/p:with-input&gt; &lt;/p:identity&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">An explicit </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is required if the author wants to include top level comments, processing instructions, or whitespace, or if the document element is in the XProc namespace.</span></p><p><a id="err.inline.S0079"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0079"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0079</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if comments, non-whitespace text nodes, or processing instructions occur as siblings of an element node that would be treated as an implicit inline. </span></p></div></section></div></section><section id="p.document" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.11 p:document</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code><span class="deltaxml-old" style="background:#FF5555"> reads a document from a URI.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:document</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">href</span></strong><span class="deltaxml-old" style="background:#FF5555"> = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  content-type? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  document-properties? = </span><var><span class="deltaxml-old" style="background:#FF5555">map(xs:QName,item()*)</span></var><span class="deltaxml-old" style="background:#FF5555">  parameters? = </span><var><span class="deltaxml-old" style="background:#FF5555">map(xs:QName,item()*)</span></var><span class="deltaxml-old" style="background:#FF5555"> /&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The value of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute, after expanding any </span><em class="glossterm"><a href="#dt-attribute-value-template"><span class="deltaxml-old" style="background:#FF5555">attribute value templates</span></a></em><span class="deltaxml-old" style="background:#FF5555">, is a URI. </span><a id="err.inline.D0064"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0064"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0064</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the URI is not a valid </span><code class="type"><span class="deltaxml-old" style="background:#FF5555">xs:anyURI</span></code><span class="deltaxml-old" style="background:#FF5555">. The URI is interpreted as an IRI reference. If it is relative, it is made absolute against the base URI of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code><span class="deltaxml-old" style="background:#FF5555"> element. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The semantics of </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code><span class="deltaxml-old" style="background:#FF5555"> are the same as a the semantics of </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:load</span></code><span class="deltaxml-old" style="background:#FF5555"> where the </span><code class="option"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> option is the URI, the </span><code class="option"><span class="deltaxml-old" style="background:#FF5555">content-type</span></code><span class="deltaxml-old" style="background:#FF5555"> option comes from </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">content-type</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute, the </span><code class="option"><span class="deltaxml-old" style="background:#FF5555">document-properties</span></code><span class="deltaxml-old" style="background:#FF5555"> option comes from the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">document-properties</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute, and the </span><code class="option"><span class="deltaxml-old" style="background:#FF5555">parameters</span></code><span class="deltaxml-old" style="background:#FF5555"> option comes from the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">parameters</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute. </span></p><div id="note-document" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code><span class="deltaxml-old" style="background:#FF5555"> always </span><em><span class="deltaxml-old" style="background:#FF5555">reads</span></em><span class="deltaxml-old" style="background:#FF5555"> from the specified IRI. In the context of a </span><a href="#p.input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:input</span></code></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#p.with-input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></code></a><span class="deltaxml-old" style="background:#FF5555">, this seems perfectly natural. In the context of a </span><a href="#p.output"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code></a><span class="deltaxml-old" style="background:#FF5555">, this may seem a little asymmetrical. Putting a </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:document</span></code><span class="deltaxml-old" style="background:#FF5555"> in a </span><a href="#p.output"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code></a><span class="deltaxml-old" style="background:#FF5555"> causes the pipeline to </span><em><span class="deltaxml-old" style="background:#FF5555">read</span></em><span class="deltaxml-old" style="background:#FF5555"> from the specified IRI and provide that document </span><em><span class="deltaxml-old" style="background:#FF5555">as an output</span></em><span class="deltaxml-old" style="background:#FF5555"> on that port. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Use </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:store</span></code><span class="deltaxml-old" style="background:#FF5555"> to store the results that appear on a </span><a href="#p.output"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></div></div></div></section><section id="p.empty" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.12 p:empty</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></code><span class="deltaxml-old" style="background:#FF5555"> connects to an </span><em class="glossterm"><a href="#dt-empty-sequence"><span class="deltaxml-old" style="background:#FF5555">empty sequence</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of documents.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:empty /&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">If an empty binding is used, it must be the only binding for the port. </span><a id="err.inline.S0089"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0089"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0089</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></code><span class="deltaxml-old" style="background:#FF5555"> binding appears as a sibling of any other binding, including itself.</span></p></div></section><section id="p.documentation" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.13 p:documentation</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:documentation</span></code><span class="deltaxml-old" style="background:#FF5555"> contains human-readable documentation.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:documentation&gt;</span><span class="deltaxml-old" style="background:#FF5555">    </span><var><span class="deltaxml-old" style="background:#FF5555">any-well-formed-content</span></var><span class="deltaxml-old" style="background:#FF5555">*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:documentation&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">There are no constraints on the content of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:documentation</span></code><span class="deltaxml-old" style="background:#FF5555"> element. Documentation is ignored by pipeline processors. See </span><a href="#documentation" title="Documentation"><span class="deltaxml-old" style="background:#FF5555">Section 14.6, “Documentation”</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></div></section><section id="p.pipeinfo" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">16.14 p:pipeinfo</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">A </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></code><span class="deltaxml-old" style="background:#FF5555"> contains ancillary information for steps in the pipeline.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:pipeinfo&gt;</span><span class="deltaxml-old" style="background:#FF5555">    </span><var><span class="deltaxml-old" style="background:#FF5555">any-well-formed-content</span></var><span class="deltaxml-old" style="background:#FF5555">*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:pipeinfo&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">There are no constraints on the content of the </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></code><span class="deltaxml-old" style="background:#FF5555"> element, see </span><a href="#annotations" title="Processor annotations"><span class="deltaxml-old" style="background:#FF5555">Section 14.7, “Processor annotations”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></div></section></div></section><section id="errors" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">17 Errors</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Errors in a pipeline can be divided into two classes: static errors and dynamic errors.</span></p><section id="static-errors" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">17.1 Static Errors</span></h3></div><div class="content"><p><span id="dt-static-error" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">static error</span></em><span class="deltaxml-old" style="background:#FF5555"> is one which can be detected before pipeline evaluation is even attempted.]</span></span><span class="deltaxml-old" style="background:#FF5555"> Examples of static errors include cycles in the pipeline graph and incorrect specification of inputs and outputs. </span></p><p><span class="deltaxml-old" style="background:#FF5555">Static errors are fatal and must be detected before any steps are evaluated.</span></p><p><span class="deltaxml-old" style="background:#FF5555">For a complete list of static errors, see </span><a href="#app.static-errors" title="Static Errors"><span class="deltaxml-old" style="background:#FF5555">Section F.1, “Static Errors”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></div></section><section id="dynamic-errors" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">17.2 Dynamic Errors</span></h3></div><div class="content"><p><span id="dt-dynamic-error" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: A </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></em><span class="deltaxml-old" style="background:#FF5555"> is one which occurs while a pipeline is being evaluated (and cannot be detected before evaluation begins).]</span></span><span class="deltaxml-old" style="background:#FF5555"> Examples of dynamic errors include references to URIs that cannot be resolved, steps which fail, and pipelines that exhaust the capacity of an implementation (such as memory or disk space).</span></p><p><span class="deltaxml-old" style="background:#FF5555">Implementations are required to evaluate the pipeline graph according to the rules of this specification, but they may choose to optimize pipeline execution in different ways. This may cause steps to be evaluated in different orders which consequently has an impact on error detection. </span><span id="impl-52"><span class="deltaxml-old" style="background:#FF5555">The detection of dynamic errors is somewhat </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555"> because the order of step execution may vary.</span></span><span class="deltaxml-old" style="background:#FF5555"> In cases where an implementation is able to run a pipeline without evaluating a particular expression, or running a particular step, the implementation is never required evaluate the expression or run the step solely in order to determine whether doing so causes a dynamic error. For example, if a variable is declared but never referenced, an implementation may choose whether or not to evaluate the expression which initializes the variable, which means that if evaluating the variable’s initializer causes a dynamic error, some implementations will signal this error and others will not.</span></p><p><span class="deltaxml-old" style="background:#FF5555">There are some cases where this specification requires that steps must not be executed: for example, the content of a </span><a href="#p.when"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code></a><span class="rfc2119" id="dynamic-errors.4.2"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> be executed if the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">test</span></code><span class="deltaxml-old" style="background:#FF5555"> condition is false. This means that an implementation </span><span class="rfc2119" id="dynamic-errors.4.4"><span class="deltaxml-old" style="background:#FF5555">must not</span></span><span class="deltaxml-old" style="background:#FF5555"> signal any dynamic errors that would arise if the contents of the </span><a href="#p.when"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:when</span></code></a><span class="deltaxml-old" style="background:#FF5555"> were executed.</span></p><p><span class="deltaxml-old" style="background:#FF5555">An implementation may signal a dynamic error before any source document is available, but only if it can determine that the error would be signaled for every possible source document and every possible set of parameter values.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If a step fails due to a dynamic error, failure propagates upwards until either a </span><a href="#p.try"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code></a><span class="deltaxml-old" style="background:#FF5555"> is encountered or the entire pipeline fails. In other words, outside of a </span><a href="#p.try"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code></a><span class="deltaxml-old" style="background:#FF5555">, step failure causes the entire pipeline to fail.</span></p><p><span class="deltaxml-old" style="background:#FF5555">For a complete list of dynamic errors, see </span><a href="#app.dynamic-errors" title="Dynamic Errors"><span class="deltaxml-old" style="background:#FF5555">Section F.2, “Dynamic Errors”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></div></section><section id="step-errors" class="section"><div class="section-titlepage"><h3><span class="deltaxml-old" style="background:#FF5555">17.3 Step Errors</span></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Several of the steps in the standard and option step library can generate dynamic errors.</span></p><p><span class="deltaxml-old" style="background:#FF5555">For a complete list of the dynamic errors raised by builtin pipeline steps, see </span><a href="#app.step-errors" title="Step Errors"><span class="deltaxml-old" style="background:#FF5555">Section F.3, “Step Errors”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></div></section></div></section><article id="conformance" class="appendix"><header class="appendix-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">A Conformance</span></h2></header><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Conformant processors </span><span class="rfc2119" id="conformance.2.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> implement all of the features described in this specification except those that are explicitly identified as optional.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Some aspects of processor behavior are not completely specified; those features are either </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555"> or </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span id="dt-implementation-dependent" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: An </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></em><span class="deltaxml-old" style="background:#FF5555"> feature is one where the implementation has discretion in how it is performed. Implementations are not required to document or explain how </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555"> features are performed.]</span></span></p><p><span id="dt-implementation-defined" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: An </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></em><span class="deltaxml-old" style="background:#FF5555"> feature is one where the implementation has discretion in how it is performed. Conformant implementations </span><span class="rfc2119" id="dt-implementation-defined.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> document how </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555"> features are performed.]</span></span></p><section id="implementation-defined" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">A.1 Implementation-defined features</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The following features are implementation-defined:</span></p><ol class="features"><li><span class="deltaxml-old" style="background:#FF5555">It is implementation-defined what additional step types, if any, are provided. See </span><a href="#step-concept" title="Steps"><span class="deltaxml-old" style="background:#FF5555">Section 2.1, “Steps”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The level of support for typed values in XDM instances in an XProc pipeline is implementation-defined. See </span><a href="#xml-documents" title="XML Documents"><span class="deltaxml-old" style="background:#FF5555">Section 3.1.1, “XML Documents”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Serialization of other kinds of documents is implementation-defined. See </span><a href="#other-documents" title="Other documents"><span class="deltaxml-old" style="background:#FF5555">Section 3.1.5, “Other documents”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">It is implementation-defined what additional content types are considered equal. See </span><a href="#media-type-match" title="Matching Media Types"><span class="deltaxml-old" style="background:#FF5555">Section 3.3, “Matching Media Types”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">How inputs are connected to documents outside the pipeline is implementation-defined. See </span><a href="#input-output" title="Inputs and Outputs"><span class="deltaxml-old" style="background:#FF5555">Section 4, “Inputs and Outputs”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">How pipeline outputs are connected to documents outside the pipeline is implementation-defined. See </span><a href="#input-output" title="Inputs and Outputs"><span class="deltaxml-old" style="background:#FF5555">Section 4, “Inputs and Outputs”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">In Version 3.0 of XProc, how (or if) implementers provide local resolution mechanisms and how (or if) they provide access to intermediate results by URI is implementation-defined. See </span><a href="#external-docs" title="External Documents"><span class="deltaxml-old" style="background:#FF5555">Section 4.1, “External Documents”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Except for cases which are specifically called out in , the extent to which namespace fixup, and other checks for outputs which cannot be serialized, are performed on intermediate outputs is implementation-defined. See </span><a href="#namespace-fixup" title="Namespace Fixup on XML Outputs"><span class="deltaxml-old" style="background:#FF5555">Section 6.1, “Namespace Fixup on XML Outputs”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">There may be an implementation-defined mechanism for providing default values for static p:options. If such a mechanism exists, the values provided must match the sequence type declared for the option, if such a declaration exists. See </span><a href="#initiating" title="Initiating a pipeline"><span class="deltaxml-old" style="background:#FF5555">Section 7, “Initiating a pipeline”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The exact format of the language string is implementation-defined but should be consistent with the xml:lang attribute. See </span><a href="#f.system-property" title="System Properties"><span class="deltaxml-old" style="background:#FF5555">Section 8.1, “System Properties”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The value of the p:system-property function during static analysis is implementation-defined. See </span><a href="#f.system-property" title="System Properties"><span class="deltaxml-old" style="background:#FF5555">Section 8.1, “System Properties”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">It is implementation-defined how or if a processor attempts to serialize maps that appear in document properties. See </span><a href="#f.document-properties-document" title="Document properties document"><span class="deltaxml-old" style="background:#FF5555">Section 8.8, “Document properties document”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">It is implementation-defined how or if a processor attempts to serialize arrays that appear in document properties. See </span><a href="#f.document-properties-document" title="Document properties document"><span class="deltaxml-old" style="background:#FF5555">Section 8.8, “Document properties document”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">How p:urify transforms its arguments into a URI is implementation-defined See </span><a href="#f.urify" title="Transform filesystem paths into URIs"><span class="deltaxml-old" style="background:#FF5555">Section 8.10, “Transform filesystem paths into URIs”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">It is implementation-defined if the processor supports any other XPath extension functions. See </span><a href="#other-xpath-extension-functions" title="Other XPath Extension Functions"><span class="deltaxml-old" style="background:#FF5555">Section 8.12, “Other XPath Extension Functions”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The value of the any other XPath extension functions during static analysis is implementation-defined. See </span><a href="#other-xpath-extension-functions" title="Other XPath Extension Functions"><span class="deltaxml-old" style="background:#FF5555">Section 8.12, “Other XPath Extension Functions”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Whether or not the pipeline processor supports passing PSVI annotations between steps is implementation-defined. See </span><a href="#psvi-support" title="PSVIs in XProc"><span class="deltaxml-old" style="background:#FF5555">Section 9, “PSVIs in XProc”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The exact PSVI properties that are preserved when documents are passed between steps is implementation-defined. See </span><a href="#psvi-support" title="PSVIs in XProc"><span class="deltaxml-old" style="background:#FF5555">Section 9, “PSVIs in XProc”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">It is implementation-defined what PSVI properties, if any, are produced by extension steps. See </span><a href="#psvi-support" title="PSVIs in XProc"><span class="deltaxml-old" style="background:#FF5555">Section 9, “PSVIs in XProc”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Whether or not an extension attribute permits attribute value templates is implementation-defined. See </span><a href="#attribute-value-templates" title="Attribute Value Templates"><span class="deltaxml-old" style="background:#FF5555">Section 10.1, “Attribute Value Templates”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">How outside values are specified for pipeline options on the pipeline initially invoked by the processor is implementation-defined. See </span><a href="#options" title="Options"><span class="deltaxml-old" style="background:#FF5555">Section 11.2, “Options”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Support for pipeline documents written in XML 1.1 and pipeline inputs and outputs that use XML 1.1 is implementation-defined. See </span><a href="#syntax" title="Syntax Overview"><span class="deltaxml-old" style="background:#FF5555">Section 14, “Syntax Overview”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">It is implementation-defined if any processing instructions are significant to an implementation. See </span><a href="#syntax" title="Syntax Overview"><span class="deltaxml-old" style="background:#FF5555">Section 14, “Syntax Overview”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The semantics of p:pipeinfo elements are implementation-defined. See </span><a href="#annotations" title="Processor annotations"><span class="deltaxml-old" style="background:#FF5555">Section 14.7, “Processor annotations”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">It is implementation-defined whether a processor supports timeouts, and if it does, how precisely and precisely how the execution time of a step is measured. See </span><a href="#timeout" title="Controlling long running steps"><span class="deltaxml-old" style="background:#FF5555">Section 14.9.4, “Controlling long running steps”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Precisely what “made available” means is implementation-defined. See </span><a href="#messages" title="Status and debugging output"><span class="deltaxml-old" style="background:#FF5555">Section 14.9.5, “Status and debugging output”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The set of URI schemes actually supported is implementation-defined. See </span><a href="#common-errors" title="Common errors"><span class="deltaxml-old" style="background:#FF5555">Section 14.11, “Common errors”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The presence of other compound steps is implementation-defined; XProc provides no standard mechanism for defining them or describing what they can contain. See </span><a href="#p.extension" title="Extension Steps"><span class="deltaxml-old" style="background:#FF5555">Section 15.9, “Extension Steps”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The default value of any serialization parameters not specified on a particular output is implementation-defined. See </span><a href="#serialization" title="Serialization parameters"><span class="deltaxml-old" style="background:#FF5555">Section 16.3.1, “Serialization parameters”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The serialization method for documents with other media types is implementation-defined. See </span><a href="#serialization" title="Serialization parameters"><span class="deltaxml-old" style="background:#FF5555">Section 16.3.1, “Serialization parameters”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">If no encoding is specified, the encoding used is implementation-defined. If the method is “xml” or “xhtml”, the implementation defined encoding must be either UTF-8 or UTF-16. See </span><a href="#xproc-xml-serialization" title="XML serialization"><span class="deltaxml-old" style="background:#FF5555">Section 16.3.1.1, “XML serialization”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">For methods other than xml, html, xhtml, text, and json; the media-type is implementation-defined. See </span><a href="#xproc-xml-serialization" title="XML serialization"><span class="deltaxml-old" style="background:#FF5555">Section 16.3.1.1, “XML serialization”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Implementations may support other method values but their results are implementation-defined. See </span><a href="#xproc-xml-serialization" title="XML serialization"><span class="deltaxml-old" style="background:#FF5555">Section 16.3.1.1, “XML serialization”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The names and values of non-XML serialization parameters are implementation-defined. See </span><a href="#xproc-non-xml-serialization" title="Non-XML serialization"><span class="deltaxml-old" style="background:#FF5555">Section 16.3.1.2, “Non-XML serialization”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The precise details about what XPath expressions are allowed (for example, can the expression declare a function) is implementation-defined. See </span><a href="#p.variable" title="p:variable"><span class="deltaxml-old" style="background:#FF5555">Section 16.4.1, “p:variable”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The precise details about what XPath expressions are allowed (for example, can the expression declare a function) is implementation-defined. See </span><a href="#p.option" title="p:option"><span class="deltaxml-old" style="background:#FF5555">Section 16.4.2, “p:option”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">When a declared step is evaluated directly by the XProc processor (as opposed to occurring as an atomic step in some container), how the input and output ports are connected to documents is implementation-defined. See </span><a href="#p.declare-step" title="p:declare-step"><span class="deltaxml-old" style="background:#FF5555">Section 16.5, “p:declare-step”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">If no type is specified, the way that the processor determines the type of the library is implementation-defined. See </span><a href="#p.import-functions" title="p:import-functions"><span class="deltaxml-old" style="background:#FF5555">Section 16.8, “p:import-functions”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Whether or not a processor can import functions, and if it can, what kinds of function libraries it can import from is implementation-defined. See </span><a href="#p.import-functions" title="p:import-functions"><span class="deltaxml-old" style="background:#FF5555">Section 16.8, “p:import-functions”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">An implementation may support encodings other than base64, but these encodings and their names are implementation-defined. See </span><a href="#p.inline" title="p:inline"><span class="deltaxml-old" style="background:#FF5555">Section 16.10, “p:inline”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">How a processor interprets other media types is implementation-defined. See </span><a href="#inline-others" title="Other inline content"><span class="deltaxml-old" style="background:#FF5555">Section 16.10.4, “Other inline content”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">It is implementation-defined whether additional information items and properties, particularly those made available in the PSVI, are preserved between steps. See </span><a href="#infoset-conformance" title="Infoset Conformance"><span class="deltaxml-old" style="background:#FF5555">Section A.3, “Infoset Conformance”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The version of Unicode supported is implementation-defined, but it is recommended that the most recent version of Unicode be used. See </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The context item used for binary documents is implementation-defined. See </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The point in time returned as the current dateTime is implementation-defined. See </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The implicit timezone is implementation-defined. See </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The default language is implementation-defined. See </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The default calendar is implementation-defined. See </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The default place is implementation-defined. See </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The list of available environment variables is implementation-defined. See </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The implicit timezone is implementation-defined. See </span><a href="#step-xpath-context-31" title="Step XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.2, “Step XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The default language is implementation-defined. See </span><a href="#step-xpath-context-31" title="Step XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.2, “Step XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The default calendar is implementation-defined. See </span><a href="#step-xpath-context-31" title="Step XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.2, “Step XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The defualt place is implementation-defined. See </span><a href="#step-xpath-context-31" title="Step XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.2, “Step XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The list of available environment variables is implementation-defined. See </span><a href="#step-xpath-context-31" title="Step XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.2, “Step XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li></ol></div></section><section id="implementation-dependent" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">A.2 Implementation-dependent features</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The following features are implementation-dependent:</span></p><ol class="features"><li><span class="deltaxml-old" style="background:#FF5555">The evaluation order of steps not connected to one another is implementation-dependent See </span><a href="#pipeline-concepts" title="Pipeline Concepts"><span class="deltaxml-old" style="background:#FF5555">Section 2, “Pipeline Concepts”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The underlying representations of other kinds of documents are implementation-dependent. See </span><a href="#other-documents" title="Other documents"><span class="deltaxml-old" style="background:#FF5555">Section 3.1.5, “Other documents”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Outside of a try/catch, the disposition of error messages is implementation-dependent See </span><a href="#input-output" title="Inputs and Outputs"><span class="deltaxml-old" style="background:#FF5555">Section 4, “Inputs and Outputs”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Resolving a URI locally may involve resolvers of various sorts and possibly appeal to implementation-dependent mechanisms such as catalog files. See </span><a href="#external-docs" title="External Documents"><span class="deltaxml-old" style="background:#FF5555">Section 4.1, “External Documents”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Whether (and when and how) or not the intermediate results that pass between steps are ever written to a filesystem is implementation-dependent. See </span><a href="#external-docs" title="External Documents"><span class="deltaxml-old" style="background:#FF5555">Section 4.1, “External Documents”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The value of the p:step-available function during static analysis is implementation-dependent. See </span><a href="#f.step-available" title="Step Available"><span class="deltaxml-old" style="background:#FF5555">Section 8.2, “Step Available”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">For any URI argument to p:urify, it is implementation-dependent whether query or fragment components are supported. See </span><a href="#f.urify" title="Transform filesystem paths into URIs"><span class="deltaxml-old" style="background:#FF5555">Section 8.10, “Transform filesystem paths into URIs”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Other implementation-dependent errors may be thrown by p:urify. See </span><a href="#f.urify" title="Transform filesystem paths into URIs"><span class="deltaxml-old" style="background:#FF5555">Section 8.10, “Transform filesystem paths into URIs”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Which steps are forbidden, what privileges are needed to access resources, and under what circumstances these security constraints apply is implementation-dependent. See </span><a href="#security-considerations" title="Security Considerations"><span class="deltaxml-old" style="background:#FF5555">Section 12, “Security Considerations”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">Implementations may use extension attributes to provide implementation-dependent information about a declared step. See </span><a href="#declare-atomic-steps" title="Declaring atomic steps"><span class="deltaxml-old" style="background:#FF5555">Section 16.5.2, “Declaring atomic steps”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The detection of dynamic errors is somewhat implementation-dependent because the order of step execution may vary. See </span><a href="#dynamic-errors" title="Dynamic Errors"><span class="deltaxml-old" style="background:#FF5555">Section 17.2, “Dynamic Errors”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The set of available documents (those that may be retrieved with a URI) is implementation-dependent. See </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The set of available text resources (those that may be retrieved with a URI) is implementation-dependent. See </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The set of available collections is implementation-dependent. See </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The set of available URI collections is implementation-dependent. See </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The default URI collection is implementation-dependent. See </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The set of available documents (those that may be retrieved with a URI) is implementation-dependent. See </span><a href="#step-xpath-context-31" title="Step XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.2, “Step XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The set of available text resources (those that may be retrieved with a URI) is implementation-dependent. See </span><a href="#step-xpath-context-31" title="Step XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.2, “Step XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The set of available URI collections is implementation-dependent. See </span><a href="#step-xpath-context-31" title="Step XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.2, “Step XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li><li><span class="deltaxml-old" style="background:#FF5555">The default URI collection is implementation-dependent. See </span><a href="#step-xpath-context-31" title="Step XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.2, “Step XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></li></ol></div></section><section id="infoset-conformance" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">A.3 Infoset Conformance</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">This specification conforms to the XML Information Set [</span><a href="#xml-infoset-rec"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Infoset</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. The information corresponding to the following information items and properties must be available to the processor for the documents that flow through the pipeline.</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="literal info-item"><span class="deltaxml-old" style="background:#FF5555">Document Information Item</span></code><span class="deltaxml-old" style="background:#FF5555"> with </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[base URI]</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[children]</span></code><span class="deltaxml-old" style="background:#FF5555"> properties.</span></p></li><li><p><code class="literal info-item"><span class="deltaxml-old" style="background:#FF5555">Element Information Items</span></code><span class="deltaxml-old" style="background:#FF5555"> with </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[base URI]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[children]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[attributes]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[in-scope namespaces]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[prefix]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[local name]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[namespace name]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[parent]</span></code><span class="deltaxml-old" style="background:#FF5555"> properties.</span></p></li><li><p><code class="literal info-item"><span class="deltaxml-old" style="background:#FF5555">Attribute Information Items</span></code><span class="deltaxml-old" style="background:#FF5555"> with </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[namespace name]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[prefix]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[local name]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[normalized value]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[attribute type]</span></code><span class="deltaxml-old" style="background:#FF5555">, and </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[owner element]</span></code><span class="deltaxml-old" style="background:#FF5555"> properties.</span></p></li><li><p><code class="literal info-item"><span class="deltaxml-old" style="background:#FF5555">Character Information Items</span></code><span class="deltaxml-old" style="background:#FF5555"> with </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[character code]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[parent]</span></code><span class="deltaxml-old" style="background:#FF5555">, and, optionally, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[element content whitespace]</span></code><span class="deltaxml-old" style="background:#FF5555"> properties.</span></p></li><li><p><code class="literal info-item"><span class="deltaxml-old" style="background:#FF5555">Processing Instruction Information Items</span></code><span class="deltaxml-old" style="background:#FF5555"> with </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[base URI]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[target]</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[content]</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[parent]</span></code><span class="deltaxml-old" style="background:#FF5555"> properties.</span></p></li><li><p><code class="literal info-item"><span class="deltaxml-old" style="background:#FF5555">Comment Information Items</span></code><span class="deltaxml-old" style="background:#FF5555"> with </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[content]</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[parent]</span></code><span class="deltaxml-old" style="background:#FF5555"> properties.</span></p></li><li><p><code class="literal info-item"><span class="deltaxml-old" style="background:#FF5555">Namespace Information Items</span></code><span class="deltaxml-old" style="background:#FF5555"> with </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[prefix]</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="literal infoset-property"><span class="deltaxml-old" style="background:#FF5555">[namespace name]</span></code><span class="deltaxml-old" style="background:#FF5555"> properties.</span></p></li></ul></div><p><span id="impl-53"><span class="deltaxml-old" style="background:#FF5555">It is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555"> whether additional information items and properties, particularly those made available in the PSVI, are preserved between steps.</span></span></p></div></section></div></article><article id="xproc-and-step-xpath-context" class="appendix"><header class="appendix-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">B XPath contexts in XProc</span></h2></header><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">Two kinds of XPath context are relevant in XProc: the context of the pipeline itself (</span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">) and the context </span><em><span class="deltaxml-old" style="background:#FF5555">within</span></em><span class="deltaxml-old" style="background:#FF5555"> steps (</span><a href="#step-xpath-context-31" title="Step XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.2, “Step XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">). </span></p><section id="xproc-xpath-context-31" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">B.1 Processor XPath Context</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">When the XProc processor evaluates an XPath expression using XPath, unless otherwise indicated by a particular step, it does so with the following static context:</span></p><div class="variablelist"><dl><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">XPath 1.0 compatibility mode</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">False</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Statically known namespaces</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The namespace declarations in-scope for the containing element. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default element/type namespace</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The null namespace.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default function namespace</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The default function namespace is </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/2005/xpath-functions</span></code><span class="deltaxml-old" style="background:#FF5555">, as defined in [</span><a href="#xpath31-functions"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath and XQuery Functions and Operators 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. Function names that do not contain a colon always refer to the default function namespace, any in-scope binding for the default namespace </span><em><span class="deltaxml-old" style="background:#FF5555">does not</span></em><span class="deltaxml-old" style="background:#FF5555"> apply. This specification does not provide a mechanism to override the default function namespace.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">In-scope schema definitions</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">A basic XPath 3.1 XProc processor includes the following named type definitions in its in-scope schema definitions:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">All the primitive atomic types defined in [</span><a href="#xmlschema-2"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">W3C XML Schema: Part 2</span></span></a><span class="deltaxml-old" style="background:#FF5555">], with the exception of </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:NOTATION</span></code><span class="deltaxml-old" style="background:#FF5555">. That is: </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:anyAtomicType</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:anySimpleType</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:anyURI</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:base64Binary</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:boolean</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:date</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:dateTime</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:decimal</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:double</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:duration</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:float</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:gDay</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:gMonth</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:gMonthDay</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:gYear</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:gYearMonth</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:hexBinary</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:QName</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:string</span></code><span class="deltaxml-old" style="background:#FF5555">, and </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:time</span></code><span class="deltaxml-old" style="background:#FF5555">. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The derived atomic type </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:integer</span></code><span class="deltaxml-old" style="background:#FF5555"> defined in [</span><a href="#xmlschema-2"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">W3C XML Schema: Part 2</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The types </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:anyType</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:yearMonthDuration</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:dayTimeDuration</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:untyped</span></code><span class="deltaxml-old" style="background:#FF5555">, and </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">xs:untypedAtomic</span></code><span class="deltaxml-old" style="background:#FF5555"> defined in [</span><a href="#xpath-datamodel"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XQuery and XPath Data Model 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. </span></p></li></ul></div></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">In-scope variables</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Variables and options are lexically scoped. The union of the options and the variables that are “visible” from the step's lexical position are available as variable bindings to the XPath processor. Variables and options can shadow each other, only the lexically most recent bindings are visible.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Context item static type</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Document.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Function signatures</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The signatures of the [</span><a href="#xpath31-functions"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath and XQuery Functions and Operators 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">] in namespaces </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/2005/xpath-functions</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/2005/xpath-functions/math</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/2005/xpath-functions/map</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/2005/xpath-functions/array</span></code><span class="deltaxml-old" style="background:#FF5555">. Additionally the function signatures defined in </span><a href="#xpath-extension-functions" title="XPath Extension Functions"><span class="deltaxml-old" style="background:#FF5555">Section 8, “XPath Extension Functions”</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Statically known collations</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Implementation-defined but </span><span class="rfc2119" id="xproc-xpath-context-31.3.9.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> include the Unicode code point collation. </span><span id="impl-54"><span class="deltaxml-old" style="background:#FF5555">The version of Unicode supported is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">, but it is recommended that the most recent version of Unicode be used.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default collation</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Unicode code point collation.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Static base URI</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The base URI of the element on which the expression occurs.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Statically known documents</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">None.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Statically known collections</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">None.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Statically known default collection type</span></span></dt><dd><p><code class="literal"><span class="deltaxml-old" style="background:#FF5555">item()*</span></code></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Statically known decimal formats</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">None.</span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">And the following dynamic context:</span></p><div class="variablelist"><dl><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">context item</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The context item. The context item is either specified with a </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555"> or is taken from the </span><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em><span class="deltaxml-old" style="background:#FF5555">. </span><a id="err.inline.D0008"></a><span class="deltaxml-old" style="background:#FF5555">It is a </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.D0008"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0008</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if a sequence of items appears where an item to be used as the context item is expected. </span></p><p><span class="deltaxml-old" style="background:#FF5555">The context item used for an XML, text, or JSON document is the XDM representation of that item. </span><span id="impl-55"><span class="deltaxml-old" style="background:#FF5555">The context item used for binary documents is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">If there is no explicit connection and there is no default readable port then the context node is undefined.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">context position and context size</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The context position and context size are both “1”. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Variable values</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The union of the in-scope options and variables are available as variable bindings to the XPath processor. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Named functions</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The [</span><a href="#xpath31-functions"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath and XQuery Functions and Operators 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">] and the </span><a href="#xpath-extension-functions" title="XPath Extension Functions"><span class="deltaxml-old" style="background:#FF5555">Section 8, “XPath Extension Functions”</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Current dateTime</span></span></dt><dd><p><span id="impl-56"><span class="deltaxml-old" style="background:#FF5555">The point in time returned as the current dateTime is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Implicit timezone</span></span></dt><dd><p><span id="impl-57"><span class="deltaxml-old" style="background:#FF5555">The implicit timezone is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default language</span></span></dt><dd><p><span id="impl-58"><span class="deltaxml-old" style="background:#FF5555">The default language is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default calendar</span></span></dt><dd><p><span id="impl-59"><span class="deltaxml-old" style="background:#FF5555">The default calendar is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default place</span></span></dt><dd><p><span id="impl-60"><span class="deltaxml-old" style="background:#FF5555">The default place is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Available documents</span></span></dt><dd><p><span id="impl-61"><span class="deltaxml-old" style="background:#FF5555">The set of available documents (those that may be retrieved with a URI) is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Available text resources</span></span></dt><dd><p><span id="impl-62"><span class="deltaxml-old" style="background:#FF5555">The set of available text resources (those that may be retrieved with a URI) is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Available collections</span></span></dt><dd><p><span id="impl-63"><span class="deltaxml-old" style="background:#FF5555">The set of available collections is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default collection</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">None. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Available URI collections</span></span></dt><dd><p><span id="impl-64"><span class="deltaxml-old" style="background:#FF5555">The set of available URI collections is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default URI collection</span></span></dt><dd><p><span id="impl-65"><span class="deltaxml-old" style="background:#FF5555">The default URI collection is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Environment variables</span></span></dt><dd><p><span id="impl-66"><span class="deltaxml-old" style="background:#FF5555">The list of available environment variables is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd></dl></div></div></section><section id="step-xpath-context-31" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">B.2 Step XPath Context</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">When a step evaluates an XPath expression using XPath 3.1, unless otherwise indicated by a particular step, it does so with the following static context:</span></p><div class="variablelist"><dl><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">XPath 1.0 compatibility mode</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">False</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Statically known namespaces</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The namespace declarations in-scope for the containing element.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default element/type namespace</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The null namespace.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default function namespace</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The default function namespace is </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/2005/xpath-functions</span></code><span class="deltaxml-old" style="background:#FF5555">, as defined in [</span><a href="#xpath31-functions"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath and XQuery Functions and Operators 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. Function names that do not contain a colon always refer to the default function namespace, any in-scope binding for the default namespace </span><em><span class="deltaxml-old" style="background:#FF5555">does not</span></em><span class="deltaxml-old" style="background:#FF5555"> apply. This specification does not provide a mechanism to override the default function namespace.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">In-scope schema definitions</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The same as the </span><a href="#xproc-xpath-context-31" title="Processor XPath Context"><span class="deltaxml-old" style="background:#FF5555">Section B.1, “Processor XPath Context”</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">In-scope variables</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">None, unless otherwise specified by the step. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Context item static type</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Document.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Function signatures</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The signatures of the [</span><a href="#xpath31-functions"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath and XQuery Functions and Operators 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">] in namespaces </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/2005/xpath-functions</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/2005/xpath-functions/math</span></code><span class="deltaxml-old" style="background:#FF5555">, </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/2005/xpath-functions/map</span></code><span class="deltaxml-old" style="background:#FF5555"> and </span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/2005/xpath-functions/array</span></code><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Statically known collations</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Implementation-defined but </span><span class="rfc2119" id="step-xpath-context-31.3.9.2.1.1"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> include the Unicode code point collation.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default collation</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Unicode code point collation.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Static base URI</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The base URI of the element on which the expression occurs.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Statically known documents</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">None.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Statically known collections</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">None.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Statically known default collection type</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">item()*</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Statically known decimal formats</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">None.</span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">And the following initial dynamic context:</span></p><div class="variablelist"><dl><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">context item</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The document node of the document that appears on the primary input of the step, unless otherwise specified by the step.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">context position and context size</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The context position and context size are both “1”, unless otherwise specified by the step. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Variable values</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">None, unless otherwise specified by the step. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Named functions</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The [</span><a href="#xpath31-functions"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath and XQuery Functions and Operators 3.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">].</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Current dateTime</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">An implementation-defined point in time. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Implicit timezone</span></span></dt><dd><p><span id="impl-67"><span class="deltaxml-old" style="background:#FF5555">The implicit timezone is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default language</span></span></dt><dd><p><span id="impl-68"><span class="deltaxml-old" style="background:#FF5555">The default language is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default calendar</span></span></dt><dd><p><span id="impl-69"><span class="deltaxml-old" style="background:#FF5555">The default calendar is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default place</span></span></dt><dd><p><span id="impl-70"><span class="deltaxml-old" style="background:#FF5555">The defualt place is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Available documents</span></span></dt><dd><p><span id="impl-71"><span class="deltaxml-old" style="background:#FF5555">The set of available documents (those that may be retrieved with a URI) is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Available text resources</span></span></dt><dd><p><span id="impl-72"><span class="deltaxml-old" style="background:#FF5555">The set of available text resources (those that may be retrieved with a URI) is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Available collections</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">None. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default collection</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">None. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Available URI collections</span></span></dt><dd><p><span id="impl-73"><span class="deltaxml-old" style="background:#FF5555">The set of available URI collections is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Default URI collection</span></span></dt><dd><p><span id="impl-74"><span class="deltaxml-old" style="background:#FF5555">The default URI collection is </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Environment variables</span></span></dt><dd><p><span id="impl-75"><span class="deltaxml-old" style="background:#FF5555">The list of available environment variables is </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></span></p></dd></dl></div><div id="note-amendments" class="note admonition"><h3><span class="deltaxml-old" style="background:#FF5555">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-old" style="background:#FF5555">Some steps may also provide for implementation-defined or implementation-dependent amendments to the contexts. Those amendments are in addition to any specified by XProc.</span></p></div></div></div></section></div></article><article id="references" class="appendix"><header class="appendix-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">C References</span></h2></header><div class="content"><section id="normative-references" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">C.1 Normative References</span></h2></div><div class="content"><div id="normative-references.2" class="bibliolist"><div id="steps30" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Steps 3.0</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://spec.xproc.org/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">XProc 3.0: Standard Step Library</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Norman Walsh, Achim Berndzen, Gerrit Imsieke and Erik Siegel, editors. </span></p></div><div id="xml-infoset-rec" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Infoset</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://www.w3.org/TR/xml-infoset/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">XML Information Set (Second Edition)</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. John Cowan, Richard Tobin, editors. W3C Working Group Note 04 February 2004. </span></p></div><div id="xml10" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XML 1.0</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://www.w3.org/TR/REC-xml/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">Extensible Markup Language (XML) 1.0 (Fifth Edition)</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Tim Bray, Jean Paoli, C. M. Sperberg-McQueen, et. al. editors. W3C Recommendation 26 November 2008.</span></p></div><div id="xmlns10" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Namespaces 1.0</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://www.w3.org/TR/REC-xml-names/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">Namespaces in XML 1.0 (Third Edition)</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Tim Bray, Dave Hollander, Andrew Layman, et. al., editors. W3C Recommendation 8 December 2009.</span></p></div><div id="xml11" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XML 1.1</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://www.w3.org/TR/xml11/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">Extensible Markup Language (XML) 1.1 (Second Edition)</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Tim Bray, Jean Paoli, C. M. Sperberg-McQueen, et. al. editors. W3C Recommendation 16 August 2006.</span></p></div><div id="xmlns11" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Namespaces 1.1</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://www.w3.org/TR/xml-names11/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">Namespaces in XML 1.1 (Second Edition)</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Tim Bray, Dave Hollander, Andrew Layman, et. al., editors. W3C Recommendation 16 August 2006.</span></p></div><div id="xpath31" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath 3.1</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://www.w3.org/TR/xpath31/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">XML Path Language (XPath) 3.1</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Jonathan Robie, Michael Dyck, Josh Spiegel, editors. W3C Recommendation. 21 March 2017.</span></p></div><div id="xpath-datamodel" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XQuery and XPath Data Model 3.1</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://www.w3.org/TR/xpath-datamodel-31/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">XQuery and XPath Data Model 3.1</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Norman Walsh, John Snelson, and Andrew Coleman, editors. W3C Recommendation. 21 March 2017.</span></p></div><div id="xml-serialization-31" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Serialization</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="https://www.w3.org/TR/xslt-xquery-serialization-31/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">XSLT and XQuery Serialization 3.1</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Andrew Coleman and C. M. Sperberg-McQueen, editors. W3C Recommendation. 21 March 2017.</span></p></div><div id="xpath31-functions" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XPath and XQuery Functions and Operators 3.1</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="https://www.w3.org/TR/xpath-functions-31/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">XPath and XQuery Functions and Operators 3.1</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Michael Kay, editor. W3C Recommendation. 21 March 2017</span></p></div><div id="xslt30" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XSLT 3.0</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://www.w3.org/TR/xslt-30/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">XSL Transformations (XSLT) Version 3.0</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Michael Kay, editor. W3C Recommendation. 8 June 2017.</span></p></div><div id="xquery10" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XQuery 1.0</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://www.w3.org/TR/xquery/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">XQuery 1.0: An XML Query Language</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Scott Boag, Don Chamberlin, Mary Fernández, et. al., editors. W3C Recommendation. 23 January 2007.</span></p></div><div id="xmlschema-1" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">W3C XML Schema: Part 1</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://www.w3.org/TR/xmlschema-1/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">XML Schema Part 1: Structures Second Edition</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Henry S. Thompson, David Beech, Murray Maloney, et. al., editors. World Wide Web Consortium, 28 October 2004. </span></p></div><div id="xmlschema-2" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">W3C XML Schema: Part 2</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://www.w3.org/TR/xmlschema-2/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">XML Schema Part 2: Datatypes Second Edition</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Paul V. Biron and Ashok Malhotra, editors. World Wide Web Consortium, 28 October 2004. </span></p></div><div id="xml-id" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">xml:id</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://www.w3.org/TR/xml-id/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">xml:id Version 1.0</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Jonathan Marsh, Daniel Veillard, and Norman Walsh, editors. W3C Recommendation. 9 September 2005.</span></p></div><div id="xml-base" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XML Base</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="http://www.w3.org/TR/xmlbase/"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">XML Base (Second Edition)</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. Jonathan Marsh and Richard Tobin, editors. W3C Recommendation. 28 January 2009.</span></p></div><div id="rfc2119" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 2119</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="https://doi.org/10.17487/RFC2119"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">Key words for use in RFCs to Indicate Requirement Levels</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. S. Bradner. Network Working Group, IETF, Mar 1997. </span></p></div><div id="rfc2396" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 2396</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="https://doi.org/10.17487/RFC2396"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">Uniform Resource Identifiers (URI): Generic Syntax</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. T. Berners-Lee, R. Fielding, and L. Masinter. Network Working Group, IETF, Aug 1998. </span></p></div><div id="rfc3023" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 3023</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="https://doi.org/10.17487/RFC3023"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">RFC 3023: XML Media Types</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. M. Murata, S. St. Laurent, and D. Kohn, editors. Internet Engineering Task Force. January, 2001.</span></p></div><div id="rfc2046" class="bibliomixed"><p><span class="deltaxml-old" style="background:#FF5555">[</span><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 2046</span></span><span class="deltaxml-old" style="background:#FF5555">] </span><a href="https://doi.org/10.17487/RFC2046"><span class="citetitle"><cite><span class="deltaxml-old" style="background:#FF5555">RFC 2046: Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</span></cite></span></a><span class="deltaxml-old" style="background:#FF5555">. N. Freed, N. Borenstein, editors. Internet Engineering Task Force. November, 1996.</span></p></div></div></div></section></div></article><article id="glossary" class="appendix"><header class="appendix-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">D Glossary</span></h2></header><div class="content"><div class="glosslist"><dl><dt id="glossary.2.1" class="glossentry"><em class="glossterm"><a href="#dt-HTML-media-type"><span class="deltaxml-old" style="background:#FF5555">HTML media type</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/html</span></code><span class="deltaxml-old" style="background:#FF5555">” and “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xhtml+xml</span></code><span class="deltaxml-old" style="background:#FF5555"> media types are </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">HTML media types</span></em><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt id="glossary.2.2" class="glossentry"><em class="glossterm"><a href="#dt-JSON-media-type"><span class="deltaxml-old" style="background:#FF5555">JSON media type</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/json</span></code><span class="deltaxml-old" style="background:#FF5555">” media type and all media types of the form “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">something</span></code></em><span class="deltaxml-old" style="background:#FF5555">+json</span></code><span class="deltaxml-old" style="background:#FF5555">” are </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">JSON media types</span></em><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt id="glossary.2.3" class="glossentry"><em class="glossterm"><a href="#dt-Namespaces-in-XML"><span class="deltaxml-old" style="background:#FF5555">Namespaces in XML</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">Unless otherwise noted, the term </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">Namespaces in XML</span></em><span class="deltaxml-old" style="background:#FF5555"> refers equally to [</span><a href="#xmlns10"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Namespaces 1.0</span></span></a><span class="deltaxml-old" style="background:#FF5555">] and [</span><a href="#xmlns11"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">Namespaces 1.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">].</span></p></dd><dt id="glossary.2.4" class="glossentry"><em class="glossterm"><a href="#dt-XML"><span class="deltaxml-old" style="background:#FF5555">XML</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">XProc is intended to work equally well with [</span><a href="#xml10"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XML 1.0</span></span></a><span class="deltaxml-old" style="background:#FF5555">] and [</span><a href="#xml11"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">XML 1.1</span></span></a><span class="deltaxml-old" style="background:#FF5555">]. Unless otherwise noted, the term “</span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">XML</span></em><span class="deltaxml-old" style="background:#FF5555">” refers equally to both versions.</span></p></dd><dt id="glossary.2.5" class="glossentry"><em class="glossterm"><a href="#dt-XML-media-type"><span class="deltaxml-old" style="background:#FF5555">XML media type</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xml</span></code><span class="deltaxml-old" style="background:#FF5555">” and “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/xml</span></code><span class="deltaxml-old" style="background:#FF5555"> media types and all media types of the form “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">something</span></code></em><span class="deltaxml-old" style="background:#FF5555">+xml</span></code><span class="deltaxml-old" style="background:#FF5555">” (except for “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">application/xhtml+xml</span></code><span class="deltaxml-old" style="background:#FF5555">” which is explicitly an </span><em class="glossterm"><a href="#dt-HTML-media-type"><span class="deltaxml-old" style="background:#FF5555">HTML media type</span></a></em><span class="deltaxml-old" style="background:#FF5555">) are </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">XML media types</span></em><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt id="glossary.2.6" class="glossentry"><em class="glossterm"><a href="#dt-ancestors"><span class="deltaxml-old" style="background:#FF5555">ancestors</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">ancestors</span></em><span class="deltaxml-old" style="background:#FF5555"> of a step, if it has any, are its </span><em class="glossterm"><a href="#dt-container"><span class="deltaxml-old" style="background:#FF5555">container</span></a></em><span class="deltaxml-old" style="background:#FF5555"> and the ancestors of its container.</span></p></dd><dt id="glossary.2.7" class="glossentry"><em class="glossterm"><a href="#dt-atomic-step"><span class="deltaxml-old" style="background:#FF5555">atomic step</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">An </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">atomic step</span></em><span class="deltaxml-old" style="background:#FF5555"> is a step that performs a unit of processing on its input, such as validation or transformation, and has no internal </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt id="glossary.2.8" class="glossentry"><em class="glossterm"><a href="#dt-attribute-value-template"><span class="deltaxml-old" style="background:#FF5555">attribute value template</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">In an attribute that is designated as an </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">attribute value template</span></em><span class="deltaxml-old" style="background:#FF5555">, an expression can be used by surrounding the expression with curly brackets (</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">{}</span></code><span class="deltaxml-old" style="background:#FF5555">), following the general rules for </span><em class="glossterm"><a href="#dt-value-template"><span class="deltaxml-old" style="background:#FF5555">value templates</span></a></em></p></dd><dt id="glossary.2.9" class="glossentry"><em class="glossterm"><a href="#dt-bag-merger"><span class="deltaxml-old" style="background:#FF5555">bag-merger</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">bag-merger</span></em><span class="deltaxml-old" style="background:#FF5555"> of two or more bags (where a bag is an unordered list or, equivalently, something like a set except that it may contain duplicates) is a bag constructed by starting with an empty bag and adding each member of each of the input bags in turn to it. It follows that the cardinality of the result is the sum of the cardinality of all the input bags.</span></p></dd><dt id="glossary.2.10" class="glossentry"><em class="glossterm"><a href="#dt-by-source"><span class="deltaxml-old" style="background:#FF5555">by source</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A document is specified </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">by source</span></em><span class="deltaxml-old" style="background:#FF5555"> if it references a specific port on another step.</span></p></dd><dt id="glossary.2.11" class="glossentry"><em class="glossterm"><a href="#dt-by-URI"><span class="deltaxml-old" style="background:#FF5555">by URI</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A document is specified </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">by URI</span></em><span class="deltaxml-old" style="background:#FF5555"> if it is referenced with a URI.</span></p></dd><dt id="glossary.2.12" class="glossentry"><em class="glossterm"><a href="#dt-compound-step"><span class="deltaxml-old" style="background:#FF5555">compound step</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">compound step</span></em><span class="deltaxml-old" style="background:#FF5555"> is a step that contains one or more </span><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipelines</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt id="glossary.2.13" class="glossentry"><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">connection</span></em><span class="deltaxml-old" style="background:#FF5555"> associates an input or output port with some data source.</span></p></dd><dt id="glossary.2.14" class="glossentry"><em class="glossterm"><a href="#dt-contained-steps"><span class="deltaxml-old" style="background:#FF5555">contained steps</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The steps that occur directly within a container are called that step’s </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">contained steps</span></em><span class="deltaxml-old" style="background:#FF5555">. In other words, “container” and “contained steps” are inverse relationships.</span></p></dd><dt id="glossary.2.15" class="glossentry"><em class="glossterm"><a href="#dt-container"><span class="deltaxml-old" style="background:#FF5555">container</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">container</span></em><span class="deltaxml-old" style="background:#FF5555"> is either a compound step or one of the non-step wrapper elements in a compound step that contains several subpipelines.</span></p></dd><dt id="glossary.2.16" class="glossentry"><em class="glossterm"><a href="#dt-declared-inputs"><span class="deltaxml-old" style="background:#FF5555">declared inputs</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The input ports declared on a step are its </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">declared inputs</span></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt id="glossary.2.17" class="glossentry"><em class="glossterm"><a href="#dt-declared-outputs"><span class="deltaxml-old" style="background:#FF5555">declared outputs</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The output ports declared on a step are its </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">declared outputs</span></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt id="glossary.2.18" class="glossentry"><em class="glossterm"><a href="#dt-default-readable-port"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">default readable port</span></em><span class="deltaxml-old" style="background:#FF5555">, which may be undefined, is a specific step name/port name pair from the set of readable ports.</span></p></dd><dt id="glossary.2.19" class="glossentry"><em class="glossterm"><a href="#dt-document"><span class="deltaxml-old" style="background:#FF5555">document</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">document</span></em><span class="deltaxml-old" style="background:#FF5555"> is a </span><em class="glossterm"><a href="#dt-representation"><span class="deltaxml-old" style="background:#FF5555">representation</span></a></em><span class="deltaxml-old" style="background:#FF5555"> and its </span><em class="glossterm"><a href="#dt-document-properties"><span class="deltaxml-old" style="background:#FF5555">document properties</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt id="glossary.2.20" class="glossentry"><em class="glossterm"><a href="#dt-document-properties"><span class="deltaxml-old" style="background:#FF5555">document properties</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">document properties</span></em><span class="deltaxml-old" style="background:#FF5555"> are exposed to the XProc pipeline as a map (</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">map(xs:QName, item()*)</span></code><span class="deltaxml-old" style="background:#FF5555">).</span></p></dd><dt id="glossary.2.21" class="glossentry"><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">dynamic error</span></em><span class="deltaxml-old" style="background:#FF5555"> is one which occurs while a pipeline is being evaluated (and cannot be detected before evaluation begins).</span></p></dd><dt id="glossary.2.22" class="glossentry"><em class="glossterm"><a href="#dt-dynamic-evaluation"><span class="deltaxml-old" style="background:#FF5555">dynamic evaluation</span></a></em></dt><dd class="glossdef"><p><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">Dynamic evaluation</span></em><span class="deltaxml-old" style="background:#FF5555"> consists of tasks which, in general, cannot be performed out until a source document is available.</span></p></dd><dt id="glossary.2.23" class="glossentry"><em class="glossterm"><a href="#dt-effectively-excluded"><span class="deltaxml-old" style="background:#FF5555">effectively excluded</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">If the effective boolean value of the </span><code class="tag-attribute"><span class="deltaxml-old" style="background:#FF5555">[p:]use-when</span></code><span class="deltaxml-old" style="background:#FF5555"> expression is false, then the element and all of its descendants are </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">effectively excluded</span></em><span class="deltaxml-old" style="background:#FF5555"> from the pipeline document.</span></p></dd><dt id="glossary.2.24" class="glossentry"><em class="glossterm"><a href="#dt-empty-environment"><span class="deltaxml-old" style="background:#FF5555">empty environment</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">empty environment</span></em><span class="deltaxml-old" style="background:#FF5555"> contains no readable ports, an undefined default readable port, and no in-scope bindings.</span></p></dd><dt id="glossary.2.25" class="glossentry"><em class="glossterm"><a href="#dt-empty-sequence"><span class="deltaxml-old" style="background:#FF5555">empty sequence</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">An </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">empty sequence</span></em><span class="deltaxml-old" style="background:#FF5555"> of documents is specified with the </span><a href="#p.empty"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></code></a><span class="deltaxml-old" style="background:#FF5555"> element.</span></p></dd><dt id="glossary.2.26" class="glossentry"><em class="glossterm"><a href="#dt-environment"><span class="deltaxml-old" style="background:#FF5555">environment</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">environment</span></em><span class="deltaxml-old" style="background:#FF5555"> is a context-dependent collection of information available within subpipelines.</span></p></dd><dt id="glossary.2.27" class="glossentry"><em class="glossterm"><a href="#dt-extension-attribute"><span class="deltaxml-old" style="background:#FF5555">extension attribute</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">An element from the XProc namespace </span><span class="rfc2119" id="glossary.2.27.2.1.1"><span class="deltaxml-old" style="background:#FF5555">may</span></span><span class="deltaxml-old" style="background:#FF5555"> have any attribute not from the XProc namespace, provided that the expanded-QName of the attribute has a non-null namespace URI. Such an attribute is called an </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">extension attribute</span></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt id="glossary.2.28" class="glossentry"><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">An </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></em><span class="deltaxml-old" style="background:#FF5555"> feature is one where the implementation has discretion in how it is performed. Conformant implementations </span><span class="rfc2119" id="glossary.2.28.2.1.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> document how </span><em class="glossterm"><a href="#dt-implementation-defined"><span class="deltaxml-old" style="background:#FF5555">implementation-defined</span></a></em><span class="deltaxml-old" style="background:#FF5555"> features are performed.</span></p></dd><dt id="glossary.2.29" class="glossentry"><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">An </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></em><span class="deltaxml-old" style="background:#FF5555"> feature is one where the implementation has discretion in how it is performed. Implementations are not required to document or explain how </span><em class="glossterm"><a href="#dt-implementation-dependent"><span class="deltaxml-old" style="background:#FF5555">implementation-dependent</span></a></em><span class="deltaxml-old" style="background:#FF5555"> features are performed.</span></p></dd><dt id="glossary.2.30" class="glossentry"><em class="glossterm"><a href="#dt-in-scope-bindings"><span class="deltaxml-old" style="background:#FF5555">in-scope bindings</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">in-scope bindings</span></em><span class="deltaxml-old" style="background:#FF5555"> are a set of name-value pairs, based on </span><em class="glossterm"><a href="#dt-option"><span class="deltaxml-old" style="background:#FF5555">option</span></a></em><span class="deltaxml-old" style="background:#FF5555"> and </span><em class="glossterm"><a href="#dt-variable"><span class="deltaxml-old" style="background:#FF5555">variable</span></a></em><span class="deltaxml-old" style="background:#FF5555"> bindings.</span></p></dd><dt id="glossary.2.31" class="glossentry"><em class="glossterm"><a href="#dt-inherited-environment"><span class="deltaxml-old" style="background:#FF5555">inherited environment</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">inherited environment</span></em><span class="deltaxml-old" style="background:#FF5555"> of a </span><em class="glossterm"><a href="#dt-contained-steps"><span class="deltaxml-old" style="background:#FF5555">contained step</span></a></em><span class="deltaxml-old" style="background:#FF5555"> is an environment that is the same as the environment of its </span><em class="glossterm"><a href="#dt-container"><span class="deltaxml-old" style="background:#FF5555">container</span></a></em><span class="deltaxml-old" style="background:#FF5555"> with the </span><a href="#dt-standard-modifications"><span class="deltaxml-old" style="background:#FF5555">standard modifications</span></a><span class="deltaxml-old" style="background:#FF5555">. </span></p></dd><dt id="glossary.2.32" class="glossentry"><em class="glossterm"><a href="#dt-initial-environment"><span class="deltaxml-old" style="background:#FF5555">initial environment</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">An </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">initial environment</span></em><span class="deltaxml-old" style="background:#FF5555"> is a </span><em class="glossterm"><a href="#dt-connection"><span class="deltaxml-old" style="background:#FF5555">connection</span></a></em><span class="deltaxml-old" style="background:#FF5555"> for each of the </span><em class="glossterm"><a href="#dt-readable-ports"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></a></em><span class="deltaxml-old" style="background:#FF5555"> and a set of option bindings used to construct the initial </span><em class="glossterm"><a href="#dt-in-scope-bindings"><span class="deltaxml-old" style="background:#FF5555">in-scope bindings</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt id="glossary.2.33" class="glossentry"><em class="glossterm"><a href="#dt-inline-document"><span class="deltaxml-old" style="background:#FF5555">inline document</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">An </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">inline document</span></em><span class="deltaxml-old" style="background:#FF5555"> is specified directly in the body of the element to which it connects.</span></p></dd><dt id="glossary.2.34" class="glossentry"><em class="glossterm"><a href="#dt-last-step"><span class="deltaxml-old" style="background:#FF5555">last step</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">last step</span></em><span class="deltaxml-old" style="background:#FF5555"> in a subpipeline is its last step in document order.</span></p></dd><dt id="glossary.2.35" class="glossentry"><em class="glossterm"><a href="#dt-map-attribute"><span class="deltaxml-old" style="background:#FF5555">map attribute</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">map attribute</span></em><span class="deltaxml-old" style="background:#FF5555"> is an option's syntactic shortcut attribute for which the option's sequence type is a map or array.</span></p></dd><dt id="glossary.2.36" class="glossentry"><em class="glossterm"><a href="#dt-matches"><span class="deltaxml-old" style="background:#FF5555">matches</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A step </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">matches</span></em><span class="deltaxml-old" style="background:#FF5555"> its signature if and only if it specifies an input for each declared input, it specifies no inputs that are not declared, it specifies an option for each option that is declared to be required, and it specifies no options that are not declared.</span></p></dd><dt id="glossary.2.37" class="glossentry"><em class="glossterm"><a href="#dt-namespace-fixup"><span class="deltaxml-old" style="background:#FF5555">namespace fixup</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">To produce a serializable </span><em class="glossterm"><a href="#dt-XML"><span class="deltaxml-old" style="background:#FF5555">XML</span></a></em><span class="deltaxml-old" style="background:#FF5555"> document, the XProc processor must sometimes add additional namespace nodes, perhaps even renaming prefixes, to satisfy the constraints of </span><em class="glossterm"><a href="#dt-Namespaces-in-XML"><span class="deltaxml-old" style="background:#FF5555">Namespaces in XML</span></a></em><span class="deltaxml-old" style="background:#FF5555">. This process is referred to as </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">namespace fixup</span></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt id="glossary.2.38" class="glossentry"><em class="glossterm"><a href="#dt-option"><span class="deltaxml-old" style="background:#FF5555">option</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">An </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">option</span></em><span class="deltaxml-old" style="background:#FF5555"> is a name/value pair. The name </span><span class="rfc2119" id="glossary.2.38.2.1.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be an </span><a href="http://www.w3.org/TR/REC-xml-names/#dt-expname"><span class="deltaxml-old" style="background:#FF5555">expanded name</span></a><span class="deltaxml-old" style="background:#FF5555">. The value may be any XPath data model value.</span></p></dd><dt id="glossary.2.39" class="glossentry"><em class="glossterm"><a href="#dt-pipeline"><span class="deltaxml-old" style="background:#FF5555">pipeline</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">pipeline</span></em><span class="deltaxml-old" style="background:#FF5555"> is a set of connected steps, with outputs of one step flowing into inputs of another.</span></p></dd><dt id="glossary.2.40" class="glossentry"><em class="glossterm"><a href="#dt-primary-input-port"><span class="deltaxml-old" style="background:#FF5555">primary input port</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">If a step has an input port which is explicitly marked “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">primary='true'</span></code><span class="deltaxml-old" style="background:#FF5555">”, or if it has exactly one document input port and that port is </span><em><span class="deltaxml-old" style="background:#FF5555">not</span></em><span class="deltaxml-old" style="background:#FF5555"> explicitly marked “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">primary='false'</span></code><span class="deltaxml-old" style="background:#FF5555">”, then that input port is the </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">primary input port</span></em><span class="deltaxml-old" style="background:#FF5555"> of the step.</span></p></dd><dt id="glossary.2.41" class="glossentry"><em class="glossterm"><a href="#dt-primary-output-port"><span class="deltaxml-old" style="background:#FF5555">primary output port</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">If a step has an output port which is explicitly marked “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">primary='true'</span></code><span class="deltaxml-old" style="background:#FF5555">”, or if it has exactly one document output port and that port is </span><em><span class="deltaxml-old" style="background:#FF5555">not</span></em><span class="deltaxml-old" style="background:#FF5555"> explicitly marked “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">primary='false'</span></code><span class="deltaxml-old" style="background:#FF5555">”, then that output port is the </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">primary output port</span></em><span class="deltaxml-old" style="background:#FF5555"> of the step.</span></p></dd><dt id="glossary.2.42" class="glossentry"><em class="glossterm"><a href="#dt-prologue"><span class="deltaxml-old" style="background:#FF5555">prologue</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">prologue</span></em><span class="deltaxml-old" style="background:#FF5555"> consists of the </span><a href="#p.input"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:input</span></code></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#p.output"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:output</span></code></a><span class="deltaxml-old" style="background:#FF5555">, and </span><a href="#p.option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements. The prologue may also contain </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements, but if it does, they must be declared statically.</span></p></dd><dt id="glossary.2.43" class="glossentry"><em class="glossterm"><a href="#dt-readable-ports"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">readable ports</span></em><span class="deltaxml-old" style="background:#FF5555"> are a set of step name/port name pairs.</span></p></dd><dt id="glossary.2.44" class="glossentry"><em class="glossterm"><a href="#dt-representation"><span class="deltaxml-old" style="background:#FF5555">representation</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">representation</span></em><span class="deltaxml-old" style="background:#FF5555"> is a data structure used by an XProc processor to refer to the actual document content.</span></p></dd><dt id="glossary.2.45" class="glossentry"><em class="glossterm"><a href="#dt-shadow"><span class="deltaxml-old" style="background:#FF5555">shadow</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">We say that a variable </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">shadows</span></em><span class="deltaxml-old" style="background:#FF5555"> another variable (or option) if it has the same name and appears later in the same lexical scope.</span></p></dd><dt id="glossary.2.46" class="glossentry"><em class="glossterm"><a href="#dt-signature"><span class="deltaxml-old" style="background:#FF5555">signature</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">signature</span></em><span class="deltaxml-old" style="background:#FF5555"> of a step is the set of inputs, outputs, and options that it is declared to accept.</span></p></dd><dt id="glossary.2.47" class="glossentry"><em class="glossterm"><a href="#dt-static-analysis"><span class="deltaxml-old" style="background:#FF5555">static analysis</span></a></em></dt><dd class="glossdef"><p><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">Static analysis</span></em><span class="deltaxml-old" style="background:#FF5555"> consists of those tasks that can be performed by inspection of the pipeline alone, including the binding of </span><a href="#statics"><span class="deltaxml-old" style="background:#FF5555">static options and variables</span></a><span class="deltaxml-old" style="background:#FF5555">, computation of serialization properties and document-properties, </span><a href="#use-when"><span class="deltaxml-old" style="background:#FF5555">evaluation of </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">use-when</span></code><span class="deltaxml-old" style="background:#FF5555"> expressions</span></a><span class="deltaxml-old" style="background:#FF5555">, performing a static analysis of all XPath expressions, and detecting static errors.</span></p></dd><dt id="glossary.2.48" class="glossentry"><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">static error</span></em><span class="deltaxml-old" style="background:#FF5555"> is one which can be detected before pipeline evaluation is even attempted.</span></p></dd><dt id="glossary.2.49" class="glossentry"><em class="glossterm"><a href="#dt-step"><span class="deltaxml-old" style="background:#FF5555">step</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">step</span></em><span class="deltaxml-old" style="background:#FF5555"> is the basic computational unit of a pipeline.</span></p></dd><dt id="glossary.2.50" class="glossentry"><em class="glossterm"><a href="#dt-step-type-exports"><span class="deltaxml-old" style="background:#FF5555">step type exports</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">step type exports</span></em><span class="deltaxml-old" style="background:#FF5555"> of an XProc element, against the background of a set of URIs of resources already visited (call this set </span><em><span class="deltaxml-old" style="background:#FF5555">Visited</span></em><span class="deltaxml-old" style="background:#FF5555">), are defined by cases.</span></p></dd><dt id="glossary.2.51" class="glossentry"><em class="glossterm"><a href="#dt-subpipeline"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">Sibling steps and variables (and the connections between them) form a </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt id="glossary.2.52" class="glossentry"><em class="glossterm"><a href="#dt-text-media-type"><span class="deltaxml-old" style="background:#FF5555">text media type</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">Media types of the form “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/</span><em class="replaceable"><code><span class="deltaxml-old" style="background:#FF5555">something</span></code></em></code><span class="deltaxml-old" style="background:#FF5555">” are </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">text media types</span></em><span class="deltaxml-old" style="background:#FF5555"> with the exception of “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/xml</span></code><span class="deltaxml-old" style="background:#FF5555">” which is an XML media type. and “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">text/html</span></code><span class="deltaxml-old" style="background:#FF5555">” which is an HTML media type. </span></p></dd><dt id="glossary.2.53" class="glossentry"><em class="glossterm"><a href="#dt-text-value-template"><span class="deltaxml-old" style="background:#FF5555">text value template</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">In a text node that is designated as a </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">text value template</span></em><span class="deltaxml-old" style="background:#FF5555">, expressions can be used by surrounding each expression with curly brackets (</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">{}</span></code><span class="deltaxml-old" style="background:#FF5555">), following the general rules for </span><em class="glossterm"><a href="#dt-value-template"><span class="deltaxml-old" style="background:#FF5555">value templates</span></a></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt id="glossary.2.54" class="glossentry"><em class="glossterm"><a href="#dt-value-template"><span class="deltaxml-old" style="background:#FF5555">value template</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">Collectively, attribute value templates and text value templates are referred to as </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">value templates</span></em><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt id="glossary.2.55" class="glossentry"><em class="glossterm"><a href="#dt-variable"><span class="deltaxml-old" style="background:#FF5555">variable</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">A </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">variable</span></em><span class="deltaxml-old" style="background:#FF5555"> is a name/value pair. The name </span><span class="rfc2119" id="glossary.2.55.2.1.2"><span class="deltaxml-old" style="background:#FF5555">must</span></span><span class="deltaxml-old" style="background:#FF5555"> be an </span><a href="http://www.w3.org/TR/REC-xml-names/#dt-expname"><span class="deltaxml-old" style="background:#FF5555">expanded name</span></a><span class="deltaxml-old" style="background:#FF5555">. The value may be any XPath data model value.</span></p></dd><dt id="glossary.2.56" class="glossentry"><em class="glossterm"><a href="#dt-visible"><span class="deltaxml-old" style="background:#FF5555">visible</span></a></em></dt><dd class="glossdef"><p><span class="deltaxml-old" style="background:#FF5555">If two names are in the same scope, we say that they are </span><em class="firstterm"><span class="deltaxml-old" style="background:#FF5555">visible</span></em><span class="deltaxml-old" style="background:#FF5555"> to each other. </span></p></dd></dl></div></div></article><article id="language-summary" class="appendix"><header class="appendix-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">E Pipeline Language Summary</span></h2></header><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">This appendix summarizes the XProc pipeline language. Machine readable descriptions of this language are available in </span><a href="schemas/xproc.rng"><span class="deltaxml-old" style="background:#FF5555">RELAX NG</span></a><span class="deltaxml-old" style="background:#FF5555"> (and the RELAX NG </span><a href="schemas/xproc.rnc"><span class="deltaxml-old" style="background:#FF5555">compact syntax</span></a><span class="deltaxml-old" style="background:#FF5555">), </span><a href="schemas/xproc.xsd"><span class="deltaxml-old" style="background:#FF5555">W3C XML Schema</span></a><span class="deltaxml-old" style="background:#FF5555">, and </span><a href="schemas/xproc.dtd"><span class="deltaxml-old" style="background:#FF5555">DTD</span></a><span class="deltaxml-old" style="background:#FF5555"> syntaxes.</span></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:for-each</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555">? &amp; </span><span class="deltaxml-old" style="background:#FF5555">      </span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*),</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:for-each&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:viewport</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">match</span></strong><span class="deltaxml-old" style="background:#FF5555"> = { </span><var><span class="deltaxml-old" style="background:#FF5555">XSLTSelectionPattern</span></var><span class="deltaxml-old" style="background:#FF5555"> }&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555">? &amp; </span><span class="deltaxml-old" style="background:#FF5555">      </span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">?),</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:viewport&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:choose</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555">?,</span><span class="deltaxml-old" style="background:#FF5555">     ((</span><a href="#p.when"><span class="deltaxml-old" style="background:#FF5555">p:when</span></a><span class="deltaxml-old" style="background:#FF5555">+,</span><span class="deltaxml-old" style="background:#FF5555">       </span><a href="#p.otherwise"><span class="deltaxml-old" style="background:#FF5555">p:otherwise</span></a><span class="deltaxml-old" style="background:#FF5555">?) | </span><span class="deltaxml-old" style="background:#FF5555">      (</span><a href="#p.when"><span class="deltaxml-old" style="background:#FF5555">p:when</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">       </span><a href="#p.otherwise"><span class="deltaxml-old" style="background:#FF5555">p:otherwise</span></a><span class="deltaxml-old" style="background:#FF5555">)))</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:choose&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:when</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">test</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  collection? = { </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555"> }&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555">?,</span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:when&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:otherwise</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:otherwise&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:if</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">test</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  collection? = { </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555"> }&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555">?,</span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:if&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:group</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:group&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:try</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">,</span><span class="deltaxml-old" style="background:#FF5555">     ((</span><a href="#p.catch"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></a><span class="deltaxml-old" style="background:#FF5555">+,</span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.finally"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></a><span class="deltaxml-old" style="background:#FF5555">?) | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.catch"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.finally"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></a><span class="deltaxml-old" style="background:#FF5555">)))</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:try&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:catch</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  code? = </span><var><span class="deltaxml-old" style="background:#FF5555">EQNameList</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:catch&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:finally</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:finally&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;</span><var><span class="deltaxml-old" style="background:#FF5555">p:atomic-step</span></var><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.with-option"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></a><span class="deltaxml-old" style="background:#FF5555">)*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/</span><var><span class="deltaxml-old" style="background:#FF5555">p:atomic-step</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;</span><var><span class="deltaxml-old" style="background:#FF5555">pfx:atomic-step</span></var><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.with-input"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.with-option"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></a><span class="deltaxml-old" style="background:#FF5555">)*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/</span><var><span class="deltaxml-old" style="background:#FF5555">pfx:atomic-step</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:input</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">port</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  sequence? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  primary? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  select? = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  content-types? = </span><var><span class="deltaxml-old" style="background:#FF5555">ContentTypes</span></var><span class="deltaxml-old" style="background:#FF5555">  href? = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.empty"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.document"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.inline"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a><span class="deltaxml-old" style="background:#FF5555">)*) | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">anyElement</span></var><span class="deltaxml-old" style="background:#FF5555">*)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:input&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:with-input</span><span class="deltaxml-old" style="background:#FF5555">  port? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  select? = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  href? = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  pipe? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.empty"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.document"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.pipe"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.inline"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a><span class="deltaxml-old" style="background:#FF5555">)*) | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">anyElement</span></var><span class="deltaxml-old" style="background:#FF5555">*)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:with-input&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:output</span><span class="deltaxml-old" style="background:#FF5555">  port? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  sequence? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  primary? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  content-types? = </span><var><span class="deltaxml-old" style="background:#FF5555">ContentTypes</span></var><span class="deltaxml-old" style="background:#FF5555"> /&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:output</span><span class="deltaxml-old" style="background:#FF5555">  port? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  sequence? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  primary? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  content-types? = </span><var><span class="deltaxml-old" style="background:#FF5555">ContentTypes</span></var><span class="deltaxml-old" style="background:#FF5555">  href? = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  pipe? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.empty"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.document"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.pipe"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.inline"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a><span class="deltaxml-old" style="background:#FF5555">)*) | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">anyElement</span></var><span class="deltaxml-old" style="background:#FF5555">*)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:output&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:output</span><span class="deltaxml-old" style="background:#FF5555">  port? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  sequence? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  primary? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  content-types? = </span><var><span class="deltaxml-old" style="background:#FF5555">ContentTypes</span></var><span class="deltaxml-old" style="background:#FF5555">  href? = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  pipe? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">  serialization? = </span><var><span class="deltaxml-old" style="background:#FF5555">map(xs:QName,item()*)</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.empty"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.document"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.pipe"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.inline"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a><span class="deltaxml-old" style="background:#FF5555">)*) | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">anyElement</span></var><span class="deltaxml-old" style="background:#FF5555">*)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:output&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:variable</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">name</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">EQName</span></var><span class="deltaxml-old" style="background:#FF5555">  as? = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathSequenceType</span></var><span class="deltaxml-old" style="background:#FF5555">  static? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">select</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  collection? = { </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  href? = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  pipe? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">  visibility? = </span><var><span class="deltaxml-old" style="background:#FF5555">private|public</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.empty"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.document"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.pipe"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.inline"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a><span class="deltaxml-old" style="background:#FF5555">)*) | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">anyElement</span></var><span class="deltaxml-old" style="background:#FF5555">*)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:variable&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:option</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">name</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">EQName</span></var><span class="deltaxml-old" style="background:#FF5555">  as? = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathSequenceType</span></var><span class="deltaxml-old" style="background:#FF5555">  values? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  static? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  required? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  select? = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  visibility? = </span><var><span class="deltaxml-old" style="background:#FF5555">private|public</span></var><span class="deltaxml-old" style="background:#FF5555"> /&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:with-option</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">name</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">EQName</span></var><span class="deltaxml-old" style="background:#FF5555">  as? = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathSequenceType</span></var><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">select</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">XPathExpression</span></var><span class="deltaxml-old" style="background:#FF5555">  collection? = { </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  href? = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  pipe? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    ((</span><a href="#p.empty"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">       (</span><a href="#p.document"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.pipe"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">        </span><a href="#p.inline"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a><span class="deltaxml-old" style="background:#FF5555">)*) | </span><span class="deltaxml-old" style="background:#FF5555">     </span><var><span class="deltaxml-old" style="background:#FF5555">anyElement</span></var><span class="deltaxml-old" style="background:#FF5555">*)</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:with-option&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:declare-step</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  type? = </span><var><span class="deltaxml-old" style="background:#FF5555">EQName</span></var><span class="deltaxml-old" style="background:#FF5555">  psvi-required? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  xpath-version? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">  version? = "3.0"</span><span class="deltaxml-old" style="background:#FF5555">  visibility? = </span><var><span class="deltaxml-old" style="background:#FF5555">private|public</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.import"><span class="deltaxml-old" style="background:#FF5555">p:import</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.import-functions"><span class="deltaxml-old" style="background:#FF5555">p:import-functions</span></a><span class="deltaxml-old" style="background:#FF5555">)*,</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.input"><span class="deltaxml-old" style="background:#FF5555">p:input</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.option"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.variable"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a><span class="deltaxml-old" style="background:#FF5555">)*,</span><span class="deltaxml-old" style="background:#FF5555">    </span><a href="#p.declare-step"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></a><span class="deltaxml-old" style="background:#FF5555">*,</span><span class="deltaxml-old" style="background:#FF5555">    </span><var><span class="deltaxml-old" style="background:#FF5555">subpipeline</span></var><span class="deltaxml-old" style="background:#FF5555">?</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:declare-step&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:declare-step</span><span class="deltaxml-old" style="background:#FF5555">  name? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  type? = </span><var><span class="deltaxml-old" style="background:#FF5555">EQName</span></var><span class="deltaxml-old" style="background:#FF5555">  psvi-required? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  xpath-version? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">  version? = "3.0"</span><span class="deltaxml-old" style="background:#FF5555">  visibility? = </span><var><span class="deltaxml-old" style="background:#FF5555">private|public</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.input"><span class="deltaxml-old" style="background:#FF5555">p:input</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.output"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.option"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a><span class="deltaxml-old" style="background:#FF5555">)*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:declare-step&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:library</span><span class="deltaxml-old" style="background:#FF5555">  psvi-required? = </span><var><span class="deltaxml-old" style="background:#FF5555">boolean</span></var><span class="deltaxml-old" style="background:#FF5555">  xpath-version? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">  version? = "3.0"&gt;</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.import"><span class="deltaxml-old" style="background:#FF5555">p:import</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.import-functions"><span class="deltaxml-old" style="background:#FF5555">p:import-functions</span></a><span class="deltaxml-old" style="background:#FF5555">)*,</span><span class="deltaxml-old" style="background:#FF5555">    (</span><a href="#p.declare-step"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.variable"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a><span class="deltaxml-old" style="background:#FF5555"> | </span><span class="deltaxml-old" style="background:#FF5555">     </span><a href="#p.option"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a><span class="deltaxml-old" style="background:#FF5555">)*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:library&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:import</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">href</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> /&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:import-functions</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">href</span></strong><span class="deltaxml-old" style="background:#FF5555"> = </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555">  content-type? = </span><var><span class="deltaxml-old" style="background:#FF5555">ContentType</span></var><span class="deltaxml-old" style="background:#FF5555">  namespace? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555"> /&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:pipe</span><span class="deltaxml-old" style="background:#FF5555">  step? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555">  port? = </span><var><span class="deltaxml-old" style="background:#FF5555">NCName</span></var><span class="deltaxml-old" style="background:#FF5555"> /&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:inline</span><span class="deltaxml-old" style="background:#FF5555">  exclude-inline-prefixes? = </span><var><span class="deltaxml-old" style="background:#FF5555">ExcludeInlinePrefixes</span></var><span class="deltaxml-old" style="background:#FF5555">  content-type? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  document-properties? = </span><var><span class="deltaxml-old" style="background:#FF5555">map(xs:QName,item()*)</span></var><span class="deltaxml-old" style="background:#FF5555">  encoding? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">&gt;</span><span class="deltaxml-old" style="background:#FF5555">    </span><var><span class="deltaxml-old" style="background:#FF5555">anyNode</span></var><span class="deltaxml-old" style="background:#FF5555">*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:inline&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:document</span><span class="deltaxml-old" style="background:#FF5555">  </span><strong><span class="deltaxml-old" style="background:#FF5555">href</span></strong><span class="deltaxml-old" style="background:#FF5555"> = { </span><var><span class="deltaxml-old" style="background:#FF5555">anyURI</span></var><span class="deltaxml-old" style="background:#FF5555"> }</span><span class="deltaxml-old" style="background:#FF5555">  content-type? = </span><var><span class="deltaxml-old" style="background:#FF5555">string</span></var><span class="deltaxml-old" style="background:#FF5555">  document-properties? = </span><var><span class="deltaxml-old" style="background:#FF5555">map(xs:QName,item()*)</span></var><span class="deltaxml-old" style="background:#FF5555">  parameters? = </span><var><span class="deltaxml-old" style="background:#FF5555">map(xs:QName,item()*)</span></var><span class="deltaxml-old" style="background:#FF5555"> /&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:empty /&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:documentation&gt;</span><span class="deltaxml-old" style="background:#FF5555">    </span><var><span class="deltaxml-old" style="background:#FF5555">any-well-formed-content</span></var><span class="deltaxml-old" style="background:#FF5555">*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:documentation&gt;</span></code></p><p class="element-syntax element-syntax-language-construct"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:pipeinfo&gt;</span><span class="deltaxml-old" style="background:#FF5555">    </span><var><span class="deltaxml-old" style="background:#FF5555">any-well-formed-content</span></var><span class="deltaxml-old" style="background:#FF5555">*</span><span class="deltaxml-old" style="background:#FF5555">&lt;/p:pipeinfo&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">The core steps are also summarized here.</span></p><p><span class="deltaxml-old" style="background:#FF5555">As are the optional steps.</span></p><p><span class="deltaxml-old" style="background:#FF5555">And the step vocabulary elements.</span></p></div></article><article id="errors-list" class="appendix"><header class="appendix-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">F List of Error Codes</span></h2></header><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The following error codes are defined by this specification.</span></p><section id="app.static-errors" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">F.1 Static Errors</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The following </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static errors</span></a></em><span class="deltaxml-old" style="background:#FF5555"> are defined:</span></p><div id="static-error-summary"><h5><span class="deltaxml-old" style="background:#FF5555">Static Errors</span></h5><dl class="errs"><dt id="err.S0001"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0001</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if there are any loops in the connections between steps, variables, and options: no step, variable, or option can be connected to itself nor can there be any sequence of connections through other steps that leads back to itself.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0001"><span class="deltaxml-old" style="background:#FF5555">Connections</span></a></p></dd><dt id="err.S0002"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0002</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">All steps in the same scope must have unique names: it is a static error if two steps with the same name appear in the same scope.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0002"><span class="deltaxml-old" style="background:#FF5555">Scoping of Names</span></a></p></dd><dt id="err.S0003"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0003</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if any declared input is not connected.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0003"><span class="deltaxml-old" style="background:#FF5555">Inputs and Outputs</span></a></p></dd><dt id="err.S0004"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0004</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to declare two or more options on the same step with the same name.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0004"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a></p></dd><dt id="err.S0006"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0006</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the primary output port has no explicit connection and the last step in the subpipeline does not have a primary output port.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0006"><span class="deltaxml-old" style="background:#FF5555">p:for-each</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0006.1"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0006.2"><span class="deltaxml-old" style="background:#FF5555">Declaring pipelines</span></a></p></dd><dt id="err.S0008"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0008</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if any element in the XProc namespace has attributes not defined by this specification unless they are extension attributes.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0008"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></p></dd><dt id="err.S0010"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0010</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if a pipeline contains a step whose specified inputs, outputs, and options do not match the signature for steps of that type.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0010"><span class="deltaxml-old" style="background:#FF5555">Extension Steps</span></a></p></dd><dt id="err.S0011"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0011</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to identify two ports with the same name on the same step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0011"><span class="deltaxml-old" style="background:#FF5555">p:input</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0011.1"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a></p></dd><dt id="err.S0014"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0014</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to identify more than one output port as primary.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0014"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a></p></dd><dt id="err.S0015"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0015</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if a compound step has no contained steps.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0015"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></p></dd><dt id="err.S0017"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0017</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to specify that an option is both required and has a default value.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0017"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a></p></dd><dt id="err.S0018"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0018</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If an option is required, it is a static error to invoke the step without specifying a value for that option.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0018"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a></p></dd><dt id="err.S0022"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0022</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">In all cases except when the p:pipe is within an p:output of a compound step, it is a static error if the port identified by the p:pipe is not in the readable ports of the step that contains the p:pipe.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0022"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a></p></dd><dt id="err.S0025"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0025</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the expanded-QName value of the type attribute is in no namespace or in the XProc namespace.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0025"><span class="deltaxml-old" style="background:#FF5555">Declaring pipelines</span></a></p></dd><dt id="err.S0027"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0027</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if an option is specified with both the shortcut form and the long form.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0027"><span class="deltaxml-old" style="background:#FF5555">Syntactic Shortcut for Option Values</span></a></p></dd><dt id="err.S0028"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0028</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to declare an option or variable in the XProc namespace.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0028"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0028.1"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a></p></dd><dt id="err.S0029"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0029</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to specify a connection for a p:output inside a p:declare-step for an atomic step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0029"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a></p></dd><dt id="err.S0030"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0030</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to specify that more than one input port is the primary.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0030"><span class="deltaxml-old" style="background:#FF5555">p:input</span></a></p></dd><dt id="err.S0031"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0031</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to use an option name in p:with-option if the step type being invoked has not declared an option with that name.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0031"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0031.1"><span class="deltaxml-old" style="background:#FF5555">Syntactic Shortcut for Option Values</span></a></p></dd><dt id="err.S0032"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0032</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if no connection is provided and the default readable port is undefined.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0032"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a></p></dd><dt id="err.S0036"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0036</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">All the step types in a pipeline or library must have unique names: it is a static error if any step type name is built-in and/or declared or defined more than once in the same scope.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0036"><span class="deltaxml-old" style="background:#FF5555">Scoping of Names</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0036.1"><span class="deltaxml-old" style="background:#FF5555">Handling Circular and Re-entrant Library Imports (Non-Normative)</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0036.2"><span class="deltaxml-old" style="background:#FF5555">Handling Circular and Re-entrant Library Imports (Non-Normative)</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0036.3"><span class="deltaxml-old" style="background:#FF5555">Handling Circular and Re-entrant Library Imports (Non-Normative)</span></a></p></dd><dt id="err.S0037"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0037</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if any user extension step or any element in the XProc namespace other than p:inline directly contains text nodes that do not consist entirely of whitespace.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0037"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></p></dd><dt id="err.S0038"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0038</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if any required attribute is not provided.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0038"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></p></dd><dt id="err.S0042"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0042</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to attempt to provide a connection for an input port on the declaration of an atomic step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0042"><span class="deltaxml-old" style="background:#FF5555">p:input</span></a></p></dd><dt id="err.S0044"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0044</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if any step contains an atomic step for which there is no visible declaration.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0044"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></p></dd><dt id="err.S0048"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0048</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to use a declared step as a compound step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0048"><span class="deltaxml-old" style="background:#FF5555">Extension Steps</span></a></p></dd><dt id="err.S0052"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0052</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the URI of a p:import cannot be retrieved or if, once retrieved, it does not point to a p:library or p:declare-step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0052"><span class="deltaxml-old" style="background:#FF5555">p:import</span></a></p></dd><dt id="err.S0053"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0053</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to import a single pipeline if that pipeline does not have a type.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0053"><span class="deltaxml-old" style="background:#FF5555">p:import</span></a></p></dd><dt id="err.S0057"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0057</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the exclude-inline-prefixes attribute does not contain a list of tokens or if any of those tokens (except #all or #default) is not a prefix bound to a namespace in the in-scope namespaces of the element on which it occurs.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0057"><span class="deltaxml-old" style="background:#FF5555">Inline XML content</span></a></p></dd><dt id="err.S0058"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0058</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the value #default is used within the exclude-inline-prefixes attribute and there is no default namespace in scope.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0058"><span class="deltaxml-old" style="background:#FF5555">Inline XML content</span></a></p></dd><dt id="err.S0059"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0059</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the pipeline element is not p:declare-step or p:library.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0059"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></p></dd><dt id="err.S0060"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0060</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the processor encounters an explicit request for a version of the language other than “3.0”.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0060"><span class="deltaxml-old" style="background:#FF5555">Versioning Considerations</span></a></p></dd><dt id="err.S0062"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0062</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if a required version attribute is not present.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0062"><span class="deltaxml-old" style="background:#FF5555">Versioning Considerations</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0062.1"><span class="deltaxml-old" style="background:#FF5555">Declaring pipelines</span></a></p></dd><dt id="err.S0063"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0063</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the value of the version attribute is not a xs:decimal.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0063"><span class="deltaxml-old" style="background:#FF5555">Versioning Considerations</span></a></p></dd><dt id="err.S0064"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0064</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the code attribute is missing from any but the last p:catch or if any error code occurs in more than one code attribute among sibling p:catch elements.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0064"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></a></p></dd><dt id="err.S0065"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0065</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if there is no primary input port.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0065"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a></p></dd><dt id="err.S0066"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0066</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if an expression does not have a closing right curly bracket or if an unescaped right curly bracket occurs outside of an expression. </span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0066"><span class="deltaxml-old" style="background:#FF5555">Value Templates</span></a></p></dd><dt id="err.S0067"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0067</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the step attribute is not specified, and there is no default readable port. It is a static error if the port attribute is not specified, and the step identified has no primary output port. </span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0067"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a></p></dd><dt id="err.S0068"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0068</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the port attribute is not specified, and the step identified has no primary output port.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0068"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a></p></dd><dt id="err.S0069"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0069</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the encoding specified is not supported by the implementation.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0069"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a></p></dd><dt id="err.S0072"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0072</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the name of any output port on the p:finally is the same as the name of any other output port in the p:try or any of its sibling p:catch elements.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0072"><span class="deltaxml-old" style="background:#FF5555">p:finally</span></a></p></dd><dt id="err.S0073"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0073</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if any specified name is not the name of an in-scope step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0073"><span class="deltaxml-old" style="background:#FF5555">Additional dependent connections</span></a></p></dd><dt id="err.S0074"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0074</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if a p:choose has neither a p:when nor a p:otherwise.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0074"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></a></p></dd><dt id="err.S0075"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0075</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if a p:try does not have at least one subpipeline step, at least one of p:catch or p:finally, and at most one p:finally.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0075"><span class="deltaxml-old" style="background:#FF5555">p:try</span></a></p></dd><dt id="err.S0076"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0076</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if there are any loops in the connections between steps and variables: no step can refer to a variable if there is any sequence of connections from that step that leads back to the input that provides the context node for the expression that defines the value of the variable.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0076"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0076.1"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></a></p></dd><dt id="err.S0077"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0077</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the value on an attribute of an XProc element does not satisfy the type required for that attribute.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0077"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></p></dd><dt id="err.S0078"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0078</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">When the p:pipe is within an p:output of a compound step, it is a static error if the port identified by the p:pipe is not in the readable ports of the compound step and is not a readable port of a contained step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0078"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a></p></dd><dt id="err.S0079"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0079</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if comments, non-whitespace text nodes, or processing instructions occur as siblings of an element node that would be treated as an implicit inline.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0079"><span class="deltaxml-old" style="background:#FF5555">Implicit inlines</span></a></p></dd><dt id="err.S0080"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0080</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to include more than one p:with-option with the same option name as part of the same step invocation.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0080"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></a></p></dd><dt id="err.S0081"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0081</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If href is specified, it is a static error if any child elements other than p:documentation and p:pipeinfo are present.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0081"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a></p></dd><dt id="err.S0082"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0082</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If pipe is specified, it is a static error any child elements other than p:documentation and p:pipeinfo are present.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0082"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a></p></dd><dt id="err.S0083"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0083</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the value of the code attribute is not a whitespace separated list of EQNames.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0083"><span class="deltaxml-old" style="background:#FF5555">p:catch</span></a></p></dd><dt id="err.S0085"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0085</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if both a href attribute and a pipe attribute are present.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0085"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0085.1"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a></p></dd><dt id="err.S0086"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0086</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to provide more than one p:with-input for the same port.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0086"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a></p></dd><dt id="err.S0087"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0087</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the name attribute on p:option or p:variable has a prefix which is not bound to a namespace.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0087"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0087.1"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a></p></dd><dt id="err.S0088"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0088</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the qualified name of a p:variable shadows the name of a static variable or option.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0088"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0088.1"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a></p></dd><dt id="err.S0089"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0089</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the p:empty binding appears as a sibling of any other binding, including itself.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0089"><span class="deltaxml-old" style="background:#FF5555">p:empty</span></a></p></dd><dt id="err.S0090"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0090</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the value of the pipe attribute contains any tokens not of the form port-name, port-name@step-name, or @step-name. </span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0090"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a></p></dd><dt id="err.S0091"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0091</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if a p:option or p:variable declared before the subpipeline begins shadows another option or variable declared within the same p:declare-step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0091"><span class="deltaxml-old" style="background:#FF5555">Declaring pipelines</span></a></p></dd><dt id="err.S0092"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0092</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if a p:with-option attempts to change the value of an option that is declared static.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0092"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0092.1"><span class="deltaxml-old" style="background:#FF5555">Syntactic Shortcut for Option Values</span></a></p></dd><dt id="err.S0093"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0093</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if visibility is specified on a p:option or p:variable that is not a child of p:library.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0093"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0093.1"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a></p></dd><dt id="err.S0094"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0094</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if a p:variable does not have a select attribute.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0094"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a></p></dd><dt id="err.S0095"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0095</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error to specify that an option is both required and static.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0095"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a></p></dd><dt id="err.S0096"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0096</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the sequence type is not syntactically valid.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0096"><span class="deltaxml-old" style="background:#FF5555">Variable and option types</span></a></p></dd><dt id="err.S0097"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0097</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if an attribute in the XProc namespace appears on an element in the XProc namespace.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0097"><span class="deltaxml-old" style="background:#FF5555">Common Attributes</span></a></p></dd><dt id="err.S0098"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0098</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if a variable is declared as static and the p:variable has a pipe attribute or p:pipe children.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0098"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a></p></dd><dt id="err.S0099"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0099</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if step or port are not valid instances of NCName.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0099"><span class="deltaxml-old" style="background:#FF5555">p:pipe</span></a></p></dd><dt id="err.S0100"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0100</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the pipeline document does not conform to the grammar for pipeline documents.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0100"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></p></dd><dt id="err.S0101"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0101</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the values list is not an XPath sequence of atomic values.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0101"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a></p></dd><dt id="err.S0102"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0102</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if alternative subpipelines have different primary output ports.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0102"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.S0102.1"><span class="deltaxml-old" style="background:#FF5555">p:try</span></a></p></dd><dt id="err.S0103"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0103</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the URI of a p:import-functions element cannot be retrieved or if, once retrieved, it points to a library that the processor cannot import.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0103"><span class="deltaxml-old" style="background:#FF5555">p:import-functions</span></a></p></dd><dt id="err.S0104"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0104</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the processor cannot load the function library.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0104"><span class="deltaxml-old" style="background:#FF5555">p:import-functions</span></a></p></dd><dt id="err.S0105"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0105</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if a function imported from a library has the same name and arity as a function already imported.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0105"><span class="deltaxml-old" style="background:#FF5555">p:import-functions</span></a></p></dd><dt id="err.S0106"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0106</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error if the processor detects that a particular library is unloadable.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0106"><span class="deltaxml-old" style="background:#FF5555">p:import-functions</span></a></p></dd><dt id="err.S0107"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0107</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a static error in XProc if any XPath expression contains a static error (error in expression syntax, references to unknown variables or functions, etc.).</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.S0107"><span class="deltaxml-old" style="background:#FF5555">Initiating a pipeline</span></a></p></dd></dl></div></div></section><section id="app.dynamic-errors" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">F.2 Dynamic Errors</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The following </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic errors</span></a></em><span class="deltaxml-old" style="background:#FF5555"> are defined:</span></p><div id="dynamic-error-summary"><h5><span class="deltaxml-old" style="background:#FF5555">Dynamic Errors</span></h5><dl class="errs"><dt id="err.D0005"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0005</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if more than one document appears on the connection for this input port.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0005"><span class="deltaxml-old" style="background:#FF5555">p:choose</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.D0005.1"><span class="deltaxml-old" style="background:#FF5555">p:when</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.D0005.2"><span class="deltaxml-old" style="background:#FF5555">p:if</span></a></p></dd><dt id="err.D0006"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0006</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If sequence is not specified, or has the value false, then it is a dynamic error unless exactly one document appears on the declared port.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0006"><span class="deltaxml-old" style="background:#FF5555">p:input</span></a></p></dd><dt id="err.D0007"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0007</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">If sequence is not specified on p:output, or has the value false, then it is a dynamic error if the step does not produce exactly one document on the declared port.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0007"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a></p></dd><dt id="err.D0008"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0008</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if a sequence of items appears where an item to be used as the context item is expected.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0008"><span class="deltaxml-old" style="background:#FF5555">Processor XPath Context</span></a></p></dd><dt id="err.D0010"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0010</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the match expression on p:viewport does not match an element or document.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0010"><span class="deltaxml-old" style="background:#FF5555">p:viewport</span></a></p></dd><dt id="err.D0012"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0012</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if any attempt is made to dereference a URI where the scheme of the URI reference is not supported.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0012"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></p></dd><dt id="err.D0015"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0015</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if a QName is specified and it cannot be resolved with the in-scope namespace declarations.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0015"><span class="deltaxml-old" style="background:#FF5555">System Properties</span></a></p></dd><dt id="err.D0016"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0016</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the select expression on a p:input or p:with-input returns anything other than document nodes, element nodes, processing instruction nodes, comment nodes, text nodes or an empty sequence.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0016"><span class="deltaxml-old" style="background:#FF5555">p:input</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.D0016.1"><span class="deltaxml-old" style="background:#FF5555">p:with-input</span></a></p></dd><dt id="err.D0017"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0017</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the running pipeline attempts to invoke a step which the processor does not know how to perform.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0017"><span class="deltaxml-old" style="background:#FF5555">Extension Steps</span></a></p></dd><dt id="err.D0019"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0019</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if any option value does not satisfy the type required for that option.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0019"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></p></dd><dt id="err.D0020"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0020</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the combination of serialization options specified or defaulted is not allowed.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0020"><span class="deltaxml-old" style="background:#FF5555">Serialization parameters</span></a></p></dd><dt id="err.D0021"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0021</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error for a pipeline to attempt to access a resource for which it has insufficient privileges or perform a step which is forbidden.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0021"><span class="deltaxml-old" style="background:#FF5555">Security Considerations</span></a></p></dd><dt id="err.D0022"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0022</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if a processor that does not support PSVI annotations attempts to invoke a step which asserts that they are required.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0022"><span class="deltaxml-old" style="background:#FF5555">PSVIs in XProc</span></a></p></dd><dt id="err.D0026"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0026</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the select expression makes reference to the context node, size, or position when the context item is undefined.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0026"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.D0026.1"><span class="deltaxml-old" style="background:#FF5555">p:option</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.D0026.2"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></a></p></dd><dt id="err.D0028"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0028</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if any attribute value does not satisfy the type required for that attribute.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0028"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></p></dd><dt id="err.D0030"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0030</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if a step is unable or incapable of performing its function.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0030"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></p></dd><dt id="err.D0036"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0036</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the supplied value of a variable or option cannot be converted to the required type.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0036"><span class="deltaxml-old" style="background:#FF5555">Variable and option types</span></a></p></dd><dt id="err.D0038"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0038</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if an input document arrives on a port and it does not match the allowed media types.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0038"><span class="deltaxml-old" style="background:#FF5555">Matching Media Types</span></a></p></dd><dt id="err.D0039"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0039</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the encoding attribute is present and content type value specifies a character set that is not supported by the implementation.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0039"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a></p></dd><dt id="err.D0040"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0040</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the body is not correctly encoded per the value of the encoding attribute.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0040"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a></p></dd><dt id="err.D0042"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0042</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if a document arrives on an output port whose content type is not accepted by the output port specification.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0042"><span class="deltaxml-old" style="background:#FF5555">p:output</span></a></p></dd><dt id="err.D0050"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0050</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the XPath expression in a value template can not be evaluated.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0050"><span class="deltaxml-old" style="background:#FF5555">Value Templates</span></a></p></dd><dt id="err.D0051"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0051</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the XPath expression in an AVT or TVT evaluates to something to other than a sequence containing atomic values or nodes.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0051"><span class="deltaxml-old" style="background:#FF5555">Value Templates</span></a></p></dd><dt id="err.D0052"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0052</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the XPath expression in a TVT evaluates to an attribute and either the parent is not an element or the attribute has a preceding node that it not an attribute.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0052"><span class="deltaxml-old" style="background:#FF5555">Text Value Templates</span></a></p></dd><dt id="err.D0053"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0053</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if a step runs longer than its timeout value.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0053"><span class="deltaxml-old" style="background:#FF5555">Controlling long running steps</span></a></p></dd><dt id="err.D0054"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0054</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if an encoding is specified and the content type is an XML media type.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0054"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a></p></dd><dt id="err.D0055"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0055</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the content type value specifies a character set and the encoding attribute is absent.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0055"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a></p></dd><dt id="err.D0056"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0056</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if an encoding is specified and the content of the p:inline contains any XML markup.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0056"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a></p></dd><dt id="err.D0057"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0057</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the text content does not conform to the JSON grammar.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0057"><span class="deltaxml-old" style="background:#FF5555">Inline JSON content</span></a></p></dd><dt id="err.D0061"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0061</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if $key is of type xs:string and cannot be converted into a xs:Qname.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0061"><span class="deltaxml-old" style="background:#FF5555">Document property</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.D0061.1"><span class="deltaxml-old" style="background:#FF5555">QName handling</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.D0061.2"><span class="deltaxml-old" style="background:#FF5555">QName handling</span></a></p></dd><dt id="err.D0062"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0062</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the document-properties map contains a content-type key and that key has a value that differs from the statically determined content type.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0062"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a></p></dd><dt id="err.D0063"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0063</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the p:inline contains any XML markup and has a content type that is not an XML media type.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0063"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></a></p></dd><dt id="err.D0064"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0064</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the URI is not a valid xs:anyURI.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0064"><span class="deltaxml-old" style="background:#FF5555">p:document</span></a></p></dd><dt id="err.D0065"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0065</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error to refer to the context item, size, or position in a value template if a sequence of documents appears on the default readable port.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0065"><span class="deltaxml-old" style="background:#FF5555">Value Templates</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.D0065.1"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="#err.inline.D0065.2"><span class="deltaxml-old" style="background:#FF5555">p:with-option</span></a></p></dd><dt id="err.D0068"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0068</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the supplied value is neither an instance of xs:QName nor an instance of xs:string.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0068"><span class="deltaxml-old" style="background:#FF5555">QName handling</span></a></p></dd><dt id="err.D0069"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XD0069</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if the string value contains a colon and the designated prefix is not declared in the in-scope namespaces.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.D0069"><span class="deltaxml-old" style="background:#FF5555">QName handling</span></a></p></dd></dl></div></div></section><section id="app.step-errors" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">F.3 Step Errors</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">The following </span><em class="glossterm"><a href="#dt-dynamic-error"><span class="deltaxml-old" style="background:#FF5555">dynamic errors</span></a></em><span class="deltaxml-old" style="background:#FF5555"> can be raised by steps in this specification:</span></p><div id="step-error-summary"><h5><span class="deltaxml-old" style="background:#FF5555">Step Errors</span></h5><dl class="errs"><dt id="err.C0023"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XC0023</span></code></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">It is a dynamic error if a select expression or match pattern returns a node type that is not allowed by the step.</span></p><p><span class="deltaxml-old" style="background:#FF5555">See: </span><a href="#err.inline.C0023"><span class="deltaxml-old" style="background:#FF5555">Common errors</span></a></p></dd></dl></div></div></section></div></article><article id="namespace-fixup-guidance" class="appendix"><header class="appendix-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">G Guidance on Namespace Fixup (Non-Normative)</span></h2></header><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">An XProc processor may find it necessary to add missing namespace declarations to ensure that a document can be serialized. While this process is implementation defined, the purpose of this appendix is to provide guidance as to what an implementation might do to either prevent such situations or fix them as before serialization.</span></p><p><span class="deltaxml-old" style="background:#FF5555">When a namespace binding is generated, the prefix associated with the QName of the element or attribute in question should be used. From an Infoset perspective, this is accomplished by setting the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">[prefix]</span></code><span class="deltaxml-old" style="background:#FF5555"> on the element or attribute. Then when an implementation needs to add a namespace binding, it can reuse that prefix if possible. If reusing the prefix is not possible, the implementation must generate a new prefix that is unique to the in-scope namespace of the element or owner element of the attribute.</span></p><p><span class="deltaxml-old" style="background:#FF5555">An implementation can avoid namespace fixup by making sure that the standard step library does not output documents that require fixup. The following list contains suggestions as to how to accomplish this within the steps:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">Any step that outputs an element in the step vocabulary namespace </span><code class="uri"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/ns/xproc-step</span></code><span class="deltaxml-old" style="background:#FF5555"> must ensure that namespace is declared. An implementation should generate a namespace binding using the prefix “</span><code class="literal"><span class="deltaxml-old" style="background:#FF5555">c</span></code><span class="deltaxml-old" style="background:#FF5555">”.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">When attributes are added by </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:add-attribute</span></code><span class="deltaxml-old" style="background:#FF5555"> or </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:set-attributes</span></code><span class="deltaxml-old" style="background:#FF5555">, the step must ensure the namespace of the attributes added are declared. If the prefix used by the QName is not in the in-scope namespaces of the element on which the attribute was added, the step must add a namespace declaration of the prefix to the in-scope namespaces. If the prefix is amongst the in-scope namespace and is not bound to the same namespace name, a new prefix and namespace binding must be added. When a new prefix is generated, the prefix associated with the attribute should be changed to reflect that generated prefix value. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">When an element is renamed by </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:rename</span></code><span class="deltaxml-old" style="background:#FF5555">, the step must ensure the namespace of the element is declared. If the prefix used by the QName is not in the in-scope namespaces of the element being renamed, the step must add a namespace declaration of the prefix to the in-scope namespaces. If the prefix is amongst the in-scope namespace and is not bound to the same namespace name, a new prefix and namespace binding must be added. When a new prefix is generated, the prefix associated with the element should be changed to reflect that generated prefix value. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If the element does not have a namespace name and there is a default namespace, the default namespace must be undeclared. For each of the child elements, the original default namespace declaration must be preserved by adding a default namespace declaration unless the child element has a different default namespace.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">When an attribute is renamed by </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:rename</span></code><span class="deltaxml-old" style="background:#FF5555">, the step must ensure the namespace of the renamed attribute is declared. If the prefix used by the QName is not in the in-scope namespaces of the element on which the attribute was added, the step must add a namespace declaration of the prefix to the in-scope namespaces. If the prefix is amongst the in-scope namespace and is not bound to the same namespace name, a new prefix and namespace binding must be added. When a new prefix is generated, the prefix associated with the attribute should be changed to reflect that generated prefix value. </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">When an element wraps content via </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:wrap</span></code><span class="deltaxml-old" style="background:#FF5555">, there may be in-scope namespaces coming from ancestor elements of the new wrapper element. The step must ensure the namespace of the element is declared properly. By default, the wrapper element will inherit the in-scope namespaces of the parent element if one exists. As such, there may be a existing namespace declaration or default namespace.</span></p><p><span class="deltaxml-old" style="background:#FF5555">If the prefix used by the QName is not in the in-scope namespaces of the wrapper element, the step must add a namespace declaration of the prefix to the in-scope namespaces. If the prefix is amongst the in-scope namespace and is not bound to the same namespace name, a new prefix and namespace binding must be added. When a new prefix is generated, the prefix associated with the wrapper element should be changed to reflect that generated prefix value. </span></p><p><span class="deltaxml-old" style="background:#FF5555">If the element does not have a namespace name and there is a default namespace, the default namespace must be undeclared. For each of the child elements, the original default namespace declaration must be preserved by adding a default namespace declaration unless the child element has a different default namespace.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">When the wrapper element is added for </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:wrap-sequence</span></code><span class="deltaxml-old" style="background:#FF5555"> or </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pack</span></code><span class="deltaxml-old" style="background:#FF5555">, the prefix used by the QName must be added to the in-scope namespaces.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">When a element is removed via </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:unwrap</span></code><span class="deltaxml-old" style="background:#FF5555">, an in-scope namespaces that are declared on the element must be copied to any child element except when the child element declares the same prefix or declares a new default namespace.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">In the output from </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:xslt</span></code><span class="deltaxml-old" style="background:#FF5555">, if an element was generated from the xsl:element or an attribute from xsl:attribute, the step must guarantee that an namespace declaration exists for the namespace name used. Depending on the XSLT implementation, the namespace declaration for the namespace name of the element or attribute may not be declared. It may also be the case that the original prefix is available. If the original prefix is available, the step should attempt to re-use that prefix. Otherwise, it must generate a prefix for a namespace binding and change the prefix associated the element or attribute.</span></p></li></ol></div></div></article><article id="handling-imports" class="appendix"><header class="appendix-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">H Handling Circular and Re-entrant Library Imports (Non-Normative)</span></h2></header><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">When handling imports, an implementation needs to be able to detect the following situations, and distinguish them from cases where multiple import chains produce genuinely conflicting step definitions:</span></p><div class="orderedlist"><ol style="list-style: decimal;"><li><p><span class="deltaxml-old" style="background:#FF5555">Circular imports: A imports B, B imports A.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Re-entrant imports: A imports B and C, B imports D, C imports D.</span></p></li></ol></div><p><span class="deltaxml-old" style="background:#FF5555">One way to achieve this is as follows:</span></p><p><span id="dt-step-type-exports" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">step type exports</span></em><span class="deltaxml-old" style="background:#FF5555"> of an XProc element, against the background of a set of URIs of resources already visited (call this set </span><em><span class="deltaxml-old" style="background:#FF5555">Visited</span></em><span class="deltaxml-old" style="background:#FF5555">), are defined by cases.]</span></span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#dt-step-type-exports"><span class="deltaxml-old" style="background:#FF5555">step type exports</span></a><span class="deltaxml-old" style="background:#FF5555"> of an XProc element are as follows:</span></p><div class="variablelist"><dl><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">A singleton bag containing the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">type</span></code><span class="deltaxml-old" style="background:#FF5555"> of the element</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">p:library</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The </span><em class="glossterm"><a href="#dt-bag-merger"><span class="deltaxml-old" style="background:#FF5555">bag-merger</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the </span><em class="glossterm"><a href="#dt-step-type-exports"><span class="deltaxml-old" style="background:#FF5555">step type exports</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of all the element's children</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">p:import</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Let </span><em><span class="deltaxml-old" style="background:#FF5555">RU</span></em><span class="deltaxml-old" style="background:#FF5555"> be the actual resolved URI of the resource identified by the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">href</span></code><span class="deltaxml-old" style="background:#FF5555"> of the element. If </span><em><span class="deltaxml-old" style="background:#FF5555">RU</span></em><span class="deltaxml-old" style="background:#FF5555"> is a member of </span><em><span class="deltaxml-old" style="background:#FF5555">Visited</span></em><span class="deltaxml-old" style="background:#FF5555">, then an empty bag, otherwise update </span><em><span class="deltaxml-old" style="background:#FF5555">Visited</span></em><span class="deltaxml-old" style="background:#FF5555"> by adding </span><em><span class="deltaxml-old" style="background:#FF5555">RU</span></em><span class="deltaxml-old" style="background:#FF5555"> to it, and return the </span><em class="glossterm"><a href="#dt-step-type-exports"><span class="deltaxml-old" style="background:#FF5555">step type exports</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the document element of the retrieved representation</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">all other elements</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">An empty bag</span></p></dd></dl></div><p><span class="deltaxml-old" style="background:#FF5555">The changes to </span><em><span class="deltaxml-old" style="background:#FF5555">Visited</span></em><span class="deltaxml-old" style="background:#FF5555"> mandated by the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">p:import</span></code><span class="deltaxml-old" style="background:#FF5555"> case above are persistent, not scoped. That is, not only the recursive processing of the imported resource but also subsequent processing of siblings and ancestors must be against the background of the updated value. In practice this means either using a side-effected global variable, or not only passing </span><em><span class="deltaxml-old" style="background:#FF5555">Visited</span></em><span class="deltaxml-old" style="background:#FF5555"> as an argument to any recursive or iterative processing, but also </span><em><span class="deltaxml-old" style="background:#FF5555">returning</span></em><span class="deltaxml-old" style="background:#FF5555"> its updated value for subsequent use, along with the bag of step types.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Given a pipeline library document with actual resolved URI </span><em><span class="deltaxml-old" style="background:#FF5555">DU</span></em><span class="deltaxml-old" style="background:#FF5555">, </span><a id="err.inline.S0036.1"></a><span class="deltaxml-old" style="background:#FF5555">it is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0036"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0036</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><em class="glossterm"><a href="#dt-step-type-exports"><span class="deltaxml-old" style="background:#FF5555">step type exports</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the document element of the retrieved representation, against the background of a singleton set containing </span><em><span class="deltaxml-old" style="background:#FF5555">DU</span></em><span class="deltaxml-old" style="background:#FF5555"> as the initial </span><em><span class="deltaxml-old" style="background:#FF5555">Visited</span></em><span class="deltaxml-old" style="background:#FF5555"> set, contains any duplicates.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Given a top-level pipeline document with actual resolved URI </span><em><span class="deltaxml-old" style="background:#FF5555">DU</span></em><span class="deltaxml-old" style="background:#FF5555">, </span><a id="err.inline.S0036.2"></a><span class="deltaxml-old" style="background:#FF5555">it is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0036"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0036</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><em class="glossterm"><a href="#dt-bag-merger"><span class="deltaxml-old" style="background:#FF5555">bag-merger</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the </span><em class="glossterm"><a href="#dt-step-type-exports"><span class="deltaxml-old" style="background:#FF5555">step type exports</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the document element of the retrieved representation with the </span><em class="glossterm"><a href="#dt-step-type-exports"><span class="deltaxml-old" style="background:#FF5555">step type exports</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of its children, against the background of a singleton set containing </span><em><span class="deltaxml-old" style="background:#FF5555">DU</span></em><span class="deltaxml-old" style="background:#FF5555"> as the initial </span><em><span class="deltaxml-old" style="background:#FF5555">Visited</span></em><span class="deltaxml-old" style="background:#FF5555"> set, contains any duplicates.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Given a non-top-level </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code><span class="deltaxml-old" style="background:#FF5555"> element, </span><a id="err.inline.S0036.3"></a><span class="deltaxml-old" style="background:#FF5555">it is a </span><em class="glossterm"><a href="#dt-static-error"><span class="deltaxml-old" style="background:#FF5555">static error</span></a></em><span class="deltaxml-old" style="background:#FF5555"> (</span><a href="#err.S0036"><code class="errqname"><span class="deltaxml-old" style="background:#FF5555">err:XS0036</span></code></a><span class="deltaxml-old" style="background:#FF5555">) if the </span><em class="glossterm"><a href="#dt-bag-merger"><span class="deltaxml-old" style="background:#FF5555">bag-merger</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of the </span><em class="glossterm"><a href="#dt-step-type-exports"><span class="deltaxml-old" style="background:#FF5555">step type exports</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of its parent with the </span><em class="glossterm"><a href="#dt-step-type-exports"><span class="deltaxml-old" style="background:#FF5555">step type exports</span></a></em><span class="deltaxml-old" style="background:#FF5555"> of its children, against the background of a copy of the </span><em><span class="deltaxml-old" style="background:#FF5555">Visited</span></em><span class="deltaxml-old" style="background:#FF5555"> set of its parent as the initial </span><em><span class="deltaxml-old" style="background:#FF5555">Visited</span></em><span class="deltaxml-old" style="background:#FF5555"> set, contains any duplicates.</span></p><p><span class="deltaxml-old" style="background:#FF5555">The phrase "a copy of the </span><em><span class="deltaxml-old" style="background:#FF5555">Visited</span></em><span class="deltaxml-old" style="background:#FF5555"> set" in the preceding paragraph is meant to indicate that checking of non-top-level </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></code><span class="deltaxml-old" style="background:#FF5555"> elements does </span><em><span class="deltaxml-old" style="background:#FF5555">not</span></em><span class="deltaxml-old" style="background:#FF5555"> have a persistent impact on the checking of its parent. The contrast is that whereas changes to </span><em><span class="deltaxml-old" style="background:#FF5555">Visited</span></em><span class="deltaxml-old" style="background:#FF5555"> pass both up </span><em><span class="deltaxml-old" style="background:#FF5555">and</span></em><span class="deltaxml-old" style="background:#FF5555"> down through </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">p:import</span></code><span class="deltaxml-old" style="background:#FF5555">, they pass only </span><em><span class="deltaxml-old" style="background:#FF5555">down</span></em><span class="deltaxml-old" style="background:#FF5555"> through </span><em><span class="deltaxml-old" style="background:#FF5555">p:declare-step</span></em><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span id="dt-bag-merger" class="termdef"><span class="deltaxml-old" style="background:#FF5555">[Definition: The </span><em class="glossterm"><span class="deltaxml-old" style="background:#FF5555">bag-merger</span></em><span class="deltaxml-old" style="background:#FF5555"> of two or more bags (where a bag is an unordered list or, equivalently, something like a set except that it may contain duplicates) is a bag constructed by starting with an empty bag and adding each member of each of the input bags in turn to it. It follows that the cardinality of the result is the sum of the cardinality of all the input bags.]</span></span></p></div></article><article id="parallelism" class="appendix"><header class="appendix-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">I Sequential steps, parallelism, and side-effects</span></h2></header><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">XProc imposes as few constraints on the order in which steps must be evaluated as possible and almost no constraints on parallel execution.</span></p><p><span class="deltaxml-old" style="background:#FF5555">In the simple, and we believe overwhelmingly common case, inputs flow into the pipeline, through the pipeline from one step to the next, and results are produced at the end. The order of the steps is constrained by the input/output connections between them. Implementations are free to execute them in a purely sequential fashion or in parallel, as they see fit. The results are the same in either case.</span></p><p><span class="deltaxml-old" style="background:#FF5555">This is not true for pipelines which rely on side effects, such as the state of the filesystem or the state of the web. Consider the following pipeline:</span></p><pre class="programlisting language-none line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:xslt name="generate-stylesheet"&gt; &lt;p:with-input port="source" href="someURI"/&gt; &lt;p:with-input port="stylesheet" href="someOtherURI"/&gt; &lt;/p:xslt&gt; &lt;p:store name="save-xslt" href="gen-style.xsl"/&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">There's no guarantee that “style” step will execute after the “save-xslt” step. In this case, the solution is straightforward. Even if you need the saved stylesheet, you don't need to rely on it in your pipeline:</span></p><pre class="programlisting language-none line-numbers"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:xslt name="generate-stylesheet"&gt; &lt;p:with-input port="source" href="someURI"/&gt; &lt;p:with-input port="stylesheet" href="someOtherURI"/&gt; &lt;/p:xslt&gt; &lt;p:store name="save-xslt" href="gen-style.xsl"/&gt;</span></code></pre><p><span class="deltaxml-old" style="background:#FF5555">Now the result is independent of the implementation strategy.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Implementations are free to invent additional control structures using </span><a href="#p.pipeinfo"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:pipeinfo</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#extension-attributes"><span class="deltaxml-old" style="background:#FF5555">extension attributes</span></a><span class="deltaxml-old" style="background:#FF5555"> to provide greater control over parallelism in their implementations.</span></p></div></article><article id="xproc-media-type" class="appendix"><header class="appendix-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">J The </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">application/xproc+xml</span></code><span class="deltaxml-old" style="background:#FF5555"> media type</span></h2></header><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">This appendix registers a new MIME media type, “</span><span class="quote"><code class="code"><span class="deltaxml-old" style="background:#FF5555">application/xproc+xml</span></code></span><span class="deltaxml-old" style="background:#FF5555">”.</span></p><section id="media-type-registration" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">J.1 Registration of MIME media type application/xproc+xml</span></h2></div><div class="content"><div class="variablelist"><dl><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">MIME media type name:</span></span></dt><dd><p><code class="code"><span class="deltaxml-old" style="background:#FF5555">application</span></code></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">MIME subtype name:</span></span></dt><dd><p><code class="code"><span class="deltaxml-old" style="background:#FF5555">xproc+xml</span></code></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Required parameters:</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">None. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Optional parameters:</span></span></dt><dd><div class="variablelist"><dl><dt><span class="term"><code class="code"><span class="deltaxml-old" style="background:#FF5555">charset</span></code></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">This parameter has identical semantics to the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">charset</span></code><span class="deltaxml-old" style="background:#FF5555"> parameter of the </span><code class="code"><span class="deltaxml-old" style="background:#FF5555">application/xml</span></code><span class="deltaxml-old" style="background:#FF5555"> media type as specified in [</span><a href="#rfc3023"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 3023</span></span></a><span class="deltaxml-old" style="background:#FF5555">] or its successors. </span></p></dd></dl></div></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Encoding considerations:</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">By virtue of XProc content being XML, it has the same considerations when sent as “</span><span class="quote"><code class="code"><span class="deltaxml-old" style="background:#FF5555">application/xproc+xml</span></code></span><span class="deltaxml-old" style="background:#FF5555">” as does XML. See [</span><a href="#rfc3023"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 3023</span></span></a><span class="deltaxml-old" style="background:#FF5555">], Section 3.2. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Security considerations:</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Several XProc elements may refer to arbitrary URIs. In this case, the security issues of [</span><a href="#rfc2396"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 2396</span></span></a><span class="deltaxml-old" style="background:#FF5555">], section 7, should be considered.</span></p><p><span class="deltaxml-old" style="background:#FF5555">In addition, because of the extensibility features of XProc, it is possible that “application/xproc+xml” may describe content that has security implications beyond those described here. However, only in the case where the processor recognizes and processes the additional content, or where further processing of that content is dispatched to other processors, would security issues potentially arise. And in that case, they would fall outside the domain of this registration document.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Interoperability considerations:</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">This specification describes processing semantics that dictate behavior that must be followed when dealing with, among other things, unrecognized elements.</span></p><p><span class="deltaxml-old" style="background:#FF5555">Because XProc is extensible, conformant "application/xproc+xml" processors can expect that content received is well-formed XML, but it cannot be guaranteed that the content is valid XProc or that the processor will recognize all of the elements and attributes in the document.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Published specification:</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">This media type registration is for XProc documents as described by this specification which is located at </span><a href="http://www.w3.org/TR/xproc/"><span class="deltaxml-old" style="background:#FF5555">http://www.w3.org/TR/xproc/</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Applications which use this media type:</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">There is no experimental, vendor specific, or personal tree predecessor to “</span><span class="quote"><code class="code"><span class="deltaxml-old" style="background:#FF5555">application/xproc+xml</span></code></span><span class="deltaxml-old" style="background:#FF5555">”, reflecting the fact that no applications currently recognize it. This new type is being registered in order to allow for the deployment of XProc on the World Wide Web, as a first class XML application. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Additional information:</span></span></dt><dd><div class="variablelist"><dl><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Magic number(s):</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">There is no single initial octet sequence that is always present in XProc documents. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">File extension(s):</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">XProc documents are most often identified with the extension “</span><span class="quote"><code class="filename"><span class="deltaxml-old" style="background:#FF5555">.xpl</span></code></span><span class="deltaxml-old" style="background:#FF5555">”. </span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Macintosh File Type Code(s):</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">TEXT</span></p></dd></dl></div></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Person &amp; email address to contact for further information:</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">Norman Walsh, </span><code class="email"><span class="deltaxml-old" style="background:#FF5555">&lt;</span><a href="mailto:Norman.Walsh@MarkLogic.com"><span class="deltaxml-old" style="background:#FF5555">Norman.Walsh@MarkLogic.com</span></a><span class="deltaxml-old" style="background:#FF5555">&gt;</span></code><span class="deltaxml-old" style="background:#FF5555">.</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Intended usage:</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">COMMON</span></p></dd><dt><span class="term"><span class="deltaxml-old" style="background:#FF5555">Author/Change controller:</span></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">The XProc specification is a work product of the World Wide Web Consortium's XML Processing Model Working Group. The W3C has change control over these specifications.</span></p></dd></dl></div></div></section><section id="fragid" class="section"><div class="section-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">J.2 Fragment Identifiers</span></h2></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">For documents labeled as “</span><span class="quote"><code class="code"><span class="deltaxml-old" style="background:#FF5555">application/xproc+xml</span></code></span><span class="deltaxml-old" style="background:#FF5555">”, the fragment identifier notation is exactly that for “</span><span class="quote"><code class="code"><span class="deltaxml-old" style="background:#FF5555">application/xml</span></code></span><span class="deltaxml-old" style="background:#FF5555">”, as specified in [</span><a href="#rfc3023"><span class="abbrev"><span class="deltaxml-old" style="background:#FF5555">RFC 3023</span></span></a><span class="deltaxml-old" style="background:#FF5555">] or its successors.</span></p></div></section></div></article><article id="ancillary-files" class="appendix"><header class="appendix-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">K Ancillary files</span></h2></header><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">This specification includes by reference a number of ancillary files.</span></p><div class="variablelist"><dl><dt><span class="term"><a href="xproc30.rnc"><span class="deltaxml-old" style="background:#FF5555">xproc30.rnc</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="xproc30.rng"><span class="deltaxml-old" style="background:#FF5555">xproc30.rng</span></a></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">A RELAX NG Schema for XProc 3.0 pipelines, in compact or XML form. </span></p></dd><dt><span class="term"><a href="xproc10.rnc"><span class="deltaxml-old" style="background:#FF5555">xproc10.rnc</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="xproc10.rng"><span class="deltaxml-old" style="background:#FF5555">xproc10.rng</span></a></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">A RELAX NG Schema for XProc 1.0 pipelines, in compact or XML form. </span></p></dd><dt><span class="term"><a href="xproc.rnc"><span class="deltaxml-old" style="background:#FF5555">xproc.rnc</span></a><span class="deltaxml-old" style="background:#FF5555">, </span><a href="xproc.rng"><span class="deltaxml-old" style="background:#FF5555">xproc.rng</span></a></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">A RELAX NG Schema for XProc pipelines, in compact or XML form. It will validate either XProc 1.0 pipelines or XProc 3.0 pipelines, depending on the value of the version attribute. </span></p><p><span class="deltaxml-old" style="background:#FF5555">In order to use this schema, you must also download the 1.0 and 3.0 schemas; they are included into this one.</span></p></dd><dt><span class="term"><a href="library.xpl"><span class="deltaxml-old" style="background:#FF5555">library.xpl</span></a></span></dt><dd><p><span class="deltaxml-old" style="background:#FF5555">An XProc pipeline library that declares all of the standard built-in steps. </span></p></dd></dl></div></div></article><article id="credits" class="appendix"><header class="appendix-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">L</span><span class="deltaxml-new" style="background:#90EE90">A</span> Credits</h2></header><div class="content"><p>This document is derived from <a href="https://www.w3.org/TR/2010/REC-xproc-20100511/">XProc: An XML Pipeline Language</a> published by the W3C. It was developed by the <em class="citetitle">XML Processing Model Working Group</em> and edited by Norman Walsh, Alex Miłowski, and Henry Thompson.</p><p>The editors of this specification extend their gratitude to everyone who contributed to this document and all of the versions that came before it.</p></div></article><article id="changelog" class="appendix"><header class="appendix-titlepage"><h2><span class="deltaxml-old" style="background:#FF5555">M Change Log</span></h2></header><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">This appendix summarizes significant changes in this draft.</span></p><p><span class="deltaxml-old" style="background:#FF5555">This First Public Working Draft contains a number of significant changes to the XProc pipeline language. Future drafts will attempt to address </span><a href="https://github.com/xproc/specification/issues?q=is%3Aopen+is%3Aissue"><span class="deltaxml-old" style="background:#FF5555">the remaining issues</span></a><span class="deltaxml-old" style="background:#FF5555">.</span></p><p><span class="deltaxml-old" style="background:#FF5555">In this draft:</span></p><div class="itemizedlist"><ul><li><p><span class="deltaxml-old" style="background:#FF5555">An attempt has been made to simplify how parameters are handled. There are no more parameter input ports. Instead, parameters are handled with a map and an otherwise ordinary option named “</span><code class="code"><span class="deltaxml-old" style="background:#FF5555">parameters</span></code><span class="deltaxml-old" style="background:#FF5555">”. (See issue </span><a href="https://github.com/xproc/specification/issues/28"><span class="deltaxml-old" style="background:#FF5555">#28</span></a><span class="deltaxml-old" style="background:#FF5555">) </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Documents have accessible, arbitrary metadata (key/value pairs). (See issue </span><a href="https://github.com/xproc/specification/issues/46"><span class="deltaxml-old" style="background:#FF5555">#46</span></a><span class="deltaxml-old" style="background:#FF5555">) </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Non-XML documents can flow between steps. (See issue </span><a href="https://github.com/xproc/specification/issues/29"><span class="deltaxml-old" style="background:#FF5555">#29</span></a><span class="deltaxml-old" style="background:#FF5555">) </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Option shortcut attributes can contain </span><a href="#attribute-value-templates"><span class="deltaxml-old" style="background:#FF5555">attribute value templates</span></a><span class="deltaxml-old" style="background:#FF5555"> and inline XML can contain </span><a href="#text-value-templates"><span class="deltaxml-old" style="background:#FF5555">text value templates</span></a><span class="deltaxml-old" style="background:#FF5555">. (See issues </span><a href="https://github.com/xproc/specification/issues/33"><span class="deltaxml-old" style="background:#FF5555">#33</span></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="https://github.com/xproc/specification/issues/39"><span class="deltaxml-old" style="background:#FF5555">#39</span></a><span class="deltaxml-old" style="background:#FF5555">) </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#p.variable"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:variable</span></code></a><span class="deltaxml-old" style="background:#FF5555"> and </span><a href="#p.option"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:option</span></code></a><span class="deltaxml-old" style="background:#FF5555"> elements may specify a value type. (See issue </span><a href="https://github.com/xproc/specification/issues/62"><span class="deltaxml-old" style="background:#FF5555">#62</span></a><span class="deltaxml-old" style="background:#FF5555">) </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#p.inline"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:inline</span></code></a><span class="deltaxml-old" style="background:#FF5555"> can be omitted when the result is unambiguous. (See issue </span><a href="https://github.com/xproc/specification/issues/38"><span class="deltaxml-old" style="background:#FF5555">#38</span></a><span class="deltaxml-old" style="background:#FF5555">) </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The </span><a href="#p.try"><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:try</span></code></a><span class="deltaxml-old" style="background:#FF5555"> step has been enhanced. (See issue </span><a href="https://github.com/xproc/specification/issues/50"><span class="deltaxml-old" style="background:#FF5555">#50</span></a><span class="deltaxml-old" style="background:#FF5555">) </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">All steps have a primary output port. (See issue </span><a href="https://github.com/xproc/specification/issues/41"><span class="deltaxml-old" style="background:#FF5555">#41</span></a><span class="deltaxml-old" style="background:#FF5555">) </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">The specification has been split into a language specification and standard step library specification. (See issue </span><a href="https://github.com/xproc/specification/issues/53"><span class="deltaxml-old" style="background:#FF5555">#53</span></a><span class="deltaxml-old" style="background:#FF5555">) </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">A version option has been added to </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:validate-with-xml-schema</span></code><span class="deltaxml-old" style="background:#FF5555">. (See issue </span><a href="https://github.com/xproc/specification/issues/83"><span class="deltaxml-old" style="background:#FF5555">#83</span></a><span class="deltaxml-old" style="background:#FF5555">) </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">A version option has been added to </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:xquery</span></code><span class="deltaxml-old" style="background:#FF5555"> (See issue </span><a href="https://github.com/xproc/specification/issues/84"><span class="deltaxml-old" style="background:#FF5555">#84</span></a><span class="deltaxml-old" style="background:#FF5555">) </span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">Support for XPath 1.0 has been removed. (See issue </span><a href="https://github.com/xproc/specification/issues/52"><span class="deltaxml-old" style="background:#FF5555">#52</span></a><span class="deltaxml-old" style="background:#FF5555">) </span></p></li></ul></div></div></article></article><script src="js/prism.js"></script></body></html>